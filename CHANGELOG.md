## Changelog v0.4.4 (2025-05-12)

### Новые возможности

1. **Система управления пользователями и группами**
   - Реализовано мягкое удаление пользователей с отстройкой перед полным удалением
   - Добавлено окончательное удаление пользователей через Админку
   - Внедрен CRUD-интерфейс для управления группами пользователей

2. **Фоновые задачи через CLI**
   - Добавлена возможность выполнения запланированных задач через cron
   - Реализован CLI-запуск через `index.php` с аргументами командной строки

3. **Расширение функционала пользователей**
   - Добавлены новые поля в таблицу `users` для будущих улучшений.

4. **Улучшенный поиск в Админке**
   - Переведен поиск пользователей на полнотекстовый (FTS).

---

### Исправления

1. **Оптимизация кода**
   - Проведен рефакторинг приватных методов (единообразие с префиксом '_')
   - Устранены утечки памяти при работе с кешем

2. **Исправление багов**
   - Починен поиск пользователей с нестандартными символами
   - Мелкиеисправления в коде и HTML-формах

3. **Безопасность**
   - Усилена валидация CSRF-токенов для операций удаления
   - Добавлена проверка прав доступа для критических операций

---

### Документация

- Обновлена Doxygen-информация до версии 0.4.4

---

### Технические изменения

1. **База данных**
   - Добавлены новые индексы для ускорения поиска
   - Оптимизированы запросы для работы с мягким удалением

2. **Зависимости**
   - Обновлены библиотеки для работы с CLI
   - Добавлены новые пакеты для обработки JSON-полей

---

## Changelog v0.4.3 (2025-05-05)

### Новые возможности

1. **Поддержка нескольких SQL-форматов через метод `with_sql_format()`**
   - Добавлено свойство `$current_format` (по умолчанию: `mysql`).
   - Список поддерживаемых форматов: `mysql`, `pgsql`, `sqlite`.
   - Метод `with_sql_format()`:
     - Позволяет временно изменить формат SQL.
     - Автоматически восстанавливает исходный формат после выполнения коллбэка.
   - Обновлены методы:
     - `convert_query()`: адаптирован для работы с разными форматами SQL.
     - Методы, используемые в `format_date()`: также поддерживают разные диалекты SQL.

2. **Реализовано кеширование данных в конструкторе класса Database**
   - Данные из хранилища (`format_cache`, `query_cache`, `unescape_cache`) загружаются при создании объекта.
   - Это ускоряет работу и уменьшает нагрузку на обработку SQL-запросов.

3. **Добавлена поддержка гибких условий в запросах WHERE**
   - Поддерживаются условия: `AND`, `OR`, `NOT`.
   - Возможна передача параметров извне: `WHERE`, `ORDER BY`, `GROUP BY`, `LIMIT`.

4. **Полнотекстовый поиск по сайту**
   - Реализовано создание TSVECTOR-полей `tsv_weighted`
   - Созданы GIN-индексы для оптимизации.

---

### Исправления

1. **Использование одинарных кавычек в строках без переменных**
   - Все строки, не требующие интерполяции, переведены на `'...'`.
   - Двойные кавычки оставлены только там, где нужна подстановка переменных.

2. **Мелкие баги**
   - Исправлены ошибки в работе с кешем.
   - Исправлены проблемы логирования в файл.

3. **Документация**
   - Обновлены разделы по новым возможностям.
   - Исправлены неточности в описаниях файлов и методов.

---

### Документация

- Обновлена до версии `0.4.3`.
- Все изменения отражены в автоматически сгенерированной Doxygen-документации.

---

## Changelog v0.4.2 (2025-04-27)

### Новые возможности
1. **Добавлена поддержка кеширования через `Cache_Handler`**:
   - Добавлен интерфейс `Cache_Handler_Interface` и класс `Cache_Handler` для работы с различными типами кеширования:
     - Файловое кеширование (`file`).
     - Redis.
     - Memcached.
   - Класс обеспечивает проверку актуальности данных, запись в кеш, инициализацию системы кеширования и обработку ошибок через исключения.
   - В файл `config.php` добавлен блок настроек для кеширования:
     ```php
     $config['cache'] = [
         'type'      => 'file', // Тип кеширования (file, redis, memcached).
         'cache_dir' => '/path/to/cache', // Путь к директории для файлового кеширования.
         'host'      => '127.0.0.1', // Хост для Redis/Memcached.
         'port'      => 6379, // Порт для Redis/Memcached.
     ];
     ```
   - Интеграция кеширования в класс `Work`:
     - Метод `load_cached_config()` переписан для использования функционала из `Cache_Handler_Interface`.

2. **Улучшена работа с языками через класс `Work`**:
   - Полностью переработан метод `set_lang()`:
     - Метод больше не принимает аргументы.
     - Автоматически сканирует языковые директории на наличие файлов.
     - Добавлена поддержка нескольких директорий для поиска языковых файлов.
   - Интегрирована система кеширования через `Cache_Handler` для оптимизации загрузки языковых данных.

3. **Добавлена поддержка SQLite (в тестовом режиме)**:
   - Реализована возможность работы с SQLite для тестирования запросов в СУБД.

### Исправления
1. **Добавлена динамическая подстановка языка в `<html lang="...">`**:
   - Язык теперь определяется на основе выбранного языка сайта или профиля пользователя.
   - Исправлена проблема с некорректным или статическим указанием языка, что важно для SEO и доступности.

2. **Обновлены дампы базы данных для MySQL и PostgreSQL**:
   - Обновлены файлы дампов базы данных:
     - `sql/MySQL/photorigma.sql` (для MySQL).
     - `sql/PostgreSQL/photorigma.sql` (для PostgreSQL).

3. **Исправлено игнорирование экранированных обратных кавычек при конвертировании запросов в СУБД**:
   - Устранена проблема с обработкой экранированных символов в SQL-запросах.

### Важные замечания
1. **Настройки кеширования**:
   - Настройки кеширования находятся в файле `config.php` (массив `$config['cache']`).
   - Убедитесь, что параметры соответствуют вашей системе:
     - Для файлового кеширования (`type = 'file'`) проверьте доступность и права записи в директорию, указанную в `cache_dir`.
     - Для Redis или Memcached убедитесь, что сервис запущен и доступен по указанным `host` и `port`.
     - Если параметры не настроены корректно, система будет использовать значение по умолчанию (`type = 'file'`), что может повлиять на производительность.

2. **Языковые файлы**:
   - Убедитесь, что языковые файлы находятся в корректных директориях.

3. **SQLite**:
   - Поддержка SQLite реализована в тестовом режиме. Рекомендуется использовать только для отладки и тестирования.

---

## Changelog v0.4.1 (2025-04-25)

### Новые возможности
- **Кеширование настроек проекта**:
  Добавлен механизм кеширования настроек проекта, хранящихся в СУБД. Это улучшает производительность при работе с часто используемыми данными.
- **Кеширование настроек сайта**:
  Реализовано кеширование настроек сайта.

### Исправления
- Исправлены мелкие баги, связанные с безопасностью данных.
  *(Примечание: подробное описание проблем безопасности не раскрывается для предотвращения потенциальных уязвимостей.)*

### Улучшения производительности
- Реализовано кеширование настроек проекта и сайта, что снижает нагрузку на базу данных и ускоряет доступ к данным.

### Рефакторинг
- Интерфейсы вынесены в отдельные файлы и пространства имён.
- Файл `include/common.php` разделён на три файла:
  - `constants.php` (константы),
  - `session_init.php` (инициализация сессий),
  - `functions.php` (вспомогательные функции).

### Документация
- Обновлена документация до версии `0.4.1`.
- Добавлены новые разделы по работе с кешированием настроек проекта и сайта.
- Улучшено описание общего функционала проекта.

### В процессе разработки
- Ведётся тестирование поддержки SQLite в проекте.

---

## Changelog v0.4.0+hotfix (2025-04-07)

### Рефакторинг
- Полный рефакторинг проекта.
