<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="ru">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Photo-Rigma-BiZ: Класс Database</title>
<link rel="icon" href="../../favicon.ico" type="image/x-icon" />
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../clipboard.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../logo-1.png"/></td>
  <td id="projectalign">
   <div id="projectname">Photo-Rigma-BiZ<span id="projectnumber">&#160;0.4.4</span>
   </div>
   <div id="projectbrief">Gallery_Photo-Rigma-BiZ</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Создано системой Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(1); });
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Поиск',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('d6/db6/classPhotoRigma_1_1Classes_1_1Database.html','../../'); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Загрузка...</div>
<div class="SRStatus" id="Searching">Поиск...</div>
<div class="SRStatus" id="NoMatches">Не найдено</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Открытые члены</a> &#124;
<a href="#pro-methods">Защищенные члены</a> &#124;
<a href="#pri-methods">Закрытые члены</a> &#124;
<a href="#pri-attribs">Закрытые данные</a> &#124;
<a href="../../d6/d06/classPhotoRigma_1_1Classes_1_1Database-members.html">Полный список членов класса</a>  </div>
  <div class="headertitle"><div class="title">Класс Database</div></div>
</div><!--header-->
<div class="contents">

<p>Класс для работы с базами данных через PDO.  
 <a href="#details">Подробнее...</a></p>
<div id="dynsection-0" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="../../closed.png" alt="+"/> Граф наследования:Database:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d8/d4b/classPhotoRigma_1_1Classes_1_1Database__inherit__graph.png" border="0" usemap="#aDatabase_inherit__map" alt="Inheritance graph"/></div>
<map name="aDatabase_inherit__map" id="aDatabase_inherit__map">
<area shape="rect" title="Класс для работы с базами данных через PDO." alt="" coords="34,78,111,103"/>
<area shape="rect" href="../../d7/dc2/interfacePhotoRigma_1_1Interfaces_1_1Database__Interface.html" title="Интерфейс для работы с базами данных через PDO." alt="" coords="5,5,140,30"/>
<area shape="poly" title=" " alt="" coords="75,46,75,78,70,78,70,46"/>
</map>
<center><span class="legend">[<a target="top" href="../../graph_legend.html">см. легенду</a>]</span></center></div>
<div id="dynsection-1" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-1-trigger" src="../../closed.png" alt="+"/> Граф связей класса Database:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d7/d5e/classPhotoRigma_1_1Classes_1_1Database__coll__graph.png" border="0" usemap="#aDatabase_coll__map" alt="Collaboration graph"/></div>
<map name="aDatabase_coll__map" id="aDatabase_coll__map">
<area shape="rect" title="Класс для работы с базами данных через PDO." alt="" coords="122,92,199,117"/>
<area shape="rect" href="../../d7/dc2/interfacePhotoRigma_1_1Interfaces_1_1Database__Interface.html" title="Интерфейс для работы с базами данных через PDO." alt="" coords="5,5,140,30"/>
<area shape="poly" title=" " alt="" coords="97,39,151,90,147,94,93,43"/>
<area shape="rect" href="../../d1/d44/interfacePhotoRigma_1_1Interfaces_1_1Cache__Handler__Interface.html" title="Интерфейс для работы с системами кеширования." alt="" coords="164,5,333,30"/>
<area shape="poly" title=" " alt="" coords="228,43,174,94,170,90,224,39"/>
</map>
<center><span class="legend">[<a target="top" href="../../graph_legend.html">см. легенду</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Открытые члены</h2></td></tr>
<tr class="memitem:af990525891a72f6449a5f72b35c4026f" id="r_af990525891a72f6449a5f72b35c4026f"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#af990525891a72f6449a5f72b35c4026f">__construct</a> (array $db_config, <a class="el" href="../../d1/d44/interfacePhotoRigma_1_1Interfaces_1_1Cache__Handler__Interface.html">Cache_Handler_Interface</a> $cache)</td></tr>
<tr class="memdesc:af990525891a72f6449a5f72b35c4026f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Конструктор класса.  <br /></td></tr>
<tr class="separator:af990525891a72f6449a5f72b35c4026f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a421831a265621325e1fdd19aace0c758" id="r_a421831a265621325e1fdd19aace0c758"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a421831a265621325e1fdd19aace0c758">__destruct</a> ()</td></tr>
<tr class="memdesc:a421831a265621325e1fdd19aace0c758"><td class="mdescLeft">&#160;</td><td class="mdescRight">Деструктор класса Database.  <br /></td></tr>
<tr class="separator:a421831a265621325e1fdd19aace0c758"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afc4126846a2eb1bc11d7418b8f120ecf" id="r_afc4126846a2eb1bc11d7418b8f120ecf"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#afc4126846a2eb1bc11d7418b8f120ecf">begin_transaction</a> (string $context='')</td></tr>
<tr class="memdesc:afc4126846a2eb1bc11d7418b8f120ecf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Начинает транзакцию в базе данных.  <br /></td></tr>
<tr class="separator:afc4126846a2eb1bc11d7418b8f120ecf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a71aacc1f4ddbd5575362b54ac80cd0d7" id="r_a71aacc1f4ddbd5575362b54ac80cd0d7"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a71aacc1f4ddbd5575362b54ac80cd0d7">commit_transaction</a> (string $context='')</td></tr>
<tr class="memdesc:a71aacc1f4ddbd5575362b54ac80cd0d7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Подтверждает транзакцию в базе данных.  <br /></td></tr>
<tr class="separator:a71aacc1f4ddbd5575362b54ac80cd0d7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a73d8e6acdfb996002f980ab7c9c18515" id="r_a73d8e6acdfb996002f980ab7c9c18515"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a73d8e6acdfb996002f980ab7c9c18515">delete</a> (string $from_tbl, array $options=[])</td></tr>
<tr class="memdesc:a73d8e6acdfb996002f980ab7c9c18515"><td class="mdescLeft">&#160;</td><td class="mdescRight">Удаляет данные из таблицы через вызов внутреннего метода.  <br /></td></tr>
<tr class="separator:a73d8e6acdfb996002f980ab7c9c18515"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac0e58b1bf2a72bbbaa896b9849ed0e42" id="r_ac0e58b1bf2a72bbbaa896b9849ed0e42"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac0e58b1bf2a72bbbaa896b9849ed0e42">format_date</a> (string $column, string $format)</td></tr>
<tr class="memdesc:ac0e58b1bf2a72bbbaa896b9849ed0e42"><td class="mdescLeft">&#160;</td><td class="mdescRight">Формирует SQL-выражение для форматирования даты с учетом специфики используемой СУБД.  <br /></td></tr>
<tr class="separator:ac0e58b1bf2a72bbbaa896b9849ed0e42"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2c437dae4e310529391e7f5388b133ba" id="r_a2c437dae4e310529391e7f5388b133ba"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a2c437dae4e310529391e7f5388b133ba">get_affected_rows</a> ()</td></tr>
<tr class="memdesc:a2c437dae4e310529391e7f5388b133ba"><td class="mdescLeft">&#160;</td><td class="mdescRight">Возвращает количество строк, затронутых последним SQL-запросом.  <br /></td></tr>
<tr class="separator:a2c437dae4e310529391e7f5388b133ba"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abafff8c03a52d73e37072449448e5a3c" id="r_abafff8c03a52d73e37072449448e5a3c"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#abafff8c03a52d73e37072449448e5a3c">get_last_insert_id</a> ()</td></tr>
<tr class="memdesc:abafff8c03a52d73e37072449448e5a3c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Возвращает ID последней вставленной строки.  <br /></td></tr>
<tr class="separator:abafff8c03a52d73e37072449448e5a3c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6e5af1f386c0c7968aa10ea928c7a110" id="r_a6e5af1f386c0c7968aa10ea928c7a110"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a6e5af1f386c0c7968aa10ea928c7a110">insert</a> (array $insert, string $to_tbl, string $type='', array $options=[])</td></tr>
<tr class="memdesc:a6e5af1f386c0c7968aa10ea928c7a110"><td class="mdescLeft">&#160;</td><td class="mdescRight">Вставляет данные в таблицу через вызов внутреннего метода.  <br /></td></tr>
<tr class="separator:a6e5af1f386c0c7968aa10ea928c7a110"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa2b6c23b3a70e9ef06c22d8a4885d69a" id="r_aa2b6c23b3a70e9ef06c22d8a4885d69a"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa2b6c23b3a70e9ef06c22d8a4885d69a">join</a> (string|array $<a class="el" href="#aab30d2495bb1362d218cd62e1556b13e">select</a>, string $from_tbl, array $join, array $options=[])</td></tr>
<tr class="memdesc:aa2b6c23b3a70e9ef06c22d8a4885d69a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Выполняет SQL-запрос с использованием JOIN через вызов внутреннего метода.  <br /></td></tr>
<tr class="separator:aa2b6c23b3a70e9ef06c22d8a4885d69a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a444f7dd61bfbe3931a7188adad61feae" id="r_a444f7dd61bfbe3931a7188adad61feae"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a444f7dd61bfbe3931a7188adad61feae">result_array</a> ()</td></tr>
<tr class="memdesc:a444f7dd61bfbe3931a7188adad61feae"><td class="mdescLeft">&#160;</td><td class="mdescRight">Извлекает все строки результата из подготовленного выражения.  <br /></td></tr>
<tr class="separator:a444f7dd61bfbe3931a7188adad61feae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acc7e70758801658b8c1f6ff0988deebb" id="r_acc7e70758801658b8c1f6ff0988deebb"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#acc7e70758801658b8c1f6ff0988deebb">result_row</a> ()</td></tr>
<tr class="memdesc:acc7e70758801658b8c1f6ff0988deebb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Извлекает одну строку результата из подготовленного выражения.  <br /></td></tr>
<tr class="separator:acc7e70758801658b8c1f6ff0988deebb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa54f5f05128d55871aa9303134170376" id="r_aa54f5f05128d55871aa9303134170376"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa54f5f05128d55871aa9303134170376">rollback_transaction</a> (string $context='')</td></tr>
<tr class="memdesc:aa54f5f05128d55871aa9303134170376"><td class="mdescLeft">&#160;</td><td class="mdescRight">Отменяет транзакцию в базе данных.  <br /></td></tr>
<tr class="separator:aa54f5f05128d55871aa9303134170376"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aab30d2495bb1362d218cd62e1556b13e" id="r_aab30d2495bb1362d218cd62e1556b13e"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aab30d2495bb1362d218cd62e1556b13e">select</a> (string|array $select, string $from_tbl, array $options=[])</td></tr>
<tr class="memdesc:aab30d2495bb1362d218cd62e1556b13e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Выполняет SQL-запрос на выборку данных из таблицы.  <br /></td></tr>
<tr class="separator:aab30d2495bb1362d218cd62e1556b13e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad4d4e455d9e4bf865126c72cf23a517b" id="r_ad4d4e455d9e4bf865126c72cf23a517b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad4d4e455d9e4bf865126c72cf23a517b">truncate</a> (string $from_tbl)</td></tr>
<tr class="memdesc:ad4d4e455d9e4bf865126c72cf23a517b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Очищает таблицу (TRUNCATE) через вызов внутреннего метода.  <br /></td></tr>
<tr class="separator:ad4d4e455d9e4bf865126c72cf23a517b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a539e51bc2144b972bfafeccdda56ee9e" id="r_a539e51bc2144b972bfafeccdda56ee9e"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a539e51bc2144b972bfafeccdda56ee9e">update</a> (array $update, string $from_tbl, array $options=[])</td></tr>
<tr class="memdesc:a539e51bc2144b972bfafeccdda56ee9e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Обновляет данные в таблице через вызов внутреннего метода.  <br /></td></tr>
<tr class="separator:a539e51bc2144b972bfafeccdda56ee9e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5bebc90a5002faea5a85470b3bad406e" id="r_a5bebc90a5002faea5a85470b3bad406e"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a5bebc90a5002faea5a85470b3bad406e">with_sql_format</a> (string $format, callable $callback)</td></tr>
<tr class="memdesc:a5bebc90a5002faea5a85470b3bad406e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Временно изменяет формат SQL для выполнения запросов.  <br /></td></tr>
<tr class="separator:a5bebc90a5002faea5a85470b3bad406e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9377cc9a0272aa329e548cc608936bb5" id="r_a9377cc9a0272aa329e548cc608936bb5"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a9377cc9a0272aa329e548cc608936bb5">full_text_search</a> (array $columns_to_return, array $columns_to_search, string $search_string, string $table, array $options=[])</td></tr>
<tr class="memdesc:a9377cc9a0272aa329e548cc608936bb5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Выполняет полнотекстовый поиск в указанной таблице.  <br /></td></tr>
<tr class="separator:a9377cc9a0272aa329e548cc608936bb5"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pro-methods" name="pro-methods"></a>
Защищенные члены</h2></td></tr>
<tr class="memitem:a8a1b1a9978392cc3c94f942e63f5d37a" id="r_a8a1b1a9978392cc3c94f942e63f5d37a"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a8a1b1a9978392cc3c94f942e63f5d37a">_begin_transaction_internal</a> (string $context='')</td></tr>
<tr class="memdesc:a8a1b1a9978392cc3c94f942e63f5d37a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Начинает транзакцию в базе данных и записывает лог с указанием контекста.  <br /></td></tr>
<tr class="separator:a8a1b1a9978392cc3c94f942e63f5d37a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a212cee52ddc3ef442f9fcce43910581c" id="r_a212cee52ddc3ef442f9fcce43910581c"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a212cee52ddc3ef442f9fcce43910581c">_commit_transaction_internal</a> (string $context='')</td></tr>
<tr class="memdesc:a212cee52ddc3ef442f9fcce43910581c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Подтверждает транзакцию в базе данных и записывает лог с указанием контекста.  <br /></td></tr>
<tr class="separator:a212cee52ddc3ef442f9fcce43910581c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa4094e522b4780bd58666dba20fdd09d" id="r_aa4094e522b4780bd58666dba20fdd09d"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa4094e522b4780bd58666dba20fdd09d">_delete_internal</a> (string $from_tbl, array $options=[])</td></tr>
<tr class="memdesc:aa4094e522b4780bd58666dba20fdd09d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Формирует SQL-запрос на удаление данных из таблицы, проверяет входные данные, обрабатывает недопустимые ключи, сохраняет текст запроса в свойстве <code>$txt_query</code> и выполняет его.  <br /></td></tr>
<tr class="separator:aa4094e522b4780bd58666dba20fdd09d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad7c3527d920ebf2dbcbc0c51845835d6" id="r_ad7c3527d920ebf2dbcbc0c51845835d6"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad7c3527d920ebf2dbcbc0c51845835d6">_format_date_internal</a> (string $column, string $format)</td></tr>
<tr class="memdesc:ad7c3527d920ebf2dbcbc0c51845835d6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Формирует SQL-выражение для форматирования даты с учетом специфики используемой СУБД.  <br /></td></tr>
<tr class="separator:ad7c3527d920ebf2dbcbc0c51845835d6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a834ca0d1c7c60bc9bfae123070b45fbd" id="r_a834ca0d1c7c60bc9bfae123070b45fbd"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a834ca0d1c7c60bc9bfae123070b45fbd">_get_affected_rows_internal</a> ()</td></tr>
<tr class="memdesc:a834ca0d1c7c60bc9bfae123070b45fbd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Возвращает количество строк, затронутых последним SQL-запросом, после проверки состояния свойства <code>$aff_rows</code>.  <br /></td></tr>
<tr class="separator:a834ca0d1c7c60bc9bfae123070b45fbd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab122f53e8d2ca9d723e32426c9e691e9" id="r_ab122f53e8d2ca9d723e32426c9e691e9"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab122f53e8d2ca9d723e32426c9e691e9">_get_last_insert_id_internal</a> ()</td></tr>
<tr class="memdesc:ab122f53e8d2ca9d723e32426c9e691e9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Возвращает ID последней вставленной строки после проверки состояния свойства <code>$insert_id</code>.  <br /></td></tr>
<tr class="separator:ab122f53e8d2ca9d723e32426c9e691e9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a442c0348c8bd3cd7104cb110cc71348a" id="r_a442c0348c8bd3cd7104cb110cc71348a"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a442c0348c8bd3cd7104cb110cc71348a">_insert_internal</a> (array $<a class="el" href="#a6e5af1f386c0c7968aa10ea928c7a110">insert</a>, string $to_tbl, string $type='', array $options=[])</td></tr>
<tr class="memdesc:a442c0348c8bd3cd7104cb110cc71348a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Формирует SQL-запрос на вставку данных в таблицу, проверяет входные данные, обрабатывает различные типы запросов, сохраняет текст запроса в свойстве <code>$txt_query</code> и выполняет его.  <br /></td></tr>
<tr class="separator:a442c0348c8bd3cd7104cb110cc71348a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa3fbbc7c98d1c241e897f0bf80177d2b" id="r_aa3fbbc7c98d1c241e897f0bf80177d2b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa3fbbc7c98d1c241e897f0bf80177d2b">_join_internal</a> (string|array $<a class="el" href="#aab30d2495bb1362d218cd62e1556b13e">select</a>, string $from_tbl, array $<a class="el" href="#aa2b6c23b3a70e9ef06c22d8a4885d69a">join</a>, array $options=[])</td></tr>
<tr class="memdesc:aa3fbbc7c98d1c241e897f0bf80177d2b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Формирует SQL-запрос с использованием JOIN для выборки данных из нескольких таблиц, проверяет входные данные, сохраняет текст запроса в свойстве <code>$txt_query</code> и выполняет его.  <br /></td></tr>
<tr class="separator:aa3fbbc7c98d1c241e897f0bf80177d2b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a31eb9243149eec0d8676bbcf7289538d" id="r_a31eb9243149eec0d8676bbcf7289538d"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a31eb9243149eec0d8676bbcf7289538d">_result_array_internal</a> ()</td></tr>
<tr class="memdesc:a31eb9243149eec0d8676bbcf7289538d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Извлекает все строки результата из подготовленного выражения, хранящегося в свойстве <code>$res_query</code>, и возвращает их как массив.  <br /></td></tr>
<tr class="separator:a31eb9243149eec0d8676bbcf7289538d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aac250b0e3e45a11bc29ad82a9feb64ec" id="r_aac250b0e3e45a11bc29ad82a9feb64ec"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aac250b0e3e45a11bc29ad82a9feb64ec">_result_row_internal</a> ()</td></tr>
<tr class="memdesc:aac250b0e3e45a11bc29ad82a9feb64ec"><td class="mdescLeft">&#160;</td><td class="mdescRight">Извлекает одну строку результата из подготовленного выражения, хранящегося в свойстве <code>$res_query</code>.  <br /></td></tr>
<tr class="separator:aac250b0e3e45a11bc29ad82a9feb64ec"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa3ddd3acf0992e7be12e65460caaa4b6" id="r_aa3ddd3acf0992e7be12e65460caaa4b6"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa3ddd3acf0992e7be12e65460caaa4b6">_rollback_transaction_internal</a> (string $context='')</td></tr>
<tr class="memdesc:aa3ddd3acf0992e7be12e65460caaa4b6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Отменяет транзакцию в базе данных.  <br /></td></tr>
<tr class="separator:aa3ddd3acf0992e7be12e65460caaa4b6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3e40bb61553455b6f52be0ab9a6062b1" id="r_a3e40bb61553455b6f52be0ab9a6062b1"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a3e40bb61553455b6f52be0ab9a6062b1">_select_internal</a> (string|array $<a class="el" href="#aab30d2495bb1362d218cd62e1556b13e">select</a>, string $from_tbl, array $options=[])</td></tr>
<tr class="memdesc:a3e40bb61553455b6f52be0ab9a6062b1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Формирует SQL-запрос на выборку данных из таблицы, основываясь на полученных аргументах, размещает его в свойстве <code>$txt_query</code> и выполняет.  <br /></td></tr>
<tr class="separator:a3e40bb61553455b6f52be0ab9a6062b1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad353291f086236ab7be0d1edc0ed3ba8" id="r_ad353291f086236ab7be0d1edc0ed3ba8"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad353291f086236ab7be0d1edc0ed3ba8">_truncate_internal</a> (string $from_tbl)</td></tr>
<tr class="memdesc:ad353291f086236ab7be0d1edc0ed3ba8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Формирует SQL-запрос на очистку таблицы (TRUNCATE), размещает его в свойстве <code>$txt_query</code> и выполняет.  <br /></td></tr>
<tr class="separator:ad353291f086236ab7be0d1edc0ed3ba8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab1dc7ae1ce60a864b1d7c865e99029b0" id="r_ab1dc7ae1ce60a864b1d7c865e99029b0"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab1dc7ae1ce60a864b1d7c865e99029b0">_update_internal</a> (array $<a class="el" href="#a539e51bc2144b972bfafeccdda56ee9e">update</a>, string $from_tbl, array $options=[])</td></tr>
<tr class="memdesc:ab1dc7ae1ce60a864b1d7c865e99029b0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Формирует SQL-запрос на обновление данных в таблице, основываясь на полученных аргументах, размещает его в свойстве <code>$txt_query</code> и выполняет.  <br /></td></tr>
<tr class="separator:ab1dc7ae1ce60a864b1d7c865e99029b0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afc2bc46cdbae22b8f2ebec12797fed6d" id="r_afc2bc46cdbae22b8f2ebec12797fed6d"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#afc2bc46cdbae22b8f2ebec12797fed6d">_with_sql_format_internal</a> (string $format, callable $callback)</td></tr>
<tr class="memdesc:afc2bc46cdbae22b8f2ebec12797fed6d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Метод временно изменяет формат SQL для выполнения запросов в указанном контексте.  <br /></td></tr>
<tr class="separator:afc2bc46cdbae22b8f2ebec12797fed6d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1a9c9d8aa5d7a039660197843f626268" id="r_a1a9c9d8aa5d7a039660197843f626268"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a1a9c9d8aa5d7a039660197843f626268">_full_text_search_internal</a> (array $columns_to_return, array $columns_to_search, string $search_string, string $table, array $options=[])</td></tr>
<tr class="memdesc:a1a9c9d8aa5d7a039660197843f626268"><td class="mdescLeft">&#160;</td><td class="mdescRight">Выполняет полнотекстовый поиск в указанной таблице по заданным столбцам.  <br /></td></tr>
<tr class="separator:a1a9c9d8aa5d7a039660197843f626268"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pri-methods" name="pri-methods"></a>
Закрытые члены</h2></td></tr>
<tr class="memitem:a852d15f131983e6f53045146bede2958" id="r_a852d15f131983e6f53045146bede2958"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a852d15f131983e6f53045146bede2958">_build_conditions</a> (array $options)</td></tr>
<tr class="memdesc:a852d15f131983e6f53045146bede2958"><td class="mdescLeft">&#160;</td><td class="mdescRight">Формирует строку дополнений для SQL-запроса (например, WHERE, GROUP BY, ORDER BY, LIMIT).  <br /></td></tr>
<tr class="separator:a852d15f131983e6f53045146bede2958"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a24acdb048ce17d880bd12b0f74567352" id="r_a24acdb048ce17d880bd12b0f74567352"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a24acdb048ce17d880bd12b0f74567352">_build_where_group</a> (array $conditions, string $operator)</td></tr>
<tr class="memdesc:a24acdb048ce17d880bd12b0f74567352"><td class="mdescLeft">&#160;</td><td class="mdescRight">Формирует группу условий для WHERE с указанным оператором (OR/NOT).  <br /></td></tr>
<tr class="separator:a24acdb048ce17d880bd12b0f74567352"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a941629b86b9c9e34bc5926c0db2478b5" id="r_a941629b86b9c9e34bc5926c0db2478b5"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a941629b86b9c9e34bc5926c0db2478b5">_execute_query</a> (array $params=[])</td></tr>
<tr class="memdesc:a941629b86b9c9e34bc5926c0db2478b5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Выполняет SQL-запрос с использованием подготовленных выражений.  <br /></td></tr>
<tr class="separator:a941629b86b9c9e34bc5926c0db2478b5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af1b08f0490df0963b0daac6690d4765f" id="r_af1b08f0490df0963b0daac6690d4765f"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#af1b08f0490df0963b0daac6690d4765f">_convert_query</a> ()</td></tr>
<tr class="memdesc:af1b08f0490df0963b0daac6690d4765f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Выполняет преобразование SQL-запроса в зависимости от текущего формата и типа СУБД.  <br /></td></tr>
<tr class="separator:af1b08f0490df0963b0daac6690d4765f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad620cb343252ceea735bab03860a0915" id="r_ad620cb343252ceea735bab03860a0915"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad620cb343252ceea735bab03860a0915">_convert_from_mysql_to</a> (string $target_db_type)</td></tr>
<tr class="memdesc:ad620cb343252ceea735bab03860a0915"><td class="mdescLeft">&#160;</td><td class="mdescRight">Производит преобразование SQL-запроса из формата MySQL в целевой формат СУБД (PostgreSQL или SQLite).  <br /></td></tr>
<tr class="separator:ad620cb343252ceea735bab03860a0915"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2e93ad3621ba0d7cf06d36c539b6c290" id="r_a2e93ad3621ba0d7cf06d36c539b6c290"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a2e93ad3621ba0d7cf06d36c539b6c290">_convert_from_pgsql_to</a> (string $target_db_type)</td></tr>
<tr class="memdesc:a2e93ad3621ba0d7cf06d36c539b6c290"><td class="mdescLeft">&#160;</td><td class="mdescRight">Производит преобразование SQL-запроса из формата PostgreSQL в целевой формат СУБД (MySQL или SQLite).  <br /></td></tr>
<tr class="separator:a2e93ad3621ba0d7cf06d36c539b6c290"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a44e1aec00a15341cd9119261482eeb0d" id="r_a44e1aec00a15341cd9119261482eeb0d"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a44e1aec00a15341cd9119261482eeb0d">_convert_from_sqlite_to</a> (string $target_db_type)</td></tr>
<tr class="memdesc:a44e1aec00a15341cd9119261482eeb0d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Производит преобразование SQL-запроса из формата SQLite в целевой формат СУБД (MySQL или PostgreSQL).  <br /></td></tr>
<tr class="separator:a44e1aec00a15341cd9119261482eeb0d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a53c8e7da5436bad14f32f64d5b532f60" id="r_a53c8e7da5436bad14f32f64d5b532f60"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a53c8e7da5436bad14f32f64d5b532f60">_log_explain</a> (array $params)</td></tr>
<tr class="memdesc:a53c8e7da5436bad14f32f64d5b532f60"><td class="mdescLeft">&#160;</td><td class="mdescRight">Логирует результат анализа SQL-запроса с помощью EXPLAIN или EXPLAIN ANALYZE.  <br /></td></tr>
<tr class="separator:a53c8e7da5436bad14f32f64d5b532f60"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8f393cc6e7e1b7e6394a9c2d4abdd8e7" id="r_a8f393cc6e7e1b7e6394a9c2d4abdd8e7"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a8f393cc6e7e1b7e6394a9c2d4abdd8e7">_log_query</a> (string $reason='other', ?float $execution_time_ms=null)</td></tr>
<tr class="memdesc:a8f393cc6e7e1b7e6394a9c2d4abdd8e7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Логирует медленные запросы, запросы без использования плейсхолдеров и другие запросы в таблицу логов.  <br /></td></tr>
<tr class="separator:a8f393cc6e7e1b7e6394a9c2d4abdd8e7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5f4312bd1da12e43a8f9a046ed068ebd" id="r_a5f4312bd1da12e43a8f9a046ed068ebd"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a5f4312bd1da12e43a8f9a046ed068ebd">_convert_to_mysql_format</a> (string $format)</td></tr>
<tr class="memdesc:a5f4312bd1da12e43a8f9a046ed068ebd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Производит преобразование строки формата даты/времени в формат, совместимый с MySQL (<code>DATE_FORMAT</code>).  <br /></td></tr>
<tr class="separator:a5f4312bd1da12e43a8f9a046ed068ebd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae74eea110900ed128b205a3d0c91687b" id="r_ae74eea110900ed128b205a3d0c91687b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ae74eea110900ed128b205a3d0c91687b">_convert_to_postgres_format</a> (string $format)</td></tr>
<tr class="memdesc:ae74eea110900ed128b205a3d0c91687b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Преобразует формат даты/времени в формат, совместимый с PostgreSQL.  <br /></td></tr>
<tr class="separator:ae74eea110900ed128b205a3d0c91687b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a80464f4180268442d13e5e319274a30a" id="r_a80464f4180268442d13e5e319274a30a"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a80464f4180268442d13e5e319274a30a">_convert_to_sqlite_format</a> (string $format)</td></tr>
<tr class="memdesc:a80464f4180268442d13e5e319274a30a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Преобразует формат даты/времени в формат, совместимый с SQLite (<code>strftime</code>).  <br /></td></tr>
<tr class="separator:a80464f4180268442d13e5e319274a30a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a56dafcbeab9a8a4a7304278eeb2edabe" id="r_a56dafcbeab9a8a4a7304278eeb2edabe"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a56dafcbeab9a8a4a7304278eeb2edabe">_full_text_search_mysql</a> (array $columns_to_return, array $columns_to_search, string $search_string, string $table, string $db_version, array $options)</td></tr>
<tr class="memdesc:a56dafcbeab9a8a4a7304278eeb2edabe"><td class="mdescLeft">&#160;</td><td class="mdescRight">Выполняет полнотекстовый поиск в MySQL с обработкой минимальной длины строки, кешированием ошибок и fallback на LIKE.  <br /></td></tr>
<tr class="separator:a56dafcbeab9a8a4a7304278eeb2edabe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a33d25ea74a693adb2d31b1a0667553b2" id="r_a33d25ea74a693adb2d31b1a0667553b2"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a33d25ea74a693adb2d31b1a0667553b2">_fallback_to_like_mysql</a> (array $columns_to_return_escaped, array $columns_to_search_escaped, string $search_string, string $table_escaped, array $options)</td></tr>
<tr class="memdesc:a33d25ea74a693adb2d31b1a0667553b2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Выполняет альтернативный поиск по LIKE для MySQL.  <br /></td></tr>
<tr class="separator:a33d25ea74a693adb2d31b1a0667553b2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af1edfadea1168e39f99fb44c9899968c" id="r_af1edfadea1168e39f99fb44c9899968c"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#af1edfadea1168e39f99fb44c9899968c">_full_text_search_pgsql</a> (array $columns_to_return, array $columns_to_search, string $search_string, string $table, string $db_version, array $options)</td></tr>
<tr class="memdesc:af1edfadea1168e39f99fb44c9899968c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Выполняет полнотекстовый поиск в PostgreSQL с обработкой минимальной длины строки, кешированием ошибок и fallback на ILIKE.  <br /></td></tr>
<tr class="separator:af1edfadea1168e39f99fb44c9899968c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a90a18b9fa64057e99f74cbc20edb17d8" id="r_a90a18b9fa64057e99f74cbc20edb17d8"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a90a18b9fa64057e99f74cbc20edb17d8">_fallback_to_ilike_pgsql</a> (array $columns_to_return_escaped, array $columns_to_search_escaped, string $search_string, string $table_escaped, array $options)</td></tr>
<tr class="memdesc:a90a18b9fa64057e99f74cbc20edb17d8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Выполняет альтернативный поиск по ILIKE с ранжированием similarity() для PostgreSQL.  <br /></td></tr>
<tr class="separator:a90a18b9fa64057e99f74cbc20edb17d8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a54df4031bb92109e8e164b9313163121" id="r_a54df4031bb92109e8e164b9313163121"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a54df4031bb92109e8e164b9313163121">_full_text_search_sqlite</a> (array $columns_to_return, array $columns_to_search, string $search_string, string $table, string $db_version, array $options)</td></tr>
<tr class="memdesc:a54df4031bb92109e8e164b9313163121"><td class="mdescLeft">&#160;</td><td class="mdescRight">Выполняет полнотекстовый поиск в SQLite через FTS5.  <br /></td></tr>
<tr class="separator:a54df4031bb92109e8e164b9313163121"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a960a7f20277c75940122885ec6b40d4b" id="r_a960a7f20277c75940122885ec6b40d4b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a960a7f20277c75940122885ec6b40d4b">_fallback_to_like_sqlite</a> (array $columns_to_return_escaped, array $columns_to_search_escaped, string $search_string, string $table_escaped, array $options)</td></tr>
<tr class="memdesc:a960a7f20277c75940122885ec6b40d4b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Выполняет альтернативный LIKE-поиск для SQLite.  <br /></td></tr>
<tr class="separator:a960a7f20277c75940122885ec6b40d4b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6d6c48e4cc7e3d7353b4bda787ac9f43" id="r_a6d6c48e4cc7e3d7353b4bda787ac9f43"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a6d6c48e4cc7e3d7353b4bda787ac9f43">_fts_check_options</a> (array $options, array $base_options)</td></tr>
<tr class="memdesc:a6d6c48e4cc7e3d7353b4bda787ac9f43"><td class="mdescLeft">&#160;</td><td class="mdescRight">Формирует финальный массив опций для запроса с учетом базовых FTS-опций и внешних условий/дополнений.  <br /></td></tr>
<tr class="separator:a6d6c48e4cc7e3d7353b4bda787ac9f43"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7bee8df3a568f0f7563281575031fec7" id="r_a7bee8df3a568f0f7563281575031fec7"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a7bee8df3a568f0f7563281575031fec7">_unescape_identifiers</a> (array $identifiers)</td></tr>
<tr class="memdesc:a7bee8df3a568f0f7563281575031fec7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Снятие экранирования идентификаторов (например, имён таблиц или столбцов).  <br /></td></tr>
<tr class="separator:a7bee8df3a568f0f7563281575031fec7"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pri-attribs" name="pri-attribs"></a>
Закрытые данные</h2></td></tr>
<tr class="memitem:a9db61e1721b616500bce6ed60491752a" id="r_a9db61e1721b616500bce6ed60491752a"><td class="memItemLeft" align="right" valign="top">PDO&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a9db61e1721b616500bce6ed60491752a">$pdo</a> = null</td></tr>
<tr class="memdesc:a9db61e1721b616500bce6ed60491752a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Объект PDO для подключения к базе данных  <br /></td></tr>
<tr class="separator:a9db61e1721b616500bce6ed60491752a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a556a1b37f162e7e8b576b86c182c7309" id="r_a556a1b37f162e7e8b576b86c182c7309"><td class="memItemLeft" align="right" valign="top">string null&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a556a1b37f162e7e8b576b86c182c7309">$txt_query</a> = null</td></tr>
<tr class="memdesc:a556a1b37f162e7e8b576b86c182c7309"><td class="mdescLeft">&#160;</td><td class="mdescRight">Текст последнего SQL-запроса, сформированного методами класса  <br /></td></tr>
<tr class="separator:a556a1b37f162e7e8b576b86c182c7309"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae87877e5a83ed158cdad137dd27b1ac8" id="r_ae87877e5a83ed158cdad137dd27b1ac8"><td class="memItemLeft" align="right" valign="top">object null&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ae87877e5a83ed158cdad137dd27b1ac8">$res_query</a> = null</td></tr>
<tr class="memdesc:ae87877e5a83ed158cdad137dd27b1ac8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Результат выполнения подготовленного выражения (PDOStatement)  <br /></td></tr>
<tr class="separator:ae87877e5a83ed158cdad137dd27b1ac8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a54ffcc55f5606eeb40e8ac59c881d22b" id="r_a54ffcc55f5606eeb40e8ac59c881d22b"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a54ffcc55f5606eeb40e8ac59c881d22b">$aff_rows</a> = 0</td></tr>
<tr class="memdesc:a54ffcc55f5606eeb40e8ac59c881d22b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Количество строк, затронутых последним запросом (INSERT, UPDATE, DELETE)  <br /></td></tr>
<tr class="separator:a54ffcc55f5606eeb40e8ac59c881d22b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0fb355e7d9e1e7d9ca0b1b83dc960f33" id="r_a0fb355e7d9e1e7d9ca0b1b83dc960f33"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a0fb355e7d9e1e7d9ca0b1b83dc960f33">$insert_id</a> = 0</td></tr>
<tr class="memdesc:a0fb355e7d9e1e7d9ca0b1b83dc960f33"><td class="mdescLeft">&#160;</td><td class="mdescRight">ID последней вставленной строки после выполнения INSERT-запроса  <br /></td></tr>
<tr class="separator:a0fb355e7d9e1e7d9ca0b1b83dc960f33"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a072c45961a79433ff94013278707ade5" id="r_a072c45961a79433ff94013278707ade5"><td class="memItemLeft" align="right" valign="top">string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a072c45961a79433ff94013278707ade5">$db_type</a></td></tr>
<tr class="memdesc:a072c45961a79433ff94013278707ade5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Тип базы данных (mysql, pgsql, sqlite)  <br /></td></tr>
<tr class="separator:a072c45961a79433ff94013278707ade5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2db215d6cd26a1915e16cb5f7ff1fca3" id="r_a2db215d6cd26a1915e16cb5f7ff1fca3"><td class="memItemLeft" align="right" valign="top">string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a2db215d6cd26a1915e16cb5f7ff1fca3">$db_name</a></td></tr>
<tr class="memdesc:a2db215d6cd26a1915e16cb5f7ff1fca3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Имя базы данных  <br /></td></tr>
<tr class="separator:a2db215d6cd26a1915e16cb5f7ff1fca3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1dfaf650c7bfa81bd699450d5404c7fd" id="r_a1dfaf650c7bfa81bd699450d5404c7fd"><td class="memItemLeft" align="right" valign="top">array&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a1dfaf650c7bfa81bd699450d5404c7fd">$format_cache</a> = []</td></tr>
<tr class="memdesc:a1dfaf650c7bfa81bd699450d5404c7fd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Кэш для преобразования форматов даты (MariaDB -&gt; PostgreSQL/SQLite)  <br /></td></tr>
<tr class="separator:a1dfaf650c7bfa81bd699450d5404c7fd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa40b201d601e6753def247ae8fda39e3" id="r_aa40b201d601e6753def247ae8fda39e3"><td class="memItemLeft" align="right" valign="top">array&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa40b201d601e6753def247ae8fda39e3">$query_cache</a> = []</td></tr>
<tr class="memdesc:aa40b201d601e6753def247ae8fda39e3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Кэш для хранения результатов проверки существования запросов  <br /></td></tr>
<tr class="separator:aa40b201d601e6753def247ae8fda39e3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa6ad7a9ae20f259f85508582d8f15068" id="r_aa6ad7a9ae20f259f85508582d8f15068"><td class="memItemLeft" align="right" valign="top">array&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa6ad7a9ae20f259f85508582d8f15068">$unescape_cache</a> = []</td></tr>
<tr class="memdesc:aa6ad7a9ae20f259f85508582d8f15068"><td class="mdescLeft">&#160;</td><td class="mdescRight">Кэш для хранения результатов снятия экранирования идентификаторов  <br /></td></tr>
<tr class="separator:aa6ad7a9ae20f259f85508582d8f15068"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8c3cf443d91cde7347577cddf302a9d0" id="r_a8c3cf443d91cde7347577cddf302a9d0"><td class="memItemLeft" align="right" valign="top">string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a8c3cf443d91cde7347577cddf302a9d0">$current_format</a> = 'mysql'</td></tr>
<tr class="memdesc:a8c3cf443d91cde7347577cddf302a9d0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Хранит текущий формат SQL (например, 'mysql', 'pgsql', 'sqlite').  <br /></td></tr>
<tr class="separator:a8c3cf443d91cde7347577cddf302a9d0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afed869cd253ba3b433a21e07703bf95d" id="r_afed869cd253ba3b433a21e07703bf95d"><td class="memItemLeft" align="right" valign="top">array&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#afed869cd253ba3b433a21e07703bf95d">$allowed_formats</a> = ['mysql', 'pgsql', 'sqlite']</td></tr>
<tr class="memdesc:afed869cd253ba3b433a21e07703bf95d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Список поддерживаемых форматов SQL.  <br /></td></tr>
<tr class="separator:afed869cd253ba3b433a21e07703bf95d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a252982d004053f182631167a8b39ce88" id="r_a252982d004053f182631167a8b39ce88"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d1/d44/interfacePhotoRigma_1_1Interfaces_1_1Cache__Handler__Interface.html">Cache_Handler_Interface</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a252982d004053f182631167a8b39ce88">$cache</a></td></tr>
<tr class="memdesc:a252982d004053f182631167a8b39ce88"><td class="mdescLeft">&#160;</td><td class="mdescRight">Объект для работы с кешем  <br /></td></tr>
<tr class="separator:a252982d004053f182631167a8b39ce88"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Подробное описание</h2>
<div class="textblock"><p>Класс для работы с базами данных через PDO. </p>
<p>Этот класс предоставляет полный спектр функционала для эффективной и безопасной работы с реляционными базами данных, поддерживая следующие СУБД: MySQL (включая MariaDB), PostgreSQL и SQLite. Основные возможности класса включают:</p><ul>
<li>Безопасное и гибкое выполнение стандартных операций с данными (SELECT, INSERT, UPDATE, DELETE, TRUNCATE, JOIN) с использованием подготовленных выражений и структурированных опций запроса. Поддерживается построение сложных условий WHERE с использованием операторов <code>OR</code> и <code>NOT</code> через удобный массивный синтаксис.</li>
<li>Реализацию <b>полнотекстового поиска (Full-Text Search - FTS)</b>, специфичного для каждой поддерживаемой СУБД (MySQL/MariaDB FTS, PostgreSQL FTS/<code>tsvector</code>/<code>tsquery</code>, SQLite FTS5). Включает обработку минимальной длины строки поиска, кеширование ошибок FTS-индексов и автоматический переход (fallback) на альтернативные методы поиска (<code>LIKE</code>, <code>ILIKE</code> с <code>similarity()</code> для PostgreSQL) в случае недоступности или ошибок FTS.</li>
<li>Получение метаданных выполненных запросов (например, количество затронутых строк (<code>$aff_rows</code>) или ID последней вставленной записи (<code>$insert_id</code>)).</li>
<li>Форматирование дат и времени в SQL-запросах с автоматическим преобразованием форматов (<code>DATE_FORMAT</code> для MySQL, <code>TO_CHAR</code> для PostgreSQL, <code>strftime</code> для SQLite) на основе текущей или временно установленной СУБД.</li>
<li>Управление транзакциями (начало, фиксация, откат).</li>
<li>Временное изменение формата SQL-синтаксиса (например, экранирования идентификаторов, форматов даты) для выполнения запросов в контексте другой СУБД (<code>with_sql_format()</code>), что позволяет использовать один экземпляр для взаимодействия с разными типами БД без переподключения.</li>
<li>Долгосрочное кеширование внутренних оптимизационных данных (кешей форматов, запросов, снятия экранирования) через интегрированный объект, реализующий <code>Cache_Handler_Interface</code>. Все ошибки, возникающие на уровне работы с базой данных или при обработке запросов, обрабатываются через исключения (<code>PDOException</code>, <code>InvalidArgumentException</code>, <code>Exception</code> и др.). </li>
</ul>

<p class="definition">См. определение в файле <a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a> строка <a class="el" href="../../d2/d89/Database_8php_source.html#l00201">201</a></p>
</div><h2 class="groupheader">Конструктор(ы)</h2>
<a id="af990525891a72f6449a5f72b35c4026f" name="af990525891a72f6449a5f72b35c4026f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af990525891a72f6449a5f72b35c4026f">&#9670;&#160;</a></span>__construct()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__construct </td>
          <td>(</td>
          <td class="paramtype">array</td>          <td class="paramname"><span class="paramname"><em>$db_config</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d1/d44/interfacePhotoRigma_1_1Interfaces_1_1Cache__Handler__Interface.html">Cache_Handler_Interface</a></td>          <td class="paramname"><span class="paramname"><em>$cache</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Конструктор класса. </p>
<p>Этот метод вызывается автоматически при создании нового объекта класса. Используется для установки соединения с базой данных на основе переданных параметров <code>$db_config</code> и инициализации механизма кеширования с использованием объекта <code>$cache</code>.</p>
<p>Подключение к базе данных выполняется в следующем порядке:</p><ol type="1">
<li>Попытка подключения к SQLite, если <code>dbtype</code> установлен в 'sqlite'. Включает проверку существования и доступности файла базы данных для записи.</li>
<li>Для MySQL/PostgreSQL:<ul>
<li>Первая попытка подключения через сокет, если указан параметр <code>dbsock</code>. Если путь к сокету некорректен или файл не существует, записывается предупреждение в лог, и выполняется попытка подключения через хост и порт.</li>
<li>Вторая попытка подключения через хост и порт, если подключение через сокет не используется или не удалось, или если <code>dbsock</code> не был указан.</li>
</ul>
</li>
</ol>
<p>При возникновении ошибок валидации параметров конфигурации или ошибок подключения на уровне PDO выбрасывается соответствующее исключение.</p>
<p>После инициализации PDO, конструктор проверяет наличие сохранённого кеша (<code>db_cache</code>) через переданный объект <code>$cache</code>. Если кеш действителен (пользовательская логика валидации кеша) и имеет корректную структуру, из него загружаются данные в внутренние свойства класса: <code>$this-&gt;format_cache</code>, <code>$this-&gt;query_cache</code>, <code>$this-&gt;unescape_cache</code>. Это позволяет избежать повторной обработки некоторых данных (например, преобразование форматов SQL) при каждом запуске скрипта.</p>
<dl class="params"><dt>Аргументы</dt><dd>
  <table class="params">
    <tr><td class="paramtype">array</td><td class="paramname">$db_config</td><td>Массив с конфигурацией подключения к базе данных. Обязательный параметр. Поддерживаемые ключи:<ul>
<li>string <code>dbtype</code>: Тип базы данных ('mysql', 'pgsql', 'sqlite'). Обязательный параметр. Если передан недопустимый тип, выбрасывается исключение <code>InvalidArgumentException</code>.</li>
<li>string <code>dbsock</code> (опционально): Путь к файлу сокета для подключения (для MySQL/PostgreSQL). При некорректном пути или отсутствии файла записывается лог и выполняется попытка подключения через хост/порт.</li>
<li>string <code>dbname</code>: Имя базы данных. Обязательный параметр. Для SQLite это полный путь к файлу базы данных. Если имя не указано, выбрасывается исключение <code>InvalidArgumentException</code>.</li>
<li>string <code>dbuser</code> (опционально для SQLite): Имя пользователя базы данных. Обязательный параметр для MySQL/PostgreSQL. Если имя не указано, выбрасывается исключение <code>InvalidArgumentException</code>.</li>
<li>string <code>dbpass</code> (опционально для SQLite): Пароль пользователя базы данных. Обязательный параметр для MySQL/PostgreSQL.</li>
<li>string <code>dbhost</code> (опционально, если используется сокет): Хост базы данных. Обязателен, если подключение через сокет не используется или не удалось. Если хост некорректен, выбрасывается исключение <code>InvalidArgumentException</code>.</li>
<li>int <code>dbport</code> (опционально): Порт базы данных. Если порт некорректен, выбрасывается исключение <code>InvalidArgumentException</code>. </li>
</ul>
</td></tr>
    <tr><td class="paramtype">Cache_Handler_Interface</td><td class="paramname">$cache</td><td>Объект, реализующий интерфейс <code>Cache_Handler_Interface</code>. Обязательный параметр. Используется для временного хранения и загрузки кеша (<code>db_cache</code>) между запусками скрипта. При наличии актуального кеша он загружается в свойства:<ul>
<li><code>$this-&gt;format_cache</code></li>
<li><code>$this-&gt;query_cache</code></li>
<li><code>$this-&gt;unescape_cache</code></li>
</ul>
</td></tr>
  </table>
  </dd>
</dl>
<dl class="exception"><dt>Исключения</dt><dd>
  <table class="exception">
    <tr><td class="paramname">InvalidArgumentException</td><td>Выбрасывается, если параметры конфигурации <code>$db_config</code> неверны или отсутствуют обязательные поля:<ul>
<li>Недопустимый тип базы данных (<code>dbtype</code>).</li>
<li>Не указано имя базы данных (<code>dbname</code>) или пользователь (<code>dbuser</code>) (кроме SQLite).</li>
<li>Некорректный хост (<code>dbhost</code>) или порт (<code>dbport</code>).</li>
<li>Не указан путь к файлу базы данных для SQLite (<code>dbname</code>). Пример сообщения: Недопустимый тип базы данных | Значение: [dbtype] Пример сообщения: Не указан хост базы данных | Конфигурация: [json_encode($db_config)] </li>
</ul>
</td></tr>
    <tr><td class="paramname">RuntimeException</td><td>Выбрасывается при ошибках, связанных с файловой системой для SQLite:<ul>
<li>Файл базы данных не существует по указанному пути (<code>dbname</code>). Пример сообщения: Файл базы данных SQLite не существует | Путь: [dbname]</li>
<li>Файл базы данных недоступен для записи по указанному пути (<code>dbname</code>). Пример сообщения: Файл базы данных SQLite недоступен для записи | Путь: [dbname] </li>
</ul>
</td></tr>
    <tr><td class="paramname">PDOException</td><td>Выбрасывается, если произошла ошибка при установлении соединения с базой данных через PDO:<ul>
<li>Ошибка подключения через сокет.</li>
<li>Ошибка подключения через хост и порт.</li>
<li>Ошибка подключения к SQLite. Пример сообщения: Ошибка подключения через хост и порт | Хост: [dbhost], Порт: [dbport] Пример сообщения: Ошибка подключения к SQLite | Путь: [dbname] | Сообщение: [текст_ошибки] </li>
</ul>
</td></tr>
    <tr><td class="paramname">JsonException</td><td>Выбрасывается, если возникает ошибка при кодировании конфигурации в JSON для сообщений исключений (например, для логирования или сообщений об ошибках). Пример сообщения: Ошибка кодирования конфигурации в JSON </td></tr>
    <tr><td class="paramname">Exception</td><td>Выбрасывается, если возникает общая ошибка или ошибка при логировании событий через функцию <code>log_in_file()</code>. Пример сообщения: Ошибка записи в лог | Сообщение: [текст_сообщения]</td></tr>
  </table>
  </dd>
</dl>
<dl class="section warning"><dt>Предупреждения</dt><dd>Если параметр <code>dbsock</code> указан для MySQL/PostgreSQL, но файл сокета не существует или некорректен, выполняется попытка подключения через хост и порт. Проверьте путь <code>dbsock</code>. Для SQLite убедитесь, что файл базы данных существует и доступен для записи по указанному пути (<code>dbname</code>). Некорректные параметры конфигурации приведут к выбросу исключения.</dd></dl>
<p>Пример использования конструктора: </p><div class="fragment"><div class="line"><span class="comment">// Пример для MySQL</span></div>
<div class="line">$db_config_mysql = [</div>
<div class="line">    <span class="stringliteral">&#39;dbtype&#39;</span> =&gt; <span class="stringliteral">&#39;mysql&#39;</span>,</div>
<div class="line">    <span class="stringliteral">&#39;dbname&#39;</span> =&gt; <span class="stringliteral">&#39;test_db&#39;</span>,</div>
<div class="line">    <span class="stringliteral">&#39;dbuser&#39;</span> =&gt; <span class="stringliteral">&#39;root&#39;</span>,</div>
<div class="line">    <span class="stringliteral">&#39;dbpass&#39;</span> =&gt; <span class="stringliteral">&#39;password&#39;</span>,</div>
<div class="line">    <span class="stringliteral">&#39;dbhost&#39;</span> =&gt; <span class="stringliteral">&#39;localhost&#39;</span>,</div>
<div class="line">    <span class="stringliteral">&#39;dbport&#39;</span> =&gt; 3306,</div>
<div class="line">];</div>
<div class="line"><a class="code hl_variable" href="#a252982d004053f182631167a8b39ce88">$cache</a> = new \PhotoRigma\Classes\Cache_Handler();</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">try</span> {</div>
<div class="line">    $db_mysql = new \PhotoRigma\Classes\Database($db_config_mysql, <a class="code hl_variable" href="#a252982d004053f182631167a8b39ce88">$cache</a>);</div>
<div class="line">    <span class="comment">// Объект $db_mysql успешно создан</span></div>
<div class="line">} <span class="keywordflow">catch</span> (\Exception $e) {</div>
<div class="line">    <span class="comment">// Обработка ошибок подключения или валидации конфигурации</span></div>
<div class="line">    echo <span class="stringliteral">&quot;Ошибка при создании объекта Database: &quot;</span> . $e-&gt;getMessage();</div>
<div class="line">}</div>
<div class="ttc" id="aclassPhotoRigma_1_1Classes_1_1Database_html_a252982d004053f182631167a8b39ce88"><div class="ttname"><a href="#a252982d004053f182631167a8b39ce88">PhotoRigma\Classes\Database\$cache</a></div><div class="ttdeci">Cache_Handler_Interface $cache</div><div class="ttdoc">Объект для работы с кешем</div><div class="ttdef"><b>Определения</b> <a href="../../d2/d89/Database_8php_source.html#l00216">Database.php:216</a></div></div>
</div><!-- fragment --><div class="fragment"><div class="line"><span class="comment">// Пример для SQLite</span></div>
<div class="line">$db_config_sqlite = [</div>
<div class="line">    <span class="stringliteral">&#39;dbtype&#39;</span> =&gt; <span class="stringliteral">&#39;sqlite&#39;</span>,</div>
<div class="line">    <span class="stringliteral">&#39;dbname&#39;</span> =&gt; <span class="stringliteral">&#39;/path/to/database.sqlite&#39;</span>,</div>
<div class="line">];</div>
<div class="line"><a class="code hl_variable" href="#a252982d004053f182631167a8b39ce88">$cache</a> = new \PhotoRigma\Classes\Cache_Handler(); <span class="comment">// Предполагается существование Cache_Handler</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">try</span> {</div>
<div class="line">    $db_sqlite = new \PhotoRigma\Classes\Database($db_config_sqlite, <a class="code hl_variable" href="#a252982d004053f182631167a8b39ce88">$cache</a>);</div>
<div class="line">    <span class="comment">// Объект $db_sqlite успешно создан</span></div>
<div class="line">} <span class="keywordflow">catch</span> (\Exception $e) {</div>
<div class="line">    <span class="comment">// Обработка ошибок подключения или валидации конфигурации</span></div>
<div class="line">    echo <span class="stringliteral">&quot;Ошибка при создании объекта Database: &quot;</span> . $e-&gt;getMessage();</div>
<div class="line">}</div>
</div><!-- fragment --> <dl class="section see"><dt>См. также</dt><dd><a class="el" href="#a9db61e1721b616500bce6ed60491752a" title="Объект PDO для подключения к базе данных">PhotoRigma\Classes\Database\$pdo</a> Свойство, хранящее объект PDO для подключения к базе данных. </dd>
<dd>
<a class="el" href="#a072c45961a79433ff94013278707ade5" title="Тип базы данных (mysql, pgsql, sqlite)">PhotoRigma\Classes\Database\$db_type</a> Свойство, хранящее тип используемой базы данных (например, 'mysql' или 'sqlite'). </dd>
<dd>
<a class="el" href="#afed869cd253ba3b433a21e07703bf95d" title="Список поддерживаемых форматов SQL.">PhotoRigma\Classes\Database\$allowed_formats</a> Массив допустимых форматов базы данных (например, 'mysql', 'sqlite', 'pgsql'). </dd>
<dd>
<a class="el" href="../../d1/d44/interfacePhotoRigma_1_1Interfaces_1_1Cache__Handler__Interface.html" title="Интерфейс для работы с системами кеширования.">PhotoRigma\Interfaces\Cache_Handler_Interface</a> Интерфейс, реализуемый классом, который отвечает за работу с кешированием. </dd>
<dd>
<a class="el" href="#a1dfaf650c7bfa81bd699450d5404c7fd" title="Кэш для преобразования форматов даты (MariaDB -&gt; PostgreSQL/SQLite)">PhotoRigma\Classes\Database\$format_cache</a> Свойство, хранящее кеш преобразования форматов даты. </dd>
<dd>
<a class="el" href="#aa40b201d601e6753def247ae8fda39e3" title="Кэш для хранения результатов проверки существования запросов">PhotoRigma\Classes\Database\$query_cache</a> Свойство, хранящее кеш уже выполненных запросов. </dd>
<dd>
<a class="el" href="#aa6ad7a9ae20f259f85508582d8f15068" title="Кэш для хранения результатов снятия экранирования идентификаторов">PhotoRigma\Classes\Database\$unescape_cache</a> Свойство, хранящее кеш результатов снятия экранирования идентификаторов. </dd>
<dd>
<a class="el" href="../../d1/d44/interfacePhotoRigma_1_1Interfaces_1_1Cache__Handler__Interface.html#a4eb59a37e4e4450d648cdbd2afac5554" title="Проверяет актуальность данных в кеше.">PhotoRigma\Interfaces\Cache_Handler_Interface\is_valid()</a> Метод интерфейса кеширования, используемый для проверки валидности кеша. </dd>
<dd>
<a class="el" href="../../db/d02/namespacePhotoRigma_1_1Include.html#a2d74c46a21e4ce612a98eee60981aef0" title="Записывает сообщение об ошибке в лог-файл и, при необходимости, завершает выполнение скрипта.">PhotoRigma\Include\log_in_file()</a> Функция для логирования ошибок и предупреждений. </dd></dl>
<p>@noinspection UnusedConstructorDependenciesInspection</p>

<p class="definition">См. определение в файле <a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a> строка <a class="el" href="../../d2/d89/Database_8php_source.html#l00362">362</a></p>

<p class="reference">Перекрестные ссылки <a class="el" href="../../d2/d89/Database_8php_source.html#l00216">$cache</a>.</p>

</div>
</div>
<a id="a421831a265621325e1fdd19aace0c758" name="a421831a265621325e1fdd19aace0c758"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a421831a265621325e1fdd19aace0c758">&#9670;&#160;</a></span>__destruct()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__destruct </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Деструктор класса Database. </p>
<p>Метод вызывается автоматически интерпретатором PHP при уничтожении объекта. Основная задача — сохранение содержимого внутренних кешей класса (<code>$this-&gt;format_cache</code>, <code>$this-&gt;query_cache</code>, <code>$this-&gt;unescape_cache</code>).</p>
<p>Сохранение выполняется через вызов метода <code>update_cache()</code> переданного в конструкторе объекта, реализующего интерфейс <code>Cache_Handler_Interface</code>.</p>
<p>Возможность сохранения кешей может быть отключена на уровне приложения через соответствующие параметры конфигурации, которые обрабатываются менеджером кеширования.</p>
<dl class="section note"><dt>Заметки</dt><dd>Данный метод не требует явного вызова. PHP автоматически исполняет его при освобождении объекта из памяти. Убедитесь, что доступ к менеджеру кеширования (<code>$this-&gt;cache</code>) корректен и объект кеширования был успешно инициализирован в конструкторе.</dd></dl>
<dl class="exception"><dt>Исключения</dt><dd>
  <table class="exception">
    <tr><td class="paramname">JsonException</td><td>Выбрасывается методом <code>Cache_Handler_Interface::update_cache()</code> в случае невозможности сериализации данных кешей перед сохранением.</td></tr>
  </table>
  </dd>
</dl>
<p>Пример использования: </p><div class="fragment"><div class="line"><a class="code hl_variable" href="../../de/d90/namespacePhotoRigma.html#a1fa3127fc82f96b1436d871ef02be319">$db</a> = new \PhotoRigma\Classes\Database(<a class="code hl_variable" href="../../de/d90/namespacePhotoRigma.html#a49c7011be9c979d9174c52a8b83e5d8e">$config</a>, $cacheHandler);</div>
<div class="line"><span class="comment">// ... работа с базой данных, которая наполняет кеши ...</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Объект $db больше не нужен. Деструктор будет вызван автоматически.</span></div>
<div class="line">unset(<a class="code hl_variable" href="../../de/d90/namespacePhotoRigma.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Кеши будут сохранены, если это не отключено в настройках приложения.</span></div>
<div class="ttc" id="anamespacePhotoRigma_html_a1fa3127fc82f96b1436d871ef02be319"><div class="ttname"><a href="../../de/d90/namespacePhotoRigma.html#a1fa3127fc82f96b1436d871ef02be319">PhotoRigma\$db</a></div><div class="ttdeci">$db</div><div class="ttdoc">Создание объекта класса Database для работы с основной БД.</div><div class="ttdef"><b>Определения</b> <a href="../../de/d20/index_8php_source.html#l00288">index.php:288</a></div></div>
<div class="ttc" id="anamespacePhotoRigma_html_a49c7011be9c979d9174c52a8b83e5d8e"><div class="ttname"><a href="../../de/d90/namespacePhotoRigma.html#a49c7011be9c979d9174c52a8b83e5d8e">PhotoRigma\$config</a></div><div class="ttdeci">$config</div><div class="ttdoc">Массив с настройками сервера.</div><div class="ttdef"><b>Определения</b> <a href="../../d0/d45/config_8php_source.html#l00138">config.php:138</a></div></div>
</div><!-- fragment --> <dl class="section see"><dt>См. также</dt><dd><a class="el" href="../../d1/d44/interfacePhotoRigma_1_1Interfaces_1_1Cache__Handler__Interface.html#ae6fe4fc9a2266dab7e9facd9cd20fd09" title="Записывает данные в кеш.">PhotoRigma\Interfaces\Cache_Handler_Interface\update_cache()</a> Метод интерфейса кеширования, ответственный за сохранение данных во внешнюю систему кеширования. </dd>
<dd>
<a class="el" href="#a1dfaf650c7bfa81bd699450d5404c7fd" title="Кэш для преобразования форматов даты (MariaDB -&gt; PostgreSQL/SQLite)">PhotoRigma\Classes\Database\$format_cache</a> Внутреннее свойство, хранящее кеш преобразования форматов даты. </dd>
<dd>
<a class="el" href="#aa40b201d601e6753def247ae8fda39e3" title="Кэш для хранения результатов проверки существования запросов">PhotoRigma\Classes\Database\$query_cache</a> Внутреннее свойство, хранящее кеш уже обработанных (например, экранированных) частей запросов. </dd>
<dd>
<a class="el" href="#aa6ad7a9ae20f259f85508582d8f15068" title="Кэш для хранения результатов снятия экранирования идентификаторов">PhotoRigma\Classes\Database\$unescape_cache</a> Внутреннее свойство, хранящее кеш результатов снятия экранирования идентификаторов. </dd>
<dd>
<a class="el" href="#a252982d004053f182631167a8b39ce88" title="Объект для работы с кешем">PhotoRigma\Classes\Database\$cache</a> Свойство, хранящее объект, реализующий <code>Cache_Handler_Interface</code>. </dd>
<dd>
<a class="el" href="#af990525891a72f6449a5f72b35c4026f" title="Конструктор класса.">PhotoRigma\Classes\Database\__construct()</a> Конструктор класса, используемый для инициализации объекта и кеширования. </dd></dl>

<p class="definition">См. определение в файле <a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a> строка <a class="el" href="../../d2/d89/Database_8php_source.html#l00564">564</a></p>

<p class="reference">Перекрестные ссылки <a class="el" href="../../d2/d89/Database_8php_source.html#l00211">$format_cache</a>, <a class="el" href="../../d2/d89/Database_8php_source.html#l00212">$query_cache</a> и <a class="el" href="../../d2/d89/Database_8php_source.html#l00213">$unescape_cache</a>.</p>

</div>
</div>
<h2 class="groupheader">Методы</h2>
<a id="a8a1b1a9978392cc3c94f942e63f5d37a" name="a8a1b1a9978392cc3c94f942e63f5d37a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8a1b1a9978392cc3c94f942e63f5d37a">&#9670;&#160;</a></span>_begin_transaction_internal()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">_begin_transaction_internal </td>
          <td>(</td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>$context</em></span><span class="paramdefsep"> = </span><span class="paramdefval">''</span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel protected">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Начинает транзакцию в базе данных и записывает лог с указанием контекста. </p>
<p>Этот защищённый метод выполняет следующие действия:</p><ol type="1">
<li>Начинает транзакцию в базе данных через объект PDO (<code>$this-&gt;pdo</code>).</li>
<li>Записывает лог с указанием контекста начала транзакции с использованием функции <code>log_in_file()</code>.</li>
</ol>
<p>Этот метод предназначен для использования внутри класса или его наследников. Основная логика метода вызывается через публичный метод-редирект <code>begin_transaction()</code>.</p>
<dl class="params"><dt>Аргументы</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$context</td><td>Контекст транзакции (необязательный параметр). Используется для описания цели или места начала транзакции. По умолчанию: пустая строка (&lsquo;&rsquo;'`).</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Возвращает</dt><dd>void Метод ничего не возвращает.</dd></dl>
<dl class="exception"><dt>Исключения</dt><dd>
  <table class="exception">
    <tr><td class="paramname">Exception</td><td>Выбрасывается, если произошла ошибка при начале транзакции на уровне PDO. Пример сообщения: Ошибка при начале транзакции | Контекст: [значение контекста] | Сообщение PDO: [текст ошибки PDO]</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Заметки</dt><dd>Метод использует функцию логирования <code>log_in_file()</code> для записи информации о начале транзакции. </dd></dl>
<dl class="section warning"><dt>Предупреждения</dt><dd>Убедитесь, что соединение с базой данных установлено (<code>$this-&gt;pdo</code> является валидным объектом PDO) перед вызовом метода. Неправильное состояние соединения может привести к ошибке.</dd></dl>
<p>Пример вызова метода внутри класса: </p><div class="fragment"><div class="line"><span class="comment">// Пример начала транзакции с контекстом</span></div>
<div class="line">$this-&gt;<a class="code hl_function" href="#a8a1b1a9978392cc3c94f942e63f5d37a">_begin_transaction_internal</a>(<span class="stringliteral">&#39;Сохранение данных пользователя&#39;</span>);</div>
<div class="line"><span class="comment">// Ожидаемый лог (в файле): [DB] Транзакция начата | Контекст: Сохранение данных пользователя</span></div>
<div class="ttc" id="aclassPhotoRigma_1_1Classes_1_1Database_html_a8a1b1a9978392cc3c94f942e63f5d37a"><div class="ttname"><a href="#a8a1b1a9978392cc3c94f942e63f5d37a">PhotoRigma\Classes\Database\_begin_transaction_internal</a></div><div class="ttdeci">_begin_transaction_internal(string $context=&#39;&#39;)</div><div class="ttdoc">Начинает транзакцию в базе данных и записывает лог с указанием контекста.</div><div class="ttdef"><b>Определения</b> <a href="../../d2/d89/Database_8php_source.html#l00658">Database.php:658</a></div></div>
</div><!-- fragment --> <dl class="section see"><dt>См. также</dt><dd><a class="el" href="#afc4126846a2eb1bc11d7418b8f120ecf" title="Начинает транзакцию в базе данных.">PhotoRigma\Classes\Database\begin_transaction()</a> Публичный метод-редирект для вызова этой логики. </dd>
<dd>
<a class="el" href="#a9db61e1721b616500bce6ed60491752a" title="Объект PDO для подключения к базе данных">PhotoRigma\Classes\Database\$pdo</a> Объект PDO для подключения к базе данных. </dd>
<dd>
<a class="el" href="../../db/d02/namespacePhotoRigma_1_1Include.html#a2d74c46a21e4ce612a98eee60981aef0" title="Записывает сообщение об ошибке в лог-файл и, при необходимости, завершает выполнение скрипта.">PhotoRigma\Include\log_in_file()</a> Логирует сообщения в файл. </dd></dl>

<p class="definition">См. определение в файле <a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a> строка <a class="el" href="../../d2/d89/Database_8php_source.html#l00658">658</a></p>

<p class="reference">Используется в <a class="el" href="../../d2/d89/Database_8php_source.html#l00611">begin_transaction()</a>.</p>
<div id="dynsection-2" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-2-trigger" src="../../closed.png" alt="+"/> Граф вызова функции:</div>
<div id="dynsection-2-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-2-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_a8a1b1a9978392cc3c94f942e63f5d37a_icgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a8a1b1a9978392cc3c94f942e63f5d37a_icgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a8a1b1a9978392cc3c94f942e63f5d37a_icgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a8a1b1a9978392cc3c94f942e63f5d37a_icgraph">
<area shape="rect" title="Начинает транзакцию в базе данных и записывает лог с указанием контекста." alt="" coords="177,5,307,44"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#afc4126846a2eb1bc11d7418b8f120ecf" title="Начинает транзакцию в базе данных." alt="" coords="5,12,129,37"/>
<area shape="poly" title=" " alt="" coords="161,27,129,27,129,22,161,22"/>
</map>
</div>

</div>
</div>
<a id="a852d15f131983e6f53045146bede2958" name="a852d15f131983e6f53045146bede2958"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a852d15f131983e6f53045146bede2958">&#9670;&#160;</a></span>_build_conditions()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">_build_conditions </td>
          <td>(</td>
          <td class="paramtype">array</td>          <td class="paramname"><span class="paramname"><em>$options</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel private">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Формирует строку дополнений для SQL-запроса (например, WHERE, GROUP BY, ORDER BY, LIMIT). </p>
<p>Этот приватный метод обрабатывает опции запроса из массива <code>$options</code> и формирует соответствующие SQL-фрагменты для добавления к основному запросу (такому как SELECT, UPDATE, DELETE).</p>
<p>Метод выполняет следующие шаги:</p><ol type="1">
<li>Обрабатывает условие <code>WHERE</code> из &lsquo;$options['where&rsquo;]<code>:<ul>
<li>Игнорируется, если значение равно</li>
</ul>
</code>false<code>.<ul>
<li>Если значение является строкой, она используется как есть.</li>
<li>Если значение является массивом, он преобразуется в SQL-условие. Поддерживаются простые условия (</li>
</ul>
</code>['поле' =&gt; значение]<code>), которые автоматически преобразуются с использованием плейсхолдеров (</code>"поле = :поле"<code>) и добавляются к возвращаемому массиву параметров. Также поддерживаются логические операторы</code>'OR'<code>и</code>'NOT'<code>с массивами условий внутри.</code></li>
<li><code>Обрабатывает группировку</code>GROUP BY<code>из</code>$options['group']<code>:<ul>
<li>Игнорируется, если значение равно</li>
</ul>
</code>false<code>.<ul>
<li>Если значение является строкой, добавляется к строке условий.</li>
</ul>
</code></li>
<li><code>Обрабатывает сортировку</code>ORDER BY<code>из</code>$options['order']<code>:<ul>
<li>Игнорируется, если значение равно</li>
</ul>
</code>false<code>.<ul>
<li>Если значение является строкой, добавляется к строке условий.</li>
</ul>
</code></li>
<li><code>Обрабатывает ограничение</code>LIMIT<code>из</code>$options['limit']<code>:<ul>
<li>Игнорируется, если значение равно</li>
</ul>
</code>false<code>.<ul>
<li>Если значение является числом, добавляется напрямую.</li>
<li>Если значение является строкой формата "OFFSET, COUNT", она разбирается и добавляется.</li>
</ul>
</code></li>
<li><code>Возвращает сформированную строку дополнений и обновлённый массив параметров. Массив параметров для возврата инициализируется значениями из</code>$options['params']` (если они были предоставлены) и дополняется параметрами, автоматически созданными для простых условий WHERE.</li>
</ol>
<dl class="params"><dt>Аргументы</dt><dd>
  <table class="params">
    <tr><td class="paramtype">array</td><td class="paramname">$options</td><td>Опции запроса. Поддерживаемые ключи:<ul>
<li>where (string|array|false): Условие WHERE. Может быть:<ul>
<li>Строкой (используется как есть)</li>
<li>Массивом:<ul>
<li>Простые условия: &lsquo;['поле&rsquo; =&gt; значение]<code>(автоматически создаются плейсхолдеры и добавляются в возвращаемый массив параметров)</code></li>
<li><code>Сложные условия:</code>['OR' =&gt; [условия], 'NOT' =&gt; [условия]]<code> -</code>false<code>: Игнорируется.</code></li>
</ul>
</li>
</ul>
</li>
<li><code>group (string|false): Группировка GROUP BY. Должна быть строкой. Игнорируется, если равно</code>false<code>.</code></li>
<li><code>order (string|false): Сортировка ORDER BY. Должна быть строкой. Игнорируется, если равно</code>false<code>.</code></li>
<li><code>limit (int|string|false): Ограничение LIMIT. Должно быть целым числом или строкой формата</code>'OFFSET, COUNT'<code>. Игнорируется, если равно</code>false`.</li>
<li>params (array): Исходный ассоциативный массив параметров для подготовленного выражения ([":имя" =&gt; значение]). Необязательный параметр. Эти параметры используются как основа для возвращаемого массива параметров.</li>
</ul>
</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Возвращает</dt><dd>array Массив с двумя элементами:<ul>
<li>string $conditions: Строка дополнений SQL (например, <code>WHERE ... GROUP BY ... ORDER BY ... LIMIT ...</code>).</li>
<li>array $params: Обновлённый ассоциативный массив параметров для подготовленного выражения. Включает параметры из &lsquo;$options['params&rsquo;]` и параметры, сгенерированные для простых условий WHERE.</li>
</ul>
</dd></dl>
<dl class="exception"><dt>Исключения</dt><dd>
  <table class="exception">
    <tr><td class="paramname">InvalidArgumentException</td><td>Выбрасывается, если значение одной из опций (<code>where</code>, <code>group</code>, <code>order</code>, <code>limit</code>) имеет недопустимый тип, который не может быть обработан методом. Например:<ul>
<li>Неверное условие 'where' | Ожидалась строка или массив, получено: [тип]</li>
<li>Неверное значение 'group' | Ожидалась строка, получено: [тип]</li>
<li>Неверное значение 'order' | Ожидалась строка, получено: [тип]</li>
<li>Неверное значение 'limit' | Ожидалось число или строка формата 'OFFSET, COUNT', получено: [тип/значение]</li>
</ul>
</td></tr>
  </table>
  </dd>
</dl>
<p>Пример использования: </p><div class="fragment"><div class="line"><span class="comment">// Пример с простыми условиями WHERE и LIMIT</span></div>
<div class="line">$options = [</div>
<div class="line">    <span class="stringliteral">&#39;where&#39;</span> =&gt; [<span class="stringliteral">&#39;id&#39;</span> =&gt; 1, <span class="stringliteral">&#39;status&#39;</span> =&gt; <span class="stringliteral">&#39;active&#39;</span>],</div>
<div class="line">    <span class="stringliteral">&#39;limit&#39;</span> =&gt; 10,</div>
<div class="line">    <span class="comment">// Входящий массив params может быть пустым или содержать другие параметры</span></div>
<div class="line">    <span class="stringliteral">&#39;params&#39;</span> =&gt; [<span class="stringliteral">&#39;:other_param&#39;</span> =&gt; <span class="stringliteral">&#39;value&#39;</span>],</div>
<div class="line">];</div>
<div class="line"> </div>
<div class="line">[$conditions, $params] = $this-&gt;<a class="code hl_function" href="#a852d15f131983e6f53045146bede2958">_build_conditions</a>($options);</div>
<div class="line"><span class="comment">// $conditions будет примерно &quot; WHERE id = :id AND status = :status LIMIT 10&quot; (в зависимости от порядка)</span></div>
<div class="line"><span class="comment">// $params будет примерно [&#39;:other_param&#39; =&gt; &#39;value&#39;, &#39;:id&#39; =&gt; 1, &#39;:status&#39; =&gt; &#39;active&#39;]</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Пример со сложными условиями WHERE и ORDER BY</span></div>
<div class="line">$complex_options = [</div>
<div class="line">    <span class="stringliteral">&#39;where&#39;</span> =&gt; [</div>
<div class="line">        <span class="stringliteral">&#39;OR&#39;</span> =&gt; [<span class="stringliteral">&#39;views &gt; :min_views&#39;</span>, <span class="stringliteral">&#39;likes &gt; :min_likes&#39;</span>],</div>
<div class="line">        <span class="stringliteral">&#39;NOT&#39;</span> =&gt; [<span class="stringliteral">&#39;deleted&#39;</span> =&gt; 1], <span class="comment">// &#39;deleted&#39; =&gt; 1 автоматически преобразуется в &#39;deleted = :deleted&#39;</span></div>
<div class="line">        <span class="stringliteral">&#39;category_id&#39;</span> =&gt; 5 <span class="comment">// автоматически преобразуется в &#39;category_id = :category_id&#39;</span></div>
<div class="line">    ],</div>
<div class="line">    <span class="stringliteral">&#39;order&#39;</span> =&gt; <span class="stringliteral">&#39;created_at DESC&#39;</span>,</div>
<div class="line">    <span class="stringliteral">&#39;params&#39;</span> =&gt; [<span class="stringliteral">&#39;:min_views&#39;</span> =&gt; 1000, <span class="stringliteral">&#39;:min_likes&#39;</span> =&gt; 50], <span class="comment">// Входящие параметры для OR</span></div>
<div class="line">];</div>
<div class="line"> </div>
<div class="line">[$complex_conditions, $complex_params] = $this-&gt;<a class="code hl_function" href="#a852d15f131983e6f53045146bede2958">_build_conditions</a>($complex_options);</div>
<div class="line"><span class="comment">// $complex_conditions будет примерно &quot; WHERE (views &gt; :min_views OR likes &gt; :min_likes) AND NOT (deleted = :deleted) AND category_id = :category_id ORDER BY created_at DESC&quot;</span></div>
<div class="line"><span class="comment">// $complex_params будет примерно [&#39;:min_views&#39; =&gt; 1000, &#39;:min_likes&#39; =&gt; 50, &#39;:deleted&#39; =&gt; 1, &#39;:category_id&#39; =&gt; 5]</span></div>
<div class="ttc" id="aclassPhotoRigma_1_1Classes_1_1Database_html_a852d15f131983e6f53045146bede2958"><div class="ttname"><a href="#a852d15f131983e6f53045146bede2958">PhotoRigma\Classes\Database\_build_conditions</a></div><div class="ttdeci">_build_conditions(array $options)</div><div class="ttdoc">Формирует строку дополнений для SQL-запроса (например, WHERE, GROUP BY, ORDER BY, LIMIT).</div><div class="ttdef"><b>Определения</b> <a href="../../d2/d89/Database_8php_source.html#l01104">Database.php:1104</a></div></div>
</div><!-- fragment --><dl class="section see"><dt>См. также</dt><dd><a class="el" href="#a539e51bc2144b972bfafeccdda56ee9e" title="Обновляет данные в таблице через вызов внутреннего метода.">PhotoRigma\Classes\Database\update()</a> Метод, который вызывает _build_conditions() для формирования UPDATE-запроса. </dd>
<dd>
<a class="el" href="#aab30d2495bb1362d218cd62e1556b13e" title="Выполняет SQL-запрос на выборку данных из таблицы.">PhotoRigma\Classes\Database\select()</a> Метод, который вызывает _build_conditions() для формирования SELECT-запроса. </dd>
<dd>
<a class="el" href="#aa2b6c23b3a70e9ef06c22d8a4885d69a" title="Выполняет SQL-запрос с использованием JOIN через вызов внутреннего метода.">PhotoRigma\Classes\Database\join()</a> Метод, который вызывает _build_conditions() для формирования JOIN-запроса. </dd>
<dd>
<a class="el" href="#a73d8e6acdfb996002f980ab7c9c18515" title="Удаляет данные из таблицы через вызов внутреннего метода.">PhotoRigma\Classes\Database\delete()</a> Метод, который вызывает _build_conditions() для формирования DELETE-запроса. </dd>
<dd>
<a class="el" href="#a24acdb048ce17d880bd12b0f74567352" title="Формирует группу условий для WHERE с указанным оператором (OR/NOT).">PhotoRigma\Classes\Database\_build_where_group()</a> Приватный метод, используемый для рекурсивной обработки групп условий (OR, NOT) внутри WHERE. </dd></dl>

<p class="definition">См. определение в файле <a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a> строка <a class="el" href="../../d2/d89/Database_8php_source.html#l01104">1104</a></p>

<p class="reference">Перекрестные ссылки <a class="el" href="../../d2/d89/Database_8php_source.html#l01246">_build_where_group()</a>.</p>

<p class="reference">Используется в <a class="el" href="../../d2/d89/Database_8php_source.html#l00954">_delete_internal()</a>, <a class="el" href="../../d2/d89/Database_8php_source.html#l06081">_fts_check_options()</a>, <a class="el" href="../../d2/d89/Database_8php_source.html#l03289">_join_internal()</a>, <a class="el" href="../../d2/d89/Database_8php_source.html#l03870">_select_internal()</a> и <a class="el" href="../../d2/d89/Database_8php_source.html#l04197">_update_internal()</a>.</p>
<div id="dynsection-3" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-3-trigger" src="../../closed.png" alt="+"/> Граф вызовов:</div>
<div id="dynsection-3-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-3-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_a852d15f131983e6f53045146bede2958_cgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a852d15f131983e6f53045146bede2958_cgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a852d15f131983e6f53045146bede2958_cgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a852d15f131983e6f53045146bede2958_cgraph">
<area shape="rect" title="Формирует строку дополнений для SQL&#45;запроса (например, WHERE, GROUP BY, ORDER BY, LIMIT)." alt="" coords="5,5,127,30"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a24acdb048ce17d880bd12b0f74567352" title="Формирует группу условий для WHERE с указанным оператором (OR/NOT)." alt="" coords="175,5,311,30"/>
<area shape="poly" title=" " alt="" coords="127,15,159,15,159,20,127,20"/>
</map>
</div>
<div id="dynsection-4" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-4-trigger" src="../../closed.png" alt="+"/> Граф вызова функции:</div>
<div id="dynsection-4-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-4-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_a852d15f131983e6f53045146bede2958_icgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a852d15f131983e6f53045146bede2958_icgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a852d15f131983e6f53045146bede2958_icgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a852d15f131983e6f53045146bede2958_icgraph">
<area shape="rect" title="Формирует строку дополнений для SQL&#45;запроса (например, WHERE, GROUP BY, ORDER BY, LIMIT)." alt="" coords="296,128,417,153"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#aa4094e522b4780bd58666dba20fdd09d" title="Формирует SQL&#45;запрос на удаление данных из таблицы, проверяет входные данные, обрабатывает недопустим..." alt="" coords="125,5,237,30"/>
<area shape="poly" title=" " alt="" coords="333,119,295,82,247,45,221,33,224,28,249,41,298,78,337,115"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a6d6c48e4cc7e3d7353b4bda787ac9f43" title="Формирует финальный массив опций для запроса с учетом базовых FTS&#45;опций и внешних условий/дополнений." alt="" coords="114,79,248,103"/>
<area shape="poly" title=" " alt="" coords="295,126,227,106,228,101,296,121"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#aa3fbbc7c98d1c241e897f0bf80177d2b" title="Формирует SQL&#45;запрос с использованием JOIN для выборки данных из нескольких таблиц,..." alt="" coords="132,128,230,153"/>
<area shape="poly" title=" " alt="" coords="281,143,230,143,230,138,281,138"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a3e40bb61553455b6f52be0ab9a6062b1" title="Формирует SQL&#45;запрос на выборку данных из таблицы, основываясь на полученных аргументах,..." alt="" coords="125,177,237,202"/>
<area shape="poly" title=" " alt="" coords="296,160,228,179,227,174,295,155"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#ab1dc7ae1ce60a864b1d7c865e99029b0" title="Формирует SQL&#45;запрос на обновление данных в таблице, основываясь на полученных аргументах,..." alt="" coords="123,227,239,251"/>
<area shape="poly" title=" " alt="" coords="329,164,292,191,249,216,221,229,219,224,247,211,289,186,326,160"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a73d8e6acdfb996002f980ab7c9c18515" title="Удаляет данные из таблицы через вызов внутреннего метода." alt="" coords="7,5,64,30"/>
<area shape="poly" title=" " alt="" coords="109,20,64,20,64,15,109,15"/>
<area shape="poly" title=" " alt="" coords="205,66,197,60,181,57,166,59,158,64,156,70,161,77,156,80,151,70,154,61,164,54,181,52,199,55,208,61"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#aa2b6c23b3a70e9ef06c22d8a4885d69a" title="Выполняет SQL&#45;запрос с использованием JOIN через вызов внутреннего метода." alt="" coords="15,128,56,153"/>
<area shape="poly" title=" " alt="" coords="117,143,57,143,57,138,117,138"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#aab30d2495bb1362d218cd62e1556b13e" title="Выполняет SQL&#45;запрос на выборку данных из таблицы." alt="" coords="7,177,64,202"/>
<area shape="poly" title=" " alt="" coords="109,192,64,192,64,187,109,187"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a539e51bc2144b972bfafeccdda56ee9e" title="Обновляет данные в таблице через вызов внутреннего метода." alt="" coords="5,227,66,251"/>
<area shape="poly" title=" " alt="" coords="107,242,66,242,66,236,107,236"/>
</map>
</div>

</div>
</div>
<a id="a24acdb048ce17d880bd12b0f74567352" name="a24acdb048ce17d880bd12b0f74567352"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a24acdb048ce17d880bd12b0f74567352">&#9670;&#160;</a></span>_build_where_group()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">_build_where_group </td>
          <td>(</td>
          <td class="paramtype">array</td>          <td class="paramname"><span class="paramname"><em>$conditions</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>$operator</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel private">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Формирует группу условий для WHERE с указанным оператором (OR/NOT). </p>
<p>Этот приватный метод используется для построения сложных SQL-условий внутри части WHERE. </p><pre class="fragment">     Метод выполняет следующие задачи:
     - Для оператора OR: объединяет условия из массива `$conditions` через `OR`.
     - Для оператора NOT: объединяет условия из массива `$conditions` через `AND` и добавляет отрицание
       `NOT` к группе.

     Поддерживает два формата условий в массиве `$conditions`:
     - Готовые строки условий (если ключ числовой) — используются как есть.
     - Ассоциативные массивы в формате `['поле' =&gt; значение]` (если ключ строковый) — преобразуются в
       синтаксис для подготовленного выражения: `"поле = :поле"`. (Подстановка и экранирование значений
       происходят на этапе выполнения запроса в методе `_execute_query()`).
</pre><dl class="params"><dt>Аргументы</dt><dd>
  <table class="params">
    <tr><td class="paramtype">array</td><td class="paramname">$conditions</td><td>Массив условий для группы.<ul>
<li>Если ключ числовой: значение используется как готовая строка условия (например, <code>"views &gt; 1000"</code>).</li>
<li>Если ключ строковый: &lsquo;['поле&rsquo; =&gt; значение]<code>— значение используется для генерации синтаксиса плейсхолдера (например,</code>"deleted = :deleted"&lsquo;). </li>
</ul>
</td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$operator</td><td>Логический оператор для объединения условий в группе ('OR&rsquo; или 'NOT').</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Возвращает</dt><dd>string Сформированная строка условий для группы WHERE.<ul>
<li>Для OR: <code>"(условие1 OR условие2)"</code></li>
<li>Для NOT: <code>"NOT (условие1 AND условие2)"</code> Возвращает пустую строку (&lsquo;&rsquo;'`), если массив условий пуст.</li>
</ul>
</dd></dl>
<dl class="exception"><dt>Исключения</dt><dd>
  <table class="exception">
    <tr><td class="paramname">InvalidArgumentException</td><td>Если передан недопустимый оператор (не 'OR' или 'NOT'). Пример сообщения: "Неверный оператор | Допустимые значения: OR, NOT, получено: [operator]"</td></tr>
  </table>
  </dd>
</dl>
<p>Пример использования: </p><div class="fragment"><div class="line"><span class="comment">// Пример с готовыми строками условий и оператором OR</span></div>
<div class="line">$or_condition = $this-&gt;<a class="code hl_function" href="#a24acdb048ce17d880bd12b0f74567352">_build_where_group</a>(</div>
<div class="line">    [<span class="stringliteral">&#39;views &gt; 1000&#39;</span>, <span class="stringliteral">&#39;likes &gt; 50&#39;</span>],</div>
<div class="line">    <span class="stringliteral">&#39;OR&#39;</span></div>
<div class="line">); <span class="comment">// Результат: &quot;(views &gt; 1000 OR likes &gt; 50)&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Пример с ассоциативным массивом условий и оператором NOT</span></div>
<div class="line"><span class="comment">// Обратите внимание: значения (1, 1) не используются этим методом напрямую,</span></div>
<div class="line"><span class="comment">// но необходимы для создания плейсхолдеров :deleted и :hidden.</span></div>
<div class="line">$not_condition = $this-&gt;<a class="code hl_function" href="#a24acdb048ce17d880bd12b0f74567352">_build_where_group</a>(</div>
<div class="line">    [<span class="stringliteral">&#39;deleted&#39;</span> =&gt; 1, <span class="stringliteral">&#39;hidden&#39;</span> =&gt; 1],</div>
<div class="line">    <span class="stringliteral">&#39;NOT&#39;</span></div>
<div class="line">); <span class="comment">// Результат: &quot;NOT (deleted = :deleted AND hidden = :hidden)&quot;</span></div>
<div class="ttc" id="aclassPhotoRigma_1_1Classes_1_1Database_html_a24acdb048ce17d880bd12b0f74567352"><div class="ttname"><a href="#a24acdb048ce17d880bd12b0f74567352">PhotoRigma\Classes\Database\_build_where_group</a></div><div class="ttdeci">_build_where_group(array $conditions, string $operator)</div><div class="ttdoc">Формирует группу условий для WHERE с указанным оператором (OR/NOT).</div><div class="ttdef"><b>Определения</b> <a href="../../d2/d89/Database_8php_source.html#l01246">Database.php:1246</a></div></div>
</div><!-- fragment --> <dl class="section see"><dt>См. также</dt><dd><a class="el" href="#a852d15f131983e6f53045146bede2958" title="Формирует строку дополнений для SQL-запроса (например, WHERE, GROUP BY, ORDER BY, LIMIT).">PhotoRigma\Classes\Database\_build_conditions()</a> Приватный метод, который вызывает _build_where_group() для формирования сложных условий в WHERE. </dd></dl>

<p class="definition">См. определение в файле <a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a> строка <a class="el" href="../../d2/d89/Database_8php_source.html#l01246">1246</a></p>

<p class="reference">Используется в <a class="el" href="../../d2/d89/Database_8php_source.html#l01104">_build_conditions()</a>.</p>
<div id="dynsection-5" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-5-trigger" src="../../closed.png" alt="+"/> Граф вызова функции:</div>
<div id="dynsection-5-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-5-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_a24acdb048ce17d880bd12b0f74567352_icgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a24acdb048ce17d880bd12b0f74567352_icgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a24acdb048ce17d880bd12b0f74567352_icgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a24acdb048ce17d880bd12b0f74567352_icgraph">
<area shape="rect" title="Формирует группу условий для WHERE с указанным оператором (OR/NOT)." alt="" coords="465,128,602,153"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a852d15f131983e6f53045146bede2958" title="Формирует строку дополнений для SQL&#45;запроса (например, WHERE, GROUP BY, ORDER BY, LIMIT)." alt="" coords="296,128,417,153"/>
<area shape="poly" title=" " alt="" coords="450,143,418,143,418,138,450,138"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#aa4094e522b4780bd58666dba20fdd09d" title="Формирует SQL&#45;запрос на удаление данных из таблицы, проверяет входные данные, обрабатывает недопустим..." alt="" coords="125,5,237,30"/>
<area shape="poly" title=" " alt="" coords="333,119,295,82,247,45,221,33,224,28,249,41,298,78,337,115"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a6d6c48e4cc7e3d7353b4bda787ac9f43" title="Формирует финальный массив опций для запроса с учетом базовых FTS&#45;опций и внешних условий/дополнений." alt="" coords="114,79,248,103"/>
<area shape="poly" title=" " alt="" coords="295,126,227,106,228,101,296,121"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#aa3fbbc7c98d1c241e897f0bf80177d2b" title="Формирует SQL&#45;запрос с использованием JOIN для выборки данных из нескольких таблиц,..." alt="" coords="132,128,230,153"/>
<area shape="poly" title=" " alt="" coords="281,143,230,143,230,138,281,138"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a3e40bb61553455b6f52be0ab9a6062b1" title="Формирует SQL&#45;запрос на выборку данных из таблицы, основываясь на полученных аргументах,..." alt="" coords="125,177,237,202"/>
<area shape="poly" title=" " alt="" coords="296,160,228,179,227,174,295,155"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#ab1dc7ae1ce60a864b1d7c865e99029b0" title="Формирует SQL&#45;запрос на обновление данных в таблице, основываясь на полученных аргументах,..." alt="" coords="123,227,239,251"/>
<area shape="poly" title=" " alt="" coords="329,164,292,191,249,216,221,229,219,224,247,211,289,186,326,160"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a73d8e6acdfb996002f980ab7c9c18515" title="Удаляет данные из таблицы через вызов внутреннего метода." alt="" coords="7,5,64,30"/>
<area shape="poly" title=" " alt="" coords="109,20,64,20,64,15,109,15"/>
<area shape="poly" title=" " alt="" coords="205,66,197,60,181,57,166,59,158,64,156,70,161,77,156,80,151,70,154,61,164,54,181,52,199,55,208,61"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#aa2b6c23b3a70e9ef06c22d8a4885d69a" title="Выполняет SQL&#45;запрос с использованием JOIN через вызов внутреннего метода." alt="" coords="15,128,56,153"/>
<area shape="poly" title=" " alt="" coords="117,143,57,143,57,138,117,138"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#aab30d2495bb1362d218cd62e1556b13e" title="Выполняет SQL&#45;запрос на выборку данных из таблицы." alt="" coords="7,177,64,202"/>
<area shape="poly" title=" " alt="" coords="109,192,64,192,64,187,109,187"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a539e51bc2144b972bfafeccdda56ee9e" title="Обновляет данные в таблице через вызов внутреннего метода." alt="" coords="5,227,66,251"/>
<area shape="poly" title=" " alt="" coords="107,242,66,242,66,236,107,236"/>
</map>
</div>

</div>
</div>
<a id="a212cee52ddc3ef442f9fcce43910581c" name="a212cee52ddc3ef442f9fcce43910581c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a212cee52ddc3ef442f9fcce43910581c">&#9670;&#160;</a></span>_commit_transaction_internal()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">_commit_transaction_internal </td>
          <td>(</td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>$context</em></span><span class="paramdefsep"> = </span><span class="paramdefval">''</span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel protected">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Подтверждает транзакцию в базе данных и записывает лог с указанием контекста. </p>
<p>Этот защищённый метод выполняет следующие действия:</p><ol type="1">
<li>Подтверждает транзакцию в базе данных через объект PDO (<code>$this-&gt;pdo</code>).</li>
<li>Записывает лог с указанием контекста подтверждения транзакции с использованием функции <code>log_in_file()</code>.</li>
</ol>
<p>Этот метод предназначен для использования внутри класса или его наследников. Основная логика метода вызывается через публичный метод-редирект <code>commit_transaction()</code>.</p>
<dl class="params"><dt>Аргументы</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$context</td><td>Контекст транзакции (необязательный параметр). Используется для описания цели или места подтверждения транзакции. По умолчанию: пустая строка (&lsquo;&rsquo;'`).</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Возвращает</dt><dd>void Метод ничего не возвращает.</dd></dl>
<dl class="exception"><dt>Исключения</dt><dd>
  <table class="exception">
    <tr><td class="paramname">Exception</td><td>Выбрасывается, если произошла ошибка при подтверждении транзакции на уровне PDO. Пример сообщения: Ошибка при подтверждении транзакции | Контекст: [значение контекста] | Сообщение PDO: [текст ошибки PDO]</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Заметки</dt><dd>Метод использует функцию логирования <code>log_in_file()</code> для записи информации о подтверждении транзакции. </dd></dl>
<dl class="section warning"><dt>Предупреждения</dt><dd>Убедитесь, что транзакция была начата (<code>$this-&gt;pdo-&gt;inTransaction()</code> возвращает <code>true</code>) перед вызовом этого метода. Попытка подтвердить несуществующую транзакцию приведёт к ошибке.</dd></dl>
<p>Пример вызова метода внутри класса: </p><div class="fragment"><div class="line"><span class="comment">// Пример подтверждения транзакции с контекстом</span></div>
<div class="line">$this-&gt;<a class="code hl_function" href="#a212cee52ddc3ef442f9fcce43910581c">_commit_transaction_internal</a>(<span class="stringliteral">&#39;Сохранение данных пользователя&#39;</span>);</div>
<div class="line"><span class="comment">// Ожидаемый лог (в файле): [DB] Транзакция подтверждена | Контекст: Сохранение данных пользователя</span></div>
<div class="ttc" id="aclassPhotoRigma_1_1Classes_1_1Database_html_a212cee52ddc3ef442f9fcce43910581c"><div class="ttname"><a href="#a212cee52ddc3ef442f9fcce43910581c">PhotoRigma\Classes\Database\_commit_transaction_internal</a></div><div class="ttdeci">_commit_transaction_internal(string $context=&#39;&#39;)</div><div class="ttdoc">Подтверждает транзакцию в базе данных и записывает лог с указанием контекста.</div><div class="ttdef"><b>Определения</b> <a href="../../d2/d89/Database_8php_source.html#l00752">Database.php:752</a></div></div>
</div><!-- fragment --> <dl class="section see"><dt>См. также</dt><dd><a class="el" href="#a71aacc1f4ddbd5575362b54ac80cd0d7" title="Подтверждает транзакцию в базе данных.">PhotoRigma\Classes\Database\commit_transaction()</a> Публичный метод-редирект для вызова этой логики. </dd>
<dd>
<a class="el" href="#a9db61e1721b616500bce6ed60491752a" title="Объект PDO для подключения к базе данных">PhotoRigma\Classes\Database\$pdo</a> Объект PDO для подключения к базе данных. </dd>
<dd>
<a class="el" href="../../db/d02/namespacePhotoRigma_1_1Include.html#a2d74c46a21e4ce612a98eee60981aef0" title="Записывает сообщение об ошибке в лог-файл и, при необходимости, завершает выполнение скрипта.">PhotoRigma\Include\log_in_file()</a> Логирует сообщения в файл. </dd></dl>

<p class="definition">См. определение в файле <a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a> строка <a class="el" href="../../d2/d89/Database_8php_source.html#l00752">752</a></p>

<p class="reference">Используется в <a class="el" href="../../d2/d89/Database_8php_source.html#l00705">commit_transaction()</a>.</p>
<div id="dynsection-6" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-6-trigger" src="../../closed.png" alt="+"/> Граф вызова функции:</div>
<div id="dynsection-6-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-6-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_a212cee52ddc3ef442f9fcce43910581c_icgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a212cee52ddc3ef442f9fcce43910581c_icgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a212cee52ddc3ef442f9fcce43910581c_icgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a212cee52ddc3ef442f9fcce43910581c_icgraph">
<area shape="rect" title="Подтверждает транзакцию в базе данных и записывает лог с указанием контекста." alt="" coords="189,5,331,44"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a71aacc1f4ddbd5575362b54ac80cd0d7" title="Подтверждает транзакцию в базе данных." alt="" coords="5,12,141,37"/>
<area shape="poly" title=" " alt="" coords="173,27,141,27,141,22,173,22"/>
</map>
</div>

</div>
</div>
<a id="ad620cb343252ceea735bab03860a0915" name="ad620cb343252ceea735bab03860a0915"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad620cb343252ceea735bab03860a0915">&#9670;&#160;</a></span>_convert_from_mysql_to()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">_convert_from_mysql_to </td>
          <td>(</td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>$target_db_type</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel private">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Производит преобразование SQL-запроса из формата MySQL в целевой формат СУБД (PostgreSQL или SQLite). </p>
<p>Этот приватный метод выполняет преобразование текста SQL-запроса, хранящегося в свойстве <code>$this-&gt;txt_query</code>, из формата MySQL в формат целевой СУБД.</p>
<p>Метод выполняет следующие шаги:</p><ol type="1">
<li>Проверяет тип целевой СУБД через параметр <code>$target_db_type</code>. Метод поддерживает преобразование только в форматы PostgreSQL ('pgsql') и SQLite ('sqlite').</li>
<li>Для поддерживаемых целевых СУБД (PostgreSQL и SQLite) находит все необратимые обратные кавычки (<code>) в строке запроса и заменяет их на двойные кавычки ("). Экранированные кавычки (например, \&lt;/tt&gt; )
            остаются без изменений. Преобразованный запрос сохраняется обратно в свойство &lt;tt&gt;\$this-\&gt;txt_query&lt;/tt&gt;.
         3. Если тип целевой СУБД (&lt;tt&gt;\$target_db_type&lt;/tt&gt;) не поддерживается методом для преобразования из MySQL,
            выбрасывается исключение InvalidArgumentException.

         Этот метод является приватным и предназначен только для использования внутри класса.
         Вызывается из метода &lt;tt&gt;_convert_query()&lt;/tt&gt;.

 \internal 


@param string $target_db_type Тип целевой СУБД, в которую нужно преобразовать запрос.
                              Поддерживаемые значения: 'pgsql', 'sqlite'.
                              Ограничения: входной тип должен быть допустимым значением из списка.

@return void Метод ничего не возвращает напрямую. Результат преобразования сохраняется в свойстве
             &lt;tt&gt;\$this-\&gt;txt_query&lt;/tt&gt;.

@throws InvalidArgumentException Выбрасывается, если тип целевой СУБД (&lt;tt&gt;\$target_db_type&lt;/tt&gt;) не поддерживается
                                 методом &lt;tt&gt;_convert_from_mysql_to&lt;/tt&gt;.
                                 Пример сообщения:
                                 Неподдерживаемый тип базы данных | Тип: [target_db_type]

@note    Метод использует регулярное выражение для поиска и замены необратимых обратных кавычек на двойные
         кавычки. Преобразованный запрос сохраняется в свойстве &lt;tt&gt;\$this-\&gt;txt_query&lt;/tt&gt;.

@warning Убедитесь, что входной тип &lt;tt&gt;\$target_db_type&lt;/tt&gt; соответствует поддерживаемым значениям ('pgsql' или
         'sqlite'). Недопустимый тип может привести к выбросу исключения. Метод предполагает, что
         &lt;tt&gt;\$this-\&gt;txt_query&lt;/tt&gt; содержит SQL-запрос, использующий синтаксис идентификаторов MySQL (обратные кавычки).

Пример вызова метода внутри класса (например, из _convert_query()):
@code 
// Предположим:
// $this-&gt;txt_query = "SELECT `id`, `name` FROM `users` WHERE `status` = 1 AND `description` LIKE 'Test\`s'";
// $this-&gt;db_type установлен в 'pgsql' или 'sqlite'

// Преобразование запроса из MySQL
$this-&gt;_convert_from_mysql_to($this-&gt;db_type);

// Если $this-&gt;db_type был 'pgsql':
// echo $this-&gt;txt_query; // Результат: SELECT "id", "name" FROM "users" WHERE "status" = 1 AND "description" LIKE 'Test\\`s'

// Если $this-&gt;db_type был 'sqlite':
// echo $this-&gt;txt_query; // Результат: SELECT "id", "name" FROM "users" WHERE "status" = 1 AND "description" LIKE 'Test\`s' // (для SQLite двойные кавычки также являются допустимым способом экранирования идентификаторов)  <dl class="section see"><dt>См. также</dt><dd><a class="el" href="#a556a1b37f162e7e8b576b86c182c7309" title="Текст последнего SQL-запроса, сформированного методами класса">PhotoRigma\Classes\Database\$txt_query</a> Свойство, содержащее текст SQL-запроса, которое модифицируется методом. </dd>
<dd>
<a class="el" href="#af1b08f0490df0963b0daac6690d4765f" title="Выполняет преобразование SQL-запроса в зависимости от текущего формата и типа СУБД.">PhotoRigma\Classes\Database\_convert_query()</a> Приватный метод, из которого вызывается данный метод. </dd></dl>
</code></li>
</ol>

<p class="definition">См. определение в файле <a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a> строка <a class="el" href="../../d2/d89/Database_8php_source.html#l01597">1597</a></p>

<p class="reference">Используется в <a class="el" href="../../d2/d89/Database_8php_source.html#l01517">_convert_query()</a>.</p>
<div id="dynsection-7" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-7-trigger" src="../../closed.png" alt="+"/> Граф вызова функции:</div>
<div id="dynsection-7-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-7-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_ad620cb343252ceea735bab03860a0915_icgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_ad620cb343252ceea735bab03860a0915_icgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_ad620cb343252ceea735bab03860a0915_icgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_ad620cb343252ceea735bab03860a0915_icgraph">
<area shape="rect" title="Производит преобразование SQL&#45;запроса из формата MySQL в целевой формат СУБД (PostgreSQL или SQLite)." alt="" coords="611,129,774,154"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#af1b08f0490df0963b0daac6690d4765f" title="Выполняет преобразование SQL&#45;запроса в зависимости от текущего формата и типа СУБД." alt="" coords="453,129,563,154"/>
<area shape="poly" title=" " alt="" coords="595,144,563,144,563,139,595,139"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a941629b86b9c9e34bc5926c0db2478b5" title="Выполняет SQL&#45;запрос с использованием подготовленных выражений." alt="" coords="294,129,405,154"/>
<area shape="poly" title=" " alt="" coords="438,144,406,144,406,139,438,139"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#aa4094e522b4780bd58666dba20fdd09d" title="Формирует SQL&#45;запрос на удаление данных из таблицы, проверяет входные данные, обрабатывает недопустим..." alt="" coords="128,5,240,30"/>
<area shape="poly" title=" " alt="" coords="326,120,290,82,245,45,221,33,224,28,247,41,294,78,330,116"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a442c0348c8bd3cd7104cb110cc71348a" title="Формирует SQL&#45;запрос на вставку данных в таблицу, проверяет входные данные, обрабатывает различные ти..." alt="" coords="129,55,238,79"/>
<area shape="poly" title=" " alt="" coords="308,124,245,95,216,82,218,77,247,90,310,120"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#aa3fbbc7c98d1c241e897f0bf80177d2b" title="Формирует SQL&#45;запрос с использованием JOIN для выборки данных из нескольких таблиц,..." alt="" coords="135,104,232,129"/>
<area shape="poly" title=" " alt="" coords="278,133,233,126,233,121,279,128"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a3e40bb61553455b6f52be0ab9a6062b1" title="Формирует SQL&#45;запрос на выборку данных из таблицы, основываясь на полученных аргументах,..." alt="" coords="128,153,240,178"/>
<area shape="poly" title=" " alt="" coords="279,155,241,160,240,155,278,149"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#ad353291f086236ab7be0d1edc0ed3ba8" title="Формирует SQL&#45;запрос на очистку таблицы (TRUNCATE), размещает его в свойстве $txt_query и выполняет." alt="" coords="122,203,246,227"/>
<area shape="poly" title=" " alt="" coords="309,163,247,192,218,205,216,200,245,187,307,159"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#ab1dc7ae1ce60a864b1d7c865e99029b0" title="Формирует SQL&#45;запрос на обновление данных в таблице, основываясь на полученных аргументах,..." alt="" coords="126,252,242,277"/>
<area shape="poly" title=" " alt="" coords="329,168,293,205,247,241,224,254,221,249,245,237,290,201,326,164"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a73d8e6acdfb996002f980ab7c9c18515" title="Удаляет данные из таблицы через вызов внутреннего метода." alt="" coords="11,5,68,30"/>
<area shape="poly" title=" " alt="" coords="112,20,68,20,68,15,112,15"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a6e5af1f386c0c7968aa10ea928c7a110" title="Вставляет данные в таблицу через вызов внутреннего метода." alt="" coords="13,55,66,79"/>
<area shape="poly" title=" " alt="" coords="113,70,67,70,67,64,113,64"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#aa2b6c23b3a70e9ef06c22d8a4885d69a" title="Выполняет SQL&#45;запрос с использованием JOIN через вызов внутреннего метода." alt="" coords="19,104,60,129"/>
<area shape="poly" title=" " alt="" coords="119,119,61,119,61,114,119,114"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#aab30d2495bb1362d218cd62e1556b13e" title="Выполняет SQL&#45;запрос на выборку данных из таблицы." alt="" coords="11,153,68,178"/>
<area shape="poly" title=" " alt="" coords="112,168,68,168,68,163,112,163"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#ad4d4e455d9e4bf865126c72cf23a517b" title="Очищает таблицу (TRUNCATE) через вызов внутреннего метода." alt="" coords="5,203,74,227"/>
<area shape="poly" title=" " alt="" coords="106,218,74,218,74,212,106,212"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a539e51bc2144b972bfafeccdda56ee9e" title="Обновляет данные в таблице через вызов внутреннего метода." alt="" coords="9,252,70,277"/>
<area shape="poly" title=" " alt="" coords="110,267,70,267,70,262,110,262"/>
</map>
</div>

</div>
</div>
<a id="a2e93ad3621ba0d7cf06d36c539b6c290" name="a2e93ad3621ba0d7cf06d36c539b6c290"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2e93ad3621ba0d7cf06d36c539b6c290">&#9670;&#160;</a></span>_convert_from_pgsql_to()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">_convert_from_pgsql_to </td>
          <td>(</td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>$target_db_type</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel private">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Производит преобразование SQL-запроса из формата PostgreSQL в целевой формат СУБД (MySQL или SQLite). </p>
<p>Этот приватный метод выполняет преобразование текста SQL-запроса, хранящегося в свойстве <code>$this-&gt;txt_query</code>, из формата PostgreSQL в формат целевой СУБД.</p>
<p>Метод выполняет следующие шаги:</p><ol type="1">
<li>Проверяет тип целевой СУБД через параметр <code>$target_db_type</code>. Метод поддерживает преобразование только в форматы MySQL ('mysql') и SQLite ('sqlite').</li>
<li>Для целевой СУБД MySQL находит все необратимые двойные кавычки (") в строке запроса и заменяет
            их на обратные апострофы (`). Экранированные кавычки (например, \") остаются без изменений.
            Преобразованный запрос сохраняется обратно в свойство &lt;tt&gt;\$this-\&gt;txt_query&lt;/tt&gt;.
         3. Для целевой СУБД SQLite запрос остается без изменений, свойство &lt;tt&gt;\$this-\&gt;txt_query&lt;/tt&gt; не модифицируется.
         4. Если тип целевой СУБД (&lt;tt&gt;\$target_db_type&lt;/tt&gt;) не поддерживается методом для преобразования из PostgreSQL,
            выбрасывается исключение InvalidArgumentException.

         Этот метод является приватным и предназначен только для использования внутри класса.
         Вызывается из метода &lt;tt&gt;_convert_query()&lt;/tt&gt;.

 \internal 


@param string $target_db_type Тип целевой СУБД, в которую нужно преобразовать запрос.
                              Поддерживаемые значения: 'mysql', 'sqlite'.
                              Ограничения: входной тип должен быть допустимым значением из списка.

@return void Метод ничего не возвращает напрямую. Результат преобразования сохраняется в свойстве
             &lt;tt&gt;\$this-\&gt;txt_query&lt;/tt&gt; (если было преобразование).

@throws InvalidArgumentException Выбрасывается, если тип целевой СУБД (&lt;tt&gt;\$target_db_type&lt;/tt&gt;) не поддерживается
                                 методом &lt;tt&gt;_convert_from_pgsql_to&lt;/tt&gt;.
                                 Пример сообщения:
                                 Неподдерживаемый тип базы данных | Тип: [target_db_type]

@note    Метод использует регулярное выражение для поиска и замены необратимых двойных кавычек на обратные
         апострофы при преобразовании в MySQL. Преобразованный запрос (или исходный, если целевая СУБД -
         SQLite) сохраняется в свойстве &lt;tt&gt;\$this-\&gt;txt_query&lt;/tt&gt;.

@warning Убедитесь, что входной тип &lt;tt&gt;\$target_db_type&lt;/tt&gt; соответствует поддерживаемым значениям ('mysql' или
         'sqlite'). Недопустимый тип может привести к выбросу исключения. Метод предполагает, что
         &lt;tt&gt;\$this-\&gt;txt_query&lt;/tt&gt; содержит SQL-запрос, использующий синтаксис идентификаторов PostgreSQL (двойные
         кавычки).

Пример вызова метода внутри класса (например, из _convert_query()):
@code 
// Предположим:
// $this-&gt;txt_query = 'SELECT "id", "name" FROM "users" WHERE "status" = 1 AND "description" LIKE \'Test\\"s\'';
// $this-&gt;current_format = 'pgsql';
// $this-&gt;db_type установлен в 'mysql' или 'sqlite'

// Преобразование запроса из PostgreSQL
$this-&gt;_convert_from_pgsql_to($this-&gt;db_type);

// Если $this-&gt;db_type был 'mysql':
// echo $this-&gt;txt_query; // Результат: SELECT `id`, `name` FROM `users` WHERE `status` = 1 AND `description` LIKE 'Test\\"s'

// Если $this-&gt;db_type был 'sqlite':
// echo $this-&gt;txt_query; // Результат: SELECT "id", "name" FROM "users" WHERE "status" = 1 AND "description" LIKE 'Test\\"s' // (запрос остается без изменений)  <dl class="section see"><dt>См. также</dt><dd><a class="el" href="#a556a1b37f162e7e8b576b86c182c7309" title="Текст последнего SQL-запроса, сформированного методами класса">PhotoRigma\Classes\Database\$txt_query</a> Свойство, содержащее текст SQL-запроса, которое модифицируется методом (или остается без изменений). </dd>
<dd>
<a class="el" href="#af1b08f0490df0963b0daac6690d4765f" title="Выполняет преобразование SQL-запроса в зависимости от текущего формата и типа СУБД.">PhotoRigma\Classes\Database\_convert_query()</a> Приватный метод, из которого вызывается данный метод. </dd></dl>
</li>
</ol>

<p class="definition">См. определение в файле <a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a> строка <a class="el" href="../../d2/d89/Database_8php_source.html#l01674">1674</a></p>

<p class="reference">Перекрестные ссылки <a class="el" href="../../d2/d89/Database_8php_source.html#l00205">$txt_query</a>.</p>

<p class="reference">Используется в <a class="el" href="../../d2/d89/Database_8php_source.html#l01517">_convert_query()</a>.</p>
<div id="dynsection-8" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-8-trigger" src="../../closed.png" alt="+"/> Граф вызова функции:</div>
<div id="dynsection-8-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-8-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_a2e93ad3621ba0d7cf06d36c539b6c290_icgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a2e93ad3621ba0d7cf06d36c539b6c290_icgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a2e93ad3621ba0d7cf06d36c539b6c290_icgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a2e93ad3621ba0d7cf06d36c539b6c290_icgraph">
<area shape="rect" title="Производит преобразование SQL&#45;запроса из формата PostgreSQL в целевой формат СУБД (MySQL или SQLite)." alt="" coords="611,129,771,154"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#af1b08f0490df0963b0daac6690d4765f" title="Выполняет преобразование SQL&#45;запроса в зависимости от текущего формата и типа СУБД." alt="" coords="453,129,563,154"/>
<area shape="poly" title=" " alt="" coords="595,144,563,144,563,139,595,139"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a941629b86b9c9e34bc5926c0db2478b5" title="Выполняет SQL&#45;запрос с использованием подготовленных выражений." alt="" coords="294,129,405,154"/>
<area shape="poly" title=" " alt="" coords="438,144,406,144,406,139,438,139"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#aa4094e522b4780bd58666dba20fdd09d" title="Формирует SQL&#45;запрос на удаление данных из таблицы, проверяет входные данные, обрабатывает недопустим..." alt="" coords="128,5,240,30"/>
<area shape="poly" title=" " alt="" coords="326,120,290,82,245,45,221,33,224,28,247,41,294,78,330,116"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a442c0348c8bd3cd7104cb110cc71348a" title="Формирует SQL&#45;запрос на вставку данных в таблицу, проверяет входные данные, обрабатывает различные ти..." alt="" coords="129,55,238,79"/>
<area shape="poly" title=" " alt="" coords="308,124,245,95,216,82,218,77,247,90,310,120"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#aa3fbbc7c98d1c241e897f0bf80177d2b" title="Формирует SQL&#45;запрос с использованием JOIN для выборки данных из нескольких таблиц,..." alt="" coords="135,104,232,129"/>
<area shape="poly" title=" " alt="" coords="278,133,233,126,233,121,279,128"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a3e40bb61553455b6f52be0ab9a6062b1" title="Формирует SQL&#45;запрос на выборку данных из таблицы, основываясь на полученных аргументах,..." alt="" coords="128,153,240,178"/>
<area shape="poly" title=" " alt="" coords="279,155,241,160,240,155,278,149"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#ad353291f086236ab7be0d1edc0ed3ba8" title="Формирует SQL&#45;запрос на очистку таблицы (TRUNCATE), размещает его в свойстве $txt_query и выполняет." alt="" coords="122,203,246,227"/>
<area shape="poly" title=" " alt="" coords="309,163,247,192,218,205,216,200,245,187,307,159"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#ab1dc7ae1ce60a864b1d7c865e99029b0" title="Формирует SQL&#45;запрос на обновление данных в таблице, основываясь на полученных аргументах,..." alt="" coords="126,252,242,277"/>
<area shape="poly" title=" " alt="" coords="329,168,293,205,247,241,224,254,221,249,245,237,290,201,326,164"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a73d8e6acdfb996002f980ab7c9c18515" title="Удаляет данные из таблицы через вызов внутреннего метода." alt="" coords="11,5,68,30"/>
<area shape="poly" title=" " alt="" coords="112,20,68,20,68,15,112,15"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a6e5af1f386c0c7968aa10ea928c7a110" title="Вставляет данные в таблицу через вызов внутреннего метода." alt="" coords="13,55,66,79"/>
<area shape="poly" title=" " alt="" coords="113,70,67,70,67,64,113,64"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#aa2b6c23b3a70e9ef06c22d8a4885d69a" title="Выполняет SQL&#45;запрос с использованием JOIN через вызов внутреннего метода." alt="" coords="19,104,60,129"/>
<area shape="poly" title=" " alt="" coords="119,119,61,119,61,114,119,114"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#aab30d2495bb1362d218cd62e1556b13e" title="Выполняет SQL&#45;запрос на выборку данных из таблицы." alt="" coords="11,153,68,178"/>
<area shape="poly" title=" " alt="" coords="112,168,68,168,68,163,112,163"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#ad4d4e455d9e4bf865126c72cf23a517b" title="Очищает таблицу (TRUNCATE) через вызов внутреннего метода." alt="" coords="5,203,74,227"/>
<area shape="poly" title=" " alt="" coords="106,218,74,218,74,212,106,212"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a539e51bc2144b972bfafeccdda56ee9e" title="Обновляет данные в таблице через вызов внутреннего метода." alt="" coords="9,252,70,277"/>
<area shape="poly" title=" " alt="" coords="110,267,70,267,70,262,110,262"/>
</map>
</div>

</div>
</div>
<a id="a44e1aec00a15341cd9119261482eeb0d" name="a44e1aec00a15341cd9119261482eeb0d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a44e1aec00a15341cd9119261482eeb0d">&#9670;&#160;</a></span>_convert_from_sqlite_to()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">_convert_from_sqlite_to </td>
          <td>(</td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>$target_db_type</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel private">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Производит преобразование SQL-запроса из формата SQLite в целевой формат СУБД (MySQL или PostgreSQL). </p>
<p>Этот приватный метод выполняет преобразование текста SQL-запроса, хранящегося в свойстве <code>$this-&gt;txt_query</code>, из формата SQLite в формат целевой СУБД. SQLite поддерживает экранирование идентификаторов с помощью двойных кавычек (") или квадратных скобок ([ ]).

         Метод выполняет следующие шаги:
         1. Проверяет тип целевой СУБД через параметр &lt;tt&gt;\$target_db_type&lt;/tt&gt;. Метод поддерживает преобразование
            только в форматы MySQL ('mysql') и PostgreSQL ('pgsql').
         2. Для целевой СУБД MySQL находит идентификаторы, экранированные двойными кавычками (") или квадратными скобками ([ ]), и заменяет их на обратные апострофы (<code>).</p><ol type="1">
<li>Для целевой СУБД PostgreSQL находит идентификаторы, экранированные квадратными скобками ([ ]), и заменяет их на двойные кавычки ("). Идентификаторы в двойных кавычках (") остаются без изменений, так как они допустимы в PostgreSQL.</li>
<li>Если тип целевой СУБД (</li>
</ol>
<p></code>$target_db_type<code>) не поддерживается методом для преобразования из SQLite, выбрасывается исключение InvalidArgumentException. Преобразованный запрос сохраняется обратно в свойство</code>$this-&gt;txt_query`.</p>
<p>Этот метод является приватным и предназначен только для использования внутри класса. Вызывается из метода <code>_convert_query()</code>.</p>
<dl class="params"><dt>Аргументы</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$target_db_type</td><td>Тип целевой СУБД, в которую нужно преобразовать запрос. Поддерживаемые значения: 'mysql', 'pgsql'. Ограничения: входной тип должен быть допустимым значением из списка.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Возвращает</dt><dd>void Метод ничего не возвращает напрямую. Результат преобразования сохраняется в свойстве <code>$this-&gt;txt_query</code>.</dd></dl>
<dl class="exception"><dt>Исключения</dt><dd>
  <table class="exception">
    <tr><td class="paramname">InvalidArgumentException</td><td>Выбрасывается, если тип целевой СУБД (<code>$target_db_type</code>) не поддерживается методом <code>_convert_from_sqlite_to</code>. Пример сообщения: Неподдерживаемый тип базы данных | Тип: [target_db_type]</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Заметки</dt><dd>Метод использует регулярные выражения для поиска идентификаторов в двойных кавычках или квадратных скобках и их замены. Преобразованный запрос сохраняется в свойстве <code>$this-&gt;txt_query</code>.</dd></dl>
<dl class="section warning"><dt>Предупреждения</dt><dd>Убедитесь, что входной тип <code>$target_db_type</code> соответствует поддерживаемым значениям ('mysql' или 'pgsql'). Недопустимый тип может привести к выбросу исключения. Метод предполагает, что <code>$this-&gt;txt_query</code> содержит SQL-запрос, использующий синтаксис идентификаторов SQLite (двойные кавычки или квадратные скобки).</dd></dl>
<p>Пример вызова метода внутри класса (например, из _convert_query()): </p><div class="fragment"><div class="line"><span class="comment">// Предположим:</span></div>
<div class="line"><span class="comment">// $this-&gt;txt_query = &#39;SELECT &quot;id&quot;, [name] FROM [users] WHERE id = 1&#39;;</span></div>
<div class="line"><span class="comment">// $this-&gt;current_format = &#39;sqlite&#39;;</span></div>
<div class="line"><span class="comment">// $this-&gt;db_type установлен в &#39;mysql&#39; или &#39;pgsql&#39;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Преобразование запроса из SQLite в MySQL</span></div>
<div class="line">$this-&gt;<a class="code hl_function" href="#a44e1aec00a15341cd9119261482eeb0d">_convert_from_sqlite_to</a>(<span class="stringliteral">&#39;mysql&#39;</span>);</div>
<div class="line"><span class="comment">// echo $this-&gt;txt_query; // Результат: SELECT `id`, `name` FROM `users` WHERE id = 1</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Предположим:</span></div>
<div class="line"><span class="comment">// $this-&gt;txt_query = &#39;SELECT &quot;id&quot;, [name] FROM [users] WHERE id = 1&#39;;</span></div>
<div class="line"><span class="comment">// $this-&gt;current_format = &#39;sqlite&#39;;</span></div>
<div class="line"><span class="comment">// $this-&gt;db_type установлен в &#39;pgsql&#39;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Преобразование запроса из SQLite в PostgreSQL</span></div>
<div class="line">$this-&gt;<a class="code hl_function" href="#a44e1aec00a15341cd9119261482eeb0d">_convert_from_sqlite_to</a>(<span class="stringliteral">&#39;pgsql&#39;</span>);</div>
<div class="line"><span class="comment">// echo $this-&gt;txt_query; // Результат: SELECT &quot;id&quot;, &quot;name&quot; FROM &quot;users&quot; WHERE id = 1</span></div>
<div class="ttc" id="aclassPhotoRigma_1_1Classes_1_1Database_html_a44e1aec00a15341cd9119261482eeb0d"><div class="ttname"><a href="#a44e1aec00a15341cd9119261482eeb0d">PhotoRigma\Classes\Database\_convert_from_sqlite_to</a></div><div class="ttdeci">_convert_from_sqlite_to(string $target_db_type)</div><div class="ttdoc">Производит преобразование SQL-запроса из формата SQLite в целевой формат СУБД (MySQL или PostgreSQL).</div><div class="ttdef"><b>Определения</b> <a href="../../d2/d89/Database_8php_source.html#l01760">Database.php:1760</a></div></div>
</div><!-- fragment --> <dl class="section see"><dt>См. также</dt><dd><a class="el" href="#a556a1b37f162e7e8b576b86c182c7309" title="Текст последнего SQL-запроса, сформированного методами класса">PhotoRigma\Classes\Database\$txt_query</a> Свойство, содержащее текст SQL-запроса, которое модифицируется методом. </dd>
<dd>
<a class="el" href="#af1b08f0490df0963b0daac6690d4765f" title="Выполняет преобразование SQL-запроса в зависимости от текущего формата и типа СУБД.">PhotoRigma\Classes\Database\_convert_query()</a> Приватный метод, из которого вызывается данный метод. </dd></dl>
<p>@noinspection RegExpUnnecessaryNonCapturingGroup @noinspection RegExpSimplifiable @noinspection RegExpDuplicateCharacterInClass @noinspection RegExpRedundantEscape</p>

<p class="definition">См. определение в файле <a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a> строка <a class="el" href="../../d2/d89/Database_8php_source.html#l01760">1760</a></p>

<p class="reference">Перекрестные ссылки <a class="el" href="../../d2/d89/Database_8php_source.html#l00205">$txt_query</a>.</p>

<p class="reference">Используется в <a class="el" href="../../d2/d89/Database_8php_source.html#l01517">_convert_query()</a>.</p>
<div id="dynsection-9" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-9-trigger" src="../../closed.png" alt="+"/> Граф вызова функции:</div>
<div id="dynsection-9-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-9-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_a44e1aec00a15341cd9119261482eeb0d_icgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a44e1aec00a15341cd9119261482eeb0d_icgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a44e1aec00a15341cd9119261482eeb0d_icgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a44e1aec00a15341cd9119261482eeb0d_icgraph">
<area shape="rect" title="Производит преобразование SQL&#45;запроса из формата SQLite в целевой формат СУБД (MySQL или PostgreSQL)." alt="" coords="611,129,771,154"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#af1b08f0490df0963b0daac6690d4765f" title="Выполняет преобразование SQL&#45;запроса в зависимости от текущего формата и типа СУБД." alt="" coords="453,129,563,154"/>
<area shape="poly" title=" " alt="" coords="595,144,563,144,563,139,595,139"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a941629b86b9c9e34bc5926c0db2478b5" title="Выполняет SQL&#45;запрос с использованием подготовленных выражений." alt="" coords="294,129,405,154"/>
<area shape="poly" title=" " alt="" coords="438,144,406,144,406,139,438,139"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#aa4094e522b4780bd58666dba20fdd09d" title="Формирует SQL&#45;запрос на удаление данных из таблицы, проверяет входные данные, обрабатывает недопустим..." alt="" coords="128,5,240,30"/>
<area shape="poly" title=" " alt="" coords="326,120,290,82,245,45,221,33,224,28,247,41,294,78,330,116"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a442c0348c8bd3cd7104cb110cc71348a" title="Формирует SQL&#45;запрос на вставку данных в таблицу, проверяет входные данные, обрабатывает различные ти..." alt="" coords="129,55,238,79"/>
<area shape="poly" title=" " alt="" coords="308,124,245,95,216,82,218,77,247,90,310,120"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#aa3fbbc7c98d1c241e897f0bf80177d2b" title="Формирует SQL&#45;запрос с использованием JOIN для выборки данных из нескольких таблиц,..." alt="" coords="135,104,232,129"/>
<area shape="poly" title=" " alt="" coords="278,133,233,126,233,121,279,128"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a3e40bb61553455b6f52be0ab9a6062b1" title="Формирует SQL&#45;запрос на выборку данных из таблицы, основываясь на полученных аргументах,..." alt="" coords="128,153,240,178"/>
<area shape="poly" title=" " alt="" coords="279,155,241,160,240,155,278,149"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#ad353291f086236ab7be0d1edc0ed3ba8" title="Формирует SQL&#45;запрос на очистку таблицы (TRUNCATE), размещает его в свойстве $txt_query и выполняет." alt="" coords="122,203,246,227"/>
<area shape="poly" title=" " alt="" coords="309,163,247,192,218,205,216,200,245,187,307,159"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#ab1dc7ae1ce60a864b1d7c865e99029b0" title="Формирует SQL&#45;запрос на обновление данных в таблице, основываясь на полученных аргументах,..." alt="" coords="126,252,242,277"/>
<area shape="poly" title=" " alt="" coords="329,168,293,205,247,241,224,254,221,249,245,237,290,201,326,164"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a73d8e6acdfb996002f980ab7c9c18515" title="Удаляет данные из таблицы через вызов внутреннего метода." alt="" coords="11,5,68,30"/>
<area shape="poly" title=" " alt="" coords="112,20,68,20,68,15,112,15"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a6e5af1f386c0c7968aa10ea928c7a110" title="Вставляет данные в таблицу через вызов внутреннего метода." alt="" coords="13,55,66,79"/>
<area shape="poly" title=" " alt="" coords="113,70,67,70,67,64,113,64"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#aa2b6c23b3a70e9ef06c22d8a4885d69a" title="Выполняет SQL&#45;запрос с использованием JOIN через вызов внутреннего метода." alt="" coords="19,104,60,129"/>
<area shape="poly" title=" " alt="" coords="119,119,61,119,61,114,119,114"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#aab30d2495bb1362d218cd62e1556b13e" title="Выполняет SQL&#45;запрос на выборку данных из таблицы." alt="" coords="11,153,68,178"/>
<area shape="poly" title=" " alt="" coords="112,168,68,168,68,163,112,163"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#ad4d4e455d9e4bf865126c72cf23a517b" title="Очищает таблицу (TRUNCATE) через вызов внутреннего метода." alt="" coords="5,203,74,227"/>
<area shape="poly" title=" " alt="" coords="106,218,74,218,74,212,106,212"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a539e51bc2144b972bfafeccdda56ee9e" title="Обновляет данные в таблице через вызов внутреннего метода." alt="" coords="9,252,70,277"/>
<area shape="poly" title=" " alt="" coords="110,267,70,267,70,262,110,262"/>
</map>
</div>

</div>
</div>
<a id="af1b08f0490df0963b0daac6690d4765f" name="af1b08f0490df0963b0daac6690d4765f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af1b08f0490df0963b0daac6690d4765f">&#9670;&#160;</a></span>_convert_query()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">_convert_query </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel private">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Выполняет преобразование SQL-запроса в зависимости от текущего формата и типа СУБД. </p>
<p>Этот приватный метод выполняет преобразование текста SQL-запроса, хранящегося в свойстве <code>$this-&gt;txt_query</code>, для обеспечения совместимости с целевой базой данных.</p>
<p>Метод выполняет следующие шаги:</p><ol type="1">
<li>Проверяет, совпадает ли текущий формат строки запроса (<code>$this-&gt;current_format</code>) с типом базы данных (<code>$this-&gt;db_type</code>). Если форматы совпадают, преобразование не требуется, и метод завершает работу.</li>
<li>Если форматы не совпадают, вызывает соответствующий приватный метод для выполнения преобразования из текущего формата (<code>$this-&gt;current_format</code>) в формат целевой СУБД (<code>$this-&gt;db_type</code>). Вызываемые методы (<code>_convert_from_mysql_to()</code>, <code>_convert_from_pgsql_to()</code>, <code>_convert_from_sqlite_to()</code>) модифицируют свойство <code>$this-&gt;txt_query</code> с преобразованным текстом запроса.</li>
<li>Если текущий формат строки (<code>$this-&gt;current_format</code>) не поддерживается для преобразования, выбрасывается исключение InvalidArgumentException.</li>
</ol>
<p>Этот метод является приватным и предназначен только для использования внутри класса. Основной вызывающий метод — <code>_execute_query()</code>.</p>
<dl class="section return"><dt>Возвращает</dt><dd>void Метод ничего не возвращает напрямую. Результат преобразования сохраняется в свойстве <code>$this-&gt;txt_query</code>.</dd></dl>
<dl class="exception"><dt>Исключения</dt><dd>
  <table class="exception">
    <tr><td class="paramname">InvalidArgumentException</td><td>Выбрасывается, если текущий формат строки (<code>$this-&gt;current_format</code>) не поддерживается для преобразования. Пример сообщения: Не поддерживаемый формат строки | Тип: [current_format]</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Заметки</dt><dd>Метод зависит от свойств <code>$this-&gt;current_format</code> и <code>$this-&gt;db_type</code> для определения необходимости и типа преобразования. Преобразованный текст запроса всегда сохраняется обратно в свойство <code>$this-&gt;txt_query</code>.</dd></dl>
<dl class="section warning"><dt>Предупреждения</dt><dd>Убедитесь, что свойство <code>$this-&gt;current_format</code> содержит одно из допустимых значений форматов ('mysql', 'pgsql', 'sqlite') перед вызовом этого метода. Недопустимый формат может привести к выбросу исключения. Убедитесь также, что <code>$this-&gt;txt_query</code> содержит исходный текст запроса, который требуется преобразовать.</dd></dl>
<p>Пример вызова метода внутри класса (например, из _execute_query()): </p><div class="fragment"><div class="line"><span class="comment">// Предположим:</span></div>
<div class="line"><span class="comment">// $this-&gt;txt_query = &quot;SELECT * FROM `users` WHERE id = 1&quot;;</span></div>
<div class="line"><span class="comment">// $this-&gt;current_format = &#39;mysql&#39;;</span></div>
<div class="line"><span class="comment">// $this-&gt;db_type = &#39;pgsql&#39;;</span></div>
<div class="line"> </div>
<div class="line">$this-&gt;<a class="code hl_function" href="#af1b08f0490df0963b0daac6690d4765f">_convert_query</a>(); <span class="comment">// Выполнит $this-&gt;_convert_from_mysql_to(&#39;pgsql&#39;)</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Теперь $this-&gt;txt_query содержит преобразованный запрос для PostgreSQL:</span></div>
<div class="line"><span class="comment">// echo $this-&gt;txt_query; // Результат: SELECT * FROM &quot;users&quot; WHERE id = 1</span></div>
<div class="ttc" id="aclassPhotoRigma_1_1Classes_1_1Database_html_af1b08f0490df0963b0daac6690d4765f"><div class="ttname"><a href="#af1b08f0490df0963b0daac6690d4765f">PhotoRigma\Classes\Database\_convert_query</a></div><div class="ttdeci">_convert_query()</div><div class="ttdoc">Выполняет преобразование SQL-запроса в зависимости от текущего формата и типа СУБД.</div><div class="ttdef"><b>Определения</b> <a href="../../d2/d89/Database_8php_source.html#l01517">Database.php:1517</a></div></div>
</div><!-- fragment --> <dl class="section see"><dt>См. также</dt><dd><a class="el" href="#a556a1b37f162e7e8b576b86c182c7309" title="Текст последнего SQL-запроса, сформированного методами класса">PhotoRigma\Classes\Database\$txt_query</a> Свойство, содержащее текст SQL-запроса, которое модифицируется методом. </dd>
<dd>
<a class="el" href="#a8c3cf443d91cde7347577cddf302a9d0" title="Хранит текущий формат SQL (например, &#39;mysql&#39;, &#39;pgsql&#39;, &#39;sqlite&#39;).">PhotoRigma\Classes\Database\$current_format</a> Свойство, определяющее исходный формат строки запроса. </dd>
<dd>
<a class="el" href="#a072c45961a79433ff94013278707ade5" title="Тип базы данных (mysql, pgsql, sqlite)">PhotoRigma\Classes\Database\$db_type</a> Свойство, определяющее целевой тип используемой СУБД. </dd>
<dd>
<a class="el" href="#ad620cb343252ceea735bab03860a0915" title="Производит преобразование SQL-запроса из формата MySQL в целевой формат СУБД (PostgreSQL или SQLite).">PhotoRigma\Classes\Database\_convert_from_mysql_to()</a> Приватный метод для преобразования запросов из формата MySQL в другие. </dd>
<dd>
<a class="el" href="#a2e93ad3621ba0d7cf06d36c539b6c290" title="Производит преобразование SQL-запроса из формата PostgreSQL в целевой формат СУБД (MySQL или SQLite).">PhotoRigma\Classes\Database\_convert_from_pgsql_to()</a> Приватный метод для преобразования запросов из формата PostgreSQL в другие. </dd>
<dd>
<a class="el" href="#a44e1aec00a15341cd9119261482eeb0d" title="Производит преобразование SQL-запроса из формата SQLite в целевой формат СУБД (MySQL или PostgreSQL).">PhotoRigma\Classes\Database\_convert_from_sqlite_to()</a> Приватный метод для преобразования запросов из формата SQLite в другие. </dd>
<dd>
<a class="el" href="#a941629b86b9c9e34bc5926c0db2478b5" title="Выполняет SQL-запрос с использованием подготовленных выражений.">PhotoRigma\Classes\Database\_execute_query()</a> Приватный метод, из которого вызывается данный метод. </dd></dl>

<p class="definition">См. определение в файле <a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a> строка <a class="el" href="../../d2/d89/Database_8php_source.html#l01517">1517</a></p>

<p class="reference">Перекрестные ссылки <a class="el" href="../../d2/d89/Database_8php_source.html#l01597">_convert_from_mysql_to()</a>, <a class="el" href="../../d2/d89/Database_8php_source.html#l01674">_convert_from_pgsql_to()</a> и <a class="el" href="../../d2/d89/Database_8php_source.html#l01760">_convert_from_sqlite_to()</a>.</p>

<p class="reference">Используется в <a class="el" href="../../d2/d89/Database_8php_source.html#l01393">_execute_query()</a>.</p>
<div id="dynsection-10" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-10-trigger" src="../../closed.png" alt="+"/> Граф вызовов:</div>
<div id="dynsection-10-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-10-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_af1b08f0490df0963b0daac6690d4765f_cgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_af1b08f0490df0963b0daac6690d4765f_cgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_af1b08f0490df0963b0daac6690d4765f_cgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_af1b08f0490df0963b0daac6690d4765f_cgraph">
<area shape="rect" title="Выполняет преобразование SQL&#45;запроса в зависимости от текущего формата и типа СУБД." alt="" coords="5,55,115,79"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#ad620cb343252ceea735bab03860a0915" title="Производит преобразование SQL&#45;запроса из формата MySQL в целевой формат СУБД (PostgreSQL или SQLite)." alt="" coords="163,5,326,30"/>
<area shape="poly" title=" " alt="" coords="108,51,180,32,182,37,110,57"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a2e93ad3621ba0d7cf06d36c539b6c290" title="Производит преобразование SQL&#45;запроса из формата PostgreSQL в целевой формат СУБД (MySQL или SQLite)." alt="" coords="164,55,324,79"/>
<area shape="poly" title=" " alt="" coords="115,64,148,64,148,70,115,70"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a44e1aec00a15341cd9119261482eeb0d" title="Производит преобразование SQL&#45;запроса из формата SQLite в целевой формат СУБД (MySQL или PostgreSQL)." alt="" coords="164,104,324,129"/>
<area shape="poly" title=" " alt="" coords="110,77,182,97,180,102,108,83"/>
</map>
</div>
<div id="dynsection-11" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-11-trigger" src="../../closed.png" alt="+"/> Граф вызова функции:</div>
<div id="dynsection-11-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-11-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_af1b08f0490df0963b0daac6690d4765f_icgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_af1b08f0490df0963b0daac6690d4765f_icgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_af1b08f0490df0963b0daac6690d4765f_icgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_af1b08f0490df0963b0daac6690d4765f_icgraph">
<area shape="rect" title="Выполняет преобразование SQL&#45;запроса в зависимости от текущего формата и типа СУБД." alt="" coords="453,129,563,154"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a941629b86b9c9e34bc5926c0db2478b5" title="Выполняет SQL&#45;запрос с использованием подготовленных выражений." alt="" coords="294,129,405,154"/>
<area shape="poly" title=" " alt="" coords="438,144,406,144,406,139,438,139"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#aa4094e522b4780bd58666dba20fdd09d" title="Формирует SQL&#45;запрос на удаление данных из таблицы, проверяет входные данные, обрабатывает недопустим..." alt="" coords="128,5,240,30"/>
<area shape="poly" title=" " alt="" coords="326,120,290,82,245,45,221,33,224,28,247,41,294,78,330,116"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a442c0348c8bd3cd7104cb110cc71348a" title="Формирует SQL&#45;запрос на вставку данных в таблицу, проверяет входные данные, обрабатывает различные ти..." alt="" coords="129,55,238,79"/>
<area shape="poly" title=" " alt="" coords="308,124,245,95,216,82,218,77,247,90,310,120"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#aa3fbbc7c98d1c241e897f0bf80177d2b" title="Формирует SQL&#45;запрос с использованием JOIN для выборки данных из нескольких таблиц,..." alt="" coords="135,104,232,129"/>
<area shape="poly" title=" " alt="" coords="278,133,233,126,233,121,279,128"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a3e40bb61553455b6f52be0ab9a6062b1" title="Формирует SQL&#45;запрос на выборку данных из таблицы, основываясь на полученных аргументах,..." alt="" coords="128,153,240,178"/>
<area shape="poly" title=" " alt="" coords="279,155,241,160,240,155,278,149"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#ad353291f086236ab7be0d1edc0ed3ba8" title="Формирует SQL&#45;запрос на очистку таблицы (TRUNCATE), размещает его в свойстве $txt_query и выполняет." alt="" coords="122,203,246,227"/>
<area shape="poly" title=" " alt="" coords="309,163,247,192,218,205,216,200,245,187,307,159"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#ab1dc7ae1ce60a864b1d7c865e99029b0" title="Формирует SQL&#45;запрос на обновление данных в таблице, основываясь на полученных аргументах,..." alt="" coords="126,252,242,277"/>
<area shape="poly" title=" " alt="" coords="329,168,293,205,247,241,224,254,221,249,245,237,290,201,326,164"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a73d8e6acdfb996002f980ab7c9c18515" title="Удаляет данные из таблицы через вызов внутреннего метода." alt="" coords="11,5,68,30"/>
<area shape="poly" title=" " alt="" coords="112,20,68,20,68,15,112,15"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a6e5af1f386c0c7968aa10ea928c7a110" title="Вставляет данные в таблицу через вызов внутреннего метода." alt="" coords="13,55,66,79"/>
<area shape="poly" title=" " alt="" coords="113,70,67,70,67,64,113,64"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#aa2b6c23b3a70e9ef06c22d8a4885d69a" title="Выполняет SQL&#45;запрос с использованием JOIN через вызов внутреннего метода." alt="" coords="19,104,60,129"/>
<area shape="poly" title=" " alt="" coords="119,119,61,119,61,114,119,114"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#aab30d2495bb1362d218cd62e1556b13e" title="Выполняет SQL&#45;запрос на выборку данных из таблицы." alt="" coords="11,153,68,178"/>
<area shape="poly" title=" " alt="" coords="112,168,68,168,68,163,112,163"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#ad4d4e455d9e4bf865126c72cf23a517b" title="Очищает таблицу (TRUNCATE) через вызов внутреннего метода." alt="" coords="5,203,74,227"/>
<area shape="poly" title=" " alt="" coords="106,218,74,218,74,212,106,212"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a539e51bc2144b972bfafeccdda56ee9e" title="Обновляет данные в таблице через вызов внутреннего метода." alt="" coords="9,252,70,277"/>
<area shape="poly" title=" " alt="" coords="110,267,70,267,70,262,110,262"/>
</map>
</div>

</div>
</div>
<a id="a5f4312bd1da12e43a8f9a046ed068ebd" name="a5f4312bd1da12e43a8f9a046ed068ebd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5f4312bd1da12e43a8f9a046ed068ebd">&#9670;&#160;</a></span>_convert_to_mysql_format()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">_convert_to_mysql_format </td>
          <td>(</td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>$format</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel private">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Производит преобразование строки формата даты/времени в формат, совместимый с MySQL (<code>DATE_FORMAT</code>). </p>
<p>Этот приватный метод преобразует строку формата даты или времени из формата, соответствующего текущему формату строки (<code>$this-&gt;current_format</code>), в формат, совместимый с функцией MySQL <code>DATE_FORMAT()</code>. Метод выполняет следующие шаги:</p><ol type="1">
<li>Проверяет, совпадает ли текущий формат строки (<code>$this-&gt;current_format</code>) с 'mysql'. Если форматы совпадают, входная строка <code>$format</code> уже считается MySQL-совместимой и возвращается без изменений.</li>
<li>Проверяет, существует ли уже преобразованная строка формата в кэше <code>$this-&gt;format_cache</code> для текущего исходного формата (<code>$this-&gt;current_format</code>) и входной строки <code>$format</code>. Если найдено в кэше, преобразованное значение возвращается немедленно.</li>
<li>Если формат не 'mysql' и не найден в кэше, определяет карту соответствия символов формата для преобразования из <code>$this-&gt;current_format</code> в MySQL. Поддерживаемые исходные форматы: 'pgsql' и 'sqlite'.</li>
<li>Если текущий формат (<code>$this-&gt;current_format</code>) не является поддерживаемым исходным форматом для преобразования в MySQL, выбрасывается исключение InvalidArgumentException.</li>
<li>Использует карту соответствия для преобразования входной строки <code>$format</code> с помощью <code>strtr()</code>.</li>
<li>Сохраняет результат преобразования в кэше <code>$this-&gt;format_cache</code> для будущего использования.</li>
<li>Возвращает преобразованную строку формата, совместимую с MySQL <code>DATE_FORMAT()</code>.</li>
</ol>
<p>Этот метод является приватным и предназначен только для использования внутри класса. Вызывается из метода <code>_format_date_internal()</code> при работе с СУБД MySQL.</p>
<dl class="params"><dt>Аргументы</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$format</td><td>Строка формата даты/времени в стиле текущего формата строки (<code>$this-&gt;current_format</code>). Пример: 'YYYY-MM-DD' для формата PostgreSQL или 'Y-m-d' для формата SQLite/MySQL.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Возвращает</dt><dd>string Строка формата даты/времени, преобразованная в стиль, совместимый с функцией MySQL <code>DATE_FORMAT ()</code>. Пример: 'Y-m-d'.</dd></dl>
<dl class="exception"><dt>Исключения</dt><dd>
  <table class="exception">
    <tr><td class="paramname">InvalidArgumentException</td><td>Выбрасывается, если текущий формат строки (<code>$this-&gt;current_format</code>) не поддерживается методом <code>_convert_to_mysql_format</code> в качестве исходного формата для преобразования в MySQL. Пример сообщения: Неизвестный формат | Формат: [current_format]</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Заметки</dt><dd>Метод использует кэширование (<code>$this-&gt;format_cache</code>) для хранения результатов преобразования форматов и избежания повторных вычислений. Используется строковая замена (<code>strtr()</code>) на основе предопределенных карт соответствия. Поведение метода зависит от свойства <code>$this-&gt;current_format</code>.</dd></dl>
<dl class="section warning"><dt>Предупреждения</dt><dd>Убедитесь, что свойство <code>$this-&gt;current_format</code> содержит одно из допустимых значений ('mysql', 'pgsql', 'sqlite') перед вызовом этого метода. Убедитесь, что входная строка <code>$format</code> соответствует синтаксису формата, ожидаемому для <code>$this-&gt;current_format</code>. Неподдерживаемый исходный формат приведет к исключению.</dd></dl>
<p>Пример вызова метода внутри класса (например, из _format_date_internal()): </p><div class="fragment"><div class="line"><span class="comment">// Предположим:</span></div>
<div class="line"><span class="comment">// $this-&gt;current_format = &#39;pgsql&#39;;</span></div>
<div class="line"><span class="comment">// $this-&gt;db_type = &#39;mysql&#39;;</span></div>
<div class="line"><span class="comment">// $pgsql_format = &#39;YYYY-MM-DD HH24:MI:SS&#39;;</span></div>
<div class="line"> </div>
<div class="line">$mysql_format = $this-&gt;<a class="code hl_function" href="#a5f4312bd1da12e43a8f9a046ed068ebd">_convert_to_mysql_format</a>($pgsql_format);</div>
<div class="line"><span class="comment">// $mysql_format будет равен &#39;%Y-%m-%d %H:%i:%s&#39; (взято из кэша или преобразовано)</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Затем этот формат может быть использован с функцией MySQL DATE_FORMAT:</span></div>
<div class="line"><span class="comment">// DATE_FORMAT(column, &#39;%Y-%m-%d %H:%i:%s&#39;)</span></div>
<div class="ttc" id="aclassPhotoRigma_1_1Classes_1_1Database_html_a5f4312bd1da12e43a8f9a046ed068ebd"><div class="ttname"><a href="#a5f4312bd1da12e43a8f9a046ed068ebd">PhotoRigma\Classes\Database\_convert_to_mysql_format</a></div><div class="ttdeci">_convert_to_mysql_format(string $format)</div><div class="ttdoc">Производит преобразование строки формата даты/времени в формат, совместимый с MySQL (DATE_FORMAT).</div><div class="ttdef"><b>Определения</b> <a href="../../d2/d89/Database_8php_source.html#l02337">Database.php:2337</a></div></div>
</div><!-- fragment --> <dl class="section see"><dt>См. также</dt><dd><a class="el" href="#a1dfaf650c7bfa81bd699450d5404c7fd" title="Кэш для преобразования форматов даты (MariaDB -&gt; PostgreSQL/SQLite)">PhotoRigma\Classes\Database\$format_cache</a> Внутреннее свойство, используемое для кэширования преобразований форматов. </dd>
<dd>
<a class="el" href="#a8c3cf443d91cde7347577cddf302a9d0" title="Хранит текущий формат SQL (например, &#39;mysql&#39;, &#39;pgsql&#39;, &#39;sqlite&#39;).">PhotoRigma\Classes\Database\$current_format</a> Свойство, определяющее исходный формат строки для преобразования. </dd>
<dd>
<a class="el" href="#ad7c3527d920ebf2dbcbc0c51845835d6" title="Формирует SQL-выражение для форматирования даты с учетом специфики используемой СУБД.">PhotoRigma\Classes\Database\_format_date_internal()</a> Приватный метод, из которого вызывается данный метод. </dd></dl>

<p class="definition">См. определение в файле <a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a> строка <a class="el" href="../../d2/d89/Database_8php_source.html#l02337">2337</a></p>

<p class="reference">Перекрестные ссылки <a class="el" href="../../d2/d89/Database_8php_source.html#l00214">$current_format</a>.</p>

<p class="reference">Используется в <a class="el" href="../../d2/d89/Database_8php_source.html#l02248">_format_date_internal()</a>.</p>
<div id="dynsection-12" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-12-trigger" src="../../closed.png" alt="+"/> Граф вызова функции:</div>
<div id="dynsection-12-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-12-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_a5f4312bd1da12e43a8f9a046ed068ebd_icgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a5f4312bd1da12e43a8f9a046ed068ebd_icgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a5f4312bd1da12e43a8f9a046ed068ebd_icgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a5f4312bd1da12e43a8f9a046ed068ebd_icgraph">
<area shape="rect" title="Производит преобразование строки формата даты/времени в формат, совместимый с MySQL (DATE_FORMAT)." alt="" coords="338,5,512,30"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#ad7c3527d920ebf2dbcbc0c51845835d6" title="Формирует SQL&#45;выражение для форматирования даты с учетом специфики используемой СУБД." alt="" coords="144,5,290,30"/>
<area shape="poly" title=" " alt="" coords="322,20,290,20,290,15,322,15"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#ac0e58b1bf2a72bbbaa896b9849ed0e42" title="Формирует SQL&#45;выражение для форматирования даты с учетом специфики используемой СУБД." alt="" coords="5,5,96,30"/>
<area shape="poly" title=" " alt="" coords="128,20,96,20,96,15,128,15"/>
</map>
</div>

</div>
</div>
<a id="ae74eea110900ed128b205a3d0c91687b" name="ae74eea110900ed128b205a3d0c91687b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae74eea110900ed128b205a3d0c91687b">&#9670;&#160;</a></span>_convert_to_postgres_format()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">_convert_to_postgres_format </td>
          <td>(</td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>$format</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel private">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Преобразует формат даты/времени в формат, совместимый с PostgreSQL. </p>
<p>Этот приватный метод преобразует строку формата даты или времени из формата, соответствующего текущему формату строки (<code>$this-&gt;current_format</code>), в формат, совместимый с функциями PostgreSQL (например, <code>TO_CHAR</code>).</p>
<p>Метод выполняет следующие шаги:</p><ol type="1">
<li>Проверяет, совпадает ли текущий формат строки (<code>$this-&gt;current_format</code>) с 'pgsql'. Если форматы совпадают, входная строка <code>$format</code> уже считается PostgreSQL-совместимой и возвращается без изменений.</li>
<li>Проверяет, существует ли уже преобразованная строка формата в кэше <code>$this-&gt;format_cache</code> для текущего исходного формата (<code>$this-&gt;current_format</code>) и входной строки <code>$format</code>. Если найдено в кэше, преобразованное значение возвращается немедленно.</li>
<li>Если формат не 'pgsql' и не найден в кэше, определяет карту соответствия символов формата для преобразования из <code>$this-&gt;current_format</code> (который может быть 'mysql' или 'sqlite') в PostgreSQL.</li>
<li>Если текущий формат (<code>$this-&gt;current_format</code>) не является поддерживаемым исходным форматом для преобразования в PostgreSQL, выбрасывается исключение InvalidArgumentException.</li>
<li>Использует карту соответствия для преобразования входной строки <code>$format</code> с помощью <code>strtr()</code>.</li>
<li>Сохраняет результат преобразования в кэше <code>$this-&gt;format_cache</code> для будущего использования.</li>
<li>Возвращает преобразованную строку формата, совместимую с функциями PostgreSQL.</li>
</ol>
<p>Этот метод является приватным и предназначен только для использования внутри класса. Вызывается из метода <code>_format_date_internal()</code> при работе с СУБД PostgreSQL.</p>
<dl class="params"><dt>Аргументы</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$format</td><td>Строка формата даты/времени в стиле текущего формата строки (<code>$this-&gt;current_format</code>). Пример: 'Y-m-d' для формата MySQL/SQLite или 'YYYY-MM-DD' для формата PostgreSQL (в случае, если current_format уже pgsql).</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Возвращает</dt><dd>string Строка формата даты/времени, преобразованная в стиль, совместимый с функциями PostgreSQL (например, TO_CHAR). Пример: 'YYYY-MM-DD HH24:MI:SS'.</dd></dl>
<dl class="exception"><dt>Исключения</dt><dd>
  <table class="exception">
    <tr><td class="paramname">InvalidArgumentException</td><td>Выбрасывается, если текущий формат строки (<code>$this-&gt;current_format</code>) не поддерживается методом <code>_convert_to_postgres_format</code> в качестве исходного формата для преобразования в PostgreSQL (т.е., не 'mysql' и не 'sqlite'). Пример сообщения: Неизвестный формат | Формат: [current_format]</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Заметки</dt><dd>Метод использует кэширование (<code>$this-&gt;format_cache</code>) для хранения результатов преобразования форматов и избежания повторных вычислений. Используется строковая замена (<code>strtr()</code>) на основе предопределенных карт соответствия. Поведение метода зависит от свойства <code>$this-&gt;current_format</code>.</dd></dl>
<dl class="section warning"><dt>Предупреждения</dt><dd>Убедитесь, что свойство <code>$this-&gt;current_format</code> содержит одно из допустимых значений ('mysql', 'pgsql', 'sqlite') перед вызовом этого метода. Убедитесь, что входная строка <code>$format</code> соответствует синтаксису формата, ожидаемому для <code>$this-&gt;current_format</code>. Неподдерживаемый исходный формат приведет к исключению.</dd></dl>
<p>Пример вызова метода внутри класса (например, из _format_date_internal()): </p><div class="fragment"><div class="line"><span class="comment">// Предположим:</span></div>
<div class="line"><span class="comment">// $this-&gt;current_format = &#39;mysql&#39;;</span></div>
<div class="line"><span class="comment">// $this-&gt;db_type = &#39;pgsql&#39;;</span></div>
<div class="line"><span class="comment">// $mysql_format = &#39;%Y-%m-%d %H:%i:%s&#39;;</span></div>
<div class="line"> </div>
<div class="line">$postgres_format = $this-&gt;<a class="code hl_function" href="#ae74eea110900ed128b205a3d0c91687b">_convert_to_postgres_format</a>($mysql_format);</div>
<div class="line"><span class="comment">// $postgres_format будет равен &#39;YYYY-MM-DD HH24:MI:SS&#39; (взято из кэша или преобразовано)</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Затем этот формат может быть использован с функцией PostgreSQL TO_CHAR:</span></div>
<div class="line"><span class="comment">// TO_CHAR(column, &#39;YYYY-MM-DD HH24:MI:SS&#39;)</span></div>
<div class="ttc" id="aclassPhotoRigma_1_1Classes_1_1Database_html_ae74eea110900ed128b205a3d0c91687b"><div class="ttname"><a href="#ae74eea110900ed128b205a3d0c91687b">PhotoRigma\Classes\Database\_convert_to_postgres_format</a></div><div class="ttdeci">_convert_to_postgres_format(string $format)</div><div class="ttdoc">Преобразует формат даты/времени в формат, совместимый с PostgreSQL.</div><div class="ttdef"><b>Определения</b> <a href="../../d2/d89/Database_8php_source.html#l02453">Database.php:2453</a></div></div>
</div><!-- fragment --> <dl class="section see"><dt>См. также</dt><dd><a class="el" href="#a1dfaf650c7bfa81bd699450d5404c7fd" title="Кэш для преобразования форматов даты (MariaDB -&gt; PostgreSQL/SQLite)">PhotoRigma\Classes\Database\$format_cache</a> Внутреннее свойство, используемое для кэширования преобразований форматов. </dd>
<dd>
<a class="el" href="#a8c3cf443d91cde7347577cddf302a9d0" title="Хранит текущий формат SQL (например, &#39;mysql&#39;, &#39;pgsql&#39;, &#39;sqlite&#39;).">PhotoRigma\Classes\Database\$current_format</a> Свойство, определяющее исходный формат строки для преобразования. </dd>
<dd>
<a class="el" href="#ad7c3527d920ebf2dbcbc0c51845835d6" title="Формирует SQL-выражение для форматирования даты с учетом специфики используемой СУБД.">PhotoRigma\Classes\Database\_format_date_internal()</a> Приватный метод, из которого вызывается данный метод. </dd></dl>

<p class="definition">См. определение в файле <a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a> строка <a class="el" href="../../d2/d89/Database_8php_source.html#l02453">2453</a></p>

<p class="reference">Перекрестные ссылки <a class="el" href="../../d2/d89/Database_8php_source.html#l00214">$current_format</a>.</p>

<p class="reference">Используется в <a class="el" href="../../d2/d89/Database_8php_source.html#l02248">_format_date_internal()</a>.</p>
<div id="dynsection-13" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-13-trigger" src="../../closed.png" alt="+"/> Граф вызова функции:</div>
<div id="dynsection-13-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-13-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_ae74eea110900ed128b205a3d0c91687b_icgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_ae74eea110900ed128b205a3d0c91687b_icgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_ae74eea110900ed128b205a3d0c91687b_icgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_ae74eea110900ed128b205a3d0c91687b_icgraph">
<area shape="rect" title="Преобразует формат даты/времени в формат, совместимый с PostgreSQL." alt="" coords="338,5,484,44"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#ad7c3527d920ebf2dbcbc0c51845835d6" title="Формирует SQL&#45;выражение для форматирования даты с учетом специфики используемой СУБД." alt="" coords="144,12,290,37"/>
<area shape="poly" title=" " alt="" coords="322,27,290,27,290,22,322,22"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#ac0e58b1bf2a72bbbaa896b9849ed0e42" title="Формирует SQL&#45;выражение для форматирования даты с учетом специфики используемой СУБД." alt="" coords="5,12,96,37"/>
<area shape="poly" title=" " alt="" coords="128,27,96,27,96,22,128,22"/>
</map>
</div>

</div>
</div>
<a id="a80464f4180268442d13e5e319274a30a" name="a80464f4180268442d13e5e319274a30a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a80464f4180268442d13e5e319274a30a">&#9670;&#160;</a></span>_convert_to_sqlite_format()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">_convert_to_sqlite_format </td>
          <td>(</td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>$format</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel private">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Преобразует формат даты/времени в формат, совместимый с SQLite (<code>strftime</code>). </p>
<p>Этот приватный метод преобразует строку формата даты или времени из формата, соответствующего текущему формату строки (<code>$this-&gt;current_format</code>), в формат, совместимый с функцией SQLite <code>strftime()</code>.</p>
<p>Метод выполняет следующие шаги:</p><ol type="1">
<li>Проверяет, совпадает ли текущий формат строки (<code>$this-&gt;current_format</code>) с 'sqlite'. Если форматы совпадают, входная строка <code>$format</code> уже считается SQLite-совместимой и возвращается без изменений.</li>
<li>Проверяет, существует ли уже преобразованная строка формата в кэше <code>$this-&gt;format_cache</code> для текущего исходного формата (<code>$this-&gt;current_format</code>) и входной строки <code>$format</code>. Если найдено в кэше, преобразованное значение возвращается немедленно.</li>
<li>Если формат не 'sqlite' и не найден в кэше, определяет карту соответствия символов формата для преобразования из <code>$this-&gt;current_format</code> (который может быть 'mysql' или 'pgsql') в SQLite.</li>
<li>Если текущий формат (<code>$this-&gt;current_format</code>) не является поддерживаемым исходным форматом для преобразования в SQLite, выбрасывается исключение InvalidArgumentException.</li>
<li>Использует карту соответствия для преобразования входной строки <code>$format</code> с помощью <code>strtr()</code>.</li>
<li>Сохраняет результат преобразования в кэше <code>$this-&gt;format_cache</code> для будущего использования.</li>
<li>Возвращает преобразованную строку формата, совместимую с функцией SQLite <code>strftime()</code>.</li>
</ol>
<p>Этот метод является приватным и предназначен только для использования внутри класса. Вызывается из метода <code>_format_date_internal()</code> при работе с СУБД SQLite.</p>
<dl class="params"><dt>Аргументы</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$format</td><td>Строка формата даты/времени в стиле текущего формата строки (<code>$this-&gt;current_format</code>). Пример: 'Y-m-d' для формата MySQL/SQLite или 'YYYY-MM-DD HH24:MI:SS' для формата PostgreSQL.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Возвращает</dt><dd>string Строка формата даты/времени, преобразованная в стиль, совместимый с функцией SQLite <code>strftime()</code>. Пример: 'Y-m-d H:M:S'.</dd></dl>
<dl class="exception"><dt>Исключения</dt><dd>
  <table class="exception">
    <tr><td class="paramname">InvalidArgumentException</td><td>Выбрасывается, если текущий формат строки (<code>$this-&gt;current_format</code>) не поддерживается методом <code>_convert_to_sqlite_format</code> в качестве исходного формата для преобразования в SQLite (т.е., не 'mysql' и не 'pgsql'). Пример сообщения: Неизвестный формат | Формат: [current_format]</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Заметки</dt><dd>Метод использует кэширование (<code>$this-&gt;format_cache</code>) для хранения результатов преобразования форматов и избежания повторных вычислений. Используется строковая замена (<code>strtr()</code>) на основе предопределенных карт соответствия. Поведение метода зависит от свойства <code>$this-&gt;current_format</code>.</dd></dl>
<dl class="section warning"><dt>Предупреждения</dt><dd>Убедитесь, что свойство <code>$this-&gt;current_format</code> содержит одно из допустимых значений ('mysql', 'pgsql', 'sqlite') перед вызовом этого метода. Убедитесь, что входная строка <code>$format</code> соответствует синтаксису формата, ожидаемому для <code>$this-&gt;current_format</code>. Неподдерживаемый исходный формат приведет к исключению.</dd></dl>
<p>Пример вызова метода внутри класса (например, из _format_date_internal()): </p><div class="fragment"><div class="line"><span class="comment">// Предположим:</span></div>
<div class="line"><span class="comment">// $this-&gt;current_format = &#39;mysql&#39;;</span></div>
<div class="line"><span class="comment">// $this-&gt;db_type = &#39;sqlite&#39;;</span></div>
<div class="line"><span class="comment">// $mysql_format = &#39;%Y-%m-%d %H:%i:%s&#39;;</span></div>
<div class="line"> </div>
<div class="line">$sqlite_format = $this-&gt;<a class="code hl_function" href="#a80464f4180268442d13e5e319274a30a">_convert_to_sqlite_format</a>($mysql_format);</div>
<div class="line"><span class="comment">// $sqlite_format будет равен &#39;%Y-%m-%d %H:%M:%S&#39; (взято из кэша или преобразовано)</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Предположим:</span></div>
<div class="line"><span class="comment">// $this-&gt;current_format = &#39;pgsql&#39;;</span></div>
<div class="line"><span class="comment">// $this-&gt;db_type = &#39;sqlite&#39;;</span></div>
<div class="line"><span class="comment">// $pgsql_format = &#39;YYYY-MM-DD HH24:MI:SS&#39;;</span></div>
<div class="line"> </div>
<div class="line">$sqlite_format_from_pgsql = $this-&gt;<a class="code hl_function" href="#a80464f4180268442d13e5e319274a30a">_convert_to_sqlite_format</a>($pgsql_format);</div>
<div class="line"><span class="comment">// $sqlite_format_from_pgsql будет равен &#39;%Y-%m-%d %H:%M:%S&#39; (взято из кэша или преобразовано)</span></div>
<div class="ttc" id="aclassPhotoRigma_1_1Classes_1_1Database_html_a80464f4180268442d13e5e319274a30a"><div class="ttname"><a href="#a80464f4180268442d13e5e319274a30a">PhotoRigma\Classes\Database\_convert_to_sqlite_format</a></div><div class="ttdeci">_convert_to_sqlite_format(string $format)</div><div class="ttdoc">Преобразует формат даты/времени в формат, совместимый с SQLite (strftime).</div><div class="ttdef"><b>Определения</b> <a href="../../d2/d89/Database_8php_source.html#l02572">Database.php:2572</a></div></div>
</div><!-- fragment --> <dl class="section see"><dt>См. также</dt><dd><a class="el" href="#a1dfaf650c7bfa81bd699450d5404c7fd" title="Кэш для преобразования форматов даты (MariaDB -&gt; PostgreSQL/SQLite)">PhotoRigma\Classes\Database\$format_cache</a> Внутреннее свойство, используемое для кэширования преобразований форматов. </dd>
<dd>
<a class="el" href="#a8c3cf443d91cde7347577cddf302a9d0" title="Хранит текущий формат SQL (например, &#39;mysql&#39;, &#39;pgsql&#39;, &#39;sqlite&#39;).">PhotoRigma\Classes\Database\$current_format</a> Свойство, определяющее исходный формат строки для преобразования. </dd>
<dd>
<a class="el" href="#ad7c3527d920ebf2dbcbc0c51845835d6" title="Формирует SQL-выражение для форматирования даты с учетом специфики используемой СУБД.">PhotoRigma\Classes\Database\_format_date_internal()</a> Приватный метод, из которого вызывается данный метод. </dd></dl>

<p class="definition">См. определение в файле <a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a> строка <a class="el" href="../../d2/d89/Database_8php_source.html#l02572">2572</a></p>

<p class="reference">Перекрестные ссылки <a class="el" href="../../d2/d89/Database_8php_source.html#l00214">$current_format</a>.</p>

<p class="reference">Используется в <a class="el" href="../../d2/d89/Database_8php_source.html#l02248">_format_date_internal()</a>.</p>
<div id="dynsection-14" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-14-trigger" src="../../closed.png" alt="+"/> Граф вызова функции:</div>
<div id="dynsection-14-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-14-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_a80464f4180268442d13e5e319274a30a_icgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a80464f4180268442d13e5e319274a30a_icgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a80464f4180268442d13e5e319274a30a_icgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a80464f4180268442d13e5e319274a30a_icgraph">
<area shape="rect" title="Преобразует формат даты/времени в формат, совместимый с SQLite (strftime)." alt="" coords="338,5,465,44"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#ad7c3527d920ebf2dbcbc0c51845835d6" title="Формирует SQL&#45;выражение для форматирования даты с учетом специфики используемой СУБД." alt="" coords="144,12,290,37"/>
<area shape="poly" title=" " alt="" coords="322,27,290,27,290,22,322,22"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#ac0e58b1bf2a72bbbaa896b9849ed0e42" title="Формирует SQL&#45;выражение для форматирования даты с учетом специфики используемой СУБД." alt="" coords="5,12,96,37"/>
<area shape="poly" title=" " alt="" coords="128,27,96,27,96,22,128,22"/>
</map>
</div>

</div>
</div>
<a id="aa4094e522b4780bd58666dba20fdd09d" name="aa4094e522b4780bd58666dba20fdd09d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa4094e522b4780bd58666dba20fdd09d">&#9670;&#160;</a></span>_delete_internal()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">_delete_internal </td>
          <td>(</td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>$from_tbl</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">array</td>          <td class="paramname"><span class="paramname"><em>$options</em></span><span class="paramdefsep"> = </span><span class="paramdefval">[]</span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel protected">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Формирует SQL-запрос на удаление данных из таблицы, проверяет входные данные, обрабатывает недопустимые ключи, сохраняет текст запроса в свойстве <code>$txt_query</code> и выполняет его. </p>
<p>Этот метод выполняет следующие шаги:</p><ol type="1">
<li>Проверяет типы входных данных: <code>$from_tbl</code> (строка), <code>$options</code> (массив).</li>
<li>Проверяет наличие обязательного условия <code>where</code> в массиве <code>$options</code>. Если условие отсутствует, выбрасывается исключение для предотвращения случайного удаления всех данных.</li>
<li>Проверяет и удаляет недопустимые ключи из массива <code>$options</code>:<ul>
<li>Ключ <code>group</code> не поддерживается в запросах DELETE и удаляется с записью в лог.</li>
<li>Ключи <code>order</code> и <code>limit</code> должны использоваться совместно. Если указан только один из них, оба удаляются с записью в лог.</li>
</ul>
</li>
<li>Формирует базовый SQL-запрос на удаление данных и сохраняет его в свойстве <code>$txt_query</code>.</li>
<li>Добавляет условия WHERE, ORDER BY и LIMIT (если они корректны) через метод <code>_build_conditions</code>.</li>
<li>Выполняет сформированный запрос через метод <code>_execute_query</code>, передавая параметры <code>params</code> для подготовленного выражения.</li>
</ol>
<p>Использование параметров <code>params</code> является обязательным для подготовленных выражений, так как это обеспечивает защиту от SQL-инъекций и совместимость с различными СУБД. Этот метод является защищенным и предназначен для использования внутри класса или его наследников. Основная логика вызывается через публичный метод-редирект <code>delete()</code>.</p>
<dl class="params"><dt>Аргументы</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$from_tbl</td><td>Имя таблицы, из которой необходимо удалить данные. Должно быть строкой, содержащей только допустимые имена таблиц без специальных символов. </td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$options</td><td>Массив дополнительных опций для формирования запроса. Поддерживаемые ключи:<ul>
<li>where (string|array|false): Условие WHERE.<ul>
<li>string - используется как есть.</li>
<li>array - преобразуется в SQL. Поддерживает простые условия (&lsquo;['поле&rsquo; =&gt; значение]<code>) и логические операторы (</code>'OR' =&gt; [...]<code>, </code>'NOT' =&gt; [...]<code>).</code></li>
<li><code>false - игнорируется. Обязательный параметр для безопасности. Без условия WHERE запрос не будет выполнен.</code></li>
</ul>
</li>
<li><code>group (string|false): Группировка GROUP BY. Игнорируется, если false. Должна быть строкой. Не поддерживается в запросах DELETE и удаляется с записью в лог.</code></li>
<li><code>order (string|false): Сортировка ORDER BY. Игнорируется, если false. Должна быть строкой. Может использоваться только вместе с</code>limit<code>. Если указан только один из них, оба игнорируются с записью в лог.</code></li>
<li><code>limit (int|string|false): Ограничение LIMIT.<ul>
<li>int - прямое значение.</li>
<li>string - формат "OFFSET,COUNT".</li>
<li>false - игнорируется. Может использоваться только вместе с</li>
</ul>
</code>order<code>. Если указан только один из них, оба игнорируются с записью в лог.</code></li>
<li><code>params (array): Ассоциативный массив параметров ([":имя" =&gt; значение]). Обязателен для использования с условиями</code>where` и другими частями запроса, требующими подготовленных выражений. Обеспечивает защиту от SQL-инъекций. Может быть пустым массивом, если параметры не требуются.</li>
</ul>
</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Возвращает</dt><dd>bool Возвращает true, если запрос успешно выполнен (даже если результат пустой). В случае ошибки выбрасывается исключение.</dd></dl>
<dl class="exception"><dt>Исключения</dt><dd>
  <table class="exception">
    <tr><td class="paramname">InvalidArgumentException</td><td>Выбрасывается, если:<ul>
<li><code>$from_tbl</code> не является строкой.</li>
<li><code>$options</code> не является массивом.</li>
<li>Отсутствует обязательное условие <code>where</code> в массиве <code>$options</code>. Пример сообщения: Запрос DELETE без условия WHERE запрещён | Причина: Соображения безопасности </li>
</ul>
</td></tr>
    <tr><td class="paramname">JsonException</td><td>Выбрасывается при ошибках кодирования JSON (например, при записи в лог). Пример сообщения: Ошибка при кодировании JSON | Переданные опции: {"group":"users"} </td></tr>
    <tr><td class="paramname">Exception</td><td>Выбрасывается при ошибках выполнения запроса или записи в лог. Пример сообщения: Ошибка выполнения запроса | SQL: DELETE FROM users WHERE id = :id AND status = :status</td></tr>
  </table>
  </dd>
</dl>
<dl class="section warning"><dt>Предупреждения</dt><dd>Метод чувствителен к корректности входных данных. Неверные типы данных или некорректные значения могут привести к выбросу исключения. Безопасность обеспечивается обязательным указанием условия <code>where</code>. Запрос без условия <code>where</code> не будет выполнен. Ключи <code>group</code>, <code>order</code> и <code>limit</code> проверяются на корректность. Недопустимые ключи удаляются с записью в лог. Использование параметров <code>params</code> для подготовленных выражений является обязательным для защиты от SQL-инъекций и обеспечения совместимости с различными СУБД. Игнорирование этого правила может привести к уязвимостям безопасности и неправильной работе с базой данных.</dd></dl>
<p>Пример использования метода _delete_internal(): </p><div class="fragment"><div class="line"><span class="comment">// Безопасное использование с параметрами `params`</span></div>
<div class="line">$this-&gt;<a class="code hl_function" href="#aa4094e522b4780bd58666dba20fdd09d">_delete_internal</a>(<span class="stringliteral">&#39;users&#39;</span>, [</div>
<div class="line">    <span class="stringliteral">&#39;where&#39;</span> =&gt; <span class="stringliteral">&#39;id = :id AND status = :status&#39;</span>,</div>
<div class="line">    <span class="stringliteral">&#39;params&#39;</span> =&gt; [<span class="stringliteral">&#39;:id&#39;</span> =&gt; 1, <span class="stringliteral">&#39;:status&#39;</span> =&gt; <span class="stringliteral">&#39;active&#39;</span>],</div>
<div class="line">]);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Безопасное использование с ассоциативным массивом в `where`</span></div>
<div class="line">$this-&gt;<a class="code hl_function" href="#aa4094e522b4780bd58666dba20fdd09d">_delete_internal</a>(<span class="stringliteral">&#39;users&#39;</span>, [</div>
<div class="line">    <span class="stringliteral">&#39;where&#39;</span> =&gt; [<span class="stringliteral">&#39;id&#39;</span> =&gt; 1, <span class="stringliteral">&#39;status&#39;</span> =&gt; <span class="stringliteral">&#39;active&#39;</span>],</div>
<div class="line">]);</div>
<div class="ttc" id="aclassPhotoRigma_1_1Classes_1_1Database_html_aa4094e522b4780bd58666dba20fdd09d"><div class="ttname"><a href="#aa4094e522b4780bd58666dba20fdd09d">PhotoRigma\Classes\Database\_delete_internal</a></div><div class="ttdeci">_delete_internal(string $from_tbl, array $options=[])</div><div class="ttdoc">Формирует SQL-запрос на удаление данных из таблицы, проверяет входные данные, обрабатывает недопустим...</div><div class="ttdef"><b>Определения</b> <a href="../../d2/d89/Database_8php_source.html#l00954">Database.php:954</a></div></div>
</div><!-- fragment --> <dl class="section see"><dt>См. также</dt><dd><a class="el" href="#a73d8e6acdfb996002f980ab7c9c18515" title="Удаляет данные из таблицы через вызов внутреннего метода.">PhotoRigma\Classes\Database\delete()</a> Публичный метод-редирект для вызова этой логики. </dd>
<dd>
<a class="el" href="#a941629b86b9c9e34bc5926c0db2478b5" title="Выполняет SQL-запрос с использованием подготовленных выражений.">PhotoRigma\Classes\Database\_execute_query()</a> Выполняет SQL-запрос. </dd>
<dd>
<a class="el" href="#a852d15f131983e6f53045146bede2958" title="Формирует строку дополнений для SQL-запроса (например, WHERE, GROUP BY, ORDER BY, LIMIT).">PhotoRigma\Classes\Database\_build_conditions()</a> Формирует условия WHERE, ORDER BY и LIMIT для запроса. </dd>
<dd>
<a class="el" href="#a556a1b37f162e7e8b576b86c182c7309" title="Текст последнего SQL-запроса, сформированного методами класса">PhotoRigma\Classes\Database\$txt_query</a> Свойство, в которое помещается текст SQL-запроса. </dd>
<dd>
<a class="el" href="../../db/d02/namespacePhotoRigma_1_1Include.html#a2d74c46a21e4ce612a98eee60981aef0" title="Записывает сообщение об ошибке в лог-файл и, при необходимости, завершает выполнение скрипта.">PhotoRigma\Include\log_in_file()</a> Логирует ошибки. </dd></dl>

<p class="definition">См. определение в файле <a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a> строка <a class="el" href="../../d2/d89/Database_8php_source.html#l00954">954</a></p>

<p class="reference">Перекрестные ссылки <a class="el" href="../../d2/d89/Database_8php_source.html#l01104">_build_conditions()</a> и <a class="el" href="../../d2/d89/Database_8php_source.html#l01393">_execute_query()</a>.</p>

<p class="reference">Используется в <a class="el" href="../../d2/d89/Database_8php_source.html#l00846">delete()</a>.</p>
<div id="dynsection-15" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-15-trigger" src="../../closed.png" alt="+"/> Граф вызовов:</div>
<div id="dynsection-15-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-15-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_aa4094e522b4780bd58666dba20fdd09d_cgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_aa4094e522b4780bd58666dba20fdd09d_cgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_aa4094e522b4780bd58666dba20fdd09d_cgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_aa4094e522b4780bd58666dba20fdd09d_cgraph">
<area shape="rect" title="Формирует SQL&#45;запрос на удаление данных из таблицы, проверяет входные данные, обрабатывает недопустим..." alt="" coords="5,56,118,81"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a852d15f131983e6f53045146bede2958" title="Формирует строку дополнений для SQL&#45;запроса (например, WHERE, GROUP BY, ORDER BY, LIMIT)." alt="" coords="166,19,287,43"/>
<area shape="poly" title=" " alt="" coords="118,53,153,45,154,50,119,58"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a941629b86b9c9e34bc5926c0db2478b5" title="Выполняет SQL&#45;запрос с использованием подготовленных выражений." alt="" coords="171,80,282,105"/>
<area shape="poly" title=" " alt="" coords="119,74,156,79,155,85,118,79"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a24acdb048ce17d880bd12b0f74567352" title="Формирует группу условий для WHERE с указанным оператором (OR/NOT)." alt="" coords="335,5,471,30"/>
<area shape="poly" title=" " alt="" coords="287,24,319,21,320,27,288,29"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#af1b08f0490df0963b0daac6690d4765f" title="Выполняет преобразование SQL&#45;запроса в зависимости от текущего формата и типа СУБД." alt="" coords="348,55,458,79"/>
<area shape="poly" title=" " alt="" coords="282,82,333,74,333,80,283,87"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a53c8e7da5436bad14f32f64d5b532f60" title="Логирует результат анализа SQL&#45;запроса с помощью EXPLAIN или EXPLAIN ANALYZE." alt="" coords="357,104,449,129"/>
<area shape="poly" title=" " alt="" coords="283,97,342,105,341,111,282,103"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a8f393cc6e7e1b7e6394a9c2d4abdd8e7" title="Логирует медленные запросы, запросы без использования плейсхолдеров и другие запросы в таблицу логов." alt="" coords="362,153,445,178"/>
<area shape="poly" title=" " alt="" coords="256,103,336,138,354,145,352,150,334,143,254,108"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#ad620cb343252ceea735bab03860a0915" title="Производит преобразование SQL&#45;запроса из формата MySQL в целевой формат СУБД (PostgreSQL или SQLite)." alt="" coords="519,5,683,30"/>
<area shape="poly" title=" " alt="" coords="455,51,533,32,534,37,456,57"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a2e93ad3621ba0d7cf06d36c539b6c290" title="Производит преобразование SQL&#45;запроса из формата PostgreSQL в целевой формат СУБД (MySQL или SQLite)." alt="" coords="521,55,681,79"/>
<area shape="poly" title=" " alt="" coords="458,64,505,64,505,70,458,70"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a44e1aec00a15341cd9119261482eeb0d" title="Производит преобразование SQL&#45;запроса из формата SQLite в целевой формат СУБД (MySQL или PostgreSQL)." alt="" coords="521,104,681,129"/>
<area shape="poly" title=" " alt="" coords="456,77,534,97,533,102,455,83"/>
</map>
</div>
<div id="dynsection-16" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-16-trigger" src="../../closed.png" alt="+"/> Граф вызова функции:</div>
<div id="dynsection-16-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-16-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_aa4094e522b4780bd58666dba20fdd09d_icgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_aa4094e522b4780bd58666dba20fdd09d_icgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_aa4094e522b4780bd58666dba20fdd09d_icgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_aa4094e522b4780bd58666dba20fdd09d_icgraph">
<area shape="rect" title="Формирует SQL&#45;запрос на удаление данных из таблицы, проверяет входные данные, обрабатывает недопустим..." alt="" coords="110,5,222,30"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a73d8e6acdfb996002f980ab7c9c18515" title="Удаляет данные из таблицы через вызов внутреннего метода." alt="" coords="5,5,62,30"/>
<area shape="poly" title=" " alt="" coords="94,20,62,20,62,15,94,15"/>
</map>
</div>

</div>
</div>
<a id="a941629b86b9c9e34bc5926c0db2478b5" name="a941629b86b9c9e34bc5926c0db2478b5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a941629b86b9c9e34bc5926c0db2478b5">&#9670;&#160;</a></span>_execute_query()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">_execute_query </td>
          <td>(</td>
          <td class="paramtype">array</td>          <td class="paramname"><span class="paramname"><em>$params</em></span><span class="paramdefsep"> = </span><span class="paramdefval">[]</span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel private">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Выполняет SQL-запрос с использованием подготовленных выражений. </p>
<p>Этот приватный метод выполняет следующие шаги:</p><ol type="1">
<li>Проверяет состояние внутренних свойств (<code>$this-&gt;res_query</code>, <code>$this-&gt;txt_query</code>) и типы переданных аргументов (<code>$params</code>).</li>
<li>Очищает внутренние свойства для вывода результата предыдущего запроса (<code>$this-&gt;res_query</code>, <code>$this-&gt;aff_rows</code>, <code>$this-&gt;insert_id</code>).</li>
<li>Преобразует текст запроса (<code>$this-&gt;txt_query</code>) в формат, специфичный для текущей СУБД, с помощью метода <code>_convert_query()</code>.</li>
<li>Если константа <code>SQL_ANALYZE</code> установлена в <code>true</code>, выполняет анализ запроса (например, <code>EXPLAIN ANALYZE</code>) с помощью метода <code>_log_explain()</code>.</li>
<li>Подготавливает и выполняет SQL-запрос с использованием объекта PDO (<code>$this-&gt;pdo</code>) и переданных параметров <code>$params</code>. Получает количество затронутых строк (<code>$this-&gt;aff_rows</code>) и, если запрос является INSERT, ID последней вставленной записи (<code>$this-&gt;insert_id</code>).</li>
<li>Измеряет время выполнения запроса и, если константа <code>SQL_LOG</code> установлена в <code>true</code>:<ul>
<li>Логирует запрос как "медленный" с помощью <code>_log_query()</code>, если время выполнения превышает 200 мс.</li>
<li>Логирует запрос как "без плейсхолдеров" с помощью <code>_log_query()</code>, если массив <code>$params</code> пустой.</li>
</ul>
</li>
<li>Очищает текст запроса (<code>$this-&gt;txt_query = null</code>) после его выполнения.</li>
<li>Возвращает <code>true</code>, указывая на успешное выполнение запроса (даже если затронуто 0 строк или SELECT не вернул результатов). Этот метод является приватным и предназначен только для использования внутри класса <code>Database</code>. Он является ключевым методом для выполнения всех SQL-операций, и его вызывают другие методы класса (например, <code>select()</code>, <code>insert()</code>, <code>update()</code>, <code>delete()</code>, <code>truncate()</code>, <code>join()</code>).</li>
</ol>
<dl class="params"><dt>Аргументы</dt><dd>
  <table class="params">
    <tr><td class="paramtype">array</td><td class="paramname">$params</td><td>Ассоциативный массив параметров для подготовленного выражения (необязательно). Пример: &lsquo;[&rsquo;:id' =&gt; 1, ':name' =&gt; 'John Doe']<code>. Ключи массива должны соответствовать именам плейсхолдеров в тексте запроса (</code>$this-&gt;txt_query<code>). По умолчанию: пустой массив (</code>[]`), если параметры не требуются.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Возвращает</dt><dd>bool Возвращает <code>true</code>, если подготовка и выполнение запроса прошли успешно.</dd></dl>
<dl class="exception"><dt>Исключения</dt><dd>
  <table class="exception">
    <tr><td class="paramname">InvalidArgumentException</td><td>Выбрасывается, если:<ul>
<li>Внутреннее свойство <code>$this-&gt;res_query</code> имеет некорректное состояние перед выполнением запроса. Пример сообщения: Некорректное состояние результата запроса | Текущее значение: [тип]</li>
<li>Внутреннее свойство <code>$this-&gt;txt_query</code> не является строкой. Пример сообщения: Неверный тип SQL-запроса | Ожидалась строка, получено: [тип]</li>
<li>Переданный аргумент <code>$params</code> не является массивом. Пример сообщения: Неверный тип параметров запроса | Ожидался массив, получено: [тип] </li>
</ul>
</td></tr>
    <tr><td class="paramname">PDOException</td><td>Выбрасывается, если возникает ошибка на уровне PDO в процессе подготовки или выполнения запроса. Пример сообщения: Ошибка при выполнении SQL-запроса | Запрос: [текст запроса или сообщение PDO] | Код ошибки PDO: [код ошибки] </td></tr>
    <tr><td class="paramname">Exception</td><td>Выбрасывается, если возникает ошибка при вызове метода <code>_log_explain()</code> или <code>_log_query()</code>. Пример сообщения: Ошибка при выполнении EXPLAIN ANALYZE | Запрос: [текст запроса] | Сообщение: [текст ошибки]</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Заметки</dt><dd>Метод зависит от корректной конфигурации базы данных и использует следующие константы для настройки поведения:<ul>
<li><code>SQL_LOG</code>: Управляет логированием медленных запросов (время выполнения &gt; 200 мс) и запросов без плейсхолдеров.</li>
<li><code>SQL_ANALYZE</code>: Управляет выполнением <code>EXPLAIN ANALYZE</code> перед запросами для диагностики производительности. Эти константы позволяют настраивать поведение метода в зависимости от требований к отладке и мониторингу. </li>
</ul>
</dd></dl>
<dl class="section warning"><dt>Предупреждения</dt><dd>Убедитесь, что перед вызовом этого метода:<ul>
<li>Свойство <code>$this-&gt;txt_query</code> содержит валидную SQL-строку для подготовленного выражения.</li>
<li>Массив <code>$params</code> содержит значения, соответствующие всем плейсхолдерам в <code>$this-&gt;txt_query</code>.</li>
<li>Соединение с базой данных установлено (<code>$this-&gt;pdo</code> является валидным объектом PDO). Невалидные входные данные или некорректное состояние могут привести к выбросу исключений.</li>
</ul>
</dd></dl>
<p>Пример использования метода _execute_query() (вызывается из других методов класса): </p><div class="fragment"><div class="line"><span class="comment">// Пример вызова _execute_query из метода select()</span></div>
<div class="line"><span class="comment">// Assume $this-&gt;txt_query is set to &quot;SELECT * FROM users WHERE id = :id&quot;</span></div>
<div class="line"><span class="comment">// Assume $params is set to [&#39;:id&#39; =&gt; 1]</span></div>
<div class="line">$success = $this-&gt;<a class="code hl_function" href="#a941629b86b9c9e34bc5926c0db2478b5">_execute_query</a>($params);</div>
<div class="line"><span class="keywordflow">if</span> ($success) {</div>
<div class="line">    <span class="comment">// Запрос выполнен, результат доступен через $this-&gt;res_query</span></div>
<div class="line">    <span class="comment">// Количество затронутых строк (для SELECT может быть 0, но метод все равно вернет true)</span></div>
<div class="line">    $affected = $this-&gt;aff_rows;</div>
<div class="line">    <span class="comment">// ID последней вставки (будет 0 для SELECT)</span></div>
<div class="line">    $lastId = $this-&gt;insert_id;</div>
<div class="line">} <span class="keywordflow">else</span> {</div>
<div class="line">    <span class="comment">// Обработка ошибки (обычно происходит через исключение)</span></div>
<div class="line">    echo <span class="stringliteral">&quot;Ошибка выполнения запроса _execute_query&quot;</span>;</div>
<div class="line">}</div>
<div class="ttc" id="aclassPhotoRigma_1_1Classes_1_1Database_html_a941629b86b9c9e34bc5926c0db2478b5"><div class="ttname"><a href="#a941629b86b9c9e34bc5926c0db2478b5">PhotoRigma\Classes\Database\_execute_query</a></div><div class="ttdeci">_execute_query(array $params=[])</div><div class="ttdoc">Выполняет SQL-запрос с использованием подготовленных выражений.</div><div class="ttdef"><b>Определения</b> <a href="../../d2/d89/Database_8php_source.html#l01393">Database.php:1393</a></div></div>
</div><!-- fragment --> <dl class="section see"><dt>См. также</dt><dd><a class="el" href="#a9db61e1721b616500bce6ed60491752a" title="Объект PDO для подключения к базе данных">PhotoRigma\Classes\Database\$pdo</a> Объект PDO, используемый для выполнения запроса. </dd>
<dd>
<a class="el" href="#ae87877e5a83ed158cdad137dd27b1ac8" title="Результат выполнения подготовленного выражения (PDOStatement)">PhotoRigma\Classes\Database\$res_query</a> Свойство, хранящее результат выполненного запроса (объект PDOStatement для SELECT/JOIN). </dd>
<dd>
<a class="el" href="#a54ffcc55f5606eeb40e8ac59c881d22b" title="Количество строк, затронутых последним запросом (INSERT, UPDATE, DELETE)">PhotoRigma\Classes\Database\$aff_rows</a> Свойство, хранящее количество строк, затронутых последним запросом. </dd>
<dd>
<a class="el" href="#a0fb355e7d9e1e7d9ca0b1b83dc960f33" title="ID последней вставленной строки после выполнения INSERT-запроса">PhotoRigma\Classes\Database\$insert_id</a> Свойство, хранящее ID последней вставленной записи (для INSERT). </dd>
<dd>
<a class="el" href="#a556a1b37f162e7e8b576b86c182c7309" title="Текст последнего SQL-запроса, сформированного методами класса">PhotoRigma\Classes\Database\$txt_query</a> Свойство, хранящее текст SQL-запроса для выполнения. </dd>
<dd>
<a class="el" href="#a73d8e6acdfb996002f980ab7c9c18515" title="Удаляет данные из таблицы через вызов внутреннего метода.">PhotoRigma\Classes\Database\delete()</a> Метод, который устанавливает <code>$this-&gt;txt_query</code> и вызывает <code>_execute_query()</code>. </dd>
<dd>
<a class="el" href="#ad4d4e455d9e4bf865126c72cf23a517b" title="Очищает таблицу (TRUNCATE) через вызов внутреннего метода.">PhotoRigma\Classes\Database\truncate()</a> Метод, который устанавливает <code>$this-&gt;txt_query</code> и вызывает <code>_execute_query()</code>. </dd>
<dd>
<a class="el" href="#a539e51bc2144b972bfafeccdda56ee9e" title="Обновляет данные в таблице через вызов внутреннего метода.">PhotoRigma\Classes\Database\update()</a> Метод, который устанавливает <code>$this-&gt;txt_query</code> и вызывает <code>_execute_query()</code>. </dd>
<dd>
<a class="el" href="#a6e5af1f386c0c7968aa10ea928c7a110" title="Вставляет данные в таблицу через вызов внутреннего метода.">PhotoRigma\Classes\Database\insert()</a> Метод, который устанавливает <code>$this-&gt;txt_query</code> и вызывает <code>_execute_query()</code>. </dd>
<dd>
<a class="el" href="#aab30d2495bb1362d218cd62e1556b13e" title="Выполняет SQL-запрос на выборку данных из таблицы.">PhotoRigma\Classes\Database\select()</a> Метод, который устанавливает <code>$this-&gt;txt_query</code> и вызывает <code>_execute_query()</code>. </dd>
<dd>
<a class="el" href="#aa2b6c23b3a70e9ef06c22d8a4885d69a" title="Выполняет SQL-запрос с использованием JOIN через вызов внутреннего метода.">PhotoRigma\Classes\Database\join()</a> Метод, который устанавливает <code>$this-&gt;txt_query</code> и вызывает <code>_execute_query()</code>. </dd>
<dd>
<a class="el" href="#af1b08f0490df0963b0daac6690d4765f" title="Выполняет преобразование SQL-запроса в зависимости от текущего формата и типа СУБД.">PhotoRigma\Classes\Database\_convert_query()</a> Приватный метод для преобразования запроса в нужный формат СУБД перед выполнением. </dd>
<dd>
<a class="el" href="#a53c8e7da5436bad14f32f64d5b532f60" title="Логирует результат анализа SQL-запроса с помощью EXPLAIN или EXPLAIN ANALYZE.">PhotoRigma\Classes\Database\_log_explain()</a> Приватный метод для выполнения EXPLAIN ANALYZE. </dd>
<dd>
<a class="el" href="#a8f393cc6e7e1b7e6394a9c2d4abdd8e7" title="Логирует медленные запросы, запросы без использования плейсхолдеров и другие запросы в таблицу логов.">PhotoRigma\Classes\Database\_log_query()</a> Приватный метод для логирования запросов. </dd></dl>

<p class="definition">См. определение в файле <a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a> строка <a class="el" href="../../d2/d89/Database_8php_source.html#l01393">1393</a></p>

<p class="reference">Перекрестные ссылки <a class="el" href="../../d2/d89/Database_8php_source.html#l01517">_convert_query()</a>, <a class="el" href="../../d2/d89/Database_8php_source.html#l01885">_log_explain()</a> и <a class="el" href="../../d2/d89/Database_8php_source.html#l02057">_log_query()</a>.</p>

<p class="reference">Используется в <a class="el" href="../../d2/d89/Database_8php_source.html#l00954">_delete_internal()</a>, <a class="el" href="../../d2/d89/Database_8php_source.html#l03029">_insert_internal()</a>, <a class="el" href="../../d2/d89/Database_8php_source.html#l03289">_join_internal()</a>, <a class="el" href="../../d2/d89/Database_8php_source.html#l03870">_select_internal()</a>, <a class="el" href="../../d2/d89/Database_8php_source.html#l03993">_truncate_internal()</a> и <a class="el" href="../../d2/d89/Database_8php_source.html#l04197">_update_internal()</a>.</p>
<div id="dynsection-17" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-17-trigger" src="../../closed.png" alt="+"/> Граф вызовов:</div>
<div id="dynsection-17-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-17-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_a941629b86b9c9e34bc5926c0db2478b5_cgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a941629b86b9c9e34bc5926c0db2478b5_cgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a941629b86b9c9e34bc5926c0db2478b5_cgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a941629b86b9c9e34bc5926c0db2478b5_cgraph">
<area shape="rect" title="Выполняет SQL&#45;запрос с использованием подготовленных выражений." alt="" coords="5,104,117,129"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#af1b08f0490df0963b0daac6690d4765f" title="Выполняет преобразование SQL&#45;запроса в зависимости от текущего формата и типа СУБД." alt="" coords="165,55,274,79"/>
<area shape="poly" title=" " alt="" coords="102,101,162,82,164,87,104,106"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a53c8e7da5436bad14f32f64d5b532f60" title="Логирует результат анализа SQL&#45;запроса с помощью EXPLAIN или EXPLAIN ANALYZE." alt="" coords="173,104,266,129"/>
<area shape="poly" title=" " alt="" coords="117,114,158,114,158,119,117,119"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a8f393cc6e7e1b7e6394a9c2d4abdd8e7" title="Логирует медленные запросы, запросы без использования плейсхолдеров и другие запросы в таблицу логов." alt="" coords="178,153,261,178"/>
<area shape="poly" title=" " alt="" coords="104,127,164,146,162,151,102,132"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#ad620cb343252ceea735bab03860a0915" title="Производит преобразование SQL&#45;запроса из формата MySQL в целевой формат СУБД (PostgreSQL или SQLite)." alt="" coords="322,5,485,30"/>
<area shape="poly" title=" " alt="" coords="268,51,340,32,341,37,269,57"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a2e93ad3621ba0d7cf06d36c539b6c290" title="Производит преобразование SQL&#45;запроса из формата PostgreSQL в целевой формат СУБД (MySQL или SQLite)." alt="" coords="324,55,484,79"/>
<area shape="poly" title=" " alt="" coords="274,64,308,64,308,70,274,70"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a44e1aec00a15341cd9119261482eeb0d" title="Производит преобразование SQL&#45;запроса из формата SQLite в целевой формат СУБД (MySQL или PostgreSQL)." alt="" coords="324,104,484,129"/>
<area shape="poly" title=" " alt="" coords="269,77,341,97,340,102,268,83"/>
</map>
</div>
<div id="dynsection-18" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-18-trigger" src="../../closed.png" alt="+"/> Граф вызова функции:</div>
<div id="dynsection-18-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-18-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_a941629b86b9c9e34bc5926c0db2478b5_icgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a941629b86b9c9e34bc5926c0db2478b5_icgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a941629b86b9c9e34bc5926c0db2478b5_icgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a941629b86b9c9e34bc5926c0db2478b5_icgraph">
<area shape="rect" title="Выполняет SQL&#45;запрос с использованием подготовленных выражений." alt="" coords="294,129,405,154"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#aa4094e522b4780bd58666dba20fdd09d" title="Формирует SQL&#45;запрос на удаление данных из таблицы, проверяет входные данные, обрабатывает недопустим..." alt="" coords="128,5,240,30"/>
<area shape="poly" title=" " alt="" coords="326,120,290,82,245,45,221,33,224,28,247,41,294,78,330,116"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a442c0348c8bd3cd7104cb110cc71348a" title="Формирует SQL&#45;запрос на вставку данных в таблицу, проверяет входные данные, обрабатывает различные ти..." alt="" coords="129,55,238,79"/>
<area shape="poly" title=" " alt="" coords="308,124,245,95,216,82,218,77,247,90,310,120"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#aa3fbbc7c98d1c241e897f0bf80177d2b" title="Формирует SQL&#45;запрос с использованием JOIN для выборки данных из нескольких таблиц,..." alt="" coords="135,104,232,129"/>
<area shape="poly" title=" " alt="" coords="278,133,233,126,233,121,279,128"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a3e40bb61553455b6f52be0ab9a6062b1" title="Формирует SQL&#45;запрос на выборку данных из таблицы, основываясь на полученных аргументах,..." alt="" coords="128,153,240,178"/>
<area shape="poly" title=" " alt="" coords="279,155,241,160,240,155,278,149"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#ad353291f086236ab7be0d1edc0ed3ba8" title="Формирует SQL&#45;запрос на очистку таблицы (TRUNCATE), размещает его в свойстве $txt_query и выполняет." alt="" coords="122,203,246,227"/>
<area shape="poly" title=" " alt="" coords="309,163,247,192,218,205,216,200,245,187,307,159"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#ab1dc7ae1ce60a864b1d7c865e99029b0" title="Формирует SQL&#45;запрос на обновление данных в таблице, основываясь на полученных аргументах,..." alt="" coords="126,252,242,277"/>
<area shape="poly" title=" " alt="" coords="329,168,293,205,247,241,224,254,221,249,245,237,290,201,326,164"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a73d8e6acdfb996002f980ab7c9c18515" title="Удаляет данные из таблицы через вызов внутреннего метода." alt="" coords="11,5,68,30"/>
<area shape="poly" title=" " alt="" coords="112,20,68,20,68,15,112,15"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a6e5af1f386c0c7968aa10ea928c7a110" title="Вставляет данные в таблицу через вызов внутреннего метода." alt="" coords="13,55,66,79"/>
<area shape="poly" title=" " alt="" coords="113,70,67,70,67,64,113,64"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#aa2b6c23b3a70e9ef06c22d8a4885d69a" title="Выполняет SQL&#45;запрос с использованием JOIN через вызов внутреннего метода." alt="" coords="19,104,60,129"/>
<area shape="poly" title=" " alt="" coords="119,119,61,119,61,114,119,114"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#aab30d2495bb1362d218cd62e1556b13e" title="Выполняет SQL&#45;запрос на выборку данных из таблицы." alt="" coords="11,153,68,178"/>
<area shape="poly" title=" " alt="" coords="112,168,68,168,68,163,112,163"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#ad4d4e455d9e4bf865126c72cf23a517b" title="Очищает таблицу (TRUNCATE) через вызов внутреннего метода." alt="" coords="5,203,74,227"/>
<area shape="poly" title=" " alt="" coords="106,218,74,218,74,212,106,212"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a539e51bc2144b972bfafeccdda56ee9e" title="Обновляет данные в таблице через вызов внутреннего метода." alt="" coords="9,252,70,277"/>
<area shape="poly" title=" " alt="" coords="110,267,70,267,70,262,110,262"/>
</map>
</div>

</div>
</div>
<a id="a90a18b9fa64057e99f74cbc20edb17d8" name="a90a18b9fa64057e99f74cbc20edb17d8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a90a18b9fa64057e99f74cbc20edb17d8">&#9670;&#160;</a></span>_fallback_to_ilike_pgsql()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">_fallback_to_ilike_pgsql </td>
          <td>(</td>
          <td class="paramtype">array</td>          <td class="paramname"><span class="paramname"><em>$columns_to_return_escaped</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">array</td>          <td class="paramname"><span class="paramname"><em>$columns_to_search_escaped</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>$search_string</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>$table_escaped</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">array</td>          <td class="paramname"><span class="paramname"><em>$options</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel private">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Выполняет альтернативный поиск по ILIKE с ранжированием similarity() для PostgreSQL. </p>
<p>Этот приватный метод реализует поиск данных в PostgreSQL, используя оператор <code>ILIKE</code> (регистронезависимый LIKE) по нескольким столбцам с возможностью ранжирования результатов по близости с использованием функции <code>similarity()</code>. Он используется как резервный механизм (fallback), когда основной полнотекстовый поиск (FTS) недоступен, отключен, или не дал результатов. Метод выполняет следующие действия:</p><ol type="1">
<li>Проверяет, является ли строка поиска <code>$search_string</code> пустой. Если да, возвращает <code>false</code> без выполнения запроса.</li>
<li>Формирует условия <code>WHERE</code> для оператора <code>ILIKE</code> по каждому столбцу из массива <code>$columns_to_search_escaped</code>. Каждое условие имеет вид <code>"имя_столбца" ILIKE :плейсхолдер</code>. Для строки поиска автоматически добавляются символы <code>%</code> в начале и конце (для поиска подстроки). Каждое условие использует уникальный именованный плейсхолдер (например, <code>:search_string_0</code>, <code>:search_string_1</code>) для безопасной привязки параметров.</li>
<li>Формирует выражения для ранжирования по близости с использованием функции <code>similarity()</code> для каждого столбца из массива <code>$columns_to_search_escaped</code>. Каждое выражение имеет вид <code>similarity ("имя_столбца", :плейсхолдер_ранга)</code>, где <code>:плейсхолдер_ранга</code> - уникальный именованный плейсхолдер для исходной строки поиска.</li>
<li>Объединяет сформированные условия <code>ILIKE</code> оператором <code>OR</code> для создания общей строки условия <code>WHERE</code>.</li>
<li>Объединяет сформированные выражения <code>similarity()</code> оператором <code>+</code> для создания общей строки сортировки <code>ORDER BY</code> по суммарному рангу (по убыванию).</li>
<li>Формирует базовые опции (<code>$base_options</code>) для поиска по <code>ILIKE</code> с ранжированием, включающие сформированные строки <code>WHERE</code> и <code>ORDER BY</code>, а также массив параметров, содержащий плейсхолдеры как для <code>ILIKE</code>, так и для <code>similarity()</code>.</li>
<li>Объединяет переданные внешние опции запроса (<code>$options</code>) с базовыми опциями (<code>$base_options</code>) с помощью приватного метода <code>_fts_check_options()</code>. Этот метод разрешает конфликты плейсхолдеров и определяет приоритеты для WHERE, ORDER BY, GROUP BY, LIMIT и PARAMS (сортировка по рангу из $base_options имеет приоритет).</li>
<li>Предпринимает попытку выполнить SQL-запрос SELECT с использованием экранированных столбцов для возврата, экранированного имени таблицы и объединенных опций (<code>$new_options</code>) в блоке <code>try...catch</code>, вызывая приватный метод <code>_select_internal()</code>.</li>
<li>В случае возникновения исключения (<code>Throwable</code>) во время выполнения LIKE-запроса (блок <code>catch</code>):<ul>
<li>Логирует информацию об ошибке с помощью функции <code>log_in_file()</code>, включая текст запроса и сообщение об ошибке.</li>
<li>Возвращает <code>false</code>, сигнализируя об ошибке выполнения поиска.</li>
</ul>
</li>
<li>В случае успешного выполнения запроса (блок <code>try</code> без исключений) получает результат запроса в виде массива с помощью приватного метода <code>_result_array_internal()</code> и возвращает его.</li>
</ol>
<p>Этот метод является приватным и предназначен только для использования внутри класса <code>Database</code>. Он вызывается из приватного метода <code>_full_text_search_pgsql()</code>.</p>
<dl class="params"><dt>Аргументы</dt><dd>
  <table class="params">
    <tr><td class="paramtype">array</td><td class="paramname">$columns_to_return_escaped</td><td>Массив строк с именами столбцов, которые нужно вернуть. Имена столбцов должны быть уже экранированы для PostgreSQL (например, <code>"id"</code>). </td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$columns_to_search_escaped</td><td>Массив строк с именами столбцов, по которым выполняется поиск по ILIKE. Имена столбцов должны быть уже экранированы для PostgreSQL. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$search_string</td><td>Строка поиска, введенная пользователем. Для поиска по ILIKE автоматически будут добавлены символы <code>%</code>. Пустая строка приводит к возврату <code>false</code>. Используется как есть для ранжирования <code>similarity()</code>. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$table_escaped</td><td>Строка с именем таблицы, в которой выполняется поиск. Имя таблицы должно быть уже экранировано для PostgreSQL (например, <code>"users"</code>). </td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$options</td><td>Массив дополнительных опций для формирования запроса. Используется для добавления условий WHERE, GROUP BY, ORDER BY, LIMIT и параметров к LIKE-запросу. Поддерживаемые ключи:<ul>
<li>where (string|array|false): Дополнительное условие WHERE (объединяется с условиями ILIKE оператором AND).</li>
<li>group (string|false): Группировка GROUP BY.</li>
<li>order (string|false): Дополнительная сортировка ORDER BY (имеет более низкий приоритет, чем сортировка по рангу similarity()).</li>
<li>limit (int|string|false): Ограничение LIMIT.</li>
<li>params (array): Ассоциативный массив дополнительных параметров для подготовленного выражения.</li>
</ul>
</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Возвращает</dt><dd>array|false Результат выполнения поиска в виде массива ассоциативных массивов (строк) при успехе и наличии результатов, пустой массив при успехе, но отсутствии результатов, или <code>false</code> в случае пустой строки поиска или ошибки выполнения запроса.</dd></dl>
<dl class="exception"><dt>Исключения</dt><dd>
  <table class="exception">
    <tr><td class="paramname">Exception</td><td>Может быть выброшено функцией логирования <code>log_in_file()</code> в случае невозможности записи в файл. </td></tr>
    <tr><td class="paramname">PDOException</td><td>Может быть выброшено методами <code>_fts_check_options()</code> (через вызов <code>_build_conditions()</code>) или <code>_select_internal()</code> в случае ошибок, связанных с базой данных или некорректным SQL, если они не перехватываются в блоке <code>try...catch</code> или выбрасываются после него. (Большинство таких ошибок внутри перехватываются и приводят к возврату false). </td></tr>
    <tr><td class="paramname">InvalidArgumentException</td><td>Может быть выброшено методом <code>_fts_check_options()</code> (через вызов <code>_build_conditions()</code>) при некорректном формате опций. (Большинство таких ошибок внутри перехватываются и приводят к возврату false).</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Заметки</dt><dd>Метод используется как резервный вариант поиска для PostgreSQL, когда полнотекстовый поиск (FTS) не может быть выполнен. Для каждого столбца поиска создается отдельное условие <code>ILIKE</code> и отдельное выражение <code>similarity()</code> с уникальными плейсхолдерами. Условия <code>ILIKE</code> объединяются оператором <code>OR</code>, а ранги <code>similarity()</code> суммируются для сортировки по убыванию. Использует приватный метод <code>_fts_check_options()</code> для объединения этих условий и сортировки с любыми дополнительными опциями, предоставленными пользователем. Для работы функции <code>similarity()</code> требуется установить и включить расширение <code>pg_trgm</code> в базе данных PostgreSQL.</dd></dl>
<dl class="section warning"><dt>Предупреждения</dt><dd>Убедитесь, что входные параметры <code>$columns_to_return_escaped</code>, <code>$columns_to_search_escaped</code> и <code>$table_escaped</code> уже экранированы для PostgreSQL. Убедитесь, что расширение <code>pg_trgm</code> установлено и доступно в базе данных PostgreSQL для корректной работы <code>similarity()</code>. Поиск с <code>ILIKE</code> и ранжирование <code>similarity()</code> могут быть неэффективны на больших объемах данных по сравнению с FTS.</dd></dl>
<p>Пример использования (вызывается из _full_text_search_pgsql()): </p><div class="fragment"><div class="line"><span class="comment">// Предположим:</span></div>
<div class="line"><span class="comment">// $columns_to_return_escaped = [&#39;&quot;id&quot;&#39;, &#39;&quot;title&quot;&#39;];</span></div>
<div class="line"><span class="comment">// $columns_to_search_escaped = [&#39;&quot;title&quot;&#39;, &#39;&quot;content&quot;&#39;];</span></div>
<div class="line"><span class="comment">// $search_string = &#39;search term&#39;;</span></div>
<div class="line"><span class="comment">// $table_escaped = &#39;&quot;articles&quot;&#39;;</span></div>
<div class="line"><span class="comment">// $options = [&#39;limit&#39; =&gt; 5];</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Вызов fallback метода</span></div>
<div class="line">$results_ilike = $this-&gt;<a class="code hl_function" href="#a90a18b9fa64057e99f74cbc20edb17d8">_fallback_to_ilike_pgsql</a>(</div>
<div class="line">    $columns_to_return_escaped,</div>
<div class="line">    $columns_to_search_escaped,</div>
<div class="line">    $search_string,</div>
<div class="line">    $table_escaped,</div>
<div class="line">    $options</div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> ($results_ilike !== <span class="keyword">false</span>) {</div>
<div class="line">    <span class="comment">// Обработка результатов поиска по ILIKE с ранжированием</span></div>
<div class="line">    print_r($results_ilike);</div>
<div class="line">} <span class="keywordflow">else</span> {</div>
<div class="line">    <span class="comment">// Обработка ошибки выполнения ILIKE-поиска</span></div>
<div class="line">    echo <span class="stringliteral">&quot;Произошла ошибка при выполнении ILIKE-поиска.&quot;</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Если $search_string был &#39;&#39;, вернет false сразу.</span></div>
<div class="ttc" id="aclassPhotoRigma_1_1Classes_1_1Database_html_a90a18b9fa64057e99f74cbc20edb17d8"><div class="ttname"><a href="#a90a18b9fa64057e99f74cbc20edb17d8">PhotoRigma\Classes\Database\_fallback_to_ilike_pgsql</a></div><div class="ttdeci">_fallback_to_ilike_pgsql(array $columns_to_return_escaped, array $columns_to_search_escaped, string $search_string, string $table_escaped, array $options)</div><div class="ttdoc">Выполняет альтернативный поиск по ILIKE с ранжированием similarity() для PostgreSQL.</div><div class="ttdef"><b>Определения</b> <a href="../../d2/d89/Database_8php_source.html#l05507">Database.php:5507</a></div></div>
</div><!-- fragment --> <dl class="section see"><dt>См. также</dt><dd><a class="el" href="#af1edfadea1168e39f99fb44c9899968c" title="Выполняет полнотекстовый поиск в PostgreSQL с обработкой минимальной длины строки,...">PhotoRigma\Classes\Database\_full_text_search_pgsql()</a> Приватный метод, который вызывает этот метод в случае необходимости fallback. </dd>
<dd>
<a class="el" href="#a6d6c48e4cc7e3d7353b4bda787ac9f43" title="Формирует финальный массив опций для запроса с учетом базовых FTS-опций и внешних условий/дополнений.">PhotoRigma\Classes\Database\_fts_check_options()</a> Приватный метод, используемый для объединения опций. </dd>
<dd>
<a class="el" href="#a3e40bb61553455b6f52be0ab9a6062b1" title="Формирует SQL-запрос на выборку данных из таблицы, основываясь на полученных аргументах,...">PhotoRigma\Classes\Database\_select_internal()</a> Приватный метод для выполнения SELECT-запроса. </dd>
<dd>
<a class="el" href="#a31eb9243149eec0d8676bbcf7289538d" title="Извлекает все строки результата из подготовленного выражения, хранящегося в свойстве $res_query,...">PhotoRigma\Classes\Database\_result_array_internal()</a> Приватный метод для получения всех строк результата запроса. </dd>
<dd>
<a class="el" href="../../db/d02/namespacePhotoRigma_1_1Include.html#a2d74c46a21e4ce612a98eee60981aef0" title="Записывает сообщение об ошибке в лог-файл и, при необходимости, завершает выполнение скрипта.">PhotoRigma\Include\log_in_file()</a> Функция для логирования сообщений. </dd>
<dd>
<a href="https://www.postgresql.org/docs/current/pgtrgm.html">https://www.postgresql.org/docs/current/pgtrgm.html</a> Документация по расширению pg_trgm и функции similarity(). </dd></dl>

<p class="definition">См. определение в файле <a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a> строка <a class="el" href="../../d2/d89/Database_8php_source.html#l05507">5507</a></p>

<p class="reference">Перекрестные ссылки <a class="el" href="../../d2/d89/Database_8php_source.html#l05507">_fallback_to_ilike_pgsql()</a>.</p>

<p class="reference">Используется в <a class="el" href="../../d2/d89/Database_8php_source.html#l05507">_fallback_to_ilike_pgsql()</a> и <a class="el" href="../../d2/d89/Database_8php_source.html#l05280">_full_text_search_pgsql()</a>.</p>
<div id="dynsection-19" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-19-trigger" src="../../closed.png" alt="+"/> Граф вызовов:</div>
<div id="dynsection-19-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-19-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_a90a18b9fa64057e99f74cbc20edb17d8_cgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a90a18b9fa64057e99f74cbc20edb17d8_cgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a90a18b9fa64057e99f74cbc20edb17d8_cgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a90a18b9fa64057e99f74cbc20edb17d8_cgraph">
<area shape="rect" title="Выполняет альтернативный поиск по ILIKE с ранжированием similarity() для PostgreSQL." alt="" coords="5,29,127,68"/>
<area shape="poly" title=" " alt="" coords="42,30,41,20,44,11,53,5,66,3,80,5,88,12,85,16,78,10,66,8,55,10,48,14,46,20,47,29"/>
</map>
</div>
<div id="dynsection-20" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-20-trigger" src="../../closed.png" alt="+"/> Граф вызова функции:</div>
<div id="dynsection-20-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-20-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_a90a18b9fa64057e99f74cbc20edb17d8_icgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a90a18b9fa64057e99f74cbc20edb17d8_icgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a90a18b9fa64057e99f74cbc20edb17d8_icgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a90a18b9fa64057e99f74cbc20edb17d8_icgraph">
<area shape="rect" title="Выполняет альтернативный поиск по ILIKE с ранжированием similarity() для PostgreSQL." alt="" coords="211,29,332,68"/>
<area shape="poly" title=" " alt="" coords="302,16,291,10,271,8,253,10,243,15,239,21,241,28,236,30,234,20,239,11,252,5,271,3,292,5,304,12"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#af1edfadea1168e39f99fb44c9899968c" title="Выполняет полнотекстовый поиск в PostgreSQL с обработкой минимальной длины строки,..." alt="" coords="5,36,163,61"/>
<area shape="poly" title=" " alt="" coords="195,51,163,51,163,46,195,46"/>
<area shape="poly" title=" " alt="" coords="116,24,106,17,84,15,64,17,54,22,52,27,57,34,53,38,46,28,50,18,63,12,84,10,107,12,119,19"/>
</map>
</div>

</div>
</div>
<a id="a33d25ea74a693adb2d31b1a0667553b2" name="a33d25ea74a693adb2d31b1a0667553b2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a33d25ea74a693adb2d31b1a0667553b2">&#9670;&#160;</a></span>_fallback_to_like_mysql()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">_fallback_to_like_mysql </td>
          <td>(</td>
          <td class="paramtype">array</td>          <td class="paramname"><span class="paramname"><em>$columns_to_return_escaped</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">array</td>          <td class="paramname"><span class="paramname"><em>$columns_to_search_escaped</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>$search_string</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>$table_escaped</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">array</td>          <td class="paramname"><span class="paramname"><em>$options</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel private">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Выполняет альтернативный поиск по LIKE для MySQL. </p>
<p>Этот приватный метод реализует поиск данных в MySQL, используя оператор <code>LIKE</code> по нескольким столбцам. Он используется как резервный механизм (fallback), когда основной полнотекстовый поиск (FTS) недоступен, отключен, или не дал результатов (например, из-за минимальной длины строки поиска или отсутствия FTS-индекса). Метод выполняет следующие действия:</p><ol type="1">
<li>Проверяет, является ли строка поиска <code>$search_string</code> пустой. Если да, возвращает <code>false</code> без выполнения запроса.</li>
<li>Формирует условия <code>WHERE</code> для оператора <code>LIKE</code> по каждому столбцу из массива <code>$columns_to_search_escaped</code>. Каждое условие имеет вид <code>"имя_столбца" LIKE :плейсхолдер</code>. Для строки поиска автоматически добавляются символы <code>%</code> в начале и конце (для поиска подстроки). Каждое условие использует уникальный именованный плейсхолдер (например, <code>:search_string_0</code>, <code>:search_string_1</code>) для безопасной привязки параметров.</li>
<li>Объединяет сформированные условия <code>LIKE</code> оператором <code>OR</code> для создания общей строки условия <code>WHERE</code>.</li>
<li>Формирует базовые опции (<code>$base_options</code>) для поиска по <code>LIKE</code>, включающие сформированное условие <code>WHERE</code> и массив параметров для плейсхолдеров <code>LIKE</code>.</li>
<li>Объединяет переданные внешние опции запроса (<code>$options</code>) с базовыми опциями <code>LIKE</code> (<code>$base_options</code>) с помощью приватного метода <code>_fts_check_options()</code>. Этот метод разрешает конфликты плейсхолдеров и определяет приоритеты для WHERE, ORDER BY, GROUP BY, LIMIT и PARAMS.</li>
<li>Предпринимает попытку выполнить SQL-запрос SELECT с использованием экранированных столбцов для возврата, экранированного имени таблицы и объединенных опций (<code>$new_options</code>) в блоке <code>try...catch</code>, вызывая приватный метод <code>_select_internal()</code>.</li>
<li>В случае возникновения исключения (<code>Throwable</code>) во время выполнения LIKE-запроса (блок <code>catch</code>):<ul>
<li>Логирует информацию об ошибке с помощью функции <code>log_in_file()</code>, включая текст запроса и сообщение об ошибке.</li>
<li>Возвращает <code>false</code>, сигнализируя об ошибке выполнения поиска.</li>
</ul>
</li>
<li>В случае успешного выполнения запроса (блок <code>try</code> без исключений) получает результат запроса в виде массива с помощью приватного метода <code>_result_array_internal()</code> и возвращает его.</li>
</ol>
<p>Этот метод является приватным и предназначен только для использования внутри класса <code>Database</code>. Он вызывается из приватного метода <code>_full_text_search_mysql()</code>.</p>
<dl class="params"><dt>Аргументы</dt><dd>
  <table class="params">
    <tr><td class="paramtype">array</td><td class="paramname">$columns_to_return_escaped</td><td>Массив строк с именами столбцов, которые нужно вернуть. Имена столбцов должны быть уже экранированы для MySQL (например, <code>`id`</code>). </td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$columns_to_search_escaped</td><td>Массив строк с именами столбцов, по которым выполняется поиск по LIKE. Имена столбцов должны быть уже экранированы для MySQL. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$search_string</td><td>Строка поиска, введенная пользователем. Для поиска по LIKE автоматически будут добавлены символы <code>%</code>. Пустая строка приводит к возврату <code>false</code>. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$table_escaped</td><td>Строка с именем таблицы, в которой выполняется поиск. Имя таблицы должно быть уже экранировано для MySQL (например, <code>`users`</code>). </td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$options</td><td>Массив дополнительных опций для формирования запроса. Используется для добавления условий WHERE, GROUP BY, ORDER BY, LIMIT и параметров к LIKE-запросу. Поддерживаемые ключи:<ul>
<li>where (string|array|false): Дополнительное условие WHERE (объединяется с условиями LIKE оператором AND).</li>
<li>group (string|false): Группировка GROUP BY.</li>
<li>order (string|false): Сортировка ORDER BY.</li>
<li>limit (int|string|false): Ограничение LIMIT.</li>
<li>params (array): Ассоциативный массив дополнительных параметров для подготовленного выражения.</li>
</ul>
</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Возвращает</dt><dd>array|false Результат выполнения поиска в виде массива ассоциативных массивов (строк) при успехе и наличии результатов, пустой массив при успехе, но отсутствии результатов, или <code>false</code> в случае пустой строки поиска или ошибки выполнения запроса.</dd></dl>
<dl class="exception"><dt>Исключения</dt><dd>
  <table class="exception">
    <tr><td class="paramname">Exception</td><td>Может быть выброшено функцией логирования <code>log_in_file()</code> в случае невозможности записи в файл. </td></tr>
    <tr><td class="paramname">PDOException</td><td>Может быть выброшено методами <code>_fts_check_options()</code> (через вызов <code>_build_conditions()</code>) или <code>_select_internal()</code> в случае ошибок, связанных с базой данных или некорректным SQL, если они не перехватываются в блоке <code>try...catch</code> или выбрасываются после него. (Большинство таких ошибок внутри LIKE перехватываются и приводят к возврату false). </td></tr>
    <tr><td class="paramname">InvalidArgumentException</td><td>Может быть выброшено методом <code>_fts_check_options()</code> (через вызов <code>_build_conditions()</code>) при некорректном формате опций. (Большинство таких ошибок внутри LIKE перехватываются и приводят к возврату false).</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Заметки</dt><dd>Метод используется как резервный вариант поиска, когда полнотекстовый поиск (FTS) не может быть выполнен. Для каждого столбца поиска создается отдельное условие <code>LIKE</code> с уникальным плейсхолдером. Использует приватный метод <code>_fts_check_options()</code> для объединения условий <code>LIKE</code> с любыми дополнительными опциями, предоставленными пользователем.</dd></dl>
<dl class="section warning"><dt>Предупреждения</dt><dd>Убедитесь, что входные параметры <code>$columns_to_return_escaped</code>, <code>$columns_to_search_escaped</code> и <code>$table_escaped</code> уже экранированы для MySQL. Поиск с <code>LIKE</code> может быть неэффективен на больших объемах данных и может вызвать высокую нагрузку на базу данных.</dd></dl>
<p>Пример использования (вызывается из _full_text_search_mysql()): </p><div class="fragment"><div class="line"><span class="comment">// Предположим:</span></div>
<div class="line"><span class="comment">// $columns_to_return_escaped = [&#39;`id`&#39;, &#39;`title`&#39;];</span></div>
<div class="line"><span class="comment">// $columns_to_search_escaped = [&#39;`title`&#39;, &#39;`content`&#39;];</span></div>
<div class="line"><span class="comment">// $search_string = &#39;search term&#39;;</span></div>
<div class="line"><span class="comment">// $table_escaped = &#39;`articles`&#39;;</span></div>
<div class="line"><span class="comment">// $options = [&#39;limit&#39; =&gt; 5];</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Вызов fallback метода</span></div>
<div class="line">$results_like = $this-&gt;<a class="code hl_function" href="#a33d25ea74a693adb2d31b1a0667553b2">_fallback_to_like_mysql</a>(</div>
<div class="line">    $columns_to_return_escaped,</div>
<div class="line">    $columns_to_search_escaped,</div>
<div class="line">    $search_string,</div>
<div class="line">    $table_escaped,</div>
<div class="line">    $options</div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> ($results_like !== <span class="keyword">false</span>) {</div>
<div class="line">    <span class="comment">// Обработка результатов поиска по LIKE</span></div>
<div class="line">    print_r($results_like);</div>
<div class="line">} <span class="keywordflow">else</span> {</div>
<div class="line">    <span class="comment">// Обработка ошибки выполнения LIKE-поиска</span></div>
<div class="line">    echo <span class="stringliteral">&quot;Произошла ошибка при выполнении LIKE-поиска.&quot;</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Если $search_string был &#39;&#39;, вернет false сразу.</span></div>
<div class="ttc" id="aclassPhotoRigma_1_1Classes_1_1Database_html_a33d25ea74a693adb2d31b1a0667553b2"><div class="ttname"><a href="#a33d25ea74a693adb2d31b1a0667553b2">PhotoRigma\Classes\Database\_fallback_to_like_mysql</a></div><div class="ttdeci">_fallback_to_like_mysql(array $columns_to_return_escaped, array $columns_to_search_escaped, string $search_string, string $table_escaped, array $options)</div><div class="ttdoc">Выполняет альтернативный поиск по LIKE для MySQL.</div><div class="ttdef"><b>Определения</b> <a href="../../d2/d89/Database_8php_source.html#l05072">Database.php:5072</a></div></div>
</div><!-- fragment --> <dl class="section see"><dt>См. также</dt><dd><a class="el" href="#a56dafcbeab9a8a4a7304278eeb2edabe" title="Выполняет полнотекстовый поиск в MySQL с обработкой минимальной длины строки, кешированием ошибок и f...">PhotoRigma\Classes\Database\_full_text_search_mysql()</a> Приватный метод, который вызывает этот метод в случае необходимости fallback. </dd>
<dd>
<a class="el" href="#a6d6c48e4cc7e3d7353b4bda787ac9f43" title="Формирует финальный массив опций для запроса с учетом базовых FTS-опций и внешних условий/дополнений.">PhotoRigma\Classes\Database\_fts_check_options()</a> Приватный метод, используемый для объединения опций. </dd>
<dd>
<a class="el" href="#a3e40bb61553455b6f52be0ab9a6062b1" title="Формирует SQL-запрос на выборку данных из таблицы, основываясь на полученных аргументах,...">PhotoRigma\Classes\Database\_select_internal()</a> Приватный метод для выполнения SELECT-запроса. </dd>
<dd>
<a class="el" href="#a31eb9243149eec0d8676bbcf7289538d" title="Извлекает все строки результата из подготовленного выражения, хранящегося в свойстве $res_query,...">PhotoRigma\Classes\Database\_result_array_internal()</a> Приватный метод для получения всех строк результата запроса. </dd>
<dd>
<a class="el" href="../../db/d02/namespacePhotoRigma_1_1Include.html#a2d74c46a21e4ce612a98eee60981aef0" title="Записывает сообщение об ошибке в лог-файл и, при необходимости, завершает выполнение скрипта.">PhotoRigma\Include\log_in_file()</a> Функция для логирования сообщений. </dd></dl>

<p class="definition">См. определение в файле <a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a> строка <a class="el" href="../../d2/d89/Database_8php_source.html#l05072">5072</a></p>

<p class="reference">Перекрестные ссылки <a class="el" href="../../d2/d89/Database_8php_source.html#l05072">_fallback_to_like_mysql()</a>.</p>

<p class="reference">Используется в <a class="el" href="../../d2/d89/Database_8php_source.html#l05072">_fallback_to_like_mysql()</a> и <a class="el" href="../../d2/d89/Database_8php_source.html#l04860">_full_text_search_mysql()</a>.</p>
<div id="dynsection-21" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-21-trigger" src="../../closed.png" alt="+"/> Граф вызовов:</div>
<div id="dynsection-21-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-21-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_a33d25ea74a693adb2d31b1a0667553b2_cgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a33d25ea74a693adb2d31b1a0667553b2_cgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a33d25ea74a693adb2d31b1a0667553b2_cgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a33d25ea74a693adb2d31b1a0667553b2_cgraph">
<area shape="rect" title="Выполняет альтернативный поиск по LIKE для MySQL." alt="" coords="5,29,165,54"/>
<area shape="poly" title=" " alt="" coords="58,30,53,21,56,11,67,5,85,3,105,5,115,12,112,16,103,10,85,8,68,10,60,15,58,20,63,28"/>
</map>
</div>
<div id="dynsection-22" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-22-trigger" src="../../closed.png" alt="+"/> Граф вызова функции:</div>
<div id="dynsection-22-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-22-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_a33d25ea74a693adb2d31b1a0667553b2_icgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a33d25ea74a693adb2d31b1a0667553b2_icgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a33d25ea74a693adb2d31b1a0667553b2_icgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a33d25ea74a693adb2d31b1a0667553b2_icgraph">
<area shape="rect" title="Выполняет альтернативный поиск по LIKE для MySQL." alt="" coords="214,29,373,54"/>
<area shape="poly" title=" " alt="" coords="329,17,317,10,293,8,271,10,260,15,257,20,263,27,259,31,252,21,256,11,270,5,293,3,319,5,332,12"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a56dafcbeab9a8a4a7304278eeb2edabe" title="Выполняет полнотекстовый поиск в MySQL с обработкой минимальной длины строки, кешированием ошибок и f..." alt="" coords="5,29,166,54"/>
<area shape="poly" title=" " alt="" coords="198,44,166,44,166,39,198,39"/>
<area shape="poly" title=" " alt="" coords="122,17,110,10,85,8,63,10,52,15,49,20,56,27,51,31,44,21,48,11,62,5,86,3,111,5,124,12"/>
</map>
</div>

</div>
</div>
<a id="a960a7f20277c75940122885ec6b40d4b" name="a960a7f20277c75940122885ec6b40d4b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a960a7f20277c75940122885ec6b40d4b">&#9670;&#160;</a></span>_fallback_to_like_sqlite()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">_fallback_to_like_sqlite </td>
          <td>(</td>
          <td class="paramtype">array</td>          <td class="paramname"><span class="paramname"><em>$columns_to_return_escaped</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">array</td>          <td class="paramname"><span class="paramname"><em>$columns_to_search_escaped</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>$search_string</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>$table_escaped</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">array</td>          <td class="paramname"><span class="paramname"><em>$options</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel private">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Выполняет альтернативный LIKE-поиск для SQLite. </p>
<p>Этот приватный метод реализует поиск данных в SQLite, используя оператор <code>LIKE</code> по нескольким столбцам. Он используется как резервный механизм (fallback), когда основной полнотекстовый поиск (FTS5) недоступен, отключен, или не дал результатов (например, из-за минимальной длины строки поиска или отсутствия виртуальной FTS5 таблицы). Метод выполняет следующие действия:</p><ol type="1">
<li>Проверяет, является ли строка поиска <code>$search_string</code> пустой. Если да, возвращает <code>false</code> без выполнения запроса.</li>
<li>Формирует условия <code>WHERE</code> для оператора <code>LIKE</code> по каждому столбцу из массива <code>$columns_to_search_escaped</code>. Каждое условие имеет вид <code>"имя_столбца" LIKE :плейсхолдер</code>. Для строки поиска автоматически добавляются символы <code>%</code> в начале и конце (для поиска подстроки). Каждое условие использует уникальный именованный плейсхолдер (например, <code>:search_string_0</code>, <code>:search_string_1</code>) для безопасной привязки параметров.</li>
<li>Объединяет сформированные условия <code>LIKE</code> оператором <code>OR</code> для создания общей строки условия <code>WHERE</code>.</li>
<li>Формирует базовые опции (<code>$base_options</code>) для поиска по <code>LIKE</code>, включающие сформированное условие <code>WHERE</code> и массив параметров для плейсхолдеров <code>LIKE</code>.</li>
<li>Объединяет переданные внешние опции запроса (<code>$options</code>) с базовыми опциями <code>LIKE</code> (<code>$base_options</code>) с помощью приватного метода <code>_fts_check_options()</code>. Этот метод разрешает конфликты плейсхолдеров и определяет приоритеты для WHERE, ORDER BY, GROUP BY, LIMIT и PARAMS.</li>
<li>Предпринимает попытку выполнить SQL-запрос SELECT с использованием экранированных столбцов для возврата, экранированного имени таблицы и объединенных опций (<code>$new_options</code>) в блоке <code>try...catch</code>, вызывая приватный метод <code>_select_internal()</code>.</li>
<li>В случае возникновения исключения (<code>Throwable</code>) во время выполнения LIKE-запроса (блок <code>catch</code>):<ul>
<li>Логирует информацию об ошибке с помощью функции <code>log_in_file()</code>, включая текст запроса и сообщение об ошибке.</li>
<li>Возвращает <code>false</code>, сигнализируя об ошибке выполнения поиска.</li>
</ul>
</li>
<li>В случае успешного выполнения запроса (блок <code>try</code> без исключений) получает результат запроса в виде массива с помощью приватного метода <code>_result_array_internal()</code> и возвращает его.</li>
</ol>
<p>Этот метод является приватным и предназначен только для использования внутри класса <code>Database</code>. Он вызывается из приватного метода <code>_full_text_search_sqlite()</code>.</p>
<dl class="params"><dt>Аргументы</dt><dd>
  <table class="params">
    <tr><td class="paramtype">array</td><td class="paramname">$columns_to_return_escaped</td><td>Массив строк с именами столбцов, которые нужно вернуть. Имена столбцов должны быть уже экранированы для SQLite (например, <code>"id"</code> или <code>[id]</code>). </td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$columns_to_search_escaped</td><td>Массив строк с именами столбцов, по которым выполняется поиск по LIKE. Имена столбцов должны быть уже экранированы для SQLite. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$search_string</td><td>Строка поиска, введенная пользователем. Для поиска по LIKE автоматически будут добавлены символы <code>%</code>. Пустая строка приводит к возврату <code>false</code>. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$table_escaped</td><td>Строка с именем таблицы, в которой выполняется поиск. Имя таблицы должно быть уже экранировано для SQLite (например, <code>"users"</code> или <code>[users]</code>). </td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$options</td><td>Массив дополнительных опций для формирования запроса. Используется для добавления условий WHERE, GROUP BY, ORDER BY, LIMIT и параметров к LIKE-запросу. Поддерживаемые ключи:<ul>
<li>where (string|array|false): Дополнительное условие WHERE (объединяется с условиями LIKE оператором AND).</li>
<li>group (string|false): Группировка GROUP BY.</li>
<li>order (string|false): Сортировка ORDER BY.</li>
<li>limit (int|string|false): Ограничение LIMIT.</li>
<li>params (array): Ассоциативный массив дополнительных параметров для подготовленного выражения.</li>
</ul>
</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Возвращает</dt><dd>array|false Результат выполнения поиска в виде массива ассоциативных массивов (строк) при успехе и наличии результатов, пустой массив при успехе, но отсутствии результатов, или <code>false</code> в случае пустой строки поиска или ошибки выполнения запроса.</dd></dl>
<dl class="exception"><dt>Исключения</dt><dd>
  <table class="exception">
    <tr><td class="paramname">Exception</td><td>Может быть выброшено функцией логирования <code>log_in_file()</code> в случае невозможности записи в файл. </td></tr>
    <tr><td class="paramname">PDOException</td><td>Может быть выброшено методами <code>_fts_check_options()</code> (через вызов <code>_build_conditions()</code>) или <code>_select_internal()</code> в случае ошибок, связанных с базой данных или некорректным SQL, если они не перехватываются в блоке <code>try...catch</code> или выбрасываются после него. (Большинство таких ошибок внутри LIKE перехватываются и приводят к возврату false). </td></tr>
    <tr><td class="paramname">InvalidArgumentException</td><td>Может быть выброшено методом <code>_fts_check_options()</code> (через вызов <code>_build_conditions()</code>) при некорректном формате опций. (Большинство таких ошибок внутри LIKE перехватываются и приводят к возврату false).</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Заметки</dt><dd>Метод используется как резервный вариант поиска для SQLite, когда полнотекстовый поиск (FTS5) не может быть выполнен. Для каждого столбца поиска создается отдельное условие <code>LIKE</code> с уникальным плейсхолдером. Использует приватный метод <code>_fts_check_options()</code> для объединения условий <code>LIKE</code> с любыми дополнительными опциями, предоставленными пользователем.</dd></dl>
<dl class="section warning"><dt>Предупреждения</dt><dd>Убедитесь, что входные параметры <code>$columns_to_return_escaped</code>, <code>$columns_to_search_escaped</code> и <code>$table_escaped</code> уже экранированы для SQLite. Поиск с <code>LIKE</code> может быть неэффективен на больших объемах данных по сравнению с FTS5.</dd></dl>
<p>Пример использования (вызывается из _full_text_search_sqlite()): </p><div class="fragment"><div class="line"><span class="comment">// Предположим:</span></div>
<div class="line"><span class="comment">// $columns_to_return_escaped = [&#39;&quot;id&quot;&#39;, &#39;&quot;title&quot;&#39;];</span></div>
<div class="line"><span class="comment">// $columns_to_search_escaped = [&#39;&quot;title&quot;&#39;, &#39;&quot;content&quot;&#39;];</span></div>
<div class="line"><span class="comment">// $search_string = &#39;search term&#39;;</span></div>
<div class="line"><span class="comment">// $table_escaped = &#39;&quot;articles&quot;&#39;;</span></div>
<div class="line"><span class="comment">// $options = [&#39;limit&#39; =&gt; 5];</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Вызов fallback метода</span></div>
<div class="line">$results_like = $this-&gt;<a class="code hl_function" href="#a960a7f20277c75940122885ec6b40d4b">_fallback_to_like_sqlite</a>(</div>
<div class="line">    $columns_to_return_escaped,</div>
<div class="line">    $columns_to_search_escaped,</div>
<div class="line">    $search_string,</div>
<div class="line">    $table_escaped,</div>
<div class="line">    $options</div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> ($results_like !== <span class="keyword">false</span>) {</div>
<div class="line">    <span class="comment">// Обработка результатов поиска по LIKE</span></div>
<div class="line">    print_r($results_like);</div>
<div class="line">} <span class="keywordflow">else</span> {</div>
<div class="line">    <span class="comment">// Обработка ошибки выполнения LIKE-поиска</span></div>
<div class="line">    echo <span class="stringliteral">&quot;Произошла ошибка при выполнении LIKE-поиска.&quot;</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Если $search_string был &#39;&#39;, вернет false сразу.</span></div>
<div class="ttc" id="aclassPhotoRigma_1_1Classes_1_1Database_html_a960a7f20277c75940122885ec6b40d4b"><div class="ttname"><a href="#a960a7f20277c75940122885ec6b40d4b">PhotoRigma\Classes\Database\_fallback_to_like_sqlite</a></div><div class="ttdeci">_fallback_to_like_sqlite(array $columns_to_return_escaped, array $columns_to_search_escaped, string $search_string, string $table_escaped, array $options)</div><div class="ttdoc">Выполняет альтернативный LIKE-поиск для SQLite.</div><div class="ttdef"><b>Определения</b> <a href="../../d2/d89/Database_8php_source.html#l05931">Database.php:5931</a></div></div>
</div><!-- fragment --> <dl class="section see"><dt>См. также</dt><dd><a class="el" href="#a54df4031bb92109e8e164b9313163121" title="Выполняет полнотекстовый поиск в SQLite через FTS5.">PhotoRigma\Classes\Database\_full_text_search_sqlite()</a> Приватный метод, который вызывает этот метод в случае необходимости fallback. </dd>
<dd>
<a class="el" href="#a6d6c48e4cc7e3d7353b4bda787ac9f43" title="Формирует финальный массив опций для запроса с учетом базовых FTS-опций и внешних условий/дополнений.">PhotoRigma\Classes\Database\_fts_check_options()</a> Приватный метод, используемый для объединения опций. </dd>
<dd>
<a class="el" href="#a3e40bb61553455b6f52be0ab9a6062b1" title="Формирует SQL-запрос на выборку данных из таблицы, основываясь на полученных аргументах,...">PhotoRigma\Classes\Database\_select_internal()</a> Приватный метод для выполнения SELECT-запроса. </dd>
<dd>
<a class="el" href="#a31eb9243149eec0d8676bbcf7289538d" title="Извлекает все строки результата из подготовленного выражения, хранящегося в свойстве $res_query,...">PhotoRigma\Classes\Database\_result_array_internal()</a> Приватный метод для получения всех строк результата запроса. </dd>
<dd>
<a class="el" href="../../db/d02/namespacePhotoRigma_1_1Include.html#a2d74c46a21e4ce612a98eee60981aef0" title="Записывает сообщение об ошибке в лог-файл и, при необходимости, завершает выполнение скрипта.">PhotoRigma\Include\log_in_file()</a> Функция для логирования сообщений. </dd></dl>

<p class="definition">См. определение в файле <a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a> строка <a class="el" href="../../d2/d89/Database_8php_source.html#l05931">5931</a></p>

<p class="reference">Перекрестные ссылки <a class="el" href="../../d2/d89/Database_8php_source.html#l05931">_fallback_to_like_sqlite()</a>.</p>

<p class="reference">Используется в <a class="el" href="../../d2/d89/Database_8php_source.html#l05931">_fallback_to_like_sqlite()</a> и <a class="el" href="../../d2/d89/Database_8php_source.html#l05723">_full_text_search_sqlite()</a>.</p>
<div id="dynsection-23" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-23-trigger" src="../../closed.png" alt="+"/> Граф вызовов:</div>
<div id="dynsection-23-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-23-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_a960a7f20277c75940122885ec6b40d4b_cgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a960a7f20277c75940122885ec6b40d4b_cgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a960a7f20277c75940122885ec6b40d4b_cgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a960a7f20277c75940122885ec6b40d4b_cgraph">
<area shape="rect" title="Выполняет альтернативный LIKE&#45;поиск для SQLite." alt="" coords="5,29,162,54"/>
<area shape="poly" title=" " alt="" coords="57,30,52,21,55,11,66,5,84,3,103,5,113,12,110,16,101,10,83,8,67,10,59,15,57,20,62,28"/>
</map>
</div>
<div id="dynsection-24" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-24-trigger" src="../../closed.png" alt="+"/> Граф вызова функции:</div>
<div id="dynsection-24-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-24-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_a960a7f20277c75940122885ec6b40d4b_icgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a960a7f20277c75940122885ec6b40d4b_icgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a960a7f20277c75940122885ec6b40d4b_icgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a960a7f20277c75940122885ec6b40d4b_icgraph">
<area shape="rect" title="Выполняет альтернативный LIKE&#45;поиск для SQLite." alt="" coords="211,29,367,54"/>
<area shape="poly" title=" " alt="" coords="324,17,313,10,289,8,267,10,256,15,253,20,259,27,255,31,248,21,252,11,266,5,289,3,314,5,327,12"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a54df4031bb92109e8e164b9313163121" title="Выполняет полнотекстовый поиск в SQLite через FTS5." alt="" coords="5,29,163,54"/>
<area shape="poly" title=" " alt="" coords="195,44,163,44,163,39,195,39"/>
<area shape="poly" title=" " alt="" coords="120,17,108,10,84,8,62,10,51,15,48,20,55,27,50,31,43,21,47,11,61,5,84,3,109,5,122,12"/>
</map>
</div>

</div>
</div>
<a id="ad7c3527d920ebf2dbcbc0c51845835d6" name="ad7c3527d920ebf2dbcbc0c51845835d6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad7c3527d920ebf2dbcbc0c51845835d6">&#9670;&#160;</a></span>_format_date_internal()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">_format_date_internal </td>
          <td>(</td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>$column</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>$format</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel protected">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Формирует SQL-выражение для форматирования даты с учетом специфики используемой СУБД. </p>
<p>Этот защищённый метод выполняет следующие шаги:</p><ol type="1">
<li>Проверяет тип СУБД через свойство <code>$this-&gt;db_type</code>.</li>
<li>Для MariaDB (MySQL) преобразует переданный формат <code>$format</code> через метод <code>_convert_to_mysql_format()</code> и использует функцию <code>DATE_FORMAT</code>.</li>
<li>Для PostgreSQL преобразует формат через метод <code>_convert_to_postgres_format()</code> и использует функцию <code>TO_CHAR</code>. Метод принимает формат не только в стиле MySQL, но и другие поддерживаемые форматы.</li>
<li>Для SQLite преобразует формат через метод <code>_convert_to_sqlite_format()</code> и использует функцию <code>strftime</code>. Метод принимает формат не только в стиле MySQL, но и другие поддерживаемые форматы.</li>
<li>Если тип СУБД не поддерживается, выбрасывает исключение InvalidArgumentException.</li>
</ol>
<p>Этот метод является защищенным и предназначен для использования внутри класса или его наследников. Основная логика вызывается через публичный метод-редирект <code>format_date()</code>.</p>
<dl class="params"><dt>Аргументы</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$column</td><td>Название столбца с датой:<ul>
<li>Должен быть непустой строкой в формате имени столбца таблицы в БД. </li>
</ul>
</td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$format</td><td>Формат даты:<ul>
<li>Может быть указан в любом поддерживаемом формате (например, MySQL, PostgreSQL, SQLite).</li>
<li>Текущий формат определяется через свойство <code>$this-&gt;current_format</code>.</li>
<li>Преобразование выполняется в зависимости от типа СУБД.</li>
</ul>
</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Возвращает</dt><dd>string SQL-выражение для форматирования даты.</dd></dl>
<dl class="exception"><dt>Исключения</dt><dd>
  <table class="exception">
    <tr><td class="paramname">InvalidArgumentException</td><td>Выбрасывается, если тип СУБД (<code>$this-&gt;db_type</code>) не поддерживается. Пример сообщения: Не поддерживаемый тип СУБД | Тип: unknown</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Заметки</dt><dd>Метод использует функции форматирования даты, специфичные для каждой СУБД. Текущий формат хранится в свойстве <code>$this-&gt;current_format</code>, а список допустимых форматов — в свойстве <code>$this-&gt;allowed_formats</code>. Для временного изменения текущего формата используется метод <code>_with_sql_format_internal()</code>.</dd></dl>
<dl class="section warning"><dt>Предупреждения</dt><dd>Убедитесь, что <code>$column</code> (непустая строка) и <code>$format</code> содержат корректные значения перед вызовом метода. Неверный формат может привести к ошибкам при формировании SQL-запроса.</dd></dl>
<p>Пример вызова метода внутри класса: </p><div class="fragment"><div class="line"><span class="comment">// Форматирование даты для MySQL</span></div>
<div class="line">$this-&gt;<a class="code hl_function" href="#ad7c3527d920ebf2dbcbc0c51845835d6">_format_date_internal</a>(<span class="stringliteral">&#39;created_at&#39;</span>, <span class="stringliteral">&#39;%Y-%m-%d&#39;</span>);</div>
<div class="line"><span class="comment">// Результат: DATE_FORMAT(created_at, &#39;2023-10-01&#39;)</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Форматирование даты для PostgreSQL</span></div>
<div class="line">$this-&gt;<a class="code hl_function" href="#ad7c3527d920ebf2dbcbc0c51845835d6">_format_date_internal</a>(<span class="stringliteral">&#39;created_at&#39;</span>, <span class="stringliteral">&#39;YYYY-MM-DD&#39;</span>);</div>
<div class="line"><span class="comment">// Результат: TO_CHAR(created_at, &#39;2023-10-01&#39;)</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Форматирование даты для SQLite</span></div>
<div class="line">$this-&gt;<a class="code hl_function" href="#ad7c3527d920ebf2dbcbc0c51845835d6">_format_date_internal</a>(<span class="stringliteral">&#39;created_at&#39;</span>, <span class="stringliteral">&#39;%Y-%m-%d&#39;</span>);</div>
<div class="line"><span class="comment">// Результат: strftime(&#39;%Y-%m-%d&#39;, created_at)</span></div>
<div class="ttc" id="aclassPhotoRigma_1_1Classes_1_1Database_html_ad7c3527d920ebf2dbcbc0c51845835d6"><div class="ttname"><a href="#ad7c3527d920ebf2dbcbc0c51845835d6">PhotoRigma\Classes\Database\_format_date_internal</a></div><div class="ttdeci">_format_date_internal(string $column, string $format)</div><div class="ttdoc">Формирует SQL-выражение для форматирования даты с учетом специфики используемой СУБД.</div><div class="ttdef"><b>Определения</b> <a href="../../d2/d89/Database_8php_source.html#l02248">Database.php:2248</a></div></div>
</div><!-- fragment --> <dl class="section see"><dt>См. также</dt><dd><a class="el" href="#a072c45961a79433ff94013278707ade5" title="Тип базы данных (mysql, pgsql, sqlite)">PhotoRigma\Classes\Database\$db_type</a> Тип используемой СУБД. </dd>
<dd>
<a class="el" href="#a8c3cf443d91cde7347577cddf302a9d0" title="Хранит текущий формат SQL (например, &#39;mysql&#39;, &#39;pgsql&#39;, &#39;sqlite&#39;).">PhotoRigma\Classes\Database\$current_format</a> Текущий формат SQL. </dd>
<dd>
<a class="el" href="#afed869cd253ba3b433a21e07703bf95d" title="Список поддерживаемых форматов SQL.">PhotoRigma\Classes\Database\$allowed_formats</a> Список допустимых форматов SQL. </dd>
<dd>
<a class="el" href="#a5f4312bd1da12e43a8f9a046ed068ebd" title="Производит преобразование строки формата даты/времени в формат, совместимый с MySQL (DATE_FORMAT).">PhotoRigma\Classes\Database\_convert_to_mysql_format()</a> Преобразовывает формат даты в стиль MySQL. </dd>
<dd>
<a class="el" href="#ae74eea110900ed128b205a3d0c91687b" title="Преобразует формат даты/времени в формат, совместимый с PostgreSQL.">PhotoRigma\Classes\Database\_convert_to_postgres_format()</a> Преобразовывает формат даты в стиль PostgreSQL. </dd>
<dd>
<a class="el" href="#a80464f4180268442d13e5e319274a30a" title="Преобразует формат даты/времени в формат, совместимый с SQLite (strftime).">PhotoRigma\Classes\Database\_convert_to_sqlite_format()</a> Преобразовывает формат даты в стиль SQLite. </dd>
<dd>
<a class="el" href="#afc2bc46cdbae22b8f2ebec12797fed6d" title="Метод временно изменяет формат SQL для выполнения запросов в указанном контексте.">PhotoRigma\Classes\Database\_with_sql_format_internal()</a> Временно изменяет формат SQL для выполнения запросов. </dd>
<dd>
<a class="el" href="#ac0e58b1bf2a72bbbaa896b9849ed0e42" title="Формирует SQL-выражение для форматирования даты с учетом специфики используемой СУБД.">PhotoRigma\Classes\Database\format_date()</a> Публичный метод-редирект для вызова этой логики. </dd></dl>

<p class="definition">См. определение в файле <a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a> строка <a class="el" href="../../d2/d89/Database_8php_source.html#l02248">2248</a></p>

<p class="reference">Перекрестные ссылки <a class="el" href="../../d2/d89/Database_8php_source.html#l02337">_convert_to_mysql_format()</a>, <a class="el" href="../../d2/d89/Database_8php_source.html#l02453">_convert_to_postgres_format()</a> и <a class="el" href="../../d2/d89/Database_8php_source.html#l02572">_convert_to_sqlite_format()</a>.</p>

<p class="reference">Используется в <a class="el" href="../../d2/d89/Database_8php_source.html#l02173">format_date()</a>.</p>
<div id="dynsection-25" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-25-trigger" src="../../closed.png" alt="+"/> Граф вызовов:</div>
<div id="dynsection-25-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-25-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_ad7c3527d920ebf2dbcbc0c51845835d6_cgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_ad7c3527d920ebf2dbcbc0c51845835d6_cgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_ad7c3527d920ebf2dbcbc0c51845835d6_cgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_ad7c3527d920ebf2dbcbc0c51845835d6_cgraph">
<area shape="rect" title="Формирует SQL&#45;выражение для форматирования даты с учетом специфики используемой СУБД." alt="" coords="5,61,152,86"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a5f4312bd1da12e43a8f9a046ed068ebd" title="Производит преобразование строки формата даты/времени в формат, совместимый с MySQL (DATE_FORMAT)." alt="" coords="200,5,374,30"/>
<area shape="poly" title=" " alt="" coords="127,58,223,32,224,37,128,63"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#ae74eea110900ed128b205a3d0c91687b" title="Преобразует формат даты/времени в формат, совместимый с PostgreSQL." alt="" coords="214,54,360,93"/>
<area shape="poly" title=" " alt="" coords="152,71,198,71,198,76,152,76"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a80464f4180268442d13e5e319274a30a" title="Преобразует формат даты/времени в формат, совместимый с SQLite (strftime)." alt="" coords="223,117,350,156"/>
<area shape="poly" title=" " alt="" coords="123,84,209,110,207,115,122,89"/>
</map>
</div>
<div id="dynsection-26" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-26-trigger" src="../../closed.png" alt="+"/> Граф вызова функции:</div>
<div id="dynsection-26-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-26-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_ad7c3527d920ebf2dbcbc0c51845835d6_icgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_ad7c3527d920ebf2dbcbc0c51845835d6_icgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_ad7c3527d920ebf2dbcbc0c51845835d6_icgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_ad7c3527d920ebf2dbcbc0c51845835d6_icgraph">
<area shape="rect" title="Формирует SQL&#45;выражение для форматирования даты с учетом специфики используемой СУБД." alt="" coords="144,5,290,30"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#ac0e58b1bf2a72bbbaa896b9849ed0e42" title="Формирует SQL&#45;выражение для форматирования даты с учетом специфики используемой СУБД." alt="" coords="5,5,96,30"/>
<area shape="poly" title=" " alt="" coords="128,20,96,20,96,15,128,15"/>
</map>
</div>

</div>
</div>
<a id="a6d6c48e4cc7e3d7353b4bda787ac9f43" name="a6d6c48e4cc7e3d7353b4bda787ac9f43"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6d6c48e4cc7e3d7353b4bda787ac9f43">&#9670;&#160;</a></span>_fts_check_options()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">_fts_check_options </td>
          <td>(</td>
          <td class="paramtype">array</td>          <td class="paramname"><span class="paramname"><em>$options</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">array</td>          <td class="paramname"><span class="paramname"><em>$base_options</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel private">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Формирует финальный массив опций для запроса с учетом базовых FTS-опций и внешних условий/дополнений. </p>
<p>Этот приватный метод объединяет массив внешних опций (<code>$options</code>) с базовыми опциями полнотекстового поиска (FTS) (<code>$base_options</code>), обрабатывая конфликты плейсхолдеров и применяя правила приоритета для формирования результирующего набора опций запроса. Метод выполняет следующие действия:</p><ol type="1">
<li>Выполняет тримминг всех строковых значений во внешних (<code>$options</code>) и базовых (<code>$base_options</code>) массивах опций.</li>
<li>Обрабатывает конфликты именованных плейсхолдеров между &lsquo;$options['params&rsquo;]<code>и </code>$base_options['params']<code>. При обнаружении совпадающих ключей плейсхолдеров, плейсхолдеры во внешних опциях (</code>$options<code>) переименовываются путем добавления суффикса</code>_ext_[n]<code>(где</code>[n]<code>- инкрементирующийся счетчик). Соответствующие ключи в массиве</code>$options['params']<code>обновляются, и старые ключи удаляются.</code></li>
<li><code>Обновляет использование переименованных плейсхолдеров в условиях</code>WHERE<code>внешних опций (</code>$options['where']<code>), если</code>where<code>является массивом.</code></li>
<li><code>Обрабатывает внешнее условие</code>WHERE<code>из</code>$options['where']<code>, вызывая приватный метод </code>_build_conditions()<code>для его преобразования в SQL-строку и получения соответствующих параметров. Начальный</code>WHERE<code>из строки условий, возвращенной</code>_build_conditions()<code>, удаляется. Если после обработки внешнее условие непустое, оно сохраняется для последующего объединения.</code></li>
<li><code>Формирует финальный массив опций (</code>$new_options<code>) на основе объединенных данных с учетом следующих правил приоритета:<ul>
<li>**WHERE:** Если присутствуют и базовое FTS-условие (</li>
</ul>
</code>$base_options['where']<code>) и обработанное внешнее условие (</code>$options['where']<code>), они объединяются с помощью</code>AND<code>(базовое условие идет первым). Если присутствует только одно из них, используется это условие.<ul>
<li>**ORDER BY:** Если присутствует сортировка в базовых FTS-опциях (</li>
</ul>
</code>$base_options['order']<code>), она имеет приоритет и используется. В противном случае, если присутствует сортировка во внешних опциях (</code>$options['order']<code>), используется она.<ul>
<li>**GROUP BY:** Используется только значение из внешних опций (</li>
</ul>
</code>$options['group']<code>), если оно задано и не равно</code>false<code>.<ul>
<li>**LIMIT:** Используется только значение из внешних опций (</li>
</ul>
</code>$options['limit']<code>), если оно задано и не равно</code>false<code>.<ul>
<li>**params:** Параметры из</li>
</ul>
</code>$options['params']<code>(уже с переименованными плейсхолдерами) и </code>$base_options['params']<code>объединяются с помощью</code>array_merge()<code>. Параметры из </code>$base_options['params']<code>имеют приоритет при совпадении ключей (что не должно происходить после обработки конфликтов, но</code>array_merge<code>работает так).</code></li>
<li><code>Возвращает финальный массив объединенных опций</code>$new_options`.</li>
</ol>
<dl class="params"><dt>Аргументы</dt><dd>
  <table class="params">
    <tr><td class="paramtype">array</td><td class="paramname">$options</td><td>Массив внешних опций запроса, предоставленных пользователем. Поддерживаемые ключи:<ul>
<li>where (string|array|false): Условие WHERE. Может быть:<ul>
<li>Строкой (используется как есть)</li>
<li>Массивом:<ul>
<li>Простые условия: &lsquo;['поле&rsquo; =&gt; значение]<code>(обрабатывается</code>_build_conditions<code>, генерируются плейсхолдеры)</code></li>
<li><code>Сложные условия:</code>['OR' =&gt; [условия], 'NOT' =&gt; [условия]]<code>(обрабатывается </code>_build_conditions<code>) -</code>false<code>: Игнорируется.</code></li>
</ul>
</li>
</ul>
</li>
<li><code>group (string|false): Группировка GROUP BY. Должна быть строкой. Игнорируется, если равно</code>false<code>.</code></li>
<li><code>order (string|false): Сортировка ORDER BY. Должна быть строкой. Игнорируется, если равно</code>false<code>.</code></li>
<li><code>limit (int|string|false): Ограничение LIMIT. Должно быть целым числом или строкой формата</code>'OFFSET, COUNT'<code>. Игнорируется, если равно</code>false<code>.</code></li>
<li><code>params (array): Исходный ассоциативный массив параметров для подготовленного выражения ([":имя" =&gt; значение]). @param array $base_options Массив базовых опций FTS (Full-Text Search), сгенерированных внутренней логикой FTS. Поддерживаемые ключи:</code></li>
<li><code>where (string): Строковое условие WHERE для полнотекстового поиска (например, </code>MATCH(...) AGAINST (...)`).</li>
<li>order (string): Строка сортировки по релевантности FTS.</li>
<li>params (array): Ассоциативный массив параметров для FTS-условий.</li>
</ul>
</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Возвращает</dt><dd>array Результирующий массив опций для запроса, содержащий объединенные и обработанные условия и параметры. Ключи могут включать:<ul>
<li>where (string|null): Объединенные условия WHERE, или <code>null</code> если условия отсутствуют.</li>
<li>order (string|null): Итоговая строка сортировки, или <code>null</code> если сортировка не задана.</li>
<li>group (string|null): Строка GROUP BY из внешних опций, или <code>null</code> если не задана.</li>
<li>limit (int|string|null): Значение LIMIT из внешних опций, или <code>null</code> если не задано.</li>
<li>params (array): Объединенный ассоциативный массив параметров, включая параметры FTS и параметры внешних условий (с разрешенными конфликтами именования).</li>
</ul>
</dd></dl>
<dl class="exception"><dt>Исключения</dt><dd>
  <table class="exception">
    <tr><td class="paramname">InvalidArgumentException</td><td>Может быть выброшено методом <code>_build_conditions()</code> при обработке &lsquo;$options['where&rsquo;]`, если его формат недопустим.</td></tr>
  </table>
  </dd>
</dl>
<p>Пример объединения опций с конфликтующими плейсхолдерами: </p><div class="fragment"><div class="line">$options = [</div>
<div class="line">    <span class="stringliteral">&#39;where&#39;</span> =&gt; [<span class="stringliteral">&#39;status&#39;</span> =&gt; <span class="stringliteral">&#39;:search&#39;</span>], <span class="comment">// Внешнее условие с плейсхолдером &#39;:search&#39;</span></div>
<div class="line">    <span class="stringliteral">&#39;params&#39;</span> =&gt; [<span class="stringliteral">&#39;:search&#39;</span> =&gt; <span class="stringliteral">&#39;active&#39;</span>] <span class="comment">// Значение внешнего плейсхолдера</span></div>
<div class="line">];</div>
<div class="line">$base_options = [</div>
<div class="line">    <span class="stringliteral">&#39;where&#39;</span> =&gt; <span class="stringliteral">&#39;MATCH(title) AGAINST (:search)&#39;</span>, <span class="comment">// Базовое FTS условие с плейсхолдером &#39;:search&#39;</span></div>
<div class="line">    <span class="stringliteral">&#39;order&#39;</span> =&gt; <span class="stringliteral">&#39;rank DESC&#39;</span>,</div>
<div class="line">    <span class="stringliteral">&#39;params&#39;</span> =&gt; [<span class="stringliteral">&#39;:search&#39;</span> =&gt; <span class="stringliteral">&#39;term&#39;</span>] <span class="comment">// Значение базового FTS плейсхолдера</span></div>
<div class="line">];</div>
<div class="line"> </div>
<div class="line">$final_options = $this-&gt;<a class="code hl_function" href="#a6d6c48e4cc7e3d7353b4bda787ac9f43">_fts_check_options</a>($options, $base_options);</div>
<div class="line"><span class="comment">// Результат $final_options:</span></div>
<div class="line"><span class="comment">// [</span></div>
<div class="line"><span class="comment">//    &#39;where&#39; =&gt; &quot;MATCH(title) AGAINST (:search) AND (status = :search_ext_0)&quot;, // Объединенное WHERE, плейсхолдер во внешнем условии переименован</span></div>
<div class="line"><span class="comment">//    &#39;order&#39; =&gt; &quot;rank DESC&quot;, // Сортировка FTS имеет приоритет</span></div>
<div class="line"><span class="comment">//    &#39;group&#39; =&gt; null, // Не было в $options</span></div>
<div class="line"><span class="comment">//    &#39;limit&#39; =&gt; null, // Не было в $options</span></div>
<div class="line"><span class="comment">//    &#39;params&#39; =&gt; [&#39;:search&#39; =&gt; &#39;term&#39;, &#39;:search_ext_0&#39; =&gt; &#39;active&#39;] // Объединенные параметры, где :search имеет значение из $base_options</span></div>
<div class="line"><span class="comment">// ]</span></div>
<div class="ttc" id="aclassPhotoRigma_1_1Classes_1_1Database_html_a6d6c48e4cc7e3d7353b4bda787ac9f43"><div class="ttname"><a href="#a6d6c48e4cc7e3d7353b4bda787ac9f43">PhotoRigma\Classes\Database\_fts_check_options</a></div><div class="ttdeci">_fts_check_options(array $options, array $base_options)</div><div class="ttdoc">Формирует финальный массив опций для запроса с учетом базовых FTS-опций и внешних условий/дополнений.</div><div class="ttdef"><b>Определения</b> <a href="../../d2/d89/Database_8php_source.html#l06081">Database.php:6081</a></div></div>
</div><!-- fragment --> <dl class="section see"><dt>См. также</dt><dd><a class="el" href="#a852d15f131983e6f53045146bede2958" title="Формирует строку дополнений для SQL-запроса (например, WHERE, GROUP BY, ORDER BY, LIMIT).">PhotoRigma\Classes\Database\_build_conditions()</a> Приватный метод, используемый для обработки внешней части условия WHERE. </dd></dl>

<p class="definition">См. определение в файле <a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a> строка <a class="el" href="../../d2/d89/Database_8php_source.html#l06081">6081</a></p>

<p class="reference">Перекрестные ссылки <a class="el" href="../../d2/d89/Database_8php_source.html#l01104">_build_conditions()</a> и <a class="el" href="../../d2/d89/Database_8php_source.html#l06081">_fts_check_options()</a>.</p>

<p class="reference">Используется в <a class="el" href="../../d2/d89/Database_8php_source.html#l06081">_fts_check_options()</a>.</p>
<div id="dynsection-27" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-27-trigger" src="../../closed.png" alt="+"/> Граф вызовов:</div>
<div id="dynsection-27-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-27-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_a6d6c48e4cc7e3d7353b4bda787ac9f43_cgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a6d6c48e4cc7e3d7353b4bda787ac9f43_cgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a6d6c48e4cc7e3d7353b4bda787ac9f43_cgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a6d6c48e4cc7e3d7353b4bda787ac9f43_cgraph">
<area shape="rect" title="Формирует финальный массив опций для запроса с учетом базовых FTS&#45;опций и внешних условий/дополнений." alt="" coords="5,29,140,54"/>
<area shape="poly" title=" " alt="" coords="43,30,37,21,40,11,52,5,73,3,94,5,106,12,103,17,93,10,72,8,54,10,44,15,42,20,48,28"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a852d15f131983e6f53045146bede2958" title="Формирует строку дополнений для SQL&#45;запроса (например, WHERE, GROUP BY, ORDER BY, LIMIT)." alt="" coords="188,29,309,54"/>
<area shape="poly" title=" " alt="" coords="140,39,172,39,172,44,140,44"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a24acdb048ce17d880bd12b0f74567352" title="Формирует группу условий для WHERE с указанным оператором (OR/NOT)." alt="" coords="357,29,493,54"/>
<area shape="poly" title=" " alt="" coords="310,39,342,39,342,44,310,44"/>
</map>
</div>
<div id="dynsection-28" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-28-trigger" src="../../closed.png" alt="+"/> Граф вызова функции:</div>
<div id="dynsection-28-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-28-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_a6d6c48e4cc7e3d7353b4bda787ac9f43_icgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a6d6c48e4cc7e3d7353b4bda787ac9f43_icgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a6d6c48e4cc7e3d7353b4bda787ac9f43_icgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a6d6c48e4cc7e3d7353b4bda787ac9f43_icgraph">
<area shape="rect" title="Формирует финальный массив опций для запроса с учетом базовых FTS&#45;опций и внешних условий/дополнений." alt="" coords="5,29,140,54"/>
<area shape="poly" title=" " alt="" coords="95,16,87,10,72,8,59,10,52,14,50,20,54,28,49,30,45,21,47,11,57,5,73,3,89,5,98,12"/>
</map>
</div>

</div>
</div>
<a id="a1a9c9d8aa5d7a039660197843f626268" name="a1a9c9d8aa5d7a039660197843f626268"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1a9c9d8aa5d7a039660197843f626268">&#9670;&#160;</a></span>_full_text_search_internal()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">_full_text_search_internal </td>
          <td>(</td>
          <td class="paramtype">array</td>          <td class="paramname"><span class="paramname"><em>$columns_to_return</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">array</td>          <td class="paramname"><span class="paramname"><em>$columns_to_search</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>$search_string</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>$table</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">array</td>          <td class="paramname"><span class="paramname"><em>$options</em></span><span class="paramdefsep"> = </span><span class="paramdefval">[]</span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel protected">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Выполняет полнотекстовый поиск в указанной таблице по заданным столбцам. </p>
<p>Этот защищённый метод является основной логикой для выполнения полнотекстового поиска и предназначен для использования внутри класса или его наследников. Он выполняет следующие шаги:</p><ol type="1">
<li>Валидация входных аргументов (<code>$columns_to_return</code>, <code>$columns_to_search</code>, <code>$table</code>, <code>$search_string</code>). Проверяется их заполненность и тип.</li>
<li>Обработка специального символа <code>*</code> в <code>$search_string</code>: если строка поиска равна <code>*</code>, выполняется обычный запрос на выборку всех записей из таблицы с помощью внутреннего метода <code>_select_internal()</code>, применяя при этом фильтрацию опций через <code>_fts_check_options()</code>, и возвращается результат через <code>_result_array_internal()</code>.</li>
<li>Получение текущей версии базы данных из таблицы <code>db_version</code> с использованием <code>_select_internal()</code> и <code>_result_row_internal()</code>. Это необходимо для выбора корректного метода полнотекстового поиска в зависимости от версии СУБД.</li>
<li>Снятие экранирования идентификаторов (имен столбцов и таблицы) с использованием метода <code>_unescape_identifiers()</code> для обеспечения корректности SQL-запроса.</li>
<li>Выбор и вызов специфического метода полнотекстового поиска в зависимости от типа используемой СУБД (<code>$this-&gt;db_type</code>). Используется конструкция <code>match</code>.</li>
<li>Передача всех необходимых параметров в выбранный специфический метод поиска.</li>
</ol>
<p>Метод зависит от наличия и доступности таблицы <code>db_version</code> и внутренних методов для работы с БД и кешем.</p>
<dl class="params"><dt>Аргументы</dt><dd>
  <table class="params">
    <tr><td class="paramtype">array</td><td class="paramname">$columns_to_return</td><td>Массив строк с именами столбцов, данные из которых необходимо включить в результат запроса. Ограничения: массив не может быть пустым. </td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$columns_to_search</td><td>Массив строк с именами столбцов, по которым должен выполняться полнотекстовый поиск. Ограничения: массив не может быть пустым. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$search_string</td><td>Строка для полнотекстового поиска.<ul>
<li>Может содержать <code>*</code> для выбора всех записей из таблицы (аналогично обычному SELECT). Ограничения: строка не может быть пустой (если не <code>*</code>). </li>
</ul>
</td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$table</td><td>Строка с именем таблицы, в которой выполняется полнотекстовый поиск. Ограничения: строка не может быть пустой и должна содержать допустимое имя таблицы. </td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$options</td><td>Массив дополнительных опций для формирования запроса. Поддерживаемые ключи:<ul>
<li>where (string|array|false): Условие WHERE.<ul>
<li>string - используется как есть.</li>
<li>array - преобразуется в SQL. Поддерживает простые условия (&lsquo;['поле&rsquo; =&gt; значение]<code>) и логические операторы (</code>'OR' =&gt; [...]<code>, </code>'NOT' =&gt; [...]<code>).</code></li>
<li><code>false - игнорируется.</code></li>
</ul>
</li>
<li><code>group (string|false): Группировка GROUP BY. Игнорируется, если false. Должна быть строкой.</code></li>
<li><code>order (string|false): Сортировка ORDER BY. Игнорируется, если false. Должна быть строкой.</code></li>
<li><code>limit (int|string|false): Ограничение LIMIT.<ul>
<li>int - прямое значение.</li>
<li>string - формат "OFFSET,COUNT".</li>
<li>false - игнорируется.</li>
</ul>
</code></li>
<li><code>params (array): Ассоциативный массив параметров ([":имя" =&gt; значение]). Обязателен для использования с условиями</code>where` и другими частями запроса, требующими подготовленных выражений. Обеспечивает защиту от SQL-инъекций. Может быть пустым массивом, если параметры не требуются.</li>
</ul>
</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Возвращает</dt><dd>array|false Возвращает результат выполнения запроса в виде ассоциативного массива строк или false, если результат пустой или произошла ошибка.</dd></dl>
<dl class="exception"><dt>Исключения</dt><dd>
  <table class="exception">
    <tr><td class="paramname">InvalidArgumentException</td><td>Выбрасывается, если:<ul>
<li>Один из обязательных аргументов (<code>$columns_to_return</code>, <code>$columns_to_search</code>, <code>$table</code>) пуст. Пример сообщения: "Недопустимые аргументы | Подробности: ..."</li>
<li><code>$search_string</code> является пустой строкой (кроме символа <code>*</code>). Пример сообщения: "Пустая строка поиска"</li>
<li>Тип используемой СУБД (<code>$this-&gt;db_type</code>) не поддерживается для полнотекстового поиска. Пример сообщения: "Неизвестный тип СУБД | Тип: mysql" </li>
</ul>
</td></tr>
    <tr><td class="paramname">RuntimeException</td><td>Выбрасывается, если не удалось получить корректную версию из таблицы <code>db_version</code>. Пример сообщения: "Не удалось получить корректную версию из таблицы db_version" </td></tr>
    <tr><td class="paramname">JsonException</td><td>Выбрасывается при ошибках, связанных с кодированием/декодированием JSON, например, при логировании конфигурации в сообщении об ошибке. </td></tr>
    <tr><td class="paramname">Exception</td><td>Выбрасывается при возникновении общих ошибок выполнения запроса на более низких уровнях.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section warning"><dt>Предупреждения</dt><dd>Убедитесь, что массивы <code>$columns_to_return</code> и <code>$columns_to_search</code> не пусты. Проверьте, что <code>$table</code> содержит корректное и непустое имя таблицы. Строка поиска <code>$search_string</code> не может быть пустой (за исключением <code>*</code>). Использование параметров <code>params</code> в <code>$options</code> обязательно для значений, подставляемых в запросы (например, в условии <code>where</code>), для предотвращения SQL-инъекций. Метод зависит от наличия таблицы <code>db_version</code> и корректного типа СУБД.</dd></dl>
<p>Пример использования метода _full_text_search_internal(): </p><div class="fragment"><div class="line"><span class="comment">// Пример выполнения полнотекстового поиска</span></div>
<div class="line">$results = $this-&gt;<a class="code hl_function" href="#a1a9c9d8aa5d7a039660197843f626268">_full_text_search_internal</a>(</div>
<div class="line">    [<span class="stringliteral">&#39;id&#39;</span>, <span class="stringliteral">&#39;title&#39;</span>, <span class="stringliteral">&#39;content&#39;</span>],</div>
<div class="line">    [<span class="stringliteral">&#39;title&#39;</span>, <span class="stringliteral">&#39;content&#39;</span>],</div>
<div class="line">    <span class="stringliteral">&#39;искомая фраза&#39;</span>,</div>
<div class="line">    <span class="stringliteral">&#39;articles&#39;</span>,</div>
<div class="line">    [</div>
<div class="line">        <span class="stringliteral">&#39;where&#39;</span> =&gt; [<span class="stringliteral">&#39;status&#39;</span> =&gt; <span class="stringliteral">&#39;published&#39;</span>],</div>
<div class="line">        <span class="stringliteral">&#39;limit&#39;</span> =&gt; 10,</div>
<div class="line">        <span class="stringliteral">&#39;params&#39;</span> =&gt; [<span class="stringliteral">&#39;:status&#39;</span> =&gt; <span class="stringliteral">&#39;published&#39;</span>]</div>
<div class="line">    ]</div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> ($results !== <span class="keyword">false</span>) {</div>
<div class="line">    print_r($results);</div>
<div class="line">} <span class="keywordflow">else</span> {</div>
<div class="line">    echo <span class="stringliteral">&quot;Поиск не дал результатов или произошла ошибка.&quot;</span>;</div>
<div class="line">}</div>
<div class="ttc" id="aclassPhotoRigma_1_1Classes_1_1Database_html_a1a9c9d8aa5d7a039660197843f626268"><div class="ttname"><a href="#a1a9c9d8aa5d7a039660197843f626268">PhotoRigma\Classes\Database\_full_text_search_internal</a></div><div class="ttdeci">_full_text_search_internal(array $columns_to_return, array $columns_to_search, string $search_string, string $table, array $options=[])</div><div class="ttdoc">Выполняет полнотекстовый поиск в указанной таблице по заданным столбцам.</div><div class="ttdef"><b>Определения</b> <a href="../../d2/d89/Database_8php_source.html#l04615">Database.php:4615</a></div></div>
</div><!-- fragment --> <dl class="section see"><dt>См. также</dt><dd><a class="el" href="#a3e40bb61553455b6f52be0ab9a6062b1" title="Формирует SQL-запрос на выборку данных из таблицы, основываясь на полученных аргументах,...">PhotoRigma\Classes\Database\_select_internal()</a> Используется для выборки всех записей при &lsquo;$search_string = &rsquo;*'<code>и для получения версии БД. @see <a class="el" href="#a31eb9243149eec0d8676bbcf7289538d" title="Извлекает все строки результата из подготовленного выражения, хранящегося в свойстве $res_query,...">PhotoRigma\Classes\Database\_result_array_internal()</a> Используется для получения результата в виде массива при</code>$search_string = '*'<code>. @see <a class="el" href="#aac250b0e3e45a11bc29ad82a9feb64ec" title="Извлекает одну строку результата из подготовленного выражения, хранящегося в свойстве $res_query.">PhotoRigma\Classes\Database\_result_row_internal()</a> Используется для получения одной строки результата (версии БД). @see <a class="el" href="#a6d6c48e4cc7e3d7353b4bda787ac9f43" title="Формирует финальный массив опций для запроса с учетом базовых FTS-опций и внешних условий/дополнений.">PhotoRigma\Classes\Database\_fts_check_options()</a> Используется для фильтрации опций при</code>$search_string = '*'`. </dd>
<dd>
<a class="el" href="#a7bee8df3a568f0f7563281575031fec7" title="Снятие экранирования идентификаторов (например, имён таблиц или столбцов).">PhotoRigma\Classes\Database\_unescape_identifiers()</a> Используется для снятия экранирования имен столбцов и таблицы. </dd>
<dd>
<a class="el" href="#a56dafcbeab9a8a4a7304278eeb2edabe" title="Выполняет полнотекстовый поиск в MySQL с обработкой минимальной длины строки, кешированием ошибок и f...">PhotoRigma\Classes\Database\_full_text_search_mysql()</a> Специфический метод для полнотекстового поиска в MySQL. </dd>
<dd>
<a class="el" href="#af1edfadea1168e39f99fb44c9899968c" title="Выполняет полнотекстовый поиск в PostgreSQL с обработкой минимальной длины строки,...">PhotoRigma\Classes\Database\_full_text_search_pgsql()</a> Специфический метод для полнотекстового поиска в PostgreSQL. </dd>
<dd>
<a class="el" href="#a54df4031bb92109e8e164b9313163121" title="Выполняет полнотекстовый поиск в SQLite через FTS5.">PhotoRigma\Classes\Database\_full_text_search_sqlite()</a> Специфический метод для полнотекстового поиска в SQLite. </dd>
<dd>
<a class="el" href="#a072c45961a79433ff94013278707ade5" title="Тип базы данных (mysql, pgsql, sqlite)">PhotoRigma\Classes\Database\$db_type</a> Свойство, хранящее тип текущей СУБД. </dd>
<dd>
<a class="el" href="#a9377cc9a0272aa329e548cc608936bb5" title="Выполняет полнотекстовый поиск в указанной таблице.">PhotoRigma\Classes\Database\full_text_search()</a> Публичный метод-обертка, использующий этот внутренний метод. </dd></dl>

<p class="definition">См. определение в файле <a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a> строка <a class="el" href="../../d2/d89/Database_8php_source.html#l04615">4615</a></p>

<p class="reference">Перекрестные ссылки <a class="el" href="../../d2/d89/Database_8php_source.html#l04615">_full_text_search_internal()</a>.</p>

<p class="reference">Используется в <a class="el" href="../../d2/d89/Database_8php_source.html#l04615">_full_text_search_internal()</a> и <a class="el" href="../../d2/d89/Database_8php_source.html#l04470">full_text_search()</a>.</p>
<div id="dynsection-29" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-29-trigger" src="../../closed.png" alt="+"/> Граф вызовов:</div>
<div id="dynsection-29-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-29-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_a1a9c9d8aa5d7a039660197843f626268_cgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a1a9c9d8aa5d7a039660197843f626268_cgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a1a9c9d8aa5d7a039660197843f626268_cgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a1a9c9d8aa5d7a039660197843f626268_cgraph">
<area shape="rect" title="Выполняет полнотекстовый поиск в указанной таблице по заданным столбцам." alt="" coords="5,29,174,54"/>
<area shape="poly" title=" " alt="" coords="61,30,55,21,59,11,70,5,90,3,111,5,121,12,118,17,109,10,89,8,72,10,63,15,61,20,66,28"/>
</map>
</div>
<div id="dynsection-30" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-30-trigger" src="../../closed.png" alt="+"/> Граф вызова функции:</div>
<div id="dynsection-30-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-30-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_a1a9c9d8aa5d7a039660197843f626268_icgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a1a9c9d8aa5d7a039660197843f626268_icgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a1a9c9d8aa5d7a039660197843f626268_icgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a1a9c9d8aa5d7a039660197843f626268_icgraph">
<area shape="rect" title="Выполняет полнотекстовый поиск в указанной таблице по заданным столбцам." alt="" coords="166,29,334,54"/>
<area shape="poly" title=" " alt="" coords="282,17,272,10,250,8,230,10,219,15,217,20,223,27,219,31,212,21,216,11,228,5,250,3,273,5,285,12"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a9377cc9a0272aa329e548cc608936bb5" title="Выполняет полнотекстовый поиск в указанной таблице." alt="" coords="5,29,118,54"/>
<area shape="poly" title=" " alt="" coords="150,44,118,44,118,39,150,39"/>
</map>
</div>

</div>
</div>
<a id="a56dafcbeab9a8a4a7304278eeb2edabe" name="a56dafcbeab9a8a4a7304278eeb2edabe"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a56dafcbeab9a8a4a7304278eeb2edabe">&#9670;&#160;</a></span>_full_text_search_mysql()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">_full_text_search_mysql </td>
          <td>(</td>
          <td class="paramtype">array</td>          <td class="paramname"><span class="paramname"><em>$columns_to_return</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">array</td>          <td class="paramname"><span class="paramname"><em>$columns_to_search</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>$search_string</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>$table</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>$db_version</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">array</td>          <td class="paramname"><span class="paramname"><em>$options</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel private">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Выполняет полнотекстовый поиск в MySQL с обработкой минимальной длины строки, кешированием ошибок и fallback на LIKE. </p>
<p>Этот приватный метод реализует логику полнотекстового поиска (Full-Text Search - FTS) для базы данных MySQL. Он обрабатывает минимальную длину строки поиска, использует кеширование для быстрого определения предыдущих ошибок выполнения FTS-запросов (например, из-за отсутствия FTS-индекса) и включает механизм автоматического перехода (fallback) на поиск с использованием оператора <code>LIKE</code> в случае необходимости. Метод выполняет следующие действия:</p><ol type="1">
<li>Экранирует имена столбцов для возврата (<code>$columns_to_return</code>), столбцов для поиска (<code>$columns_to_search</code>) и имя таблицы (<code>$table</code>) с использованием обратных кавычек (<code>`</code>) для соответствия синтаксису MySQL.</li>
<li>Проверяет, что длина строки поиска <code>$search_string</code> превышает минимально допустимое значение, определенное константой <code>MIN_FULLTEXT_SEARCH_LENGTH</code>. Если длина недостаточна, метод сразу же вызывает приватный метод <code>_fallback_to_like_mysql()</code> для выполнения поиска с использованием <code>LIKE</code> и возвращает его результат.</li>
<li>Формирует уникальный ключ кеша на основе имени таблицы и столбцов для поиска для идентификации FTS-индекса в кеше.</li>
<li>Проверяет кеш (<code>$this-&gt;cache</code>) на наличие записи, связанной с этим FTS-индексом, используя <code>$db_version</code> как параметр валидности кеша. Если в кеше найдена запись с флагом <code>query_error = true</code>, это означает, что предыдущая попытка выполнить FTS-запрос для этого индекса завершилась ошибкой. В этом случае метод также вызывает <code>_fallback_to_like_mysql()</code> и возвращает его результат.</li>
<li>Предпринимает попытку выполнить полнотекстовый поиск в блоке <code>try...catch</code>:<ul>
<li>Формирует базовые опции FTS (<code>$base_options</code>), включающие условие <code>WHERE MATCH(...) AGAINST(...) IN NATURAL LANGUAGE MODE</code> и сортировку <code>ORDER BY MATCH(...) AGAINST(...) DESC</code>, используя переданную строку поиска <code>$search_string</code> как параметр.</li>
<li>Объединяет переданные внешние опции запроса (<code>$options</code>) с базовыми FTS-опциями (<code>$base_options</code>) с помощью приватного метода <code>_fts_check_options()</code>. Этот метод разрешает конфликты плейсхолдеров и определяет приоритеты для WHERE, ORDER BY, GROUP BY, LIMIT и PARAMS.</li>
<li>Вызывает приватный метод <code>_select_internal()</code> с экранированными столбцами, экранированным именем таблицы и объединенными опциями для выполнения SQL-запроса.</li>
</ul>
</li>
<li>В случае успешного выполнения FTS-запроса (блок <code>try</code> без исключений):<ul>
<li>Обновляет кеш (<code>$this-&gt;cache</code>), устанавливая флаг <code>query_error = false</code> для данного FTS-индекса, указывая на успешность последнего запроса.</li>
<li>Получает результат запроса в виде массива с помощью приватного метода <code>_result_array_internal()</code> и возвращает его.</li>
</ul>
</li>
<li>В случае возникновения исключения (<code>Throwable</code>) во время выполнения FTS-запроса (блок <code>catch</code>):<ul>
<li>Логирует информацию об ошибке с помощью функции <code>log_in_file()</code>, включая сообщение об ошибке.</li>
<li>Обновляет кеш (<code>$this-&gt;cache</code>), устанавливая флаг <code>query_error = true</code> для данного FTS-индекса, чтобы избежать повторных ошибок в будущем.</li>
<li>Вызывает приватный метод <code>_fallback_to_like_mysql()</code> для выполнения поиска с использованием <code>LIKE</code> и возвращает его результат.</li>
</ul>
</li>
</ol>
<p>Этот метод является приватным и предназначен только для использования внутри класса <code>Database</code>. Он вызывается из публичных или защищенных методов поиска, когда определен тип базы данных MySQL.</p>
<dl class="params"><dt>Аргументы</dt><dd>
  <table class="params">
    <tr><td class="paramtype">array</td><td class="paramname">$columns_to_return</td><td>Массив строк с именами столбцов, которые нужно вернуть в результате поиска. </td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$columns_to_search</td><td>Массив строк с именами столбцов, по которым выполняется полнотекстовый поиск. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$search_string</td><td>Строка поиска, введенная пользователем (должна быть без спецсимволов LIKE, но может содержать операторы FTS, если включен соответствующий режим). Проверяется на минимальную длину. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$table</td><td>Строка с именем таблицы, в которой выполняется поиск. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$db_version</td><td>Строка, представляющая версию структуры базы данных (например, из специальной таблицы), используется для валидации кеша. </td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$options</td><td>Массив дополнительных опций для формирования запроса. Используется для добавления условий WHERE, GROUP BY, ORDER BY, LIMIT и параметров к FTS-запросу. Поддерживаемые ключи:<ul>
<li>where (string|array|false): Дополнительное условие WHERE.</li>
<li>group (string|false): Группировка GROUP BY.</li>
<li>order (string|false): Дополнительная сортировка ORDER BY (имеет более низкий приоритет, чем сортировка FTS).</li>
<li>limit (int|string|false): Ограничение LIMIT.</li>
<li>params (array): Ассоциативный массив дополнительных параметров для подготовленного выражения.</li>
</ul>
</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Возвращает</dt><dd>array|false Результат выполнения поиска в виде массива ассоциативных массивов (строк) при успехе и наличии результатов, пустой массив при успехе, но отсутствии результатов, или <code>false</code> в случае критической ошибки (хотя большинство ошибок обрабатывается через исключения или fallback).</dd></dl>
<dl class="exception"><dt>Исключения</dt><dd>
  <table class="exception">
    <tr><td class="paramname">JsonException</td><td>Может быть выброшено методами кеширования (<code>$this-&gt;cache-&gt;is_valid</code>, <code>$this-&gt;cache-&gt;update_cache</code>) при ошибках сериализации/десериализации данных кеша. </td></tr>
    <tr><td class="paramname">Exception</td><td>Может быть выброшено функцией логирования <code>log_in_file()</code> в случае невозможности записи в файл. </td></tr>
    <tr><td class="paramname">PDOException</td><td>Может быть выброшено методами <code>_fts_check_options()</code> (через вызов <code>_build_conditions()</code>) или <code>_select_internal()</code> в случае ошибок, связанных с базой данных или некорректным SQL, если они не перехватываются в блоке <code>try...catch</code> или выбрасываются после него. (Большинство таких ошибок внутри FTS перехватываются и приводят к fallback). </td></tr>
    <tr><td class="paramname">InvalidArgumentException</td><td>Может быть выброшено методом <code>_fts_check_options()</code> (через вызов <code>_build_conditions()</code>) при некорректном формате опций. (Большинство таких ошибок внутри FTS перехватываются и приводят к fallback).</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Заметки</dt><dd>Метод использует константу <code>MIN_FULLTEXT_SEARCH_LENGTH</code> для проверки минимальной длины строки поиска. Активно используется кеширование (<code>$this-&gt;cache</code>, <code>$this-&gt;format_cache</code> неявно через <code>_select_internal</code>) для оптимизации и запоминания FTS-индексов, вызывающих ошибки. При возникновении ошибок выполнения FTS-запроса (например, отсутствие FTS-индекса), метод автоматически переключается на более медленный поиск с помощью оператора <code>LIKE</code>, вызывая <code>_fallback_to_like_mysql()</code>.</dd></dl>
<dl class="section warning"><dt>Предупреждения</dt><dd>Убедитесь, что в таблице, указанной в <code>$table</code>, существуют столбцы из <code>$columns_to_search</code>, и по ним создан действующий полнотекстовый индекс (<code>FULLTEXT</code>). Отсутствие индекса приведет к ошибке выполнения FTS-запроса и переключению на <code>LIKE</code>. Поиск с <code>LIKE</code> может быть значительно медленнее полнотекстового поиска на больших объемах данных.</dd></dl>
<p>Пример использования (вызывается внутри класса): </p><div class="fragment"><div class="line"><span class="comment">// Предположим, MIN_FULLTEXT_SEARCH_LENGTH = 4</span></div>
<div class="line"><span class="comment">// $this-&gt;current_format = &#39;mysql&#39;;</span></div>
<div class="line"><span class="comment">// $this-&gt;db_type = &#39;mysql&#39;;</span></div>
<div class="line"> </div>
<div class="line">$columns_to_return = [<span class="stringliteral">&#39;id&#39;</span>, <span class="stringliteral">&#39;title&#39;</span>, <span class="stringliteral">&#39;content&#39;</span>];</div>
<div class="line">$columns_to_search = [<span class="stringliteral">&#39;title&#39;</span>, <span class="stringliteral">&#39;content&#39;</span>];</div>
<div class="line">$search_string = <span class="stringliteral">&#39;database optimization&#39;</span>; <span class="comment">// Длина &gt;= 4</span></div>
<div class="line">$table = <span class="stringliteral">&#39;articles&#39;</span>;</div>
<div class="line">$db_version = <span class="stringliteral">&#39;1.0&#39;</span>; <span class="comment">// Пример версии структуры БД</span></div>
<div class="line">$options = [</div>
<div class="line">    <span class="stringliteral">&#39;where&#39;</span> =&gt; [<span class="stringliteral">&#39;is_published&#39;</span> =&gt; 1],</div>
<div class="line">    <span class="stringliteral">&#39;limit&#39;</span> =&gt; 10,</div>
<div class="line">    <span class="stringliteral">&#39;params&#39;</span> =&gt; [<span class="stringliteral">&#39;:is_published&#39;</span> =&gt; 1],</div>
<div class="line">];</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Вызов метода</span></div>
<div class="line">$results = $this-&gt;<a class="code hl_function" href="#a56dafcbeab9a8a4a7304278eeb2edabe">_full_text_search_mysql</a>(</div>
<div class="line">    $columns_to_return,</div>
<div class="line">    $columns_to_search,</div>
<div class="line">    $search_string,</div>
<div class="line">    $table,</div>
<div class="line">    $db_version,</div>
<div class="line">    $options</div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> ($results !== <span class="keyword">false</span>) {</div>
<div class="line">    <span class="comment">// Обработка результатов поиска</span></div>
<div class="line">    print_r($results);</div>
<div class="line">} <span class="keywordflow">else</span> {</div>
<div class="line">    <span class="comment">// Обработка критической ошибки (редко, т.к. есть fallback)</span></div>
<div class="line">    echo <span class="stringliteral">&quot;Произошла критическая ошибка поиска.&quot;</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Если strlen($search_string) &lt; 4, будет вызван _fallback_to_like_mysql</span></div>
<div class="line"><span class="comment">// Если FTS запрос упадет (нет индекса), будет вызван _fallback_to_like_mysql, ошибка будет залогирована и закэширована.</span></div>
<div class="ttc" id="aclassPhotoRigma_1_1Classes_1_1Database_html_a56dafcbeab9a8a4a7304278eeb2edabe"><div class="ttname"><a href="#a56dafcbeab9a8a4a7304278eeb2edabe">PhotoRigma\Classes\Database\_full_text_search_mysql</a></div><div class="ttdeci">_full_text_search_mysql(array $columns_to_return, array $columns_to_search, string $search_string, string $table, string $db_version, array $options)</div><div class="ttdoc">Выполняет полнотекстовый поиск в MySQL с обработкой минимальной длины строки, кешированием ошибок и f...</div><div class="ttdef"><b>Определения</b> <a href="../../d2/d89/Database_8php_source.html#l04860">Database.php:4860</a></div></div>
</div><!-- fragment --> <dl class="section see"><dt>См. также</dt><dd><a class="el" href="#a33d25ea74a693adb2d31b1a0667553b2" title="Выполняет альтернативный поиск по LIKE для MySQL.">PhotoRigma\Classes\Database\_fallback_to_like_mysql()</a> Приватный метод, реализующий поиск по LIKE в качестве fallback. </dd>
<dd>
<a class="el" href="#a6d6c48e4cc7e3d7353b4bda787ac9f43" title="Формирует финальный массив опций для запроса с учетом базовых FTS-опций и внешних условий/дополнений.">PhotoRigma\Classes\Database\_fts_check_options()</a> Приватный метод, объединяющий и обрабатывающий опции запроса для FTS. </dd>
<dd>
<a class="el" href="#a3e40bb61553455b6f52be0ab9a6062b1" title="Формирует SQL-запрос на выборку данных из таблицы, основываясь на полученных аргументах,...">PhotoRigma\Classes\Database\_select_internal()</a> Приватный метод для выполнения SELECT-запроса. </dd>
<dd>
<a class="el" href="#a31eb9243149eec0d8676bbcf7289538d" title="Извлекает все строки результата из подготовленного выражения, хранящегося в свойстве $res_query,...">PhotoRigma\Classes\Database\_result_array_internal()</a> Приватный метод для получения всех строк результата запроса. </dd>
<dd>
<a class="el" href="../../db/d02/namespacePhotoRigma_1_1Include.html#a2d74c46a21e4ce612a98eee60981aef0" title="Записывает сообщение об ошибке в лог-файл и, при необходимости, завершает выполнение скрипта.">PhotoRigma\Include\log_in_file()</a> Функция для логирования сообщений. </dd>
<dd>
<a class="el" href="../../d1/d44/interfacePhotoRigma_1_1Interfaces_1_1Cache__Handler__Interface.html" title="Интерфейс для работы с системами кеширования.">PhotoRigma\Interfaces\Cache_Handler_Interface</a> Интерфейс, используемый для работы с кешированием. </dd>
<dd>
<a class="el" href="#a252982d004053f182631167a8b39ce88" title="Объект для работы с кешем">PhotoRigma\Classes\Database\$cache</a> Свойство, хранящее объект, реализующий <code>Cache_Handler_Interface</code>. </dd>
<dd>
<a class="el" href="#a1dfaf650c7bfa81bd699450d5404c7fd" title="Кэш для преобразования форматов даты (MariaDB -&gt; PostgreSQL/SQLite)">PhotoRigma\Classes\Database\$format_cache</a> Внутреннее свойство, используемое для кэширования форматов (используется косвенно через _select_internal). </dd>
<dd>
<a class="el" href="#aa6ad7a9ae20f259f85508582d8f15068" title="Кэш для хранения результатов снятия экранирования идентификаторов">PhotoRigma\Classes\Database\$unescape_cache</a> Внутреннее свойство, используемое для кэширования снятия экранирования (используется косвенно через _select_internal). </dd>
<dd>
<a class="el" href="#a8c3cf443d91cde7347577cddf302a9d0" title="Хранит текущий формат SQL (например, &#39;mysql&#39;, &#39;pgsql&#39;, &#39;sqlite&#39;).">PhotoRigma\Classes\Database\$current_format</a> Свойство, хранящее текущий формат SQL. </dd>
<dd>
<a class="el" href="#a072c45961a79433ff94013278707ade5" title="Тип базы данных (mysql, pgsql, sqlite)">PhotoRigma\Classes\Database\$db_type</a> Свойство, хранящее тип текущей СУБД. </dd>
<dd>
MIN_FULLTEXT_SEARCH_LENGTH Константа, определяющая минимальную длину строки для полнотекстового поиска. </dd></dl>

<p class="definition">См. определение в файле <a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a> строка <a class="el" href="../../d2/d89/Database_8php_source.html#l04860">4860</a></p>

<p class="reference">Перекрестные ссылки <a class="el" href="../../d2/d89/Database_8php_source.html#l05072">_fallback_to_like_mysql()</a> и <a class="el" href="../../d2/d89/Database_8php_source.html#l04860">_full_text_search_mysql()</a>.</p>

<p class="reference">Используется в <a class="el" href="../../d2/d89/Database_8php_source.html#l04860">_full_text_search_mysql()</a>.</p>
<div id="dynsection-31" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-31-trigger" src="../../closed.png" alt="+"/> Граф вызовов:</div>
<div id="dynsection-31-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-31-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_a56dafcbeab9a8a4a7304278eeb2edabe_cgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a56dafcbeab9a8a4a7304278eeb2edabe_cgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a56dafcbeab9a8a4a7304278eeb2edabe_cgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a56dafcbeab9a8a4a7304278eeb2edabe_cgraph">
<area shape="rect" title="Выполняет полнотекстовый поиск в MySQL с обработкой минимальной длины строки, кешированием ошибок и f..." alt="" coords="5,29,166,54"/>
<area shape="poly" title=" " alt="" coords="51,31,44,21,48,11,62,5,86,3,111,5,124,12,122,17,110,10,85,8,63,10,52,15,49,20,56,27"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a33d25ea74a693adb2d31b1a0667553b2" title="Выполняет альтернативный поиск по LIKE для MySQL." alt="" coords="214,29,373,54"/>
<area shape="poly" title=" " alt="" coords="166,39,198,39,198,44,166,44"/>
<area shape="poly" title=" " alt="" coords="259,31,252,21,256,11,270,5,293,3,319,5,332,12,329,17,317,10,293,8,271,10,260,15,257,20,263,27"/>
</map>
</div>
<div id="dynsection-32" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-32-trigger" src="../../closed.png" alt="+"/> Граф вызова функции:</div>
<div id="dynsection-32-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-32-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_a56dafcbeab9a8a4a7304278eeb2edabe_icgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a56dafcbeab9a8a4a7304278eeb2edabe_icgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a56dafcbeab9a8a4a7304278eeb2edabe_icgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a56dafcbeab9a8a4a7304278eeb2edabe_icgraph">
<area shape="rect" title="Выполняет полнотекстовый поиск в MySQL с обработкой минимальной длины строки, кешированием ошибок и f..." alt="" coords="5,29,166,54"/>
<area shape="poly" title=" " alt="" coords="113,16,103,10,85,8,69,10,60,15,58,20,63,28,59,30,53,21,56,11,67,5,86,3,105,5,116,12"/>
</map>
</div>

</div>
</div>
<a id="af1edfadea1168e39f99fb44c9899968c" name="af1edfadea1168e39f99fb44c9899968c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af1edfadea1168e39f99fb44c9899968c">&#9670;&#160;</a></span>_full_text_search_pgsql()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">_full_text_search_pgsql </td>
          <td>(</td>
          <td class="paramtype">array</td>          <td class="paramname"><span class="paramname"><em>$columns_to_return</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">array</td>          <td class="paramname"><span class="paramname"><em>$columns_to_search</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>$search_string</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>$table</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>$db_version</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">array</td>          <td class="paramname"><span class="paramname"><em>$options</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel private">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Выполняет полнотекстовый поиск в PostgreSQL с обработкой минимальной длины строки, кешированием ошибок и fallback на ILIKE. </p>
<p>Этот приватный метод реализует логику полнотекстового поиска (Full-Text Search - FTS) для базы данных PostgreSQL. Он обрабатывает минимальную длину строки поиска, использует кеширование для быстрого определения предыдущих ошибок выполнения FTS-запросов и включает механизм автоматического перехода (fallback) на поиск с использованием оператора <code>ILIKE</code> (регистронезависимый LIKE) в случае необходимости. Метод выполняет следующие действия:</p><ol type="1">
<li>Экранирует имена столбцов для возврата (<code>$columns_to_return</code>), столбцов для поиска (<code>$columns_to_search</code>) и имя таблицы (<code>$table</code>) с использованием двойных кавычек (<code>"&lt;/tt&gt;) для
            соответствия синтаксису PostgreSQL.
         2. Проверяет, что длина строки поиска &lt;tt&gt;\$search_string&lt;/tt&gt; превышает минимально допустимое значение,
            определенное константой &lt;tt&gt;MIN_FULLTEXT_SEARCH_LENGTH&lt;/tt&gt;. Если длина недостаточна, метод сразу же
            вызывает приватный метод &lt;tt&gt;_fallback_to_ilike_pgsql()&lt;/tt&gt; для выполнения поиска с использованием
            &lt;tt&gt;ILIKE&lt;/tt&gt; и возвращает его результат.
         3. Формирует уникальный ключ кеша на основе имени таблицы и столбцов для поиска для идентификации
            FTS-индекса в кеше.
         4. Проверяет кеш (&lt;tt&gt;\$this-\&gt;cache&lt;/tt&gt;) на наличие записи, связанной с этим FTS-индексом, используя
            &lt;tt&gt;\$db_version&lt;/tt&gt; как параметр валидности кеша. Если в кеше найдена запись с флагом &lt;tt&gt;query_error = true&lt;/tt&gt;,
            это означает, что предыдущая попытка выполнить FTS-запрос для этого индекса завершилась ошибкой.
            В этом случае метод также вызывает &lt;tt&gt;_fallback_to_ilike_pgsql()&lt;/tt&gt; и возвращает его результат.
         5. Предпринимает попытку выполнить полнотекстовый поиск в блоке &lt;tt&gt;try...catch&lt;/tt&gt;:
            - Формирует базовые опции FTS (&lt;tt&gt;\$base_options&lt;/tt&gt;), включающие условие &lt;tt&gt;WHERE tsv_weighted \@\@
              plainto_tsquery(:search_string_where)&lt;/tt&gt; и сортировку &lt;tt&gt;ORDER BY ts_rank(tsv_weighted,
              plainto_tsquery(:search_string_order)) DESC&lt;/tt&gt;, используя переданную строку поиска
              &lt;tt&gt;\$search_string&lt;/tt&gt; как параметр. Предполагается наличие столбца &lt;tt&gt;tsv_weighted&lt;/tt&gt; типа &lt;tt&gt;TSVECTOR&lt;/tt&gt; в
              таблице, содержащего лексемы для поиска.
            - Объединяет переданные внешние опции запроса (&lt;tt&gt;\$options&lt;/tt&gt;) с базовыми FTS-опциями
              (&lt;tt&gt;\$base_options&lt;/tt&gt;) с помощью приватного метода &lt;tt&gt;_fts_check_options()&lt;/tt&gt;. Этот метод разрешает
              конфликты плейсхолдеров и определяет приоритеты для WHERE, ORDER BY, GROUP BY, LIMIT и PARAMS.
            - Вызывает приватный метод &lt;tt&gt;_select_internal()&lt;/tt&gt; с экранированными столбцами, экранированным именем
              таблицы и объединенными опциями для выполнения SQL-запроса.
         6. В случае успешного выполнения FTS-запроса (блок &lt;tt&gt;try&lt;/tt&gt; без исключений):
            - Обновляет кеш (&lt;tt&gt;\$this-\&gt;cache&lt;/tt&gt;), устанавливая флаг &lt;tt&gt;query_error = false&lt;/tt&gt; для данного FTS-индекса,
              указывая на успешность последнего запроса.
            - Получает результат запроса в виде массива с помощью приватного метода &lt;tt&gt;_result_array_internal()&lt;/tt&gt; и
              возвращает его.
         7. В случае возникновения исключения (&lt;tt&gt;Throwable&lt;/tt&gt;) во время выполнения FTS-запроса (блок &lt;tt&gt;catch&lt;/tt&gt;):
            - Логирует информацию об ошибке с помощью функции &lt;tt&gt;log_in_file()&lt;/tt&gt;, включая текст запроса и
              сообщение об ошибке.
            - Обновляет кеш (&lt;tt&gt;\$this-\&gt;cache&lt;/tt&gt;), устанавливая флаг &lt;tt&gt;query_error = true&lt;/tt&gt; для данного FTS-индекса,
              чтобы избежать повторных ошибок в будущем.
            - Вызывает приватный метод &lt;tt&gt;_fallback_to_ilike_pgsql()&lt;/tt&gt; для выполнения поиска с использованием
              &lt;tt&gt;ILIKE&lt;/tt&gt; и возвращает его результат.

         Этот метод является приватным и предназначен только для использования внутри класса &lt;tt&gt;Database&lt;/tt&gt;.
         Он вызывается из публичных или защищенных методов поиска, когда определен тип базы данных PostgreSQL.

 \internal 



@param array  $columns_to_return Массив строк с именами столбцов, которые нужно вернуть в результате поиска.
@param array  $columns_to_search Массив строк с именами столбцов, по которым выполняется полнотекстовый поиск.
@param string $search_string     Строка поиска, введенная пользователем (должна быть без спецсимволов LIKE, но
                                 может содержать операторы FTS, если включен соответствующий режим).
                                 Проверяется на минимальную длину.
@param string $table             Строка с именем таблицы, в которой выполняется поиск.
@param string $db_version        Строка, представляющая версию структуры базы данных (например, из специальной
                                 таблицы), используется для валидации кеша.
@param array $options            Массив дополнительных опций для формирования запроса. Используется для
                                 добавления условий WHERE, GROUP BY, ORDER BY, LIMIT и параметров к FTS-запросу.
                                 Поддерживаемые ключи:
                                 - where (string|array|false): Дополнительное условие WHERE.
                                 - group (string|false): Группировка GROUP BY.
                                 - order (string|false): Дополнительная сортировка ORDER BY (имеет более
                                   низкий приоритет, чем сортировка FTS).
                                 - limit (int|string|false): Ограничение LIMIT.
                                 - params (array): Ассоциативный массив дополнительных параметров для
                                   подготовленного выражения.

@return array|false Результат выполнения поиска в виде массива ассоциативных массивов (строк) при успехе и
                    наличии результатов, пустой массив при успехе, но отсутствии результатов, или &lt;tt&gt;false&lt;/tt&gt; в
                    случае пустой строки поиска, критической ошибки или если предыдущий FTS-запрос для этого
                    индекса завершился ошибкой (приводит к fallback, который может вернуть false).

@throws JsonException            Может быть выброшено методами кеширования (&lt;tt&gt;\$this-\&gt;cache-\&gt;is_valid&lt;/tt&gt;,
                                 &lt;tt&gt;\$this-\&gt;cache-\&gt;update_cache&lt;/tt&gt;) при ошибках сериализации/десериализации данных
                                 кеша.
@throws Exception                Может быть выброшено функцией логирования &lt;tt&gt;log_in_file()&lt;/tt&gt; в случае
                                 невозможности записи в файл.
@throws PDOException             Может быть выброшено методами &lt;tt&gt;_fts_check_options()&lt;/tt&gt; (через вызов
                                 &lt;tt&gt;_build_conditions()&lt;/tt&gt;) или &lt;tt&gt;_select_internal()&lt;/tt&gt; в случае ошибок, связанных с
                                 базой данных или некорректным SQL, если они не перехватываются в блоке
                                 &lt;tt&gt;try...catch&lt;/tt&gt; или выбрасываются после него. (Большинство таких ошибок внутри
                                 FTS перехватываются и приводят к fallback).
@throws InvalidArgumentException Может быть выброшено методом &lt;tt&gt;_fts_check_options()&lt;/tt&gt; (через вызов
                                 &lt;tt&gt;_build_conditions()&lt;/tt&gt;) при некорректном формате опций. (Большинство таких
                                 ошибок внутри FTS перехватываются и приводят к fallback).

@note    Метод использует константу &lt;tt&gt;MIN_FULLTEXT_SEARCH_LENGTH&lt;/tt&gt; для проверки минимальной длины строки поиска.
         Активно используется кеширование (&lt;tt&gt;\$this-\&gt;cache&lt;/tt&gt;) для оптимизации и запоминания FTS-индексов,
         вызывающих ошибки.
         При возникновении ошибок выполнения FTS-запроса (например, из-за проблем с FTS конфигурацией или
         отсутствия колонки tsv_weighted), метод автоматически переключается на поиск с помощью оператора
         &lt;tt&gt;ILIKE&lt;/tt&gt;, вызывая &lt;tt&gt;_fallback_to_ilike_pgsql()&lt;/tt&gt;.
         Для работы FTS в PostgreSQL требуется колонка типа TSVECTOR (например, &lt;tt&gt;tsv_weighted&lt;/tt&gt;) и
         соответствующая конфигурация.

@warning Убедитесь, что в таблице, указанной в &lt;tt&gt;\$table&lt;/tt&gt;, существуют столбцы из &lt;tt&gt;\$columns_to_search&lt;/tt&gt;,
         а также колонка типа TSVECTOR (например, &lt;tt&gt;tsv_weighted&lt;/tt&gt;), содержащая лексемы для поиска. Убедитесь,
         что настроена соответствующая FTS-конфигурация (словари, парсеры). Отсутствие необходимых компонентов
         или некорректная конфигурация приведет к ошибке выполнения FTS-запроса и переключению на &lt;tt&gt;ILIKE&lt;/tt&gt;.
         Поиск с &lt;tt&gt;ILIKE&lt;/tt&gt; может быть значительно медленнее полнотекстового поиска на больших объемах данных.

Пример использования (вызывается внутри класса):
@code 
// Предположим, MIN_FULLTEXT_SEARCH_LENGTH = 4
// $this-&gt;current_format = 'pgsql';
// $this-&gt;db_type = 'pgsql';

$columns_to_return = ['id', 'title', 'content'];
$columns_to_search = ['title', 'content']; // Используются для формирования запроса, но поиск идет по tsv_weighted
$search_string = 'database optimization'; // Длина &gt;= 4
$table = 'articles'; // Предполагается, что в таблице 'articles' есть колонка tsv_weighted
$db_version = '1.0'; // Пример версии структуры БД
$options = [
    'where' =&gt; ['is_published' =&gt; 1],
    'limit' =&gt; 10,
    'params' =&gt; [':is_published' =&gt; 1],
];

// Вызов метода
$results = $this-&gt;_full_text_search_pgsql(
    $columns_to_return,
    $columns_to_search, // Столбцы для поиска используются plainto_tsquery
    $search_string,
    $table,
    $db_version,
    $options
);

if ($results !== false) {
    // Обработка результатов поиска
    print_r($results);
} else {
    // Обработка ошибки (произошел fallback на ILIKE, и он тоже вернул false при ошибке)
    echo "Произошла ошибка поиска (включая fallback)."; }</code></li>
</ol>
<p><code>// Если strlen($search_string) &lt; 4, будет вызван _fallback_to_ilike_pgsql // Если FTS запрос упадет (например, нет колонки tsv_weighted), будет вызван _fallback_to_ilike_pgsql, ошибка будет залогирована и закэширована.  </p><dl class="section see"><dt>См. также</dt><dd><a class="el" href="#a90a18b9fa64057e99f74cbc20edb17d8" title="Выполняет альтернативный поиск по ILIKE с ранжированием similarity() для PostgreSQL.">PhotoRigma\Classes\Database\_fallback_to_ilike_pgsql()</a> Приватный метод, реализующий поиск по ILIKE в качестве fallback. </dd>
<dd>
<a class="el" href="#a6d6c48e4cc7e3d7353b4bda787ac9f43" title="Формирует финальный массив опций для запроса с учетом базовых FTS-опций и внешних условий/дополнений.">PhotoRigma\Classes\Database\_fts_check_options()</a> Приватный метод, объединяющий и обрабатывающий опции запроса для FTS. </dd>
<dd>
<a class="el" href="#a3e40bb61553455b6f52be0ab9a6062b1" title="Формирует SQL-запрос на выборку данных из таблицы, основываясь на полученных аргументах,...">PhotoRigma\Classes\Database\_select_internal()</a> Приватный метод для выполнения SELECT-запроса. </dd>
<dd>
<a class="el" href="#a31eb9243149eec0d8676bbcf7289538d" title="Извлекает все строки результата из подготовленного выражения, хранящегося в свойстве $res_query,...">PhotoRigma\Classes\Database\_result_array_internal()</a> Приватный метод для получения всех строк результата запроса. </dd>
<dd>
<a class="el" href="../../db/d02/namespacePhotoRigma_1_1Include.html#a2d74c46a21e4ce612a98eee60981aef0" title="Записывает сообщение об ошибке в лог-файл и, при необходимости, завершает выполнение скрипта.">PhotoRigma\Include\log_in_file()</a> Функция для логирования сообщений. </dd>
<dd>
<a class="el" href="../../d1/d44/interfacePhotoRigma_1_1Interfaces_1_1Cache__Handler__Interface.html" title="Интерфейс для работы с системами кеширования.">PhotoRigma\Interfaces\Cache_Handler_Interface</a> Интерфейс, используемый для работы с кешированием. </dd>
<dd>
<a class="el" href="#a252982d004053f182631167a8b39ce88" title="Объект для работы с кешем">PhotoRigma\Classes\Database\$cache</a> Свойство, хранящее объект, реализующий <code>Cache_Handler_Interface</code>. </dd>
<dd>
MIN_FULLTEXT_SEARCH_LENGTH Константа, определяющая минимальную длину строки для полнотекстового поиска. </dd></dl>
<p></code></p>

<p class="definition">См. определение в файле <a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a> строка <a class="el" href="../../d2/d89/Database_8php_source.html#l05280">5280</a></p>

<p class="reference">Перекрестные ссылки <a class="el" href="../../d2/d89/Database_8php_source.html#l05507">_fallback_to_ilike_pgsql()</a> и <a class="el" href="../../d2/d89/Database_8php_source.html#l05280">_full_text_search_pgsql()</a>.</p>

<p class="reference">Используется в <a class="el" href="../../d2/d89/Database_8php_source.html#l05280">_full_text_search_pgsql()</a>.</p>
<div id="dynsection-33" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-33-trigger" src="../../closed.png" alt="+"/> Граф вызовов:</div>
<div id="dynsection-33-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-33-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_af1edfadea1168e39f99fb44c9899968c_cgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_af1edfadea1168e39f99fb44c9899968c_cgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_af1edfadea1168e39f99fb44c9899968c_cgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_af1edfadea1168e39f99fb44c9899968c_cgraph">
<area shape="rect" title="Выполняет полнотекстовый поиск в PostgreSQL с обработкой минимальной длины строки,..." alt="" coords="5,36,163,61"/>
<area shape="poly" title=" " alt="" coords="53,38,46,28,50,18,63,12,84,10,107,12,119,19,116,24,106,17,84,15,64,17,54,22,52,27,57,34"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a90a18b9fa64057e99f74cbc20edb17d8" title="Выполняет альтернативный поиск по ILIKE с ранжированием similarity() для PostgreSQL." alt="" coords="211,29,332,68"/>
<area shape="poly" title=" " alt="" coords="163,46,195,46,195,51,163,51"/>
<area shape="poly" title=" " alt="" coords="236,30,234,20,239,11,252,5,271,3,292,5,304,12,302,16,291,10,271,8,253,10,243,15,239,21,241,28"/>
</map>
</div>
<div id="dynsection-34" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-34-trigger" src="../../closed.png" alt="+"/> Граф вызова функции:</div>
<div id="dynsection-34-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-34-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_af1edfadea1168e39f99fb44c9899968c_icgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_af1edfadea1168e39f99fb44c9899968c_icgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_af1edfadea1168e39f99fb44c9899968c_icgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_af1edfadea1168e39f99fb44c9899968c_icgraph">
<area shape="rect" title="Выполняет полнотекстовый поиск в PostgreSQL с обработкой минимальной длины строки,..." alt="" coords="5,29,163,54"/>
<area shape="poly" title=" " alt="" coords="111,16,102,10,84,8,68,10,59,15,57,20,62,28,57,30,52,21,55,11,66,5,84,3,103,5,114,12"/>
</map>
</div>

</div>
</div>
<a id="a54df4031bb92109e8e164b9313163121" name="a54df4031bb92109e8e164b9313163121"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a54df4031bb92109e8e164b9313163121">&#9670;&#160;</a></span>_full_text_search_sqlite()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">_full_text_search_sqlite </td>
          <td>(</td>
          <td class="paramtype">array</td>          <td class="paramname"><span class="paramname"><em>$columns_to_return</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">array</td>          <td class="paramname"><span class="paramname"><em>$columns_to_search</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>$search_string</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>$table</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>$db_version</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">array</td>          <td class="paramname"><span class="paramname"><em>$options</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel private">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Выполняет полнотекстовый поиск в SQLite через FTS5. </p>
<p>Этот приватный метод реализует логику полнотекстового поиска (Full-Text Search - FTS) для базы данных SQLite, используя возможности модуля FTS5. Он обрабатывает минимальную длину строки поиска, использует кеширование для быстрого определения предыдущих ошибок выполнения FTS5-запросов и включает механизм автоматического перехода (fallback) на поиск с использованием оператора <code>LIKE</code> в случае необходимости. Метод выполняет следующие действия:</p><ol type="1">
<li>Экранирует имена столбцов для возврата (<code>$columns_to_return</code>), столбцов для поиска (<code>$columns_to_search</code>) и имя основной таблицы (<code>$table</code>) с использованием двойных кавычек (<code>"&lt;/tt&gt;)
            для соответствия синтаксису SQLite. Также формирует экранированное имя связанной виртуальной FTS5
            таблицы, добавляя суффикс &lt;tt&gt;_fts&lt;/tt&gt; к имени основной таблицы.
         2. Проверяет, что длина строки поиска &lt;tt&gt;\$search_string&lt;/tt&gt; превышает минимально допустимое значение,
            определенное константой &lt;tt&gt;MIN_FULLTEXT_SEARCH_LENGTH&lt;/tt&gt;. Если длина недостаточна, метод сразу же
            вызывает приватный метод &lt;tt&gt;_fallback_to_like_sqlite()&lt;/tt&gt; для выполнения поиска с использованием &lt;tt&gt;LIKE&lt;/tt&gt;
            и возвращает его результат.
         3. Формирует уникальный ключ кеша на основе имени основной таблицы и столбцов для поиска для
            идентификации соответствующего FTS5-индекса в кеше.
         4. Проверяет кеш (&lt;tt&gt;\$this-\&gt;cache&lt;/tt&gt;) на наличие записи, связанной с этим FTS5-индексом, используя
            &lt;tt&gt;\$db_version&lt;/tt&gt; как параметр валидности кеша. Если в кеше найдена запись с флагом &lt;tt&gt;query_error =
            true&lt;/tt&gt;, это означает, что предыдущая попытка выполнить FTS5-запрос для этого индекса завершилась
            ошибкой. В этом случае метод также вызывает &lt;tt&gt;_fallback_to_like_sqlite()&lt;/tt&gt; и возвращает его результат.
         5. Предпринимает попытку выполнить полнотекстовый поиск FTS5 в блоке &lt;tt&gt;try...catch&lt;/tt&gt;:
            - Формирует базовые опции FTS (&lt;tt&gt;\$base_options&lt;/tt&gt;), включающие условие &lt;tt&gt;WHERE "имя_fts_таблицы" MATCH
              :search_string_where&lt;/tt&gt; и сортировку &lt;tt&gt;ORDER BY rank DESC&lt;/tt&gt;, используя переданную строку поиска
              &lt;tt&gt;\$search_string&lt;/tt&gt; как параметр.
            - Объединяет переданные внешние опции запроса (&lt;tt&gt;\$options&lt;/tt&gt;) с базовыми FTS-опциями
              (&lt;tt&gt;\$base_options&lt;/tt&gt;) с помощью приватного метода &lt;tt&gt;_fts_check_options()&lt;/tt&gt;. Этот метод разрешает
              конфликты плейсхолдеров и определяет приоритеты для WHERE, ORDER BY, GROUP BY, LIMIT и PARAMS.
            - Вызывает приватный метод &lt;tt&gt;_select_internal()&lt;/tt&gt; с экранированными столбцами для возврата,
              &lt;strong&gt;экранированным именем FTS5 таблицы&lt;/strong&gt; (&lt;tt&gt;\$fts_table_escaped&lt;/tt&gt;) и объединенными опциями
              (&lt;tt&gt;\$new_options&lt;/tt&gt;) для выполнения SQL-запроса к виртуальной FTS5 таблице.
         6. В случае успешного выполнения FTS5-запроса (блок &lt;tt&gt;try&lt;/tt&gt; без исключений):
            - Обновляет кеш (&lt;tt&gt;\$this-\&gt;cache&lt;/tt&gt;), устанавливая флаг &lt;tt&gt;query_error = false&lt;/tt&gt; для данного FTS5-индекса,
              указывая на успешность последнего запроса.
            - Получает результат запроса в виде массива с помощью приватного метода &lt;tt&gt;_result_array_internal()&lt;/tt&gt; и
              возвращает его.
         7. В случае возникновения исключения (&lt;tt&gt;Throwable&lt;/tt&gt;) во время выполнения FTS5-запроса (блок &lt;tt&gt;catch&lt;/tt&gt;):
            - Логирует информацию об ошибке с помощью функции &lt;tt&gt;log_in_file()&lt;/tt&gt;, включая текст запроса и
              сообщение об ошибке.
            - Обновляет кеш (&lt;tt&gt;\$this-\&gt;cache&lt;/tt&gt;), устанавливая флаг &lt;tt&gt;query_error = true&lt;/tt&gt; для данного FTS5-индекса,
              чтобы избежать повторных ошибок в будущем.
            - Вызывает приватный метод &lt;tt&gt;_fallback_to_like_sqlite()&lt;/tt&gt; для выполнения поиска с использованием
              &lt;tt&gt;LIKE&lt;/tt&gt; и возвращает его результат.

         Этот метод является приватным и предназначен только для использования внутри класса &lt;tt&gt;Database&lt;/tt&gt;.
         Он вызывается из публичных или защищенных методов поиска, когда определен тип базы данных SQLite.

 \internal 



@param array  $columns_to_return Массив строк с именами столбцов, которые нужно вернуть в результате поиска.
@param array $columns_to_search  Массив строк с именами столбцов, по которым выполняется полнотекстовый поиск
                                 (используются для формирования имени FTS5 таблицы и кеш-ключа).
@param string $search_string     Строка поиска, введенная пользователем. Используется как есть для оператора
                                 FTS5 &lt;tt&gt;MATCH&lt;/tt&gt;. Проверяется на минимальную длину.
@param string $table             Строка с именем основной таблицы, для которой существует связанная FTS5
                                 виртуальная таблица.
@param string $db_version        Строка, представляющая версию структуры базы данных (например, из специальной
                                 таблицы), используется для валидации кеша.
@param array $options            Массив дополнительных опций для формирования запроса. Используется для
                                 добавления условий WHERE, GROUP BY, ORDER BY, LIMIT и параметров к FTS5-запросу.
                                 Поддерживаемые ключи:
                                 - where (string|array|false): Дополнительное условие WHERE (объединяется с
                                   FTS5 MATCH оператором AND).
                                 - group (string|false): Группировка GROUP BY.
                                 - order (string|false): Дополнительная сортировка ORDER BY (имеет более
                                   низкий приоритет, чем FTS5 &lt;tt&gt;rank DESC&lt;/tt&gt;).
                                 - limit (int|string|false): Ограничение LIMIT.
                                 - params (array): Ассоциативный массив дополнительных параметров для
                                   подготовленного выражения.

@return array|false Результат выполнения поиска в виде массива ассоциативных массивов (строк) при успехе и
                    наличии результатов, пустой массив при успехе, но отсутствии результатов, или &lt;tt&gt;false&lt;/tt&gt; в
                    случае пустой строки поиска, критической ошибки или если предыдущий FTS5-запрос для этого
                    индекса завершился ошибкой (приводит к fallback, который может вернуть false).

@throws JsonException            Может быть выброшено методами кеширования (&lt;tt&gt;\$this-\&gt;cache-\&gt;is_valid&lt;/tt&gt;,
                                 &lt;tt&gt;\$this-\&gt;cache-\&gt;update_cache&lt;/tt&gt;) при ошибках сериализации/десериализации данных кеша.
@throws Exception                Может быть выброшено функцией логирования &lt;tt&gt;log_in_file()&lt;/tt&gt; в случае
                                 невозможности записи в файл.
@throws PDOException             Может быть выброшено методами &lt;tt&gt;_fts_check_options()&lt;/tt&gt; (через вызов
                                 &lt;tt&gt;_build_conditions()&lt;/tt&gt;) или &lt;tt&gt;_select_internal()&lt;/tt&gt; в случае ошибок, связанных с
                                 базой данных или некорректным SQL, если они не перехватываются в блоке
                                 &lt;tt&gt;try...catch&lt;/tt&gt; или выбрасываются после него. (Большинство таких ошибок внутри
                                 FTS5 перехватываются и приводят к fallback).
@throws InvalidArgumentException Может быть выброшено методом &lt;tt&gt;_fts_check_options()&lt;/tt&gt; (через вызов
                                 &lt;tt&gt;_build_conditions()&lt;/tt&gt;) при некорректном формате опций. (Большинство таких
                                 ошибок внутри FTS5 перехватываются и приводят к fallback).

@note    Метод использует константу &lt;tt&gt;MIN_FULLTEXT_SEARCH_LENGTH&lt;/tt&gt; для проверки минимальной длины строки поиска.
         Активно используется кеширование (&lt;tt&gt;\$this-\&gt;cache&lt;/tt&gt;) для оптимизации и запоминания FTS5-индексов,
         вызывающих ошибки. При возникновении ошибок выполнения FTS5-запроса (например, из-за отсутствия
         виртуальной таблицы или некорректного синтаксиса FTS5), метод автоматически переключается на поиск с
         использованием оператора &lt;tt&gt;LIKE&lt;/tt&gt;, вызывая &lt;tt&gt;_fallback_to_like_sqlite()&lt;/tt&gt;.
         Для работы требуется создание виртуальной таблицы FTS5 с именем &lt;tt&gt;имя_основной_таблицы_fts&lt;/tt&gt; и
         соответствующей структурой, содержащей столбцы для поиска.

@warning Убедитесь, что для таблицы, указанной в &lt;tt&gt;\$table&lt;/tt&gt;, существует виртуальная таблица FTS5 с именем
         &lt;tt&gt;{\$table}_fts&lt;/tt&gt; и что она содержит столбцы, достаточные для поиска.
         Поиск с &lt;tt&gt;LIKE&lt;/tt&gt; может быть значительно медленнее полнотекстового поиска FTS5 на больших объемах данных.

Пример использования (вызывается внутри класса):
@code 
// Предположим, MIN_FULLTEXT_SEARCH_LENGTH = 4
// $this-&gt;current_format = 'sqlite';
// $this-&gt;db_type = 'sqlite';

$columns_to_return = ['id', 'title', 'content'];
$columns_to_search = ['title', 'content']; // Используются для формирования имени FTS таблицы и кеш-ключа
$search_string = 'database optimization'; // Длина &gt;= 4
$table = 'articles'; // Предполагается, что существует FTS5 таблица 'articles_fts'
$db_version = '1.0'; // Пример версии структуры БД
$options = [
    'where' =&gt; ['is_published' =&gt; 1],
    'limit' =&gt; 10,
    'params' =&gt; [':is_published' =&gt; 1],
];

// Вызов метода
$results = $this-&gt;_full_text_search_sqlite(
    $columns_to_return,
    $columns_to_search, // Столбцы для поиска используются для MATCH
    $search_string,
    $table,
    $db_version,
    $options
);

if ($results !== false) {
    // Обработка результатов поиска
    print_r($results);
} else {
    // Обработка ошибки (произошел fallback на LIKE, и он тоже вернул false при ошибке)
    echo "Произошла ошибка поиска (включая fallback)."; }</code></li>
</ol>
<p><code>// Если strlen($search_string) &lt; 4, будет вызван _fallback_to_like_sqlite // Если FTS5 запрос упадет (например, нет таблицы articles_fts), будет вызван _fallback_to_like_sqlite, ошибка будет залогирована и закэширована.  </p><dl class="section see"><dt>См. также</dt><dd><a class="el" href="#a960a7f20277c75940122885ec6b40d4b" title="Выполняет альтернативный LIKE-поиск для SQLite.">PhotoRigma\Classes\Database\_fallback_to_like_sqlite()</a> Приватный метод, реализующий поиск по LIKE в качестве fallback. </dd>
<dd>
<a class="el" href="#a6d6c48e4cc7e3d7353b4bda787ac9f43" title="Формирует финальный массив опций для запроса с учетом базовых FTS-опций и внешних условий/дополнений.">PhotoRigma\Classes\Database\_fts_check_options()</a> Приватный метод, объединяющий и обрабатывающий опции запроса для FTS. </dd>
<dd>
<a class="el" href="#a3e40bb61553455b6f52be0ab9a6062b1" title="Формирует SQL-запрос на выборку данных из таблицы, основываясь на полученных аргументах,...">PhotoRigma\Classes\Database\_select_internal()</a> Приватный метод для выполнения SELECT-запроса к FTS5 таблице. </dd>
<dd>
<a class="el" href="#a31eb9243149eec0d8676bbcf7289538d" title="Извлекает все строки результата из подготовленного выражения, хранящегося в свойстве $res_query,...">PhotoRigma\Classes\Database\_result_array_internal()</a> Приватный метод для получения всех строк результата запроса. </dd>
<dd>
<a class="el" href="../../db/d02/namespacePhotoRigma_1_1Include.html#a2d74c46a21e4ce612a98eee60981aef0" title="Записывает сообщение об ошибке в лог-файл и, при необходимости, завершает выполнение скрипта.">PhotoRigma\Include\log_in_file()</a> Функция для логирования сообщений. </dd>
<dd>
<a class="el" href="../../d1/d44/interfacePhotoRigma_1_1Interfaces_1_1Cache__Handler__Interface.html" title="Интерфейс для работы с системами кеширования.">PhotoRigma\Interfaces\Cache_Handler_Interface</a> Интерфейс, используемый для работы с кешированием. </dd>
<dd>
<a class="el" href="#a252982d004053f182631167a8b39ce88" title="Объект для работы с кешем">PhotoRigma\Classes\Database\$cache</a> Свойство, хранящее объект, реализующий <code>Cache_Handler_Interface</code>. </dd>
<dd>
MIN_FULLTEXT_SEARCH_LENGTH Константа, определяющая минимальную длину строки для полнотекстового поиска. </dd>
<dd>
<a href="https://www.sqlite.org/fts5.html">https://www.sqlite.org/fts5.html</a> Документация по модулю SQLite FTS5. </dd></dl>
<p></code></p>

<p class="definition">См. определение в файле <a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a> строка <a class="el" href="../../d2/d89/Database_8php_source.html#l05723">5723</a></p>

<p class="reference">Перекрестные ссылки <a class="el" href="../../d2/d89/Database_8php_source.html#l05931">_fallback_to_like_sqlite()</a> и <a class="el" href="../../d2/d89/Database_8php_source.html#l05723">_full_text_search_sqlite()</a>.</p>

<p class="reference">Используется в <a class="el" href="../../d2/d89/Database_8php_source.html#l05723">_full_text_search_sqlite()</a>.</p>
<div id="dynsection-35" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-35-trigger" src="../../closed.png" alt="+"/> Граф вызовов:</div>
<div id="dynsection-35-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-35-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_a54df4031bb92109e8e164b9313163121_cgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a54df4031bb92109e8e164b9313163121_cgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a54df4031bb92109e8e164b9313163121_cgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a54df4031bb92109e8e164b9313163121_cgraph">
<area shape="rect" title="Выполняет полнотекстовый поиск в SQLite через FTS5." alt="" coords="5,29,163,54"/>
<area shape="poly" title=" " alt="" coords="50,31,43,21,47,11,61,5,84,3,109,5,122,12,120,17,108,10,84,8,62,10,51,15,48,20,55,27"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a960a7f20277c75940122885ec6b40d4b" title="Выполняет альтернативный LIKE&#45;поиск для SQLite." alt="" coords="211,29,367,54"/>
<area shape="poly" title=" " alt="" coords="163,39,195,39,195,44,163,44"/>
<area shape="poly" title=" " alt="" coords="255,31,248,21,252,11,266,5,289,3,314,5,327,12,324,17,313,10,289,8,267,10,256,15,253,20,259,27"/>
</map>
</div>
<div id="dynsection-36" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-36-trigger" src="../../closed.png" alt="+"/> Граф вызова функции:</div>
<div id="dynsection-36-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-36-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_a54df4031bb92109e8e164b9313163121_icgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a54df4031bb92109e8e164b9313163121_icgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a54df4031bb92109e8e164b9313163121_icgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a54df4031bb92109e8e164b9313163121_icgraph">
<area shape="rect" title="Выполняет полнотекстовый поиск в SQLite через FTS5." alt="" coords="5,29,163,54"/>
<area shape="poly" title=" " alt="" coords="111,16,102,10,84,8,68,10,59,15,57,20,62,28,57,30,52,21,55,11,66,5,84,3,103,5,114,12"/>
</map>
</div>

</div>
</div>
<a id="a834ca0d1c7c60bc9bfae123070b45fbd" name="a834ca0d1c7c60bc9bfae123070b45fbd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a834ca0d1c7c60bc9bfae123070b45fbd">&#9670;&#160;</a></span>_get_affected_rows_internal()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">_get_affected_rows_internal </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel protected">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Возвращает количество строк, затронутых последним SQL-запросом, после проверки состояния свойства <code>$aff_rows</code>. </p>
<p>Этот защищённый метод выполняет следующие шаги:</p><ol type="1">
<li>Проверяет, что свойство <code>$this-&gt;aff_rows</code> установлено. Если это не так, выбрасывается исключение InvalidArgumentException.</li>
<li>Проверяет, что значение свойства <code>$this-&gt;aff_rows</code> является целым числом. Если это не так, выбрасывается исключение InvalidArgumentException.</li>
<li>Возвращает значение свойства <code>$this-&gt;aff_rows</code>, которое представляет собой количество строк, затронутых последним SQL-запросом (операциями INSERT, UPDATE, DELETE, REPLACE).</li>
</ol>
<p>Метод только читает значение свойства <code>$this-&gt;aff_rows</code> и не выполняет дополнительной логики для его обновления. Значение <code>$this-&gt;aff_rows</code> должно быть установлено внешними методами, такими как <code>_execute_query()</code>, <code>delete()</code>, <code>update()</code> или <code>insert()</code>. Этот метод является защищенным и предназначен для использования внутри класса или его наследников. Основная логика вызывается через публичный метод-редирект <code>get_affected_rows()</code>.</p>
<dl class="section return"><dt>Возвращает</dt><dd>int Количество строк, затронутых последним SQL-запросом.</dd></dl>
<dl class="exception"><dt>Исключения</dt><dd>
  <table class="exception">
    <tr><td class="paramname">InvalidArgumentException</td><td>Выбрасывается, если:<ul>
<li>Свойство <code>$this-&gt;aff_rows</code> не установлено (т.е. не было выполнено запроса, обновляющего его). Пример сообщения: Количество затронутых строк не установлено | Причина: Свойство aff_rows не определено</li>
<li>Значение свойства <code>$this-&gt;aff_rows</code> не является целым числом (указывает на некорректное состояние). Пример сообщения: Некорректное значение свойства aff_rows | Ожидалось целое число, получено: [значение]</li>
</ul>
</td></tr>
  </table>
  </dd>
</dl>
<dl class="section warning"><dt>Предупреждения</dt><dd>Метод чувствителен к состоянию свойства <code>$this-&gt;aff_rows</code>. Убедитесь, что перед вызовом метода был выполнен запрос (например, INSERT, UPDATE, DELETE), который корректно установил значение <code>$this-&gt;aff_rows</code> как целое число.</dd></dl>
<p>Пример использования метода _get_affected_rows_internal(): </p><div class="fragment"><div class="line"><span class="comment">// Предполагается, что перед этим был выполнен INSERT, UPDATE, DELETE или REPLACE запрос</span></div>
<div class="line"><span class="comment">// ... например: $this-&gt;update(&#39;users&#39;, [&#39;status&#39; =&gt; 1], [&#39;where&#39; =&gt; &#39;id = 5&#39;]);</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Получаем количество затронутых строк</span></div>
<div class="line">$affectedRows = $this-&gt;<a class="code hl_function" href="#a834ca0d1c7c60bc9bfae123070b45fbd">_get_affected_rows_internal</a>();</div>
<div class="line">echo <span class="stringliteral">&quot;Affected rows: &quot;</span> . $affectedRows;</div>
<div class="ttc" id="aclassPhotoRigma_1_1Classes_1_1Database_html_a834ca0d1c7c60bc9bfae123070b45fbd"><div class="ttname"><a href="#a834ca0d1c7c60bc9bfae123070b45fbd">PhotoRigma\Classes\Database\_get_affected_rows_internal</a></div><div class="ttdeci">_get_affected_rows_internal()</div><div class="ttdoc">Возвращает количество строк, затронутых последним SQL-запросом, после проверки состояния свойства $af...</div><div class="ttdef"><b>Определения</b> <a href="../../d2/d89/Database_8php_source.html#l02722">Database.php:2722</a></div></div>
</div><!-- fragment --> <dl class="section see"><dt>См. также</dt><dd><a class="el" href="#a54ffcc55f5606eeb40e8ac59c881d22b" title="Количество строк, затронутых последним запросом (INSERT, UPDATE, DELETE)">PhotoRigma\Classes\Database\$aff_rows</a> Свойство, хранящее количество строк, затронутых последним запросом. </dd>
<dd>
<a class="el" href="#a941629b86b9c9e34bc5926c0db2478b5" title="Выполняет SQL-запрос с использованием подготовленных выражений.">PhotoRigma\Classes\Database\_execute_query()</a> Метод нижнего уровня, который обновляет значение <code>$aff_rows</code> после выполнения запроса. </dd>
<dd>
<a class="el" href="#a73d8e6acdfb996002f980ab7c9c18515" title="Удаляет данные из таблицы через вызов внутреннего метода.">PhotoRigma\Classes\Database\delete()</a> Метод, который вызывает <code>_execute_query</code> и, таким образом, может изменять значение <code>$aff_rows</code>. </dd>
<dd>
<a class="el" href="#a539e51bc2144b972bfafeccdda56ee9e" title="Обновляет данные в таблице через вызов внутреннего метода.">PhotoRigma\Classes\Database\update()</a> Метод, который вызывает <code>_execute_query</code> и, таким образом, может изменять значение <code>$aff_rows</code>. </dd>
<dd>
<a class="el" href="#a6e5af1f386c0c7968aa10ea928c7a110" title="Вставляет данные в таблицу через вызов внутреннего метода.">PhotoRigma\Classes\Database\insert()</a> Метод, который вызывает <code>_execute_query</code> и, таким образом, может изменять значение <code>$aff_rows</code>. </dd>
<dd>
<a class="el" href="#a2c437dae4e310529391e7f5388b133ba" title="Возвращает количество строк, затронутых последним SQL-запросом.">PhotoRigma\Classes\Database\get_affected_rows()</a> Публичный метод-редирект для вызова этой логики. </dd></dl>

<p class="definition">См. определение в файле <a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a> строка <a class="el" href="../../d2/d89/Database_8php_source.html#l02722">2722</a></p>

<p class="reference">Перекрестные ссылки <a class="el" href="../../d2/d89/Database_8php_source.html#l00207">$aff_rows</a>.</p>

<p class="reference">Используется в <a class="el" href="../../d2/d89/Database_8php_source.html#l02656">get_affected_rows()</a>.</p>
<div id="dynsection-37" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-37-trigger" src="../../closed.png" alt="+"/> Граф вызова функции:</div>
<div id="dynsection-37-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-37-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_a834ca0d1c7c60bc9bfae123070b45fbd_icgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a834ca0d1c7c60bc9bfae123070b45fbd_icgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a834ca0d1c7c60bc9bfae123070b45fbd_icgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a834ca0d1c7c60bc9bfae123070b45fbd_icgraph">
<area shape="rect" title="Возвращает количество строк, затронутых последним SQL&#45;запросом, после проверки состояния свойства $af..." alt="" coords="181,5,315,44"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a2c437dae4e310529391e7f5388b133ba" title="Возвращает количество строк, затронутых последним SQL&#45;запросом." alt="" coords="5,12,133,37"/>
<area shape="poly" title=" " alt="" coords="165,27,133,27,133,22,165,22"/>
</map>
</div>

</div>
</div>
<a id="ab122f53e8d2ca9d723e32426c9e691e9" name="ab122f53e8d2ca9d723e32426c9e691e9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab122f53e8d2ca9d723e32426c9e691e9">&#9670;&#160;</a></span>_get_last_insert_id_internal()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">_get_last_insert_id_internal </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel protected">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Возвращает ID последней вставленной строки после проверки состояния свойства <code>$insert_id</code>. </p>
<p>Этот защищённый метод выполняет следующие шаги:</p><ol type="1">
<li>Проверяет, что свойство <code>$this-&gt;insert_id</code> установлено. Если это не так, выбрасывается исключение InvalidArgumentException.</li>
<li>Проверяет, что значение свойства <code>$this-&gt;insert_id</code> является целым числом. Если это не так, выбрасывается исключение InvalidArgumentException.</li>
<li>Возвращает значение свойства <code>$this-&gt;insert_id</code>, которое представляет собой ID последней вставленной строки.</li>
</ol>
<p>Метод только читает значение свойства <code>$this-&gt;insert_id</code> и не выполняет дополнительной логики для его обновления. Значение <code>$this-&gt;insert_id</code> должно быть установлено внешними методами, такими как <code>_execute_query()</code> или <code>insert()</code>. Этот метод является защищенным и предназначен для использования внутри класса или его наследников. Основная логика вызывается через публичный метод-редирект <code>get_last_insert_id()</code>.</p>
<dl class="section return"><dt>Возвращает</dt><dd>int ID последней вставленной строки.</dd></dl>
<dl class="exception"><dt>Исключения</dt><dd>
  <table class="exception">
    <tr><td class="paramname">InvalidArgumentException</td><td>Выбрасывается, если:<ul>
<li>Свойство <code>$this-&gt;insert_id</code> не установлено (т.е. не было выполнено запроса, устанавливающего его). Пример сообщения: ID последней вставленной строки не установлен | Причина: Свойство insert_id не определено</li>
<li>Значение свойства <code>$this-&gt;insert_id</code> не является целым числом (указывает на некорректное состояние). Пример сообщения: Некорректное значение свойства insert_id | Ожидалось целое число, получено: [значение]</li>
</ul>
</td></tr>
  </table>
  </dd>
</dl>
<dl class="section warning"><dt>Предупреждения</dt><dd>Метод чувствителен к состоянию свойства <code>$this-&gt;insert_id</code>. Убедитесь, что перед вызовом метода был выполнен запрос (например, INSERT), который корректно установил значение <code>$this-&gt;insert_id</code> как целое число.</dd></dl>
<p>Пример использования метода _get_last_insert_id_internal(): </p><div class="fragment"><div class="line"><span class="comment">// Предполагается, что перед этим был выполнен INSERT запрос, например:</span></div>
<div class="line"><span class="comment">// $this-&gt;insert([&#39;name&#39; =&gt; &#39;John Doe&#39;, &#39;email&#39; =&gt; &#39;john@local.com&#39;], &#39;users&#39;);</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Получаем ID последней вставленной строки</span></div>
<div class="line">$lastInsertId = $this-&gt;<a class="code hl_function" href="#ab122f53e8d2ca9d723e32426c9e691e9">_get_last_insert_id_internal</a>();</div>
<div class="line">echo <span class="stringliteral">&quot;Last insert ID: &quot;</span> . $lastInsertId;</div>
<div class="line"><span class="comment">// Примечание: Метод insert обновляет значение свойства $insert_id.</span></div>
<div class="ttc" id="aclassPhotoRigma_1_1Classes_1_1Database_html_ab122f53e8d2ca9d723e32426c9e691e9"><div class="ttname"><a href="#ab122f53e8d2ca9d723e32426c9e691e9">PhotoRigma\Classes\Database\_get_last_insert_id_internal</a></div><div class="ttdeci">_get_last_insert_id_internal()</div><div class="ttdoc">Возвращает ID последней вставленной строки после проверки состояния свойства $insert_id.</div><div class="ttdef"><b>Определения</b> <a href="../../d2/d89/Database_8php_source.html#l02834">Database.php:2834</a></div></div>
</div><!-- fragment --> <dl class="section see"><dt>См. также</dt><dd><a class="el" href="#a0fb355e7d9e1e7d9ca0b1b83dc960f33" title="ID последней вставленной строки после выполнения INSERT-запроса">PhotoRigma\Classes\Database\$insert_id</a> Свойство, хранящее ID последней вставленной строки. </dd>
<dd>
<a class="el" href="#a6e5af1f386c0c7968aa10ea928c7a110" title="Вставляет данные в таблицу через вызов внутреннего метода.">PhotoRigma\Classes\Database\insert()</a> Метод, который может устанавливать значение <code>$insert_id</code>. </dd>
<dd>
<a class="el" href="#a941629b86b9c9e34bc5926c0db2478b5" title="Выполняет SQL-запрос с использованием подготовленных выражений.">PhotoRigma\Classes\Database\_execute_query()</a> Метод нижнего уровня, который может обновлять значение <code>$insert_id</code> после выполнения запроса. </dd>
<dd>
<a class="el" href="#abafff8c03a52d73e37072449448e5a3c" title="Возвращает ID последней вставленной строки.">PhotoRigma\Classes\Database\get_last_insert_id()</a> Публичный метод-редирект для вызова этой логики. </dd></dl>

<p class="definition">См. определение в файле <a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a> строка <a class="el" href="../../d2/d89/Database_8php_source.html#l02834">2834</a></p>

<p class="reference">Перекрестные ссылки <a class="el" href="../../d2/d89/Database_8php_source.html#l00208">$insert_id</a>.</p>

<p class="reference">Используется в <a class="el" href="../../d2/d89/Database_8php_source.html#l02773">get_last_insert_id()</a>.</p>
<div id="dynsection-38" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-38-trigger" src="../../closed.png" alt="+"/> Граф вызова функции:</div>
<div id="dynsection-38-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-38-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_ab122f53e8d2ca9d723e32426c9e691e9_icgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_ab122f53e8d2ca9d723e32426c9e691e9_icgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_ab122f53e8d2ca9d723e32426c9e691e9_icgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_ab122f53e8d2ca9d723e32426c9e691e9_icgraph">
<area shape="rect" title="Возвращает ID последней вставленной строки после проверки состояния свойства $insert_id." alt="" coords="177,5,307,44"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#abafff8c03a52d73e37072449448e5a3c" title="Возвращает ID последней вставленной строки." alt="" coords="5,12,129,37"/>
<area shape="poly" title=" " alt="" coords="161,27,129,27,129,22,161,22"/>
</map>
</div>

</div>
</div>
<a id="a442c0348c8bd3cd7104cb110cc71348a" name="a442c0348c8bd3cd7104cb110cc71348a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a442c0348c8bd3cd7104cb110cc71348a">&#9670;&#160;</a></span>_insert_internal()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">_insert_internal </td>
          <td>(</td>
          <td class="paramtype">array</td>          <td class="paramname"><span class="paramname"><em>$insert</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>$to_tbl</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>$type</em></span><span class="paramdefsep"> = </span><span class="paramdefval">''</span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">array</td>          <td class="paramname"><span class="paramname"><em>$options</em></span><span class="paramdefsep"> = </span><span class="paramdefval">[]</span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel protected">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Формирует SQL-запрос на вставку данных в таблицу, проверяет входные данные, обрабатывает различные типы запросов, сохраняет текст запроса в свойстве <code>$txt_query</code> и выполняет его. </p>
<p>Этот защищённый метод выполняет следующие шаги:</p><ol type="1">
<li>Валидация входных данных: <code>$insert</code> (ассоциативный массив), <code>$to_tbl</code> (строка), <code>$type</code> (строка), <code>$options</code> (массив).</li>
<li>Проверяет, что массив <code>$insert</code> не пустой. Если массив пустой, выбрасывается исключение.</li>
<li>Нормализует параметр <code>$type</code>, приводя его к нижнему регистру, и проверяет на допустимые значения: &lsquo;'ignore&rsquo;<code>,</code>'replace'<code>,</code>'into'<code>,</code>''<code>. Если указан недопустимый тип, выбрасывается исключение.</code></li>
<li><code>Определяет тип запроса на основе параметра</code>$type<code>: -</code>'ignore'<code>: Формирует запрос типа "INSERT IGNORE INTO". -</code>'replace'<code>: Формирует запрос типа "REPLACE INTO". -</code>'into'<code>или пустая строка (</code>''<code>): Формирует запрос типа "INSERT INTO" (по умолчанию).</code></li>
<li><code>Формирует базовый SQL-запрос INSERT с использованием преобразованных данных и сохраняет его в свойстве</code>$txt_query<code>.</code></li>
<li><code>Выполняет сформированный запрос через метод</code>_execute_query<code>, передавая параметры</code>params<code>из </code>$options` для подготовленного выражения.</li>
</ol>
<p>Использование параметров <code>params</code> является обязательным для подготовленных выражений, так как это обеспечивает защиту от SQL-инъекций и совместимость с различными СУБД. Этот метод является защищенным и предназначен для использования внутри класса или его наследников. Основная логика вызывается через публичный метод-редирект <code>insert()</code>.</p>
<dl class="params"><dt>Аргументы</dt><dd>
  <table class="params">
    <tr><td class="paramtype">array</td><td class="paramname">$insert</td><td>Ассоциативный массив данных для вставки в формате: 'имя_поля' =&gt; 'значение' или 'имя_поля' =&gt; ':плейсхолдер'. Если передан пустой массив, выбрасывается исключение. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$to_tbl</td><td>Имя таблицы, в которую необходимо вставить данные. Должно быть строкой, содержащей только допустимые имена таблиц без специальных символов. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$type</td><td>Тип запроса (необязательно). Определяет тип SQL-запроса на вставку. Допустимые значения:<ul>
<li>'ignore': Формирует запрос типа "INSERT IGNORE INTO".</li>
<li>'replace': Формирует запрос типа "REPLACE INTO".</li>
<li>'into': Формирует запрос типа "INSERT INTO" (явное указание).</li>
<li>'' (пустая строка): Формирует запрос типа "INSERT INTO" (по умолчанию). Если указан недопустимый тип, выбрасывается исключение InvalidArgumentException. </li>
</ul>
</td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$options</td><td>Массив опций для формирования запроса. Поддерживаемые ключи:<ul>
<li>params (array): Параметры для подготовленного выражения. Ассоциативный массив значений, используемых в запросе (например, [":name" =&gt; "John Doe", ":email" =&gt; "john@local.com"]). Обязателен для использования с данными для вставки, требующими подготовленных выражений. Обеспечивает защиту от SQL-инъекций. Может быть пустым массивом, если параметры не требуются.</li>
<li>where (string|array|false): Условие WHERE. Игнорируется в этом методе.</li>
<li>group (string|false): Группировка GROUP BY. Игнорируется в этом методе.</li>
<li>order (string|false): Сортировка ORDER BY. Игнорируется в этом методе.</li>
<li>limit (int|string|false): Ограничение LIMIT. Игнорируется в этом методе.</li>
</ul>
</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Возвращает</dt><dd>bool Возвращает true, если запрос успешно выполнен (даже если результат пустой). В случае ошибки выбрасывается исключение.</dd></dl>
<dl class="exception"><dt>Исключения</dt><dd>
  <table class="exception">
    <tr><td class="paramname">InvalidArgumentException</td><td>Выбрасывается, если:<ul>
<li><code>$insert</code> не является массивом или является пустым массивом. Пример сообщения: Данные для вставки не могут быть пустыми | Причина: Пустой массив данных</li>
<li><code>$to_tbl</code> не является строкой. Пример сообщения: Недопустимое имя таблицы | Ожидалась строка, получено: [тип]</li>
<li><code>$type</code> содержит недопустимое значение (не '', 'ignore', 'replace', 'into'). Пример сообщения: Недопустимый тип вставки | Разрешённые значения: '', 'ignore', 'replace', 'into'. Получено: '$type'</li>
<li><code>$options</code> не является массивом. Пример сообщения: Недопустимый тип параметра options | Ожидался массив, получено: [тип] </li>
</ul>
</td></tr>
    <tr><td class="paramname">Exception</td><td>Выбрасывается при ошибках выполнения запроса.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section warning"><dt>Предупреждения</dt><dd>Метод чувствителен к корректности входных данных. Неверные типы данных или некорректные значения могут привести к выбросу исключения. Убедитесь, что массив <code>$insert</code> не пустой и содержит корректные данные. Параметр <code>$type</code> должен быть одним из допустимых значений: '', 'ignore', 'replace', 'into'. Использование параметров <code>params</code> для подготовленных выражений является обязательным для защиты от SQL-инъекций и обеспечения совместимости с различными СУБД. Игнорирование этого правила может привести к уязвимостям безопасности и неправильной работе с базой данных. Другие ключи массива <code>$options</code> (<code>where</code>, <code>group</code>, <code>order</code>, <code>limit</code>) игнорируются в этом методе.</dd></dl>
<p>Пример использования метода _insert_internal(): </p><div class="fragment"><div class="line"><span class="comment">// Безопасное использование с параметрами `params`</span></div>
<div class="line">$this-&gt;<a class="code hl_function" href="#a442c0348c8bd3cd7104cb110cc71348a">_insert_internal</a>(</div>
<div class="line">    [<span class="stringliteral">&#39;name&#39;</span> =&gt; <span class="stringliteral">&#39;:name&#39;</span>, <span class="stringliteral">&#39;email&#39;</span> =&gt; <span class="stringliteral">&#39;:email&#39;</span>],</div>
<div class="line">    <span class="stringliteral">&#39;users&#39;</span>,</div>
<div class="line">    <span class="stringliteral">&#39;&#39;</span>,</div>
<div class="line">    [<span class="stringliteral">&#39;params&#39;</span> =&gt; [<span class="stringliteral">&#39;:name&#39;</span> =&gt; <span class="stringliteral">&#39;John Doe&#39;</span>, <span class="stringliteral">&#39;:email&#39;</span> =&gt; <span class="stringliteral">&#39;john@local.com&#39;</span>]]</div>
<div class="line">);</div>
<div class="ttc" id="aclassPhotoRigma_1_1Classes_1_1Database_html_a442c0348c8bd3cd7104cb110cc71348a"><div class="ttname"><a href="#a442c0348c8bd3cd7104cb110cc71348a">PhotoRigma\Classes\Database\_insert_internal</a></div><div class="ttdeci">_insert_internal(array $insert, string $to_tbl, string $type=&#39;&#39;, array $options=[])</div><div class="ttdoc">Формирует SQL-запрос на вставку данных в таблицу, проверяет входные данные, обрабатывает различные ти...</div><div class="ttdef"><b>Определения</b> <a href="../../d2/d89/Database_8php_source.html#l03029">Database.php:3029</a></div></div>
</div><!-- fragment --> <dl class="section see"><dt>См. также</dt><dd><a class="el" href="#a556a1b37f162e7e8b576b86c182c7309" title="Текст последнего SQL-запроса, сформированного методами класса">PhotoRigma\Classes\Database\$txt_query</a> Свойство, в которое помещается текст SQL-запроса. </dd>
<dd>
<a class="el" href="#a6e5af1f386c0c7968aa10ea928c7a110" title="Вставляет данные в таблицу через вызов внутреннего метода.">PhotoRigma\Classes\Database\insert()</a> Публичный метод-редирект для вызова этой логики. </dd>
<dd>
<a class="el" href="#a941629b86b9c9e34bc5926c0db2478b5" title="Выполняет SQL-запрос с использованием подготовленных выражений.">PhotoRigma\Classes\Database\_execute_query()</a> Выполняет SQL-запрос. </dd></dl>

<p class="definition">См. определение в файле <a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a> строка <a class="el" href="../../d2/d89/Database_8php_source.html#l03029">3029</a></p>

<p class="reference">Перекрестные ссылки <a class="el" href="../../d2/d89/Database_8php_source.html#l01393">_execute_query()</a>.</p>

<p class="reference">Используется в <a class="el" href="../../d2/d89/Database_8php_source.html#l02928">insert()</a>.</p>
<div id="dynsection-39" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-39-trigger" src="../../closed.png" alt="+"/> Граф вызовов:</div>
<div id="dynsection-39-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-39-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_a442c0348c8bd3cd7104cb110cc71348a_cgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a442c0348c8bd3cd7104cb110cc71348a_cgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a442c0348c8bd3cd7104cb110cc71348a_cgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a442c0348c8bd3cd7104cb110cc71348a_cgraph">
<area shape="rect" title="Формирует SQL&#45;запрос на вставку данных в таблицу, проверяет входные данные, обрабатывает различные ти..." alt="" coords="5,104,115,129"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a941629b86b9c9e34bc5926c0db2478b5" title="Выполняет SQL&#45;запрос с использованием подготовленных выражений." alt="" coords="163,104,274,129"/>
<area shape="poly" title=" " alt="" coords="115,114,147,114,147,119,115,119"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#af1b08f0490df0963b0daac6690d4765f" title="Выполняет преобразование SQL&#45;запроса в зависимости от текущего формата и типа СУБД." alt="" coords="322,55,431,79"/>
<area shape="poly" title=" " alt="" coords="260,101,319,82,321,87,261,106"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a53c8e7da5436bad14f32f64d5b532f60" title="Логирует результат анализа SQL&#45;запроса с помощью EXPLAIN или EXPLAIN ANALYZE." alt="" coords="330,104,423,129"/>
<area shape="poly" title=" " alt="" coords="275,114,315,114,315,119,275,119"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a8f393cc6e7e1b7e6394a9c2d4abdd8e7" title="Логирует медленные запросы, запросы без использования плейсхолдеров и другие запросы в таблицу логов." alt="" coords="335,153,418,178"/>
<area shape="poly" title=" " alt="" coords="261,127,321,146,319,151,260,132"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#ad620cb343252ceea735bab03860a0915" title="Производит преобразование SQL&#45;запроса из формата MySQL в целевой формат СУБД (PostgreSQL или SQLite)." alt="" coords="479,5,643,30"/>
<area shape="poly" title=" " alt="" coords="425,51,497,32,498,37,426,57"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a2e93ad3621ba0d7cf06d36c539b6c290" title="Производит преобразование SQL&#45;запроса из формата PostgreSQL в целевой формат СУБД (MySQL или SQLite)." alt="" coords="481,55,641,79"/>
<area shape="poly" title=" " alt="" coords="432,64,465,64,465,70,432,70"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a44e1aec00a15341cd9119261482eeb0d" title="Производит преобразование SQL&#45;запроса из формата SQLite в целевой формат СУБД (MySQL или PostgreSQL)." alt="" coords="481,104,641,129"/>
<area shape="poly" title=" " alt="" coords="426,77,498,97,497,102,425,83"/>
</map>
</div>
<div id="dynsection-40" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-40-trigger" src="../../closed.png" alt="+"/> Граф вызова функции:</div>
<div id="dynsection-40-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-40-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_a442c0348c8bd3cd7104cb110cc71348a_icgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a442c0348c8bd3cd7104cb110cc71348a_icgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a442c0348c8bd3cd7104cb110cc71348a_icgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a442c0348c8bd3cd7104cb110cc71348a_icgraph">
<area shape="rect" title="Формирует SQL&#45;запрос на вставку данных в таблицу, проверяет входные данные, обрабатывает различные ти..." alt="" coords="107,5,216,30"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a6e5af1f386c0c7968aa10ea928c7a110" title="Вставляет данные в таблицу через вызов внутреннего метода." alt="" coords="5,5,59,30"/>
<area shape="poly" title=" " alt="" coords="91,20,59,20,59,15,91,15"/>
</map>
</div>

</div>
</div>
<a id="aa3fbbc7c98d1c241e897f0bf80177d2b" name="aa3fbbc7c98d1c241e897f0bf80177d2b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa3fbbc7c98d1c241e897f0bf80177d2b">&#9670;&#160;</a></span>_join_internal()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">_join_internal </td>
          <td>(</td>
          <td class="paramtype">string|array</td>          <td class="paramname"><span class="paramname"><em>$select</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>$from_tbl</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">array</td>          <td class="paramname"><span class="paramname"><em>$join</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">array</td>          <td class="paramname"><span class="paramname"><em>$options</em></span><span class="paramdefsep"> = </span><span class="paramdefval">[]</span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel protected">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Формирует SQL-запрос с использованием JOIN для выборки данных из нескольких таблиц, проверяет входные данные, сохраняет текст запроса в свойстве <code>$txt_query</code> и выполняет его. </p>
<p>Этот метод выполняет следующие шаги:</p><ol type="1">
<li>Проверяет типы входных данных: <code>$select</code> (строка или массив), <code>$from_tbl</code> (строка), <code>$join</code> (массив), <code>$options</code> (массив).</li>
<li>Проверяет, что массив <code>$join</code> не пустой. Если массив пустой, выбрасывается исключение.</li>
<li>Обрабатывает список полей для выборки (<code>$select</code>):<ul>
<li>Если <code>$select</code> является строкой, она используется как есть.</li>
<li>Если <code>$select</code> является массивом, он преобразуется в строку с разделителем <code>,</code>. Каждое имя поля оборачивается в обратные кавычки ().</li>
</ul>
</li>
<li>Обрабатывает массив JOIN-операций (<code>$join</code>):<ul>
<li>Для каждой операции проверяется наличие имени таблицы (<code>table</code>) и условия (<code>on</code>).</li>
<li>Если тип JOIN не указан, используется <code>INNER</code> по умолчанию.</li>
</ul>
</li>
<li>Формирует базовый SQL-запрос с использованием JOIN-операций.</li>
<li>Добавляет условия WHERE, GROUP BY, ORDER BY и LIMIT, если они указаны в параметре <code>$options</code>.</li>
<li>Сохраняет сформированный запрос в свойстве <code>$txt_query</code>.</li>
<li>Выполняет запрос через метод <code>_execute_query</code>, передавая параметры <code>params</code> для подготовленного выражения.</li>
</ol>
<p>Использование параметров <code>params</code> является обязательным для подготовленных выражений, так как это обеспечивает защиту от SQL-инъекций и совместимость с различными СУБД. Этот метод является защищенным и предназначен для использования внутри класса или его наследников. Основная логика вызывается через публичный метод-редирект <code>join()</code>.</p>
<dl class="params"><dt>Аргументы</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string&#160;|&#160;array</td><td class="paramname">$select</td><td>Список полей для выборки. Может быть строкой (имя одного поля) или массивом (список полей). Если передан массив, он преобразуется в строку с разделителем <code>,</code>. Пример: "id", ["id", "name"]. Ограничения: массив не может быть пустым. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$from_tbl</td><td>Имя основной таблицы, из которой начинается выборка. Должно быть строкой, содержащей только допустимые имена таблиц без специальных символов. Ограничения: строка должна быть непустой. </td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$join</td><td>Массив описаний JOIN-операций. Каждый элемент массива должен содержать следующие ключи:<ul>
<li>table (string): Имя таблицы для JOIN. Должно быть строкой, содержащей только допустимые имена таблиц.</li>
<li>type (string, optional): Тип JOIN (например, INNER, LEFT, RIGHT). Если тип не указан, используется INNER по умолчанию.</li>
<li>on (string): Условие для JOIN. Должно быть строкой с допустимым условием сравнения полей. Если условие отсутствует, выбрасывается исключение. Пример: [['type' =&gt; 'INNER', 'table' =&gt; 'orders', 'on' =&gt; 'users.id = orders.user_id']]. Ограничения: массив не может быть пустым. </li>
</ul>
</td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$options</td><td>Массив дополнительных опций для формирования запроса. Поддерживаемые ключи:<ul>
<li>where (string|array|false): Условие WHERE.<ul>
<li>string - используется как есть.</li>
<li>array - преобразуется в SQL. Поддерживает простые условия (&lsquo;['поле&rsquo; =&gt; значение]<code>) и логические операторы (</code>'OR' =&gt; [...]<code>, </code>'NOT' =&gt; [...]<code>).</code></li>
<li><code>false - игнорируется.</code></li>
</ul>
</li>
<li><code>group (string|false): Группировка GROUP BY. Игнорируется, если false. Должна быть строкой.</code></li>
<li><code>order (string|false): Сортировка ORDER BY. Игнорируется, если false. Должна быть строкой.</code></li>
<li><code>limit (int|string|false): Ограничение LIMIT.<ul>
<li>int - прямое значение.</li>
<li>string - формат "OFFSET,COUNT".</li>
<li>false - игнорируется.</li>
</ul>
</code></li>
<li><code>params (array): Ассоциативный массив параметров ([":имя" =&gt; значение]). Обязателен для использования с условиями</code>where` и другими частями запроса, требующими подготовленных выражений. Обеспечивает защиту от SQL-инъекций. Может быть пустым массивом, если параметры не требуются.</li>
</ul>
</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Возвращает</dt><dd>bool Возвращает true, если запрос успешно выполнен (даже если результат пустой).</dd></dl>
<dl class="exception"><dt>Исключения</dt><dd>
  <table class="exception">
    <tr><td class="paramname">InvalidArgumentException</td><td>Выбрасывается, если:<ul>
<li><code>$from_tbl</code> не является строкой. Пример сообщения: Недопустимое имя таблицы | Ожидалась строка, получено: [тип]</li>
<li><code>$join</code> не является массивом. Пример сообщения: Недопустимый тип параметра join | Ожидался массив, получено: [тип]</li>
<li><code>$select</code> не является строкой или массивом. Пример сообщения: Недопустимый тип параметра select | Ожидалась строка или массив, получено: [тип]</li>
<li>Отсутствует имя таблицы (<code>table</code>) или условие (<code>on</code>) в описании JOIN. Пример сообщения: Отсутствует имя таблицы или условие для JOIN | Проверьте структуру массива $join</li>
<li><code>$options</code> не является массивом. Пример сообщения: Недопустимый тип параметра options | Ожидался массив, получено: [тип] </li>
</ul>
</td></tr>
    <tr><td class="paramname">Exception</td><td>Выбрасывается при ошибках выполнения запроса.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section warning"><dt>Предупреждения</dt><dd>Метод чувствителен к корректности входных данных. Неверные типы данных или некорректные значения могут привести к выбросу исключения. Убедитесь, что массив <code>$join</code> не пустой и содержит корректные данные. Использование параметров <code>params</code> для подготовленных выражений является обязательным для защиты от SQL-инъекций и обеспечения совместимости с различными СУБД. Игнорирование этого правила может привести к уязвимостям безопасности и неправильной работе с базой данных.</dd></dl>
<p>Пример использования метода _join_internal(): </p><div class="fragment"><div class="line"><span class="comment">// Безопасное использование с параметрами `params`</span></div>
<div class="line">$this-&gt;<a class="code hl_function" href="#aa3fbbc7c98d1c241e897f0bf80177d2b">_join_internal</a>(</div>
<div class="line">    [<span class="stringliteral">&#39;users.id&#39;</span>, <span class="stringliteral">&#39;users.name&#39;</span>, <span class="stringliteral">&#39;orders.order_date&#39;</span>],</div>
<div class="line">    <span class="stringliteral">&#39;users&#39;</span>,</div>
<div class="line">    [</div>
<div class="line">        [<span class="stringliteral">&#39;type&#39;</span> =&gt; <span class="stringliteral">&#39;INNER&#39;</span>, <span class="stringliteral">&#39;table&#39;</span> =&gt; <span class="stringliteral">&#39;orders&#39;</span>, <span class="stringliteral">&#39;on&#39;</span> =&gt; <span class="stringliteral">&#39;users.id = orders.user_id&#39;</span>],</div>
<div class="line">    ],</div>
<div class="line">    [</div>
<div class="line">        <span class="stringliteral">&#39;where&#39;</span> =&gt; [<span class="stringliteral">&#39;users.status&#39;</span> =&gt; 1],</div>
<div class="line">        <span class="stringliteral">&#39;params&#39;</span> =&gt; [<span class="stringliteral">&#39;:status&#39;</span> =&gt; 1],</div>
<div class="line">    ]</div>
<div class="line">);</div>
<div class="ttc" id="aclassPhotoRigma_1_1Classes_1_1Database_html_aa3fbbc7c98d1c241e897f0bf80177d2b"><div class="ttname"><a href="#aa3fbbc7c98d1c241e897f0bf80177d2b">PhotoRigma\Classes\Database\_join_internal</a></div><div class="ttdeci">_join_internal(string|array $select, string $from_tbl, array $join, array $options=[])</div><div class="ttdoc">Формирует SQL-запрос с использованием JOIN для выборки данных из нескольких таблиц,...</div><div class="ttdef"><b>Определения</b> <a href="../../d2/d89/Database_8php_source.html#l03289">Database.php:3289</a></div></div>
</div><!-- fragment --> <dl class="section see"><dt>См. также</dt><dd><a class="el" href="#a556a1b37f162e7e8b576b86c182c7309" title="Текст последнего SQL-запроса, сформированного методами класса">PhotoRigma\Classes\Database\$txt_query</a> Свойство, в которое помещается текст SQL-запроса. </dd>
<dd>
<a class="el" href="#aa2b6c23b3a70e9ef06c22d8a4885d69a" title="Выполняет SQL-запрос с использованием JOIN через вызов внутреннего метода.">PhotoRigma\Classes\Database\join()</a> Публичный метод-редирект для вызова этой логики. </dd>
<dd>
<a class="el" href="#a941629b86b9c9e34bc5926c0db2478b5" title="Выполняет SQL-запрос с использованием подготовленных выражений.">PhotoRigma\Classes\Database\_execute_query()</a> Выполняет SQL-запрос. </dd>
<dd>
<a class="el" href="#a852d15f131983e6f53045146bede2958" title="Формирует строку дополнений для SQL-запроса (например, WHERE, GROUP BY, ORDER BY, LIMIT).">PhotoRigma\Classes\Database\_build_conditions()</a> Формирует условия WHERE, GROUP BY, ORDER BY и LIMIT для запроса. </dd></dl>

<p class="definition">См. определение в файле <a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a> строка <a class="el" href="../../d2/d89/Database_8php_source.html#l03289">3289</a></p>

<p class="reference">Перекрестные ссылки <a class="el" href="../../d2/d89/Database_8php_source.html#l01104">_build_conditions()</a> и <a class="el" href="../../d2/d89/Database_8php_source.html#l01393">_execute_query()</a>.</p>

<p class="reference">Используется в <a class="el" href="../../d2/d89/Database_8php_source.html#l03165">join()</a>.</p>
<div id="dynsection-41" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-41-trigger" src="../../closed.png" alt="+"/> Граф вызовов:</div>
<div id="dynsection-41-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-41-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_aa3fbbc7c98d1c241e897f0bf80177d2b_cgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_aa3fbbc7c98d1c241e897f0bf80177d2b_cgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_aa3fbbc7c98d1c241e897f0bf80177d2b_cgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_aa3fbbc7c98d1c241e897f0bf80177d2b_cgraph">
<area shape="rect" title="Формирует SQL&#45;запрос с использованием JOIN для выборки данных из нескольких таблиц,..." alt="" coords="5,56,103,81"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a852d15f131983e6f53045146bede2958" title="Формирует строку дополнений для SQL&#45;запроса (например, WHERE, GROUP BY, ORDER BY, LIMIT)." alt="" coords="151,19,272,43"/>
<area shape="poly" title=" " alt="" coords="102,54,141,45,142,50,104,59"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a941629b86b9c9e34bc5926c0db2478b5" title="Выполняет SQL&#45;запрос с использованием подготовленных выражений." alt="" coords="156,80,267,105"/>
<area shape="poly" title=" " alt="" coords="103,73,141,79,140,84,103,78"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a24acdb048ce17d880bd12b0f74567352" title="Формирует группу условий для WHERE с указанным оператором (OR/NOT)." alt="" coords="320,5,456,30"/>
<area shape="poly" title=" " alt="" coords="272,24,304,21,305,27,273,29"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#af1b08f0490df0963b0daac6690d4765f" title="Выполняет преобразование SQL&#45;запроса в зависимости от текущего формата и типа СУБД." alt="" coords="334,55,443,79"/>
<area shape="poly" title=" " alt="" coords="267,82,318,74,318,80,268,87"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a53c8e7da5436bad14f32f64d5b532f60" title="Логирует результат анализа SQL&#45;запроса с помощью EXPLAIN или EXPLAIN ANALYZE." alt="" coords="342,104,434,129"/>
<area shape="poly" title=" " alt="" coords="268,97,327,105,326,111,267,103"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a8f393cc6e7e1b7e6394a9c2d4abdd8e7" title="Логирует медленные запросы, запросы без использования плейсхолдеров и другие запросы в таблицу логов." alt="" coords="346,153,430,178"/>
<area shape="poly" title=" " alt="" coords="241,103,321,138,339,145,337,150,319,143,239,108"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#ad620cb343252ceea735bab03860a0915" title="Производит преобразование SQL&#45;запроса из формата MySQL в целевой формат СУБД (PostgreSQL или SQLite)." alt="" coords="504,5,668,30"/>
<area shape="poly" title=" " alt="" coords="440,51,518,32,519,37,441,57"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a2e93ad3621ba0d7cf06d36c539b6c290" title="Производит преобразование SQL&#45;запроса из формата PostgreSQL в целевой формат СУБД (MySQL или SQLite)." alt="" coords="506,55,666,79"/>
<area shape="poly" title=" " alt="" coords="443,64,490,64,490,70,443,70"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a44e1aec00a15341cd9119261482eeb0d" title="Производит преобразование SQL&#45;запроса из формата SQLite в целевой формат СУБД (MySQL или PostgreSQL)." alt="" coords="506,104,666,129"/>
<area shape="poly" title=" " alt="" coords="441,77,519,97,518,102,440,83"/>
</map>
</div>
<div id="dynsection-42" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-42-trigger" src="../../closed.png" alt="+"/> Граф вызова функции:</div>
<div id="dynsection-42-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-42-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_aa3fbbc7c98d1c241e897f0bf80177d2b_icgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_aa3fbbc7c98d1c241e897f0bf80177d2b_icgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_aa3fbbc7c98d1c241e897f0bf80177d2b_icgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_aa3fbbc7c98d1c241e897f0bf80177d2b_icgraph">
<area shape="rect" title="Формирует SQL&#45;запрос с использованием JOIN для выборки данных из нескольких таблиц,..." alt="" coords="95,5,192,30"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#aa2b6c23b3a70e9ef06c22d8a4885d69a" title="Выполняет SQL&#45;запрос с использованием JOIN через вызов внутреннего метода." alt="" coords="5,5,47,30"/>
<area shape="poly" title=" " alt="" coords="79,20,47,20,47,15,79,15"/>
</map>
</div>

</div>
</div>
<a id="a53c8e7da5436bad14f32f64d5b532f60" name="a53c8e7da5436bad14f32f64d5b532f60"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a53c8e7da5436bad14f32f64d5b532f60">&#9670;&#160;</a></span>_log_explain()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">_log_explain </td>
          <td>(</td>
          <td class="paramtype">array</td>          <td class="paramname"><span class="paramname"><em>$params</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel private">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Логирует результат анализа SQL-запроса с помощью EXPLAIN или EXPLAIN ANALYZE. </p>
<p>Этот приватный метод выполняет анализ текущего SQL-запроса, хранящегося в свойстве <code>$this-&gt;txt_query</code>, с помощью команды <code>EXPLAIN</code> или <code>EXPLAIN ANALYZE</code>, и логирует полученный результат.</p>
<p>Алгоритм работы:</p><ol type="1">
<li>Определяет тип команды анализа (<code>EXPLAIN</code> или <code>EXPLAIN ANALYZE</code>) в зависимости от типа текущей СУБД (<code>$this-&gt;db_type</code>), версии СУБД (для MySQL/MariaDB) и типа запроса (WRITE или SELECT для PostgreSQL/MySQL).<ul>
<li>Для SQLite всегда используется только <code>EXPLAIN</code>.</li>
<li>Для MySQL/MariaDB: <code>EXPLAIN ANALYZE</code> используется только для SELECT-запросов на MySQL &gt;= 5.7 (не MariaDB). В остальных случаях - <code>EXPLAIN</code>.</li>
<li>Для PostgreSQL: <code>EXPLAIN ANALYZE</code> используется для SELECT-запросов, <code>EXPLAIN</code> - для WRITE-запросов.</li>
</ul>
</li>
<li>Выполняет команду анализа (<code>EXPLAIN ...</code> или <code>EXPLAIN ANALYZE ...</code>) с использованием объекта PDO (<code>$this-&gt;pdo</code>) и переданных параметров <code>$params</code>.</li>
<li>Извлекает строки результата анализа и форматирует их для удобства чтения (ключ: значение).</li>
<li>Логирует результат анализа, исходный текст запроса (<code>$this-&gt;txt_query</code>) и переданные параметры <code>$params</code> с использованием функции <code>log_in_file()</code>.</li>
<li>В случае ошибки при определении версии СУБД или выполнении команды анализа, также логируется сообщение об ошибке.</li>
</ol>
<p>Этот метод является приватным и предназначен только для использования внутри класса. Вызывается из метода <code>_execute_query()</code>, если включена константа <code>SQL_ANALYZE</code>.</p>
<dl class="params"><dt>Аргументы</dt><dd>
  <table class="params">
    <tr><td class="paramtype">array</td><td class="paramname">$params</td><td>Ассоциативный массив параметров для подготовленного запроса (такой же, как передается в <code>_execute_query()</code>). Пример: &lsquo;[&rsquo;:id' =&gt; 1, ':name' =&gt; 'John Doe']<code>. Ключи массива должны соответствовать именам плейсхолдеров в</code>$this-&gt;txt_query<code>. Если параметры отсутствуют, можно передать пустой массив (</code>[]`).</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Возвращает</dt><dd>void Метод ничего не возвращает. Результат анализа логируется.</dd></dl>
<dl class="exception"><dt>Исключения</dt><dd>
  <table class="exception">
    <tr><td class="paramname">InvalidArgumentException</td><td>Выбрасывается, если тип текущей СУБД (<code>$this-&gt;db_type</code>) не поддерживается методом <code>_log_explain</code> для определения типа команды анализа. Пример сообщения: Не поддерживаемый тип СУБД | Тип: [db_type] </td></tr>
    <tr><td class="paramname">Exception</td><td>Выбрасывается, если произошла ошибка при получении версии СУБД (для MySQL/MariaDB) или при выполнении команды EXPLAIN/EXPLAIN ANALYZE (например, синтаксическая ошибка в запросе на уровне PDO). В случае выброса исключения, оно перехватывается внутри метода и логируется.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Заметки</dt><dd>Метод использует объект PDO (<code>$this-&gt;pdo</code>) для выполнения команд анализа и функцию <code>log_in_file()</code> для записи результатов и ошибок. Результат анализа форматируется для удобства чтения. При возникновении ошибки логируются текст запроса, параметры и сообщение об ошибке из пойманного исключения. Поведение метода зависит от константы <code>SQL_ANALYZE</code>.</dd></dl>
<dl class="section warning"><dt>Предупреждения</dt><dd>Убедитесь, что свойство <code>$this-&gt;txt_query</code> содержит синтаксически корректный SQL-запрос перед вызовом метода, чтобы избежать ошибок при выполнении команды анализа. Метод предполагает, что соединение с базой данных <code>$this-&gt;pdo</code> установлено.</dd></dl>
<p>Пример вызова метода внутри класса (например, из _execute_query()): </p><div class="fragment"><div class="line"><span class="comment">// Предположим:</span></div>
<div class="line"><span class="comment">// $this-&gt;txt_query = &quot;SELECT * FROM users WHERE id = :id&quot;;</span></div>
<div class="line"><span class="comment">// $this-&gt;db_type = &#39;mysql&#39;; // или &#39;pgsql&#39;</span></div>
<div class="line"><span class="comment">// $params = [&#39;:id&#39; =&gt; 1];</span></div>
<div class="line"><span class="comment">// SQL_ANALYZE = true</span></div>
<div class="line"> </div>
<div class="line">$this-&gt;<a class="code hl_function" href="#a53c8e7da5436bad14f32f64d5b532f60">_log_explain</a>($params);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// В файл лога будет записан отчет по анализу, содержащий:</span></div>
<div class="line"><span class="comment">// - Использованную команду анализа (EXPLAIN или EXPLAIN ANALYZE)</span></div>
<div class="line"><span class="comment">// - Текст запроса</span></div>
<div class="line"><span class="comment">// - Параметры запроса (в формате JSON)</span></div>
<div class="line"><span class="comment">// - Результат анализа (строки, отформатированные ключ: значение)</span></div>
<div class="ttc" id="aclassPhotoRigma_1_1Classes_1_1Database_html_a53c8e7da5436bad14f32f64d5b532f60"><div class="ttname"><a href="#a53c8e7da5436bad14f32f64d5b532f60">PhotoRigma\Classes\Database\_log_explain</a></div><div class="ttdeci">_log_explain(array $params)</div><div class="ttdoc">Логирует результат анализа SQL-запроса с помощью EXPLAIN или EXPLAIN ANALYZE.</div><div class="ttdef"><b>Определения</b> <a href="../../d2/d89/Database_8php_source.html#l01885">Database.php:1885</a></div></div>
</div><!-- fragment --> <dl class="section see"><dt>См. также</dt><dd><a class="el" href="../../db/d02/namespacePhotoRigma_1_1Include.html#a2d74c46a21e4ce612a98eee60981aef0" title="Записывает сообщение об ошибке в лог-файл и, при необходимости, завершает выполнение скрипта.">PhotoRigma\Include\log_in_file()</a> Функция для логирования сообщений в файл. </dd>
<dd>
<a class="el" href="#a556a1b37f162e7e8b576b86c182c7309" title="Текст последнего SQL-запроса, сформированного методами класса">PhotoRigma\Classes\Database\$txt_query</a> Свойство, содержащее текст SQL-запроса для анализа. </dd>
<dd>
<a class="el" href="#a9db61e1721b616500bce6ed60491752a" title="Объект PDO для подключения к базе данных">PhotoRigma\Classes\Database\$pdo</a> Объект PDO, используемый для выполнения команды анализа. </dd>
<dd>
<a class="el" href="#a072c45961a79433ff94013278707ade5" title="Тип базы данных (mysql, pgsql, sqlite)">PhotoRigma\Classes\Database\$db_type</a> Свойство, определяющее тип используемой СУБД. </dd>
<dd>
<a class="el" href="#a941629b86b9c9e34bc5926c0db2478b5" title="Выполняет SQL-запрос с использованием подготовленных выражений.">PhotoRigma\Classes\Database\_execute_query()</a> Приватный метод, из которого вызывается данный метод (при SQL_ANALYZE=true). </dd></dl>

<p class="definition">См. определение в файле <a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a> строка <a class="el" href="../../d2/d89/Database_8php_source.html#l01885">1885</a></p>

<p class="reference">Используется в <a class="el" href="../../d2/d89/Database_8php_source.html#l01393">_execute_query()</a>.</p>
<div id="dynsection-43" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-43-trigger" src="../../closed.png" alt="+"/> Граф вызова функции:</div>
<div id="dynsection-43-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-43-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_a53c8e7da5436bad14f32f64d5b532f60_icgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a53c8e7da5436bad14f32f64d5b532f60_icgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a53c8e7da5436bad14f32f64d5b532f60_icgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a53c8e7da5436bad14f32f64d5b532f60_icgraph">
<area shape="rect" title="Логирует результат анализа SQL&#45;запроса с помощью EXPLAIN или EXPLAIN ANALYZE." alt="" coords="453,129,546,154"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a941629b86b9c9e34bc5926c0db2478b5" title="Выполняет SQL&#45;запрос с использованием подготовленных выражений." alt="" coords="294,129,405,154"/>
<area shape="poly" title=" " alt="" coords="438,144,406,144,406,139,438,139"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#aa4094e522b4780bd58666dba20fdd09d" title="Формирует SQL&#45;запрос на удаление данных из таблицы, проверяет входные данные, обрабатывает недопустим..." alt="" coords="128,5,240,30"/>
<area shape="poly" title=" " alt="" coords="326,120,290,82,245,45,221,33,224,28,247,41,294,78,330,116"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a442c0348c8bd3cd7104cb110cc71348a" title="Формирует SQL&#45;запрос на вставку данных в таблицу, проверяет входные данные, обрабатывает различные ти..." alt="" coords="129,55,238,79"/>
<area shape="poly" title=" " alt="" coords="308,124,245,95,216,82,218,77,247,90,310,120"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#aa3fbbc7c98d1c241e897f0bf80177d2b" title="Формирует SQL&#45;запрос с использованием JOIN для выборки данных из нескольких таблиц,..." alt="" coords="135,104,232,129"/>
<area shape="poly" title=" " alt="" coords="278,133,233,126,233,121,279,128"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a3e40bb61553455b6f52be0ab9a6062b1" title="Формирует SQL&#45;запрос на выборку данных из таблицы, основываясь на полученных аргументах,..." alt="" coords="128,153,240,178"/>
<area shape="poly" title=" " alt="" coords="279,155,241,160,240,155,278,149"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#ad353291f086236ab7be0d1edc0ed3ba8" title="Формирует SQL&#45;запрос на очистку таблицы (TRUNCATE), размещает его в свойстве $txt_query и выполняет." alt="" coords="122,203,246,227"/>
<area shape="poly" title=" " alt="" coords="309,163,247,192,218,205,216,200,245,187,307,159"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#ab1dc7ae1ce60a864b1d7c865e99029b0" title="Формирует SQL&#45;запрос на обновление данных в таблице, основываясь на полученных аргументах,..." alt="" coords="126,252,242,277"/>
<area shape="poly" title=" " alt="" coords="329,168,293,205,247,241,224,254,221,249,245,237,290,201,326,164"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a73d8e6acdfb996002f980ab7c9c18515" title="Удаляет данные из таблицы через вызов внутреннего метода." alt="" coords="11,5,68,30"/>
<area shape="poly" title=" " alt="" coords="112,20,68,20,68,15,112,15"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a6e5af1f386c0c7968aa10ea928c7a110" title="Вставляет данные в таблицу через вызов внутреннего метода." alt="" coords="13,55,66,79"/>
<area shape="poly" title=" " alt="" coords="113,70,67,70,67,64,113,64"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#aa2b6c23b3a70e9ef06c22d8a4885d69a" title="Выполняет SQL&#45;запрос с использованием JOIN через вызов внутреннего метода." alt="" coords="19,104,60,129"/>
<area shape="poly" title=" " alt="" coords="119,119,61,119,61,114,119,114"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#aab30d2495bb1362d218cd62e1556b13e" title="Выполняет SQL&#45;запрос на выборку данных из таблицы." alt="" coords="11,153,68,178"/>
<area shape="poly" title=" " alt="" coords="112,168,68,168,68,163,112,163"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#ad4d4e455d9e4bf865126c72cf23a517b" title="Очищает таблицу (TRUNCATE) через вызов внутреннего метода." alt="" coords="5,203,74,227"/>
<area shape="poly" title=" " alt="" coords="106,218,74,218,74,212,106,212"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a539e51bc2144b972bfafeccdda56ee9e" title="Обновляет данные в таблице через вызов внутреннего метода." alt="" coords="9,252,70,277"/>
<area shape="poly" title=" " alt="" coords="110,267,70,267,70,262,110,262"/>
</map>
</div>

</div>
</div>
<a id="a8f393cc6e7e1b7e6394a9c2d4abdd8e7" name="a8f393cc6e7e1b7e6394a9c2d4abdd8e7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8f393cc6e7e1b7e6394a9c2d4abdd8e7">&#9670;&#160;</a></span>_log_query()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">_log_query </td>
          <td>(</td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>$reason</em></span><span class="paramdefsep"> = </span><span class="paramdefval">'other'</span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">?float</td>          <td class="paramname"><span class="paramname"><em>$execution_time_ms</em></span><span class="paramdefsep"> = </span><span class="paramdefval">null</span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel private">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Логирует медленные запросы, запросы без использования плейсхолдеров и другие запросы в таблицу логов. </p>
<p>Этот приватный метод выполняет логирование информации о SQL-запросах в специализированную таблицу логов (<code>TBL_LOG_QUERY</code>). Алгоритм работы:</p><ol type="1">
<li>Выполняет начальные проверки: убеждается, что <code>$this-&gt;txt_query</code> является непустой строкой и не содержит имени таблицы логов, чтобы избежать рекурсивного логирования.</li>
<li>Нормализует переданное время выполнения <code>$execution_time_ms</code>, гарантируя, что оно является неотрицательным числом.</li>
<li>Обрезает текст запроса <code>$this-&gt;txt_query</code> до максимальной длины (<code>$max_query_length</code>, по умолчанию 65530 символов), чтобы соответствовать размеру поля в базе данных (например, TEXT в MySQL), добавляя суффикс "..." при обрезке.</li>
<li>Вычисляет MD5-хэш от полного текста запроса (<code>$this-&gt;txt_query</code>) для последующей идентификации дубликатов.</li>
<li>Валидирует переданную причину логирования <code>$reason</code>, используя <code>match</code> для ограничения допустимых значений ('slow', 'no_placeholders', 'other'). Если значение некорректно, используется 'other'.</li>
<li>Проверяет наличие хэша запроса в кэше <code>$this-&gt;query_cache</code> для оптимизации. Если хэш не найден в кэше, выполняется запрос к таблице логов <code>TBL_LOG_QUERY</code> для проверки существования записи с таким хэшем, и результат сохраняется в кэше.</li>
<li>На основе результата проверки в кэше логирует или обновляет запись в таблице логов:<ul>
<li>Если запись с таким хэшем уже существует (найдена в кэше/БД), обновляет поля <code>usage_count</code> (увеличивает на 1), <code>last_used_at</code> (устанавливает текущее время) и <code>execution_time</code> (обновляет только если переданное <code>$execution_time_ms</code> больше сохраненного).</li>
<li>Если запись не существует, вставляет новую строку с хэшем, обрезанным текстом запроса, причиной и временем выполнения.</li>
</ul>
</li>
</ol>
<p>Этот метод является приватным и предназначен только для использования внутри класса <code>Database</code>. Вызывается из метода <code>_execute_query()</code> при выполнении определенных условий логирования (<code>SQL_LOG</code>).</p>
<dl class="params"><dt>Аргументы</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$reason</td><td>Причина логирования запроса. Допустимые значения: 'slow', 'no_placeholders', 'other'. Некорректные значения преобразуются в 'other'. По умолчанию: 'other'. Пример: 'slow'. </td></tr>
    <tr><td class="paramtype">float&#160;|&#160;null</td><td class="paramname">$execution_time_ms</td><td>Время выполнения запроса в миллисекундах. Должно быть положительным числом или <code>null</code>. Используется для записи или обновления максимального времени выполнения в логах. По умолчанию: <code>null</code>. Пример: 1200.5.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Возвращает</dt><dd>void Метод ничего не возвращает.</dd></dl>
<dl class="exception"><dt>Исключения</dt><dd>
  <table class="exception">
    <tr><td class="paramname">PDOException</td><td>Выбрасывается, если произошла ошибка при работе с базой данных в процессе выполнения запросов INSERT или UPDATE к таблице логов <code>TBL_LOG_QUERY</code> (например, проблемы с подключением или выполнением запроса). Пример сообщения: Ошибка при работе с таблицей логов запросов | Таблица: [TBL_LOG_QUERY] | Сообщение PDO: [текст ошибки]</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Заметки</dt><dd>Метод активно использует кэширование (<code>$this-&gt;query_cache</code>) для оптимизации проверки существования запросов в базе данных. Запросы хэшируются с помощью <code>md5()</code> для идентификации уникальных запросов и предотвращения дублирования записей. Длинные запросы обрезаются для соответствия ограничению поля в базе данных. Поведение метода и целевая таблица определяются константой <code>TBL_LOG_QUERY</code>.</dd></dl>
<dl class="section warning"><dt>Предупреждения</dt><dd>Убедитесь, что константа <code>TBL_LOG_QUERY</code> определена и указывает на существующую таблицу с подходящей структурой. Также учтите, что слишком длинные запросы будут обрезаны до <code>$max_query_length</code> символов перед сохранением.</dd></dl>
<p>Пример вызова метода _log_query() внутри класса (например, из _execute_query()): </p><div class="fragment"><div class="line"><span class="comment">// Предположим:</span></div>
<div class="line"><span class="comment">// $this-&gt;txt_query содержит текст выполненного запроса</span></div>
<div class="line"><span class="comment">// $execution_time_ms содержит время выполнения в мс</span></div>
<div class="line"><span class="comment">// SQL_LOG = true</span></div>
<div class="line"><span class="comment">// TBL_LOG_QUERY определена</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Логирование медленного запроса (если $execution_time_ms &gt; 200)</span></div>
<div class="line"><span class="keywordflow">if</span> ($execution_time_ms &gt; 200) {</div>
<div class="line">    $this-&gt;<a class="code hl_function" href="#a8f393cc6e7e1b7e6394a9c2d4abdd8e7">_log_query</a>(<span class="stringliteral">&#39;slow&#39;</span>, $execution_time_ms);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Логирование запроса без плейсхолдеров (если $params был пуст)</span></div>
<div class="line"><span class="comment">// else if (empty($params)) { // ... применимо, если не был медленным</span></div>
<div class="line"><span class="comment">//     $this-&gt;_log_query(&#39;no_placeholders&#39;, $execution_time_ms); // Время выполнения все равно полезно</span></div>
<div class="line"><span class="comment">// }</span></div>
<div class="ttc" id="aclassPhotoRigma_1_1Classes_1_1Database_html_a8f393cc6e7e1b7e6394a9c2d4abdd8e7"><div class="ttname"><a href="#a8f393cc6e7e1b7e6394a9c2d4abdd8e7">PhotoRigma\Classes\Database\_log_query</a></div><div class="ttdeci">_log_query(string $reason=&#39;other&#39;, ?float $execution_time_ms=null)</div><div class="ttdoc">Логирует медленные запросы, запросы без использования плейсхолдеров и другие запросы в таблицу логов.</div><div class="ttdef"><b>Определения</b> <a href="../../d2/d89/Database_8php_source.html#l02057">Database.php:2057</a></div></div>
</div><!-- fragment --> <dl class="section see"><dt>См. также</dt><dd><a class="el" href="#a556a1b37f162e7e8b576b86c182c7309" title="Текст последнего SQL-запроса, сформированного методами класса">PhotoRigma\Classes\Database\$txt_query</a> Свойство, содержащее текст SQL-запроса, который логируется. </dd>
<dd>
<a class="el" href="#a9db61e1721b616500bce6ed60491752a" title="Объект PDO для подключения к базе данных">PhotoRigma\Classes\Database\$pdo</a> Объект PDO, используемый для выполнения запросов к таблице логов. </dd>
<dd>
<a class="el" href="#aa40b201d601e6753def247ae8fda39e3" title="Кэш для хранения результатов проверки существования запросов">PhotoRigma\Classes\Database\$query_cache</a> Внутреннее свойство, используемое для кэширования результатов проверки существования запросов. </dd>
<dd>
<a class="el" href="#a941629b86b9c9e34bc5926c0db2478b5" title="Выполняет SQL-запрос с использованием подготовленных выражений.">PhotoRigma\Classes\Database\_execute_query()</a> Приватный метод, из которого вызывается данный метод. </dd></dl>

<p class="definition">См. определение в файле <a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a> строка <a class="el" href="../../d2/d89/Database_8php_source.html#l02057">2057</a></p>

<p class="reference">Перекрестные ссылки <a class="el" href="../../d2/d89/Database_8php_source.html#l00205">$txt_query</a>.</p>

<p class="reference">Используется в <a class="el" href="../../d2/d89/Database_8php_source.html#l01393">_execute_query()</a>.</p>
<div id="dynsection-44" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-44-trigger" src="../../closed.png" alt="+"/> Граф вызова функции:</div>
<div id="dynsection-44-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-44-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_a8f393cc6e7e1b7e6394a9c2d4abdd8e7_icgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a8f393cc6e7e1b7e6394a9c2d4abdd8e7_icgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a8f393cc6e7e1b7e6394a9c2d4abdd8e7_icgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a8f393cc6e7e1b7e6394a9c2d4abdd8e7_icgraph">
<area shape="rect" title="Логирует медленные запросы, запросы без использования плейсхолдеров и другие запросы в таблицу логов." alt="" coords="453,129,537,154"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a941629b86b9c9e34bc5926c0db2478b5" title="Выполняет SQL&#45;запрос с использованием подготовленных выражений." alt="" coords="294,129,405,154"/>
<area shape="poly" title=" " alt="" coords="438,144,406,144,406,139,438,139"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#aa4094e522b4780bd58666dba20fdd09d" title="Формирует SQL&#45;запрос на удаление данных из таблицы, проверяет входные данные, обрабатывает недопустим..." alt="" coords="128,5,240,30"/>
<area shape="poly" title=" " alt="" coords="326,120,290,82,245,45,221,33,224,28,247,41,294,78,330,116"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a442c0348c8bd3cd7104cb110cc71348a" title="Формирует SQL&#45;запрос на вставку данных в таблицу, проверяет входные данные, обрабатывает различные ти..." alt="" coords="129,55,238,79"/>
<area shape="poly" title=" " alt="" coords="308,124,245,95,216,82,218,77,247,90,310,120"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#aa3fbbc7c98d1c241e897f0bf80177d2b" title="Формирует SQL&#45;запрос с использованием JOIN для выборки данных из нескольких таблиц,..." alt="" coords="135,104,232,129"/>
<area shape="poly" title=" " alt="" coords="278,133,233,126,233,121,279,128"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a3e40bb61553455b6f52be0ab9a6062b1" title="Формирует SQL&#45;запрос на выборку данных из таблицы, основываясь на полученных аргументах,..." alt="" coords="128,153,240,178"/>
<area shape="poly" title=" " alt="" coords="279,155,241,160,240,155,278,149"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#ad353291f086236ab7be0d1edc0ed3ba8" title="Формирует SQL&#45;запрос на очистку таблицы (TRUNCATE), размещает его в свойстве $txt_query и выполняет." alt="" coords="122,203,246,227"/>
<area shape="poly" title=" " alt="" coords="309,163,247,192,218,205,216,200,245,187,307,159"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#ab1dc7ae1ce60a864b1d7c865e99029b0" title="Формирует SQL&#45;запрос на обновление данных в таблице, основываясь на полученных аргументах,..." alt="" coords="126,252,242,277"/>
<area shape="poly" title=" " alt="" coords="329,168,293,205,247,241,224,254,221,249,245,237,290,201,326,164"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a73d8e6acdfb996002f980ab7c9c18515" title="Удаляет данные из таблицы через вызов внутреннего метода." alt="" coords="11,5,68,30"/>
<area shape="poly" title=" " alt="" coords="112,20,68,20,68,15,112,15"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a6e5af1f386c0c7968aa10ea928c7a110" title="Вставляет данные в таблицу через вызов внутреннего метода." alt="" coords="13,55,66,79"/>
<area shape="poly" title=" " alt="" coords="113,70,67,70,67,64,113,64"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#aa2b6c23b3a70e9ef06c22d8a4885d69a" title="Выполняет SQL&#45;запрос с использованием JOIN через вызов внутреннего метода." alt="" coords="19,104,60,129"/>
<area shape="poly" title=" " alt="" coords="119,119,61,119,61,114,119,114"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#aab30d2495bb1362d218cd62e1556b13e" title="Выполняет SQL&#45;запрос на выборку данных из таблицы." alt="" coords="11,153,68,178"/>
<area shape="poly" title=" " alt="" coords="112,168,68,168,68,163,112,163"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#ad4d4e455d9e4bf865126c72cf23a517b" title="Очищает таблицу (TRUNCATE) через вызов внутреннего метода." alt="" coords="5,203,74,227"/>
<area shape="poly" title=" " alt="" coords="106,218,74,218,74,212,106,212"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a539e51bc2144b972bfafeccdda56ee9e" title="Обновляет данные в таблице через вызов внутреннего метода." alt="" coords="9,252,70,277"/>
<area shape="poly" title=" " alt="" coords="110,267,70,267,70,262,110,262"/>
</map>
</div>

</div>
</div>
<a id="a31eb9243149eec0d8676bbcf7289538d" name="a31eb9243149eec0d8676bbcf7289538d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a31eb9243149eec0d8676bbcf7289538d">&#9670;&#160;</a></span>_result_array_internal()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">_result_array_internal </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel protected">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Извлекает все строки результата из подготовленного выражения, хранящегося в свойстве <code>$res_query</code>, и возвращает их как массив. </p>
<p>Этот защищённый метод выполняет следующие шаги:</p><ol type="1">
<li>Проверяет, что свойство <code>$this-&gt;res_query</code> установлено и является объектом типа <code>PDOStatement</code>. Если это не так, выбрасывается исключение InvalidArgumentException.</li>
<li>Использует метод <code>fetchAll(PDO::FETCH_ASSOC)</code> для извлечения всех строк результата из <code>$this-&gt;res_query</code> в виде массива ассоциативных массивов.</li>
<li>Если результатов нет (метод <code>fetchAll()</code> возвращает пустой массив), явно возвращается <code>false</code>.</li>
<li>В противном случае возвращается массив, содержащий все строки результата.</li>
</ol>
<p>Метод только читает значение свойства <code>$this-&gt;res_query</code> и не выполняет дополнительной логики для его обновления. Значение <code>$this-&gt;res_query</code> должно быть установлено внешними методами, такими как <code>_execute_query()</code>, <code>delete()</code>, <code>update()</code> или <code>insert()</code>. Этот метод является защищенным и предназначен для использования внутри класса или его наследников. Основная логика вызывается через публичный метод-редирект <code>result_array()</code>.</p>
<dl class="section return"><dt>Возвращает</dt><dd>array|false Возвращает массив ассоциативных массивов, содержащих данные всех строк результата, если они доступны. Если результатов нет (запрос не вернул строк), возвращает <code>false</code>.</dd></dl>
<dl class="exception"><dt>Исключения</dt><dd>
  <table class="exception">
    <tr><td class="paramname">InvalidArgumentException</td><td>Выбрасывается, если:<ul>
<li>Свойство <code>$this-&gt;res_query</code> не установлено (т.е. не был выполнен запрос, устанавливающий его). Пример сообщения: Результат запроса недоступен | Причина: Свойство $res_query не установлено</li>
<li>Свойство <code>$this-&gt;res_query</code> не является объектом типа <code>PDOStatement</code> (указывает на некорректное состояние). Пример сообщения: Недопустимый тип результата запроса | Ожидался объект PDOStatement, получено: [тип]</li>
</ul>
</td></tr>
  </table>
  </dd>
</dl>
<dl class="section warning"><dt>Предупреждения</dt><dd>Метод чувствителен к состоянию свойства <code>$this-&gt;res_query</code>. Убедитесь, что перед вызовом метода был выполнен запрос (например, SELECT), который корректно установил значение <code>$this-&gt;res_query</code> как объект <code>PDOStatement</code>.</dd></dl>
<p>Пример использования метода _result_array_internal(): </p><div class="fragment"><div class="line"><span class="comment">// Предполагается, что перед этим был выполнен SELECT запрос, например:</span></div>
<div class="line"><span class="comment">// $db-&gt;select([&#39;id&#39;, &#39;name&#39;], &#39;users&#39;, [&#39;where&#39; =&gt; &#39;status = 1&#39;]);</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Получаем все строки результата в виде массива</span></div>
<div class="line">$results = $this-&gt;<a class="code hl_function" href="#a31eb9243149eec0d8676bbcf7289538d">_result_array_internal</a>();</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> ($results !== <span class="keyword">false</span>) {</div>
<div class="line">    <span class="keywordflow">foreach</span> ($results as $row) {</div>
<div class="line">        echo <span class="stringliteral">&quot;ID: &quot;</span> . $row[<span class="stringliteral">&#39;id&#39;</span>] . <span class="stringliteral">&quot;, Name: &quot;</span> . $row[<span class="stringliteral">&#39;name&#39;</span>] . <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">    }</div>
<div class="line">} <span class="keywordflow">else</span> {</div>
<div class="line">    echo <span class="stringliteral">&quot;No results found.&quot;</span>;</div>
<div class="line">}</div>
<div class="ttc" id="aclassPhotoRigma_1_1Classes_1_1Database_html_a31eb9243149eec0d8676bbcf7289538d"><div class="ttname"><a href="#a31eb9243149eec0d8676bbcf7289538d">PhotoRigma\Classes\Database\_result_array_internal</a></div><div class="ttdeci">_result_array_internal()</div><div class="ttdoc">Извлекает все строки результата из подготовленного выражения, хранящегося в свойстве $res_query,...</div><div class="ttdef"><b>Определения</b> <a href="../../d2/d89/Database_8php_source.html#l03446">Database.php:3446</a></div></div>
</div><!-- fragment --> <dl class="section see"><dt>См. также</dt><dd><a class="el" href="#ae87877e5a83ed158cdad137dd27b1ac8" title="Результат выполнения подготовленного выражения (PDOStatement)">PhotoRigma\Classes\Database\$res_query</a> Свойство, хранящее результат подготовленного выражения (объект PDOStatement). </dd>
<dd>
<a class="el" href="#a941629b86b9c9e34bc5926c0db2478b5" title="Выполняет SQL-запрос с использованием подготовленных выражений.">PhotoRigma\Classes\Database\_execute_query()</a> Метод нижнего уровня, который устанавливает значение <code>$res_query</code> после выполнения запроса. </dd>
<dd>
<a class="el" href="#aab30d2495bb1362d218cd62e1556b13e" title="Выполняет SQL-запрос на выборку данных из таблицы.">PhotoRigma\Classes\Database\select()</a> Метод, который может использовать <code>_result_array_internal()</code> для получения результатов SELECT-запроса. </dd>
<dd>
<a class="el" href="#aa2b6c23b3a70e9ef06c22d8a4885d69a" title="Выполняет SQL-запрос с использованием JOIN через вызов внутреннего метода.">PhotoRigma\Classes\Database\join()</a> Метод, который может использовать <code>_result_array_internal()</code> для получения результатов SELECT-запроса с использованием JOIN. </dd>
<dd>
<a class="el" href="#a444f7dd61bfbe3931a7188adad61feae" title="Извлекает все строки результата из подготовленного выражения.">PhotoRigma\Classes\Database\result_array()</a> Публичный метод-редирект для вызова этой логики. </dd></dl>

<p class="definition">См. определение в файле <a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a> строка <a class="el" href="../../d2/d89/Database_8php_source.html#l03446">3446</a></p>

<p class="reference">Используется в <a class="el" href="../../d2/d89/Database_8php_source.html#l03374">result_array()</a>.</p>
<div id="dynsection-45" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-45-trigger" src="../../closed.png" alt="+"/> Граф вызова функции:</div>
<div id="dynsection-45-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-45-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_a31eb9243149eec0d8676bbcf7289538d_icgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a31eb9243149eec0d8676bbcf7289538d_icgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a31eb9243149eec0d8676bbcf7289538d_icgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a31eb9243149eec0d8676bbcf7289538d_icgraph">
<area shape="rect" title="Извлекает все строки результата из подготовленного выражения, хранящегося в свойстве $res_query,..." alt="" coords="142,5,286,30"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a444f7dd61bfbe3931a7188adad61feae" title="Извлекает все строки результата из подготовленного выражения." alt="" coords="5,5,94,30"/>
<area shape="poly" title=" " alt="" coords="126,20,94,20,94,15,126,15"/>
</map>
</div>

</div>
</div>
<a id="aac250b0e3e45a11bc29ad82a9feb64ec" name="aac250b0e3e45a11bc29ad82a9feb64ec"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aac250b0e3e45a11bc29ad82a9feb64ec">&#9670;&#160;</a></span>_result_row_internal()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">_result_row_internal </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel protected">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Извлекает одну строку результата из подготовленного выражения, хранящегося в свойстве <code>$res_query</code>. </p>
<p>Этот защищённый метод выполняет следующие шаги:</p><ol type="1">
<li>Проверяет, что свойство <code>$this-&gt;res_query</code> установлено и является объектом типа <code>PDOStatement</code>. Если это не так, выбрасывается исключение InvalidArgumentException.</li>
<li>Использует метод <code>fetch(PDO::FETCH_ASSOC)</code> для извлечения одной строки результата из <code>$this-&gt;res_query</code> в виде ассоциативного массива.</li>
<li>Если результатов больше нет (метод <code>fetch()</code> возвращает <code>false</code>), явно возвращается <code>false</code>.</li>
<li>В противном случае возвращается ассоциативный массив, содержащий данные одной строки.</li>
</ol>
<p>Метод только читает значение свойства <code>$this-&gt;res_query</code> и не выполняет дополнительной логики для его обновления. Значение <code>$this-&gt;res_query</code> должно быть установлено внешними методами, такими как <code>_execute_query()</code>, <code>delete()</code>, <code>update()</code> или <code>insert()</code>. Этот метод является защищенным и предназначен для использования внутри класса или его наследников. Основная логика вызывается через публичный метод-редирект <code>result_row()</code>.</p>
<dl class="section return"><dt>Возвращает</dt><dd>array|false Возвращает ассоциативный массив, содержащий данные одной строки результата, если она доступна. При последовательных вызовах переходит к следующей строке. Если результатов больше нет (все строки были извлечены), возвращает <code>false</code>.</dd></dl>
<dl class="exception"><dt>Исключения</dt><dd>
  <table class="exception">
    <tr><td class="paramname">InvalidArgumentException</td><td>Выбрасывается, если:<ul>
<li>Свойство <code>$this-&gt;res_query</code> не установлено (т.е. не был выполнен запрос, устанавливающий его). Пример сообщения: Результат запроса недоступен | Причина: Свойство $res_query не установлено</li>
<li>Свойство <code>$this-&gt;res_query</code> не является объектом типа <code>PDOStatement</code> (указывает на некорректное состояние). Пример сообщения: Недопустимый тип результата запроса | Ожидался объект PDOStatement, получено: [тип]</li>
</ul>
</td></tr>
  </table>
  </dd>
</dl>
<dl class="section warning"><dt>Предупреждения</dt><dd>Метод чувствителен к состоянию свойства <code>$this-&gt;res_query</code>. Убедитесь, что перед вызовом метода был выполнен запрос (например, SELECT), который корректно установил значение <code>$this-&gt;res_query</code> как объект <code>PDOStatement</code>. Последовательные вызовы извлекают следующую строку; для начала извлечения сначала нужно выполнить запрос.</dd></dl>
<p>Пример использования метода _result_row_internal(): </p><div class="fragment"><div class="line"><span class="comment">// Предполагается, что перед этим был выполнен SELECT запрос, например:</span></div>
<div class="line"><span class="comment">// $db-&gt;select([&#39;id&#39;, &#39;name&#39;], &#39;users&#39;, [&#39;where&#39; =&gt; &#39;status = 1&#39;]);</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Извлекаем строки по одной</span></div>
<div class="line"><span class="keywordflow">while</span> ($row = $this-&gt;<a class="code hl_function" href="#aac250b0e3e45a11bc29ad82a9feb64ec">_result_row_internal</a>()) {</div>
<div class="line">    echo <span class="stringliteral">&quot;ID: &quot;</span> . $row[<span class="stringliteral">&#39;id&#39;</span>] . <span class="stringliteral">&quot;, Name: &quot;</span> . $row[<span class="stringliteral">&#39;name&#39;</span>] . <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">}</div>
<div class="ttc" id="aclassPhotoRigma_1_1Classes_1_1Database_html_aac250b0e3e45a11bc29ad82a9feb64ec"><div class="ttname"><a href="#aac250b0e3e45a11bc29ad82a9feb64ec">PhotoRigma\Classes\Database\_result_row_internal</a></div><div class="ttdeci">_result_row_internal()</div><div class="ttdoc">Извлекает одну строку результата из подготовленного выражения, хранящегося в свойстве $res_query.</div><div class="ttdef"><b>Определения</b> <a href="../../d2/d89/Database_8php_source.html#l03571">Database.php:3571</a></div></div>
</div><!-- fragment --> <dl class="section see"><dt>См. также</dt><dd><a class="el" href="#ae87877e5a83ed158cdad137dd27b1ac8" title="Результат выполнения подготовленного выражения (PDOStatement)">PhotoRigma\Classes\Database\$res_query</a> Свойство, хранящее результат подготовленного выражения (объект PDOStatement). </dd>
<dd>
<a class="el" href="#a941629b86b9c9e34bc5926c0db2478b5" title="Выполняет SQL-запрос с использованием подготовленных выражений.">PhotoRigma\Classes\Database\_execute_query()</a> Метод нижнего уровня, который устанавливает значение <code>$res_query</code> после выполнения запроса. </dd>
<dd>
<a class="el" href="#aab30d2495bb1362d218cd62e1556b13e" title="Выполняет SQL-запрос на выборку данных из таблицы.">PhotoRigma\Classes\Database\select()</a> Метод, который может использовать <code>_result_row_internal()</code> для получения результатов SELECT-запроса. </dd>
<dd>
<a class="el" href="#aa2b6c23b3a70e9ef06c22d8a4885d69a" title="Выполняет SQL-запрос с использованием JOIN через вызов внутреннего метода.">PhotoRigma\Classes\Database\join()</a> Метод, который может использовать <code>_result_row_internal()</code> для получения результатов SELECT-запроса с использованием JOIN. </dd>
<dd>
<a class="el" href="#acc7e70758801658b8c1f6ff0988deebb" title="Извлекает одну строку результата из подготовленного выражения.">PhotoRigma\Classes\Database\result_row()</a> Публичный метод-редирект для вызова этой логики. </dd></dl>

<p class="definition">См. определение в файле <a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a> строка <a class="el" href="../../d2/d89/Database_8php_source.html#l03571">3571</a></p>

<p class="reference">Используется в <a class="el" href="../../d2/d89/Database_8php_source.html#l03504">result_row()</a>.</p>
<div id="dynsection-46" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-46-trigger" src="../../closed.png" alt="+"/> Граф вызова функции:</div>
<div id="dynsection-46-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-46-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_aac250b0e3e45a11bc29ad82a9feb64ec_icgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_aac250b0e3e45a11bc29ad82a9feb64ec_icgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_aac250b0e3e45a11bc29ad82a9feb64ec_icgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_aac250b0e3e45a11bc29ad82a9feb64ec_icgraph">
<area shape="rect" title="Извлекает одну строку результата из подготовленного выражения, хранящегося в свойстве $res_query." alt="" coords="135,5,272,30"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#acc7e70758801658b8c1f6ff0988deebb" title="Извлекает одну строку результата из подготовленного выражения." alt="" coords="5,5,87,30"/>
<area shape="poly" title=" " alt="" coords="119,20,87,20,87,15,119,15"/>
</map>
</div>

</div>
</div>
<a id="aa3ddd3acf0992e7be12e65460caaa4b6" name="aa3ddd3acf0992e7be12e65460caaa4b6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa3ddd3acf0992e7be12e65460caaa4b6">&#9670;&#160;</a></span>_rollback_transaction_internal()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">_rollback_transaction_internal </td>
          <td>(</td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>$context</em></span><span class="paramdefsep"> = </span><span class="paramdefval">''</span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel protected">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Отменяет транзакцию в базе данных. </p>
<p>Этот защищённый метод выполняет следующие шаги:</p><ol type="1">
<li>Отменяет транзакцию в базе данных через объект PDO с использованием метода <code>rollBack()</code>.</li>
<li>Логирует информацию об отмене транзакции с указанием контекста через функцию <code>log_in_file()</code>.</li>
</ol>
<p>Этот метод предназначен для использования внутри класса или его наследников. Основная логика вызывается через публичный метод-редирект <code>rollback_transaction()</code>.</p>
<dl class="params"><dt>Аргументы</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$context</td><td>Контекст транзакции (необязательный параметр). Используется для описания цели или места отмены транзакции. По умолчанию: пустая строка (&lsquo;&rsquo;'`).</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Возвращает</dt><dd>void Метод ничего не возвращает.</dd></dl>
<dl class="exception"><dt>Исключения</dt><dd>
  <table class="exception">
    <tr><td class="paramname">Exception</td><td>Выбрасывается, если произошла ошибка при отмене транзакции на уровне PDO или при логировании. Пример сообщения: Ошибка при отмене транзакции | Контекст: [значение контекста] | Сообщение PDO: [текст ошибки PDO]</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Заметки</dt><dd>Метод использует функцию логирования <code>log_in_file()</code> для записи информации об отмене транзакции. </dd></dl>
<dl class="section warning"><dt>Предупреждения</dt><dd>Убедитесь, что транзакция была начата (<code>$this-&gt;pdo-&gt;inTransaction()</code> возвращает <code>true</code>) перед вызовом этого метода. Попытка отменить несуществующую транзакцию приведёт к ошибке на уровне PDO.</dd></dl>
<p>Пример использования метода _rollback_transaction_internal(): </p><div class="fragment"><div class="line"><span class="comment">// Пример отмены транзакции с указанием контекста</span></div>
<div class="line">$this-&gt;<a class="code hl_function" href="#aa3ddd3acf0992e7be12e65460caaa4b6">_rollback_transaction_internal</a>(<span class="stringliteral">&#39;Отмена сохранения данных пользователя&#39;</span>);</div>
<div class="line"><span class="comment">// Ожидаемый лог (в файле): [DB] Транзакция отменена | Контекст: Отмена сохранения данных пользователя</span></div>
<div class="ttc" id="aclassPhotoRigma_1_1Classes_1_1Database_html_aa3ddd3acf0992e7be12e65460caaa4b6"><div class="ttname"><a href="#aa3ddd3acf0992e7be12e65460caaa4b6">PhotoRigma\Classes\Database\_rollback_transaction_internal</a></div><div class="ttdeci">_rollback_transaction_internal(string $context=&#39;&#39;)</div><div class="ttdoc">Отменяет транзакцию в базе данных.</div><div class="ttdef"><b>Определения</b> <a href="../../d2/d89/Database_8php_source.html#l03671">Database.php:3671</a></div></div>
</div><!-- fragment --> <dl class="section see"><dt>См. также</dt><dd><a class="el" href="#a9db61e1721b616500bce6ed60491752a" title="Объект PDO для подключения к базе данных">PhotoRigma\Classes\Database\$pdo</a> Объект PDO для подключения к базе данных. </dd>
<dd>
<a class="el" href="../../db/d02/namespacePhotoRigma_1_1Include.html#a2d74c46a21e4ce612a98eee60981aef0" title="Записывает сообщение об ошибке в лог-файл и, при необходимости, завершает выполнение скрипта.">PhotoRigma\Include\log_in_file()</a> Логирует сообщения в файл. </dd>
<dd>
<a class="el" href="#aa54f5f05128d55871aa9303134170376" title="Отменяет транзакцию в базе данных.">PhotoRigma\Classes\Database\rollback_transaction()</a> Публичный метод-редирект для вызова этой логики. </dd></dl>

<p class="definition">См. определение в файле <a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a> строка <a class="el" href="../../d2/d89/Database_8php_source.html#l03671">3671</a></p>

<p class="reference">Используется в <a class="el" href="../../d2/d89/Database_8php_source.html#l03626">rollback_transaction()</a>.</p>
<div id="dynsection-47" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-47-trigger" src="../../closed.png" alt="+"/> Граф вызова функции:</div>
<div id="dynsection-47-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-47-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_aa3ddd3acf0992e7be12e65460caaa4b6_icgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_aa3ddd3acf0992e7be12e65460caaa4b6_icgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_aa3ddd3acf0992e7be12e65460caaa4b6_icgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_aa3ddd3acf0992e7be12e65460caaa4b6_icgraph">
<area shape="rect" title="Отменяет транзакцию в базе данных." alt="" coords="191,5,335,44"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#aa54f5f05128d55871aa9303134170376" title="Отменяет транзакцию в базе данных." alt="" coords="5,12,143,37"/>
<area shape="poly" title=" " alt="" coords="175,27,143,27,143,22,175,22"/>
</map>
</div>

</div>
</div>
<a id="a3e40bb61553455b6f52be0ab9a6062b1" name="a3e40bb61553455b6f52be0ab9a6062b1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3e40bb61553455b6f52be0ab9a6062b1">&#9670;&#160;</a></span>_select_internal()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">_select_internal </td>
          <td>(</td>
          <td class="paramtype">string|array</td>          <td class="paramname"><span class="paramname"><em>$select</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>$from_tbl</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">array</td>          <td class="paramname"><span class="paramname"><em>$options</em></span><span class="paramdefsep"> = </span><span class="paramdefval">[]</span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel protected">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Формирует SQL-запрос на выборку данных из таблицы, основываясь на полученных аргументах, размещает его в свойстве <code>$txt_query</code> и выполняет. </p>
<p>Этот метод выполняет следующие шаги:</p><ol type="1">
<li>Проверяет типы входных данных: <code>$select</code> (строка или массив), <code>$from_tbl</code> (строка), <code>$options</code> (массив).</li>
<li>Обрабатывает список полей для выборки (<code>$select</code>):<ul>
<li>Если <code>$select</code> является строкой, она разбивается по запятым и преобразуется в массив.</li>
<li>Каждое имя поля проверяется на корректность и преобразуется в строку с разделителем <code>,</code>.</li>
</ul>
</li>
<li>Формирует базовый SQL-запрос <code>SELECT ... FROM ...</code>.</li>
<li>Добавляет условия WHERE, GROUP BY, ORDER BY и LIMIT, если они указаны в параметре <code>$options</code>.</li>
<li>Сохраняет сформированный запрос в свойстве <code>$txt_query</code>.</li>
<li>Выполняет запрос через метод <code>_execute_query</code>, передавая параметры <code>params</code> для подготовленного выражения.</li>
</ol>
<p>Использование параметров <code>params</code> является обязательным для подготовленных выражений, так как это обеспечивает защиту от SQL-инъекций и совместимость с различными СУБД. Этот метод является защищенным и предназначен для использования внутри класса или его наследников. Основная логика вызывается через публичный метод-редирект <code>select()</code>.</p>
<dl class="params"><dt>Аргументы</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string&#160;|&#160;array</td><td class="paramname">$select</td><td>Список полей для выборки. Может быть строкой (имя одного поля) или массивом (список полей). Если передан массив, он преобразуется в строку с разделителем <code>,</code>. Пример: "id", ["id", "name"]. Ограничения: массив не может содержать элементы, которые не являются строками. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$from_tbl</td><td>Имя таблицы, из которой выбираются данные. Должно быть строкой, содержащей только допустимые имена таблиц без специальных символов. Ограничения: строка должна быть непустой. </td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$options</td><td>Массив дополнительных опций для формирования запроса. Поддерживаемые ключи:<ul>
<li>where (string|array|false): Условие WHERE.<ul>
<li>string - используется как есть.</li>
<li>array - преобразуется в SQL. Поддерживает простые условия (&lsquo;['поле&rsquo; =&gt; значение]<code>) и логические операторы (</code>'OR' =&gt; [...]<code>, </code>'NOT' =&gt; [...]<code>).</code></li>
<li><code>false - игнорируется.</code></li>
</ul>
</li>
<li><code>group (string|false): Группировка GROUP BY. Игнорируется, если false. Должна быть строкой.</code></li>
<li><code>order (string|false): Сортировка ORDER BY. Игнорируется, если false. Должна быть строкой.</code></li>
<li><code>limit (int|string|false): Ограничение LIMIT.<ul>
<li>int - прямое значение.</li>
<li>string - формат "OFFSET,COUNT".</li>
<li>false - игнорируется.</li>
</ul>
</code></li>
<li><code>params (array): Ассоциативный массив параметров ([":имя" =&gt; значение]). Обязателен для использования с условиями</code>where` и другими частями запроса, требующими подготовленных выражений. Обеспечивает защиту от SQL-инъекций. Может быть пустым массивом, если параметры не требуются.</li>
</ul>
</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Возвращает</dt><dd>bool Возвращает true, если запрос успешно выполнен (даже если результат пустой).</dd></dl>
<dl class="exception"><dt>Исключения</dt><dd>
  <table class="exception">
    <tr><td class="paramname">InvalidArgumentException</td><td>Выбрасывается, если:<ul>
<li><code>$from_tbl</code> не является строкой. Пример сообщения: Недопустимое имя таблицы | Ожидалась строка, получено: [тип]</li>
<li><code>$options</code> не является массивом. Пример сообщения: Недопустимый тип параметра options | Ожидался массив, получено: [тип]</li>
<li><code>$select</code> не является строкой или массивом. Пример сообщения: Недопустимый тип параметра select | Ожидалась строка или массив, получено: [тип]</li>
<li>Элемент в списке <code>$select</code> не является строкой. Пример сообщения: Недопустимый элемент в выборке | Ожидалась строка, получено: [тип] </li>
</ul>
</td></tr>
    <tr><td class="paramname">Exception</td><td>Выбрасывается при ошибках выполнения запроса.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section warning"><dt>Предупреждения</dt><dd>Метод чувствителен к корректности входных данных. Неверные типы данных или некорректные значения могут привести к выбросу исключения. Убедитесь, что массив <code>$select</code> содержит только строки. Использование параметров <code>params</code> для подготовленных выражений является обязательным для защиты от SQL-инъекций и обеспечения совместимости с различными СУБД. Игнорирование этого правила может привести к уязвимостям безопасности и неправильной работе с базой данных.</dd></dl>
<p>Пример использования метода _select_internal(): </p><div class="fragment"><div class="line"><span class="comment">// Безопасное использование с параметрами `params`</span></div>
<div class="line">$this-&gt;<a class="code hl_function" href="#a3e40bb61553455b6f52be0ab9a6062b1">_select_internal</a>(</div>
<div class="line">    [<span class="stringliteral">&#39;id&#39;</span>, <span class="stringliteral">&#39;name&#39;</span>],</div>
<div class="line">    <span class="stringliteral">&#39;users&#39;</span>,</div>
<div class="line">    [</div>
<div class="line">        <span class="stringliteral">&#39;where&#39;</span> =&gt; <span class="stringliteral">&#39;status = :status&#39;</span>,</div>
<div class="line">        <span class="stringliteral">&#39;group&#39;</span> =&gt; <span class="stringliteral">&#39;category_id&#39;</span>,</div>
<div class="line">        <span class="stringliteral">&#39;order&#39;</span> =&gt; <span class="stringliteral">&#39;created_at DESC&#39;</span>,</div>
<div class="line">        <span class="stringliteral">&#39;limit&#39;</span> =&gt; 10,</div>
<div class="line">        <span class="stringliteral">&#39;params&#39;</span> =&gt; [<span class="stringliteral">&#39;:status&#39;</span> =&gt; <span class="stringliteral">&#39;active&#39;</span>]</div>
<div class="line">    ]</div>
<div class="line">);</div>
<div class="ttc" id="aclassPhotoRigma_1_1Classes_1_1Database_html_a3e40bb61553455b6f52be0ab9a6062b1"><div class="ttname"><a href="#a3e40bb61553455b6f52be0ab9a6062b1">PhotoRigma\Classes\Database\_select_internal</a></div><div class="ttdeci">_select_internal(string|array $select, string $from_tbl, array $options=[])</div><div class="ttdoc">Формирует SQL-запрос на выборку данных из таблицы, основываясь на полученных аргументах,...</div><div class="ttdef"><b>Определения</b> <a href="../../d2/d89/Database_8php_source.html#l03870">Database.php:3870</a></div></div>
</div><!-- fragment --> <dl class="section see"><dt>См. также</dt><dd><a class="el" href="#a556a1b37f162e7e8b576b86c182c7309" title="Текст последнего SQL-запроса, сформированного методами класса">PhotoRigma\Classes\Database\$txt_query</a> Свойство, в которое помещается текст SQL-запроса. </dd>
<dd>
<a class="el" href="#aab30d2495bb1362d218cd62e1556b13e" title="Выполняет SQL-запрос на выборку данных из таблицы.">PhotoRigma\Classes\Database\select()</a> Публичный метод-редирект для вызова этой логики. </dd>
<dd>
<a class="el" href="#a941629b86b9c9e34bc5926c0db2478b5" title="Выполняет SQL-запрос с использованием подготовленных выражений.">PhotoRigma\Classes\Database\_execute_query()</a> Выполняет SQL-запрос. </dd>
<dd>
<a class="el" href="#a852d15f131983e6f53045146bede2958" title="Формирует строку дополнений для SQL-запроса (например, WHERE, GROUP BY, ORDER BY, LIMIT).">PhotoRigma\Classes\Database\_build_conditions()</a> Формирует условия WHERE, GROUP BY, ORDER BY и LIMIT для запроса. </dd></dl>

<p class="definition">См. определение в файле <a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a> строка <a class="el" href="../../d2/d89/Database_8php_source.html#l03870">3870</a></p>

<p class="reference">Перекрестные ссылки <a class="el" href="../../d2/d89/Database_8php_source.html#l01104">_build_conditions()</a> и <a class="el" href="../../d2/d89/Database_8php_source.html#l01393">_execute_query()</a>.</p>

<p class="reference">Используется в <a class="el" href="../../d2/d89/Database_8php_source.html#l03765">select()</a>.</p>
<div id="dynsection-48" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-48-trigger" src="../../closed.png" alt="+"/> Граф вызовов:</div>
<div id="dynsection-48-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-48-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_a3e40bb61553455b6f52be0ab9a6062b1_cgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a3e40bb61553455b6f52be0ab9a6062b1_cgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a3e40bb61553455b6f52be0ab9a6062b1_cgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a3e40bb61553455b6f52be0ab9a6062b1_cgraph">
<area shape="rect" title="Формирует SQL&#45;запрос на выборку данных из таблицы, основываясь на полученных аргументах,..." alt="" coords="5,56,118,81"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a852d15f131983e6f53045146bede2958" title="Формирует строку дополнений для SQL&#45;запроса (например, WHERE, GROUP BY, ORDER BY, LIMIT)." alt="" coords="166,19,287,43"/>
<area shape="poly" title=" " alt="" coords="118,53,153,45,154,50,119,58"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a941629b86b9c9e34bc5926c0db2478b5" title="Выполняет SQL&#45;запрос с использованием подготовленных выражений." alt="" coords="171,80,282,105"/>
<area shape="poly" title=" " alt="" coords="119,74,156,79,155,85,118,79"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a24acdb048ce17d880bd12b0f74567352" title="Формирует группу условий для WHERE с указанным оператором (OR/NOT)." alt="" coords="335,5,471,30"/>
<area shape="poly" title=" " alt="" coords="287,24,319,21,320,27,288,29"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#af1b08f0490df0963b0daac6690d4765f" title="Выполняет преобразование SQL&#45;запроса в зависимости от текущего формата и типа СУБД." alt="" coords="348,55,458,79"/>
<area shape="poly" title=" " alt="" coords="282,82,333,74,333,80,283,87"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a53c8e7da5436bad14f32f64d5b532f60" title="Логирует результат анализа SQL&#45;запроса с помощью EXPLAIN или EXPLAIN ANALYZE." alt="" coords="357,104,449,129"/>
<area shape="poly" title=" " alt="" coords="283,97,342,105,341,111,282,103"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a8f393cc6e7e1b7e6394a9c2d4abdd8e7" title="Логирует медленные запросы, запросы без использования плейсхолдеров и другие запросы в таблицу логов." alt="" coords="362,153,445,178"/>
<area shape="poly" title=" " alt="" coords="256,103,336,138,354,145,352,150,334,143,254,108"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#ad620cb343252ceea735bab03860a0915" title="Производит преобразование SQL&#45;запроса из формата MySQL в целевой формат СУБД (PostgreSQL или SQLite)." alt="" coords="519,5,683,30"/>
<area shape="poly" title=" " alt="" coords="455,51,533,32,534,37,456,57"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a2e93ad3621ba0d7cf06d36c539b6c290" title="Производит преобразование SQL&#45;запроса из формата PostgreSQL в целевой формат СУБД (MySQL или SQLite)." alt="" coords="521,55,681,79"/>
<area shape="poly" title=" " alt="" coords="458,64,505,64,505,70,458,70"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a44e1aec00a15341cd9119261482eeb0d" title="Производит преобразование SQL&#45;запроса из формата SQLite в целевой формат СУБД (MySQL или PostgreSQL)." alt="" coords="521,104,681,129"/>
<area shape="poly" title=" " alt="" coords="456,77,534,97,533,102,455,83"/>
</map>
</div>
<div id="dynsection-49" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-49-trigger" src="../../closed.png" alt="+"/> Граф вызова функции:</div>
<div id="dynsection-49-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-49-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_a3e40bb61553455b6f52be0ab9a6062b1_icgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a3e40bb61553455b6f52be0ab9a6062b1_icgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a3e40bb61553455b6f52be0ab9a6062b1_icgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a3e40bb61553455b6f52be0ab9a6062b1_icgraph">
<area shape="rect" title="Формирует SQL&#45;запрос на выборку данных из таблицы, основываясь на полученных аргументах,..." alt="" coords="110,5,222,30"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#aab30d2495bb1362d218cd62e1556b13e" title="Выполняет SQL&#45;запрос на выборку данных из таблицы." alt="" coords="5,5,62,30"/>
<area shape="poly" title=" " alt="" coords="94,20,62,20,62,15,94,15"/>
</map>
</div>

</div>
</div>
<a id="ad353291f086236ab7be0d1edc0ed3ba8" name="ad353291f086236ab7be0d1edc0ed3ba8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad353291f086236ab7be0d1edc0ed3ba8">&#9670;&#160;</a></span>_truncate_internal()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">_truncate_internal </td>
          <td>(</td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>$from_tbl</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel protected">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Формирует SQL-запрос на очистку таблицы (TRUNCATE), размещает его в свойстве <code>$txt_query</code> и выполняет. </p>
<p>Этот защищённый метод выполняет следующие шаги:</p><ol type="1">
<li>Проверяет тип входных данных: <code>$from_tbl</code> должен быть строкой. Если передан неверный тип, выбрасывается исключение InvalidArgumentException.</li>
<li>Формирует базовый SQL-запрос <code>TRUNCATE TABLE</code> для очистки таблицы с использованием <code>$from_tbl</code>.</li>
<li>Сохраняет сформированный запрос в свойстве <code>$this-&gt;txt_query</code>.</li>
<li>Выполняет запрос через метод <code>_execute_query()</code>.</li>
</ol>
<p>Этот метод является защищенным и предназначен для использования внутри класса или его наследников. Основная логика вызывается через публичный метод-редирект <code>truncate()</code>.</p>
<dl class="params"><dt>Аргументы</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$from_tbl</td><td>Имя таблицы, которую необходимо очистить. Должно быть строкой, содержащей только допустимые имена таблиц без специальных символов. Ограничения: строка должна быть непустой.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Возвращает</dt><dd>bool Возвращает <code>true</code>, если запрос успешно выполнен (даже если результат пустой или не возвращает строк).</dd></dl>
<dl class="exception"><dt>Исключения</dt><dd>
  <table class="exception">
    <tr><td class="paramname">InvalidArgumentException</td><td>Выбрасывается, если <code>$from_tbl</code> не является непустой строкой. Пример сообщения: Недопустимое имя таблицы | Ожидалась непустая строка, получено: [тип/значение] </td></tr>
    <tr><td class="paramname">Exception</td><td>Выбрасывается при ошибках выполнения запроса.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section warning"><dt>Предупреждения</dt><dd>Метод чувствителен к корректности входных данных. Неверные типы данных или некорректные значения могут привести к выбросу исключения. Запрос TRUNCATE полностью очищает таблицу, удаляя все строки без возможности восстановления. Этот метод следует использовать с осторожностью, так как он не поддерживает откат операции через транзакции.</dd></dl>
<p>Пример использования метода _truncate_internal(): </p><div class="fragment"><div class="line"><span class="comment">// Очистка таблицы &#39;users&#39;</span></div>
<div class="line">$this-&gt;<a class="code hl_function" href="#ad353291f086236ab7be0d1edc0ed3ba8">_truncate_internal</a>(<span class="stringliteral">&#39;users&#39;</span>);</div>
<div class="ttc" id="aclassPhotoRigma_1_1Classes_1_1Database_html_ad353291f086236ab7be0d1edc0ed3ba8"><div class="ttname"><a href="#ad353291f086236ab7be0d1edc0ed3ba8">PhotoRigma\Classes\Database\_truncate_internal</a></div><div class="ttdeci">_truncate_internal(string $from_tbl)</div><div class="ttdoc">Формирует SQL-запрос на очистку таблицы (TRUNCATE), размещает его в свойстве $txt_query и выполняет.</div><div class="ttdef"><b>Определения</b> <a href="../../d2/d89/Database_8php_source.html#l03993">Database.php:3993</a></div></div>
</div><!-- fragment --> <dl class="section see"><dt>См. также</dt><dd><a class="el" href="#a556a1b37f162e7e8b576b86c182c7309" title="Текст последнего SQL-запроса, сформированного методами класса">PhotoRigma\Classes\Database\$txt_query</a> Свойство, в которое помещается текст SQL-запроса. </dd>
<dd>
<a class="el" href="#ad4d4e455d9e4bf865126c72cf23a517b" title="Очищает таблицу (TRUNCATE) через вызов внутреннего метода.">PhotoRigma\Classes\Database\truncate()</a> Публичный метод-редирект для вызова этой логики. </dd>
<dd>
<a class="el" href="#a941629b86b9c9e34bc5926c0db2478b5" title="Выполняет SQL-запрос с использованием подготовленных выражений.">PhotoRigma\Classes\Database\_execute_query()</a> Выполняет SQL-запрос. </dd></dl>

<p class="definition">См. определение в файле <a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a> строка <a class="el" href="../../d2/d89/Database_8php_source.html#l03993">3993</a></p>

<p class="reference">Перекрестные ссылки <a class="el" href="../../d2/d89/Database_8php_source.html#l01393">_execute_query()</a>.</p>

<p class="reference">Используется в <a class="el" href="../../d2/d89/Database_8php_source.html#l03944">truncate()</a>.</p>
<div id="dynsection-50" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-50-trigger" src="../../closed.png" alt="+"/> Граф вызовов:</div>
<div id="dynsection-50-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-50-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_ad353291f086236ab7be0d1edc0ed3ba8_cgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_ad353291f086236ab7be0d1edc0ed3ba8_cgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_ad353291f086236ab7be0d1edc0ed3ba8_cgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_ad353291f086236ab7be0d1edc0ed3ba8_cgraph">
<area shape="rect" title="Формирует SQL&#45;запрос на очистку таблицы (TRUNCATE), размещает его в свойстве $txt_query и выполняет." alt="" coords="5,104,130,129"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a941629b86b9c9e34bc5926c0db2478b5" title="Выполняет SQL&#45;запрос с использованием подготовленных выражений." alt="" coords="178,104,289,129"/>
<area shape="poly" title=" " alt="" coords="130,114,162,114,162,119,130,119"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#af1b08f0490df0963b0daac6690d4765f" title="Выполняет преобразование SQL&#45;запроса в зависимости от текущего формата и типа СУБД." alt="" coords="337,55,446,79"/>
<area shape="poly" title=" " alt="" coords="275,101,334,82,336,87,276,106"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a53c8e7da5436bad14f32f64d5b532f60" title="Логирует результат анализа SQL&#45;запроса с помощью EXPLAIN или EXPLAIN ANALYZE." alt="" coords="346,104,438,129"/>
<area shape="poly" title=" " alt="" coords="290,114,330,114,330,119,290,119"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a8f393cc6e7e1b7e6394a9c2d4abdd8e7" title="Логирует медленные запросы, запросы без использования плейсхолдеров и другие запросы в таблицу логов." alt="" coords="350,153,433,178"/>
<area shape="poly" title=" " alt="" coords="276,127,336,146,334,151,275,132"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#ad620cb343252ceea735bab03860a0915" title="Производит преобразование SQL&#45;запроса из формата MySQL в целевой формат СУБД (PostgreSQL или SQLite)." alt="" coords="494,5,658,30"/>
<area shape="poly" title=" " alt="" coords="440,51,512,32,513,37,441,57"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a2e93ad3621ba0d7cf06d36c539b6c290" title="Производит преобразование SQL&#45;запроса из формата PostgreSQL в целевой формат СУБД (MySQL или SQLite)." alt="" coords="496,55,656,79"/>
<area shape="poly" title=" " alt="" coords="447,64,480,64,480,70,447,70"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a44e1aec00a15341cd9119261482eeb0d" title="Производит преобразование SQL&#45;запроса из формата SQLite в целевой формат СУБД (MySQL или PostgreSQL)." alt="" coords="496,104,656,129"/>
<area shape="poly" title=" " alt="" coords="441,77,513,97,512,102,440,83"/>
</map>
</div>
<div id="dynsection-51" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-51-trigger" src="../../closed.png" alt="+"/> Граф вызова функции:</div>
<div id="dynsection-51-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-51-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_ad353291f086236ab7be0d1edc0ed3ba8_icgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_ad353291f086236ab7be0d1edc0ed3ba8_icgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_ad353291f086236ab7be0d1edc0ed3ba8_icgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_ad353291f086236ab7be0d1edc0ed3ba8_icgraph">
<area shape="rect" title="Формирует SQL&#45;запрос на очистку таблицы (TRUNCATE), размещает его в свойстве $txt_query и выполняет." alt="" coords="122,5,246,30"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#ad4d4e455d9e4bf865126c72cf23a517b" title="Очищает таблицу (TRUNCATE) через вызов внутреннего метода." alt="" coords="5,5,74,30"/>
<area shape="poly" title=" " alt="" coords="106,20,74,20,74,15,106,15"/>
</map>
</div>

</div>
</div>
<a id="a7bee8df3a568f0f7563281575031fec7" name="a7bee8df3a568f0f7563281575031fec7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7bee8df3a568f0f7563281575031fec7">&#9670;&#160;</a></span>_unescape_identifiers()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">_unescape_identifiers </td>
          <td>(</td>
          <td class="paramtype">array</td>          <td class="paramname"><span class="paramname"><em>$identifiers</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel private">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Снятие экранирования идентификаторов (например, имён таблиц или столбцов). </p>
<p>Этот приватный метод обрабатывает массив идентификаторов, удаляя из них символы экранирования, специфичные для текущей СУБД, определенной свойством <code>$this-&gt;current_format</code>. Результат "чистых" идентификаторов сохраняется в кэше для оптимизации. Метод выполняет следующие шаги:</p><ol type="1">
<li>Инициализирует пустой массив для хранения результатов и определяет правила снятия экранирования на основе свойства <code>$this-&gt;current_format</code>.</li>
<li>Перебирает каждый идентификатор в массиве <code>$identifiers</code>, проверяя, является ли он строкой. Если обнаружен не строковый элемент, выбрасывается исключение InvalidArgumentException.</li>
<li>Для каждого идентификатора проверяет наличие результата снятия экранирования в кэше <code>$this-&gt;unescape_cache</code>.</li>
<li>Если идентификатор не найден в кэше, применяет соответствующие правила снятия экранирования (<code>strtr</code>) для удаления специфических символов (обратные кавычки для MySQL, двойные кавычки для PostgreSQL, квадратные скобки и двойные кавычки для SQLite). Результат сохраняется в кэше.</li>
<li>Добавляет "чистый" идентификатор (из кэша или только что вычисленный) в массив результатов.</li>
<li>После обработки всех идентификаторов возвращает массив "чистых" идентификаторов.</li>
</ol>
<p>Поддерживаемые правила снятия экранирования в зависимости от <code>$this-&gt;current_format</code>:</p><ul>
<li>'mysql': удаляются обратные кавычки (&lsquo;).</li>
<li>'pgsql&rsquo;: удаляются двойные кавычки (").
         - 'sqlite': удаляются квадратные скобки ([]) и двойные кавычки (").</li>
</ul>
<dl class="params"><dt>Аргументы</dt><dd>
  <table class="params">
    <tr><td class="paramtype">array</td><td class="paramname">$identifiers</td><td>Массив экранированных идентификаторов для обработки. Элементы массива должны быть строками. Могут содержать квалифицированные имена (например, "schema.table").</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Возвращает</dt><dd>array Массив "чистых" идентификаторов. Все экранирующие символы, специфичные для <code>$this-&gt;current_format</code>, удалены. Сохраняется исходная структура квалифицированных имен (например, разделитель '.').</dd></dl>
<dl class="exception"><dt>Исключения</dt><dd>
  <table class="exception">
    <tr><td class="paramname">InvalidArgumentException</td><td>Выбрасывается, если какой-либо элемент в массиве <code>$identifiers</code> не является строкой. Пример сообщения: Идентификатор должен быть строкой, получен: [тип]</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Заметки</dt><dd>Метод использует текущую конфигурацию СУБД, заданную в свойстве <code>$this-&gt;current_format</code>, для определения правил снятия экранирования. Результаты снятия экранирования кешируются в свойстве <code>$this-&gt;unescape_cache</code> для оптимизации повторных операций с теми же идентификаторами.</dd></dl>
<dl class="section warning"><dt>Предупреждения</dt><dd>Убедитесь, что свойство <code>$this-&gt;current_format</code> установлено в одно из поддерживаемых значений ('mysql', 'pgsql', 'sqlite') перед вызовом метода.</dd></dl>
<p>Пример использования: </p><div class="fragment"><div class="line"><span class="comment">// Предположим:</span></div>
<div class="line"><span class="comment">// $this-&gt;current_format = &#39;sqlite&#39;;</span></div>
<div class="line">$quoted = [<span class="stringliteral">&#39;&quot;id&quot;&#39;</span>, <span class="stringliteral">&#39;[name]&#39;</span>, <span class="stringliteral">&#39;user.&quot;email&quot;&#39;</span>, <span class="stringliteral">&#39;`field`&#39;</span>]; <span class="comment">// Идентификаторы с разным экранированием</span></div>
<div class="line"> </div>
<div class="line">$clean = $this-&gt;<a class="code hl_function" href="#a7bee8df3a568f0f7563281575031fec7">_unescape_identifiers</a>($quoted);</div>
<div class="line"><span class="comment">// Если current_format был &#39;sqlite&#39;:</span></div>
<div class="line"><span class="comment">// $clean = [&#39;id&#39;, &#39;name&#39;, &#39;user.email&#39;, &#39;`field`&#39;] // Обратные кавычки останутся, т.к. не правило SQLite</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Предположим:</span></div>
<div class="line"><span class="comment">// $this-&gt;current_format = &#39;mysql&#39;;</span></div>
<div class="line">$quoted_mysql = [<span class="stringliteral">&#39;`id`&#39;</span>, <span class="stringliteral">&#39;&quot;name&quot;&#39;</span>, <span class="stringliteral">&#39;[created_at]&#39;</span>, <span class="stringliteral">&#39;user.`email`&#39;</span>];</div>
<div class="line"> </div>
<div class="line">$clean_mysql = $this-&gt;<a class="code hl_function" href="#a7bee8df3a568f0f7563281575031fec7">_unescape_identifiers</a>($quoted_mysql);</div>
<div class="line"><span class="comment">// Если current_format был &#39;mysql&#39;:</span></div>
<div class="line"><span class="comment">// $clean_mysql = [&#39;id&#39;, &#39;&quot;name&quot;&#39;, &#39;[created_at]&#39;, &#39;user.email&#39;] // Двойные кавычки и скобки останутся</span></div>
<div class="ttc" id="aclassPhotoRigma_1_1Classes_1_1Database_html_a7bee8df3a568f0f7563281575031fec7"><div class="ttname"><a href="#a7bee8df3a568f0f7563281575031fec7">PhotoRigma\Classes\Database\_unescape_identifiers</a></div><div class="ttdeci">_unescape_identifiers(array $identifiers)</div><div class="ttdoc">Снятие экранирования идентификаторов (например, имён таблиц или столбцов).</div><div class="ttdef"><b>Определения</b> <a href="../../d2/d89/Database_8php_source.html#l06249">Database.php:6249</a></div></div>
</div><!-- fragment --> <dl class="section see"><dt>См. также</dt><dd><a class="el" href="#aa6ad7a9ae20f259f85508582d8f15068" title="Кэш для хранения результатов снятия экранирования идентификаторов">PhotoRigma\Classes\Database\$unescape_cache</a> Внутреннее свойство, используемое для кэширования результатов снятия экранирования идентификаторов. </dd>
<dd>
<a class="el" href="#a8c3cf443d91cde7347577cddf302a9d0" title="Хранит текущий формат SQL (например, &#39;mysql&#39;, &#39;pgsql&#39;, &#39;sqlite&#39;).">PhotoRigma\Classes\Database\$current_format</a> Свойство, хранящее текущий формат SQL, определяющий правила снятия экранирования. </dd></dl>

<p class="definition">См. определение в файле <a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a> строка <a class="el" href="../../d2/d89/Database_8php_source.html#l06249">6249</a></p>

<p class="reference">Перекрестные ссылки <a class="el" href="../../d2/d89/Database_8php_source.html#l06249">_unescape_identifiers()</a>.</p>

<p class="reference">Используется в <a class="el" href="../../d2/d89/Database_8php_source.html#l06249">_unescape_identifiers()</a>.</p>
<div id="dynsection-52" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-52-trigger" src="../../closed.png" alt="+"/> Граф вызовов:</div>
<div id="dynsection-52-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-52-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_a7bee8df3a568f0f7563281575031fec7_cgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a7bee8df3a568f0f7563281575031fec7_cgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a7bee8df3a568f0f7563281575031fec7_cgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a7bee8df3a568f0f7563281575031fec7_cgraph">
<area shape="rect" title="Снятие экранирования идентификаторов (например, имён таблиц или столбцов)." alt="" coords="5,29,152,54"/>
<area shape="poly" title=" " alt="" coords="54,30,49,21,51,11,62,5,79,3,97,5,106,12,103,16,95,10,78,8,63,10,55,15,54,20,58,28"/>
</map>
</div>
<div id="dynsection-53" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-53-trigger" src="../../closed.png" alt="+"/> Граф вызова функции:</div>
<div id="dynsection-53-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-53-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_a7bee8df3a568f0f7563281575031fec7_icgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a7bee8df3a568f0f7563281575031fec7_icgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a7bee8df3a568f0f7563281575031fec7_icgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a7bee8df3a568f0f7563281575031fec7_icgraph">
<area shape="rect" title="Снятие экранирования идентификаторов (например, имён таблиц или столбцов)." alt="" coords="5,29,152,54"/>
<area shape="poly" title=" " alt="" coords="103,16,95,10,78,8,63,10,55,15,54,20,58,28,54,30,49,21,51,11,62,5,79,3,97,5,106,12"/>
</map>
</div>

</div>
</div>
<a id="ab1dc7ae1ce60a864b1d7c865e99029b0" name="ab1dc7ae1ce60a864b1d7c865e99029b0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab1dc7ae1ce60a864b1d7c865e99029b0">&#9670;&#160;</a></span>_update_internal()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">_update_internal </td>
          <td>(</td>
          <td class="paramtype">array</td>          <td class="paramname"><span class="paramname"><em>$update</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>$from_tbl</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">array</td>          <td class="paramname"><span class="paramname"><em>$options</em></span><span class="paramdefsep"> = </span><span class="paramdefval">[]</span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel protected">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Формирует SQL-запрос на обновление данных в таблице, основываясь на полученных аргументах, размещает его в свойстве <code>$txt_query</code> и выполняет. </p>
<p>Этот защищённый метод выполняет следующие шаги:</p><ol type="1">
<li>Проверяет типы входных данных: <code>$update</code> (ассоциативный массив), <code>$from_tbl</code> (строка), <code>$options</code> (массив).</li>
<li>Проверяет наличие обязательного условия <code>where</code> в массиве <code>$options</code>. Если условие отсутствует, выбрасывается исключение для предотвращения случайного обновления всех данных.</li>
<li>Удаляет недопустимый ключ <code>group</code> из массива <code>$options</code> с записью в лог, так как GROUP BY не поддерживается в запросах UPDATE.</li>
<li>Формирует базовый SQL-запрос UPDATE с использованием преобразованных данных.</li>
<li>Добавляет условия WHERE, ORDER BY и LIMIT, если они указаны в параметре <code>$options</code>.</li>
<li>Сохраняет сформированный запрос в свойстве <code>$txt_query</code>.</li>
<li>Выполняет запрос через метод <code>_execute_query</code>, передавая параметры <code>params</code> для подготовленного выражения.</li>
</ol>
<p>Использование параметров <code>params</code> является обязательным для подготовленных выражений, так как это обеспечивает защиту от SQL-инъекций и совместимость с различными СУБД. Этот метод является защищенным и предназначен для использования внутри класса или его наследников. Основная логика вызывается через публичный метод-редирект <code>update()</code>.</p>
<dl class="params"><dt>Аргументы</dt><dd>
  <table class="params">
    <tr><td class="paramtype">array</td><td class="paramname">$update</td><td>Ассоциативный массив данных для обновления в формате: 'имя_поля' =&gt; 'значение'. Пример: ["name" =&gt; ":name", "status" =&gt; ":status"]. Для защиты от SQL-инъекций рекомендуется использовать плейсхолдеры (например, <code>:name</code>). </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$from_tbl</td><td>Имя таблицы, в которой необходимо обновить данные. Должно быть строкой, содержащей только допустимые имена таблиц без специальных символов. Ограничения: строка должна быть непустой. </td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$options</td><td>Массив опций для формирования запроса. Поддерживаемые ключи:<ul>
<li>where (string|array|false): Условие WHERE.<ul>
<li>string - используется как есть.</li>
<li>array - преобразуется в SQL. Поддерживает простые условия (&lsquo;['поле&rsquo; =&gt; значение]<code>) и логические операторы (</code>'OR' =&gt; [...]<code>, </code>'NOT' =&gt; [...]<code>).</code></li>
<li><code>false - игнорируется. Обязательный параметр для безопасности. Без условия WHERE запрос не будет выполнен.</code></li>
</ul>
</li>
<li><code>group (string|false): Группировка GROUP BY. Игнорируется, если false. Должна быть строкой. Не поддерживается в запросах UPDATE и удаляется с записью в лог.</code></li>
<li><code>order (string|false): Сортировка ORDER BY. Игнорируется, если false. Должна быть строкой.</code></li>
<li><code>limit (int|string|false): Ограничение LIMIT.<ul>
<li>int - прямое значение.</li>
<li>string - формат "OFFSET,COUNT".</li>
<li>false - игнорируется.</li>
</ul>
</code></li>
<li><code>params (array): Ассоциативный массив параметров ([":имя" =&gt; значение]). Обязателен для использования с данными для обновления или условиями</code>where`, требующими подготовленных выражений. Обеспечивает защиту от SQL-инъекций. Может быть пустым массивом, если параметры не требуются.</li>
</ul>
</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Возвращает</dt><dd>bool Возвращает true, если запрос успешно выполнен (даже если результат пустой).</dd></dl>
<dl class="exception"><dt>Исключения</dt><dd>
  <table class="exception">
    <tr><td class="paramname">InvalidArgumentException</td><td>Выбрасывается, если:<ul>
<li><code>$update</code> не является массивом. Пример сообщения: Недопустимый тип параметра update | Ожидался массив, получено: [тип]</li>
<li><code>$from_tbl</code> не является строкой. Пример сообщения: Недопустимое имя таблицы | Ожидалась строка, получено: [тип]</li>
<li><code>$options</code> не является массивом. Пример сообщения: Недопустимый тип параметра options | Ожидался массив, получено: [тип]</li>
<li>Отсутствует обязательное условие <code>where</code> в массиве <code>$options</code>. Пример сообщения: Запрос UPDATE без условия WHERE запрещён | Причина: Соображения безопасности </li>
</ul>
</td></tr>
    <tr><td class="paramname">JsonException</td><td>Выбрасывается при ошибках записи лога. </td></tr>
    <tr><td class="paramname">Exception</td><td>Выбрасывается при ошибках выполнения запроса.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section warning"><dt>Предупреждения</dt><dd>Метод чувствителен к корректности входных данных. Неверные типы данных или некорректные значения могут привести к выбросу исключения. Безопасность обеспечивается обязательным указанием условия <code>where</code>. Запрос без условия <code>where</code> не будет выполнен. Ключ <code>group</code> не поддерживается в запросах UPDATE и удаляется с записью в лог. Использование параметров <code>params</code> для подготовленных выражений является обязательным для защиты от SQL-инъекций и обеспечения совместимости с различными СУБД. Игнорирование этого правила может привести к уязвимостям безопасности и неправильной работе с базой данных.</dd></dl>
<p>Пример использования метода _update_internal(): </p><div class="fragment"><div class="line"><span class="comment">// Безопасное использование с параметрами `params`</span></div>
<div class="line">$this-&gt;<a class="code hl_function" href="#ab1dc7ae1ce60a864b1d7c865e99029b0">_update_internal</a>(</div>
<div class="line">    [<span class="stringliteral">&#39;name&#39;</span> =&gt; <span class="stringliteral">&#39;:name&#39;</span>, <span class="stringliteral">&#39;status&#39;</span> =&gt; <span class="stringliteral">&#39;:status&#39;</span>],</div>
<div class="line">    <span class="stringliteral">&#39;users&#39;</span>,</div>
<div class="line">    [</div>
<div class="line">        <span class="stringliteral">&#39;where&#39;</span> =&gt; <span class="stringliteral">&#39;id = :id&#39;</span>,</div>
<div class="line">        <span class="stringliteral">&#39;params&#39;</span> =&gt; [<span class="stringliteral">&#39;:id&#39;</span> =&gt; 1, <span class="stringliteral">&#39;:name&#39;</span> =&gt; <span class="stringliteral">&#39;John Doe&#39;</span>, <span class="stringliteral">&#39;:status&#39;</span> =&gt; <span class="stringliteral">&#39;active&#39;</span>]</div>
<div class="line">    ]</div>
<div class="line">);</div>
<div class="ttc" id="aclassPhotoRigma_1_1Classes_1_1Database_html_ab1dc7ae1ce60a864b1d7c865e99029b0"><div class="ttname"><a href="#ab1dc7ae1ce60a864b1d7c865e99029b0">PhotoRigma\Classes\Database\_update_internal</a></div><div class="ttdeci">_update_internal(array $update, string $from_tbl, array $options=[])</div><div class="ttdoc">Формирует SQL-запрос на обновление данных в таблице, основываясь на полученных аргументах,...</div><div class="ttdef"><b>Определения</b> <a href="../../d2/d89/Database_8php_source.html#l04197">Database.php:4197</a></div></div>
</div><!-- fragment --> <dl class="section see"><dt>См. также</dt><dd><a class="el" href="#a556a1b37f162e7e8b576b86c182c7309" title="Текст последнего SQL-запроса, сформированного методами класса">PhotoRigma\Classes\Database\$txt_query</a> Свойство, в которое помещается текст SQL-запроса. </dd>
<dd>
<a class="el" href="#a539e51bc2144b972bfafeccdda56ee9e" title="Обновляет данные в таблице через вызов внутреннего метода.">PhotoRigma\Classes\Database\update()</a> Публичный метод-редирект для вызова этой логики. </dd>
<dd>
<a class="el" href="#a941629b86b9c9e34bc5926c0db2478b5" title="Выполняет SQL-запрос с использованием подготовленных выражений.">PhotoRigma\Classes\Database\_execute_query()</a> Выполняет SQL-запрос. </dd>
<dd>
<a class="el" href="#a852d15f131983e6f53045146bede2958" title="Формирует строку дополнений для SQL-запроса (например, WHERE, GROUP BY, ORDER BY, LIMIT).">PhotoRigma\Classes\Database\_build_conditions()</a> Формирует условия WHERE, ORDER BY и LIMIT для запроса. </dd></dl>

<p class="definition">См. определение в файле <a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a> строка <a class="el" href="../../d2/d89/Database_8php_source.html#l04197">4197</a></p>

<p class="reference">Перекрестные ссылки <a class="el" href="../../d2/d89/Database_8php_source.html#l01104">_build_conditions()</a> и <a class="el" href="../../d2/d89/Database_8php_source.html#l01393">_execute_query()</a>.</p>

<p class="reference">Используется в <a class="el" href="../../d2/d89/Database_8php_source.html#l04091">update()</a>.</p>
<div id="dynsection-54" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-54-trigger" src="../../closed.png" alt="+"/> Граф вызовов:</div>
<div id="dynsection-54-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-54-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_ab1dc7ae1ce60a864b1d7c865e99029b0_cgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_ab1dc7ae1ce60a864b1d7c865e99029b0_cgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_ab1dc7ae1ce60a864b1d7c865e99029b0_cgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_ab1dc7ae1ce60a864b1d7c865e99029b0_cgraph">
<area shape="rect" title="Формирует SQL&#45;запрос на обновление данных в таблице, основываясь на полученных аргументах,..." alt="" coords="5,56,122,81"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a852d15f131983e6f53045146bede2958" title="Формирует строку дополнений для SQL&#45;запроса (например, WHERE, GROUP BY, ORDER BY, LIMIT)." alt="" coords="170,19,291,43"/>
<area shape="poly" title=" " alt="" coords="121,53,157,45,158,50,122,58"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a941629b86b9c9e34bc5926c0db2478b5" title="Выполняет SQL&#45;запрос с использованием подготовленных выражений." alt="" coords="175,80,286,105"/>
<area shape="poly" title=" " alt="" coords="123,74,160,80,159,85,122,79"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a24acdb048ce17d880bd12b0f74567352" title="Формирует группу условий для WHERE с указанным оператором (OR/NOT)." alt="" coords="339,5,475,30"/>
<area shape="poly" title=" " alt="" coords="291,24,323,21,324,27,292,29"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#af1b08f0490df0963b0daac6690d4765f" title="Выполняет преобразование SQL&#45;запроса в зависимости от текущего формата и типа СУБД." alt="" coords="352,55,462,79"/>
<area shape="poly" title=" " alt="" coords="286,82,337,74,337,80,287,87"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a53c8e7da5436bad14f32f64d5b532f60" title="Логирует результат анализа SQL&#45;запроса с помощью EXPLAIN или EXPLAIN ANALYZE." alt="" coords="361,104,453,129"/>
<area shape="poly" title=" " alt="" coords="287,97,346,105,345,111,286,103"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a8f393cc6e7e1b7e6394a9c2d4abdd8e7" title="Логирует медленные запросы, запросы без использования плейсхолдеров и другие запросы в таблицу логов." alt="" coords="366,153,449,178"/>
<area shape="poly" title=" " alt="" coords="260,103,340,138,358,145,356,150,338,143,258,108"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#ad620cb343252ceea735bab03860a0915" title="Производит преобразование SQL&#45;запроса из формата MySQL в целевой формат СУБД (PostgreSQL или SQLite)." alt="" coords="523,5,687,30"/>
<area shape="poly" title=" " alt="" coords="459,51,537,32,538,37,460,57"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a2e93ad3621ba0d7cf06d36c539b6c290" title="Производит преобразование SQL&#45;запроса из формата PostgreSQL в целевой формат СУБД (MySQL или SQLite)." alt="" coords="525,55,685,79"/>
<area shape="poly" title=" " alt="" coords="462,64,509,64,509,70,462,70"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a44e1aec00a15341cd9119261482eeb0d" title="Производит преобразование SQL&#45;запроса из формата SQLite в целевой формат СУБД (MySQL или PostgreSQL)." alt="" coords="525,104,685,129"/>
<area shape="poly" title=" " alt="" coords="460,77,538,97,537,102,459,83"/>
</map>
</div>
<div id="dynsection-55" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-55-trigger" src="../../closed.png" alt="+"/> Граф вызова функции:</div>
<div id="dynsection-55-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-55-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_ab1dc7ae1ce60a864b1d7c865e99029b0_icgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_ab1dc7ae1ce60a864b1d7c865e99029b0_icgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_ab1dc7ae1ce60a864b1d7c865e99029b0_icgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_ab1dc7ae1ce60a864b1d7c865e99029b0_icgraph">
<area shape="rect" title="Формирует SQL&#45;запрос на обновление данных в таблице, основываясь на полученных аргументах,..." alt="" coords="114,5,230,30"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a539e51bc2144b972bfafeccdda56ee9e" title="Обновляет данные в таблице через вызов внутреннего метода." alt="" coords="5,5,66,30"/>
<area shape="poly" title=" " alt="" coords="98,20,66,20,66,15,98,15"/>
</map>
</div>

</div>
</div>
<a id="afc2bc46cdbae22b8f2ebec12797fed6d" name="afc2bc46cdbae22b8f2ebec12797fed6d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afc2bc46cdbae22b8f2ebec12797fed6d">&#9670;&#160;</a></span>_with_sql_format_internal()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">_with_sql_format_internal </td>
          <td>(</td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>$format</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">callable</td>          <td class="paramname"><span class="paramname"><em>$callback</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel protected">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Метод временно изменяет формат SQL для выполнения запросов в указанном контексте. </p>
<p>Этот защищённый метод выполняет следующие шаги:</p><ol type="1">
<li>Проверяет поддерживаемость указанного формата SQL <code>$format</code>. Если формат не поддерживается, выбрасывается исключение <code>InvalidArgumentException</code>.</li>
<li>Сохраняет текущий формат SQL из свойства <code>$this-&gt;current_format</code> во временную переменную.</li>
<li>Устанавливает временный формат SQL в свойство <code>$this-&gt;current_format</code>, используя значение из <code>$format</code>.</li>
<li>Выполняет переданный коллбэк <code>$callback</code>. Код внутри коллбэка будет использовать новый временный формат SQL.</li>
<li>Восстанавливает исходный формат SQL в свойстве <code>$this-&gt;current_format</code> после завершения коллбэка (даже если внутри коллбэка произошла ошибка благодаря использованию <code>finally</code>).</li>
</ol>
<p>Этот метод является защищенным и предназначен для использования внутри класса или его наследников. Основная логика вызывается через публичный метод-редирект <code>with_sql_format()</code>.</p>
<dl class="params"><dt>Аргументы</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$format</td><td>Формат SQL, который нужно использовать временно. Поддерживаемые значения: 'mysql', 'pgsql', 'sqlite'. </td></tr>
    <tr><td class="paramtype">callable</td><td class="paramname">$callback</td><td>Коллбэк, содержащий код, который должен выполняться в контексте указанного формата SQL. Коллбэк может принимать ссылку на текущий объект базы данных как аргумент (например, <code>function (\<a class="el" href="../../de/d90/namespacePhotoRigma.html">PhotoRigma</a>\Classes\Database $db) { ... }</code>).</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Возвращает</dt><dd>mixed Результат выполнения коллбэка <code>$callback</code>.</dd></dl>
<dl class="exception"><dt>Исключения</dt><dd>
  <table class="exception">
    <tr><td class="paramname">InvalidArgumentException</td><td>Выбрасывается, если указан неподдерживаемый формат SQL. Пример сообщения: Неподдерживаемый формат SQL | Формат: [format]</td></tr>
  </table>
  </dd>
</dl>
<dl class="section warning"><dt>Предупреждения</dt><dd>Важные замечания:<ol type="1">
<li>Убедитесь, что все методы текущего класса <code>$this-&gt;...()</code>, вызываемые внутри коллбэка, корректно работают с указанным временным форматом SQL.</li>
<li><b>Особая осторожность:</b> Не используйте внутри коллбэка методы <b>других</b> классов, которые напрямую зависят от объекта <code>$db</code> и при этом написаны с жесткой привязкой к определенному формату SQL (например, парсят SQL-строки, не учитывая временное изменение формата в объекте <code>$db</code>). Это может привести к непредсказуемому поведению или ошибкам.</li>
<li>Для выполнения группы запросов в одном и том же временном формате оберните их в один коллбэк.</li>
</ol>
</dd></dl>
<p>Пример использования метода _with_sql_format_internal(): </p><div class="fragment"><div class="line"><span class="comment">// Выполнение запроса в формате PostgreSQL</span></div>
<div class="line"><span class="comment">// Предполагается, что TBL_NEWS определена как константа</span></div>
<div class="line">$years_list = $this-&gt;<a class="code hl_function" href="#afc2bc46cdbae22b8f2ebec12797fed6d">_with_sql_format_internal</a>(<span class="stringliteral">&#39;pgsql&#39;</span>, <span class="keyword">function</span> () { <span class="comment">// Можно использовать `use ($this)` или передать $this в коллбэк</span></div>
<div class="line">    <span class="comment">// Форматирование даты для PostgreSQL с учетом временного формата</span></div>
<div class="line">    $formatted_date = $this-&gt;<a class="code hl_function" href="#ac0e58b1bf2a72bbbaa896b9849ed0e42">format_date</a>(<span class="stringliteral">&#39;data_last_edit&#39;</span>, <span class="stringliteral">&#39;YYYY&#39;</span>);</div>
<div class="line">    <span class="comment">// Выборка данных</span></div>
<div class="line">    $this-&gt;<a class="code hl_function" href="#aab30d2495bb1362d218cd62e1556b13e">select</a>(</div>
<div class="line">        <span class="stringliteral">&#39;DISTINCT &#39;</span> . $formatted_date . <span class="stringliteral">&#39; AS year&#39;</span>,</div>
<div class="line">        TBL_NEWS, <span class="comment">// Используем константу TBL_NEWS</span></div>
<div class="line">        [</div>
<div class="line">            <span class="stringliteral">&#39;order&#39;</span> =&gt; <span class="stringliteral">&#39;year ASC&#39;</span>,</div>
<div class="line">        ]</div>
<div class="line">    );</div>
<div class="line">    <span class="comment">// Получение результата</span></div>
<div class="line">    <span class="keywordflow">return</span> $this-&gt;<a class="code hl_function" href="#a444f7dd61bfbe3931a7188adad61feae">result_array</a>();</div>
<div class="line">});</div>
<div class="line">print_r($years_list);</div>
<div class="ttc" id="aclassPhotoRigma_1_1Classes_1_1Database_html_a444f7dd61bfbe3931a7188adad61feae"><div class="ttname"><a href="#a444f7dd61bfbe3931a7188adad61feae">PhotoRigma\Classes\Database\result_array</a></div><div class="ttdeci">result_array()</div><div class="ttdoc">Извлекает все строки результата из подготовленного выражения.</div><div class="ttdef"><b>Определения</b> <a href="../../d2/d89/Database_8php_source.html#l03374">Database.php:3374</a></div></div>
<div class="ttc" id="aclassPhotoRigma_1_1Classes_1_1Database_html_aab30d2495bb1362d218cd62e1556b13e"><div class="ttname"><a href="#aab30d2495bb1362d218cd62e1556b13e">PhotoRigma\Classes\Database\select</a></div><div class="ttdeci">select(string|array $select, string $from_tbl, array $options=[])</div><div class="ttdoc">Выполняет SQL-запрос на выборку данных из таблицы.</div><div class="ttdef"><b>Определения</b> <a href="../../d2/d89/Database_8php_source.html#l03765">Database.php:3765</a></div></div>
<div class="ttc" id="aclassPhotoRigma_1_1Classes_1_1Database_html_ac0e58b1bf2a72bbbaa896b9849ed0e42"><div class="ttname"><a href="#ac0e58b1bf2a72bbbaa896b9849ed0e42">PhotoRigma\Classes\Database\format_date</a></div><div class="ttdeci">format_date(string $column, string $format)</div><div class="ttdoc">Формирует SQL-выражение для форматирования даты с учетом специфики используемой СУБД.</div><div class="ttdef"><b>Определения</b> <a href="../../d2/d89/Database_8php_source.html#l02173">Database.php:2173</a></div></div>
<div class="ttc" id="aclassPhotoRigma_1_1Classes_1_1Database_html_afc2bc46cdbae22b8f2ebec12797fed6d"><div class="ttname"><a href="#afc2bc46cdbae22b8f2ebec12797fed6d">PhotoRigma\Classes\Database\_with_sql_format_internal</a></div><div class="ttdeci">_with_sql_format_internal(string $format, callable $callback)</div><div class="ttdoc">Метод временно изменяет формат SQL для выполнения запросов в указанном контексте.</div><div class="ttdef"><b>Определения</b> <a href="../../d2/d89/Database_8php_source.html#l04372">Database.php:4372</a></div></div>
</div><!-- fragment --> <dl class="section see"><dt>См. также</dt><dd><a class="el" href="#a8c3cf443d91cde7347577cddf302a9d0" title="Хранит текущий формат SQL (например, &#39;mysql&#39;, &#39;pgsql&#39;, &#39;sqlite&#39;).">PhotoRigma\Classes\Database\$current_format</a> Свойство, хранящее текущий формат SQL. </dd>
<dd>
<a class="el" href="#a5bebc90a5002faea5a85470b3bad406e" title="Временно изменяет формат SQL для выполнения запросов.">PhotoRigma\Classes\Database\with_sql_format()</a> Публичный метод-редирект для вызова этой логики. </dd></dl>

<p class="definition">См. определение в файле <a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a> строка <a class="el" href="../../d2/d89/Database_8php_source.html#l04372">4372</a></p>

<p class="reference">Перекрестные ссылки <a class="el" href="../../d2/d89/Database_8php_source.html#l00214">$current_format</a>.</p>

<p class="reference">Используется в <a class="el" href="../../d2/d89/Database_8php_source.html#l04301">with_sql_format()</a>.</p>
<div id="dynsection-56" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-56-trigger" src="../../closed.png" alt="+"/> Граф вызова функции:</div>
<div id="dynsection-56-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-56-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_afc2bc46cdbae22b8f2ebec12797fed6d_icgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_afc2bc46cdbae22b8f2ebec12797fed6d_icgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_afc2bc46cdbae22b8f2ebec12797fed6d_icgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_afc2bc46cdbae22b8f2ebec12797fed6d_icgraph">
<area shape="rect" title="Метод временно изменяет формат SQL для выполнения запросов в указанном контексте." alt="" coords="167,5,336,30"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a5bebc90a5002faea5a85470b3bad406e" title="Временно изменяет формат SQL для выполнения запросов." alt="" coords="5,5,119,30"/>
<area shape="poly" title=" " alt="" coords="151,20,119,20,119,15,151,15"/>
</map>
</div>

</div>
</div>
<a id="afc4126846a2eb1bc11d7418b8f120ecf" name="afc4126846a2eb1bc11d7418b8f120ecf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afc4126846a2eb1bc11d7418b8f120ecf">&#9670;&#160;</a></span>begin_transaction()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">begin_transaction </td>
          <td>(</td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>$context</em></span><span class="paramdefsep"> = </span><span class="paramdefval">''</span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Начинает транзакцию в базе данных. </p>
<p>Этот публичный метод является обёрткой для защищённого метода <code>_begin_transaction_internal()</code>. Он передаёт контекст транзакции во внутренний метод, который выполняет начало транзакции на уровне PDO и записывает соответствующий лог. Метод предназначен для использования клиентским кодом как точка входа для явного управления транзакциями.</p>
<dl class="params"><dt>Аргументы</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$context</td><td>Контекст транзакции (необязательный параметр). Используется для описания цели или места начала транзакции. По умолчанию: пустая строка (&lsquo;&rsquo;'`).</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Возвращает</dt><dd>void Метод ничего не возвращает.</dd></dl>
<dl class="exception"><dt>Исключения</dt><dd>
  <table class="exception">
    <tr><td class="paramname">Exception</td><td>Выбрасывается, если произошла ошибка при начале транзакции на уровне PDO (выбрасывается из внутренней логики). Пример сообщения: Ошибка при начале транзакции | Контекст: [значение контекста] | Сообщение PDO: [текст ошибки PDO]</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Заметки</dt><dd>Этот метод является точкой входа для начала транзакций. Основная логика и логирование выполняются в защищённом методе <code>_begin_transaction_internal()</code>. </dd></dl>
<dl class="section warning"><dt>Предупреждения</dt><dd>Убедитесь, что соединение с базой данных установлено перед вызовом метода.</dd></dl>
<p>Пример использования: </p><div class="fragment"><div class="line"><span class="comment">// Пример начала транзакции из клиентского кода</span></div>
<div class="line"><a class="code hl_variable" href="../../de/d90/namespacePhotoRigma.html#a1fa3127fc82f96b1436d871ef02be319">$db</a> = new \PhotoRigma\Classes\Database();</div>
<div class="line"> </div>
<div class="line"><a class="code hl_variable" href="../../de/d90/namespacePhotoRigma.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;begin_transaction(<span class="stringliteral">&#39;Сохранение данных пользователя&#39;</span>);</div>
<div class="line"><span class="comment">// ... операции с БД ...</span></div>
<div class="line"><span class="comment">// $db-&gt;commit(); или $db-&gt;roll_back();</span></div>
</div><!-- fragment --> <dl class="section see"><dt>См. также</dt><dd><a class="el" href="#a8a1b1a9978392cc3c94f942e63f5d37a" title="Начинает транзакцию в базе данных и записывает лог с указанием контекста.">PhotoRigma\Classes\Database\_begin_transaction_internal()</a> Защищённый метод, выполняющий основную логику начала транзакции. </dd></dl>

<p>Замещает <a class="el" href="../../d7/dc2/interfacePhotoRigma_1_1Interfaces_1_1Database__Interface.html#afc4126846a2eb1bc11d7418b8f120ecf">Database_Interface</a>.</p>

<p class="definition">См. определение в файле <a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a> строка <a class="el" href="../../d2/d89/Database_8php_source.html#l00611">611</a></p>

<p class="reference">Перекрестные ссылки <a class="el" href="../../d2/d89/Database_8php_source.html#l00658">_begin_transaction_internal()</a>.</p>
<div id="dynsection-57" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-57-trigger" src="../../closed.png" alt="+"/> Граф вызовов:</div>
<div id="dynsection-57-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-57-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_afc4126846a2eb1bc11d7418b8f120ecf_cgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_afc4126846a2eb1bc11d7418b8f120ecf_cgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_afc4126846a2eb1bc11d7418b8f120ecf_cgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_afc4126846a2eb1bc11d7418b8f120ecf_cgraph">
<area shape="rect" title="Начинает транзакцию в базе данных." alt="" coords="5,12,129,37"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a8a1b1a9978392cc3c94f942e63f5d37a" title="Начинает транзакцию в базе данных и записывает лог с указанием контекста." alt="" coords="177,5,307,44"/>
<area shape="poly" title=" " alt="" coords="129,22,161,22,161,27,129,27"/>
</map>
</div>

</div>
</div>
<a id="a71aacc1f4ddbd5575362b54ac80cd0d7" name="a71aacc1f4ddbd5575362b54ac80cd0d7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a71aacc1f4ddbd5575362b54ac80cd0d7">&#9670;&#160;</a></span>commit_transaction()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">commit_transaction </td>
          <td>(</td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>$context</em></span><span class="paramdefsep"> = </span><span class="paramdefval">''</span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Подтверждает транзакцию в базе данных. </p>
<p>Этот публичный метод является обёрткой для защищённого метода <code>_commit_transaction_internal()</code>. Он передаёт контекст транзакции во внутренний метод, который выполняет подтверждение транзакции на уровне PDO и записывает соответствующий лог. Метод предназначен для использования клиентским кодом как точка входа для явного управления транзакциями.</p>
<dl class="params"><dt>Аргументы</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$context</td><td>Контекст транзакции (необязательный параметр). Используется для описания цели или места подтверждения транзакции. По умолчанию: пустая строка (&lsquo;&rsquo;'`).</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Возвращает</dt><dd>void Метод ничего не возвращает.</dd></dl>
<dl class="exception"><dt>Исключения</dt><dd>
  <table class="exception">
    <tr><td class="paramname">Exception</td><td>Выбрасывается, если произошла ошибка при подтверждении транзакции на уровне PDO (выбрасывается из внутренней логики). Пример сообщения: Ошибка при подтверждении транзакции | Контекст: [значение контекста] | Сообщение PDO: [текст ошибки PDO]</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Заметки</dt><dd>Этот метод является точкой входа для подтверждения транзакций. Основная логика и логирование выполняются в защищённом методе <code>_commit_transaction_internal()</code>. </dd></dl>
<dl class="section warning"><dt>Предупреждения</dt><dd>Убедитесь, что транзакция была начата перед вызовом метода.</dd></dl>
<p>Пример использования: </p><div class="fragment"><div class="line"><span class="comment">// Пример подтверждения транзакции из клиентского кода</span></div>
<div class="line"><a class="code hl_variable" href="../../de/d90/namespacePhotoRigma.html#a1fa3127fc82f96b1436d871ef02be319">$db</a> = new \PhotoRigma\Classes\Database();</div>
<div class="line"> </div>
<div class="line"><a class="code hl_variable" href="../../de/d90/namespacePhotoRigma.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;begin_transaction(<span class="stringliteral">&#39;Пакетное обновление&#39;</span>);</div>
<div class="line"><span class="comment">// ... операции с БД ...</span></div>
<div class="line"><a class="code hl_variable" href="../../de/d90/namespacePhotoRigma.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;commit_transaction(<span class="stringliteral">&#39;Пакетное обновление завершено&#39;</span>);</div>
</div><!-- fragment --> <dl class="section see"><dt>См. также</dt><dd><a class="el" href="#a212cee52ddc3ef442f9fcce43910581c" title="Подтверждает транзакцию в базе данных и записывает лог с указанием контекста.">PhotoRigma\Classes\Database\_commit_transaction_internal()</a> Защищённый метод, выполняющий основную логику подтверждения транзакции. </dd></dl>

<p>Замещает <a class="el" href="../../d7/dc2/interfacePhotoRigma_1_1Interfaces_1_1Database__Interface.html#a71aacc1f4ddbd5575362b54ac80cd0d7">Database_Interface</a>.</p>

<p class="definition">См. определение в файле <a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a> строка <a class="el" href="../../d2/d89/Database_8php_source.html#l00705">705</a></p>

<p class="reference">Перекрестные ссылки <a class="el" href="../../d2/d89/Database_8php_source.html#l00752">_commit_transaction_internal()</a>.</p>
<div id="dynsection-58" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-58-trigger" src="../../closed.png" alt="+"/> Граф вызовов:</div>
<div id="dynsection-58-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-58-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_a71aacc1f4ddbd5575362b54ac80cd0d7_cgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a71aacc1f4ddbd5575362b54ac80cd0d7_cgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a71aacc1f4ddbd5575362b54ac80cd0d7_cgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a71aacc1f4ddbd5575362b54ac80cd0d7_cgraph">
<area shape="rect" title="Подтверждает транзакцию в базе данных." alt="" coords="5,12,141,37"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a212cee52ddc3ef442f9fcce43910581c" title="Подтверждает транзакцию в базе данных и записывает лог с указанием контекста." alt="" coords="189,5,331,44"/>
<area shape="poly" title=" " alt="" coords="141,22,173,22,173,27,141,27"/>
</map>
</div>

</div>
</div>
<a id="a73d8e6acdfb996002f980ab7c9c18515" name="a73d8e6acdfb996002f980ab7c9c18515"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a73d8e6acdfb996002f980ab7c9c18515">&#9670;&#160;</a></span>delete()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">delete </td>
          <td>(</td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>$from_tbl</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">array</td>          <td class="paramname"><span class="paramname"><em>$options</em></span><span class="paramdefsep"> = </span><span class="paramdefval">[]</span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Удаляет данные из таблицы через вызов внутреннего метода. </p>
<p>Этот публичный метод является обёрткой для защищённого метода <code>_delete_internal()</code>. Он передаёт имя таблицы и опции запроса во внутренний метод, который выполняет формирование и выполнение SQL-запроса на удаление. Безопасность обеспечивается обязательным указанием условия <code>where</code> в опциях и использованием подготовленных выражений с параметрами. Метод предназначен для использования клиентским кодом как точка входа для выполнения операций удаления данных.</p>
<dl class="params"><dt>Аргументы</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$from_tbl</td><td>Имя таблицы, из которой необходимо удалить данные. Должно быть строкой, содержащей только допустимые имена таблиц без специальных символов. </td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$options</td><td>Массив дополнительных опций для формирования запроса. Поддерживаемые ключи:<ul>
<li>where (string|array|false): Условие WHERE.<ul>
<li>string - используется как есть.</li>
<li>array - преобразуется в SQL. Поддерживает простые условия (&lsquo;['поле&rsquo; =&gt; значение]<code>) и логические операторы (</code>'OR' =&gt; [...]<code>, </code>'NOT' =&gt; [...]<code>).</code></li>
<li><code>false - игнорируется. Обязательный параметр для безопасности. Без условия WHERE запрос не будет выполнен.</code></li>
</ul>
</li>
<li><code>group (string|false): Группировка GROUP BY. Игнорируется, если false. Должна быть строкой. Не поддерживается в запросах DELETE и удаляется с записью в лог.</code></li>
<li><code>order (string|false): Сортировка ORDER BY. Игнорируется, если false. Должна быть строкой. Может использоваться только вместе с</code>limit<code>. Если указан только один из них, оба игнорируются с записью в лог.</code></li>
<li><code>limit (int|string|false): Ограничение LIMIT.<ul>
<li>int - прямое значение.</li>
<li>string - формат "OFFSET,COUNT".</li>
<li>false - игнорируется. Может использоваться только вместе с</li>
</ul>
</code>order<code>. Если указан только один из них, оба игнорируются с записью в лог.</code></li>
<li><code>params (array): Ассоциативный массив параметров ([":имя" =&gt; значение]). Обязателен для использования с условиями</code>where` и другими частями запроса, требующими подготовленных выражений. Обеспечивает защиту от SQL-инъекций. Может быть пустым массивом, если параметры не требуются.</li>
</ul>
</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Возвращает</dt><dd>bool Возвращает true, если запрос успешно выполнен (даже если результат пустой). В случае ошибки выбрасывается исключение.</dd></dl>
<dl class="exception"><dt>Исключения</dt><dd>
  <table class="exception">
    <tr><td class="paramname">InvalidArgumentException</td><td>Выбрасывается, если:<ul>
<li><code>$from_tbl</code> не является строкой.</li>
<li><code>$options</code> не является массивом.</li>
<li>Отсутствует обязательное условие <code>where</code> в массиве <code>$options</code>. Пример сообщения: Запрос DELETE без условия WHERE запрещён | Причина: Соображения безопасности </li>
</ul>
</td></tr>
    <tr><td class="paramname">JsonException</td><td>Выбрасывается при ошибках кодирования JSON (например, при записи в лог). Пример сообщения: Ошибка при кодировании JSON | Переданные опции: {"group":"users"} </td></tr>
    <tr><td class="paramname">Exception</td><td>Выбрасывается при ошибках выполнения запроса или записи в лог. Пример сообщения: Ошибка выполнения запроса | SQL: DELETE FROM users WHERE id = :id AND status = :status</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Заметки</dt><dd>Этот метод является точкой входа для выполнения операций удаления данных. Все проверки (включая обязательное <code>where</code>) и основная логика выполняются в защищённом методе <code>_delete_internal()</code>.</dd></dl>
<dl class="section warning"><dt>Предупреждения</dt><dd>Метод чувствителен к корректности входных данных. Неверные типы данных или некорректные значения могут привести к выбросу исключения. Безопасность обеспечивается обязательным указанием условия <code>where</code>. Запрос без условия <code>where</code> не будет выполнен. Ключи <code>group</code>, <code>order</code> и <code>limit</code> проверяются на корректность во внутренней логике. Использование параметров <code>params</code> для подготовленных выражений является обязательным для защиты от SQL-инъекций и обеспечения совместимости с различными СУБД.</dd></dl>
<p>Пример использования: </p><div class="fragment"><div class="line"><span class="comment">// Пример безопасного использования публичного метода</span></div>
<div class="line"><a class="code hl_variable" href="../../de/d90/namespacePhotoRigma.html#a1fa3127fc82f96b1436d871ef02be319">$db</a> = new \PhotoRigma\Classes\Database();</div>
<div class="line"> </div>
<div class="line"><a class="code hl_variable" href="../../de/d90/namespacePhotoRigma.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;delete(<span class="stringliteral">&#39;users&#39;</span>, [</div>
<div class="line">    <span class="stringliteral">&#39;where&#39;</span> =&gt; <span class="stringliteral">&#39;id = :id AND status = :status&#39;</span>,</div>
<div class="line">    <span class="stringliteral">&#39;params&#39;</span> =&gt; [<span class="stringliteral">&#39;:id&#39;</span> =&gt; 1, <span class="stringliteral">&#39;:status&#39;</span> =&gt; <span class="stringliteral">&#39;active&#39;</span>],</div>
<div class="line">]);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Использование с ассоциативным массивом в `where`</span></div>
<div class="line"><a class="code hl_variable" href="../../de/d90/namespacePhotoRigma.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;delete(<span class="stringliteral">&#39;users&#39;</span>, [</div>
<div class="line">    <span class="stringliteral">&#39;where&#39;</span> =&gt; [<span class="stringliteral">&#39;id&#39;</span> =&gt; 1, <span class="stringliteral">&#39;status&#39;</span> =&gt; <span class="stringliteral">&#39;active&#39;</span>],</div>
<div class="line">]);</div>
</div><!-- fragment --> <dl class="section see"><dt>См. также</dt><dd><a class="el" href="#aa4094e522b4780bd58666dba20fdd09d" title="Формирует SQL-запрос на удаление данных из таблицы, проверяет входные данные, обрабатывает недопустим...">PhotoRigma\Classes\Database\_delete_internal()</a> Защищённый метод, выполняющий основную логику удаления данных. </dd></dl>

<p>Замещает <a class="el" href="../../d7/dc2/interfacePhotoRigma_1_1Interfaces_1_1Database__Interface.html#a73d8e6acdfb996002f980ab7c9c18515">Database_Interface</a>.</p>

<p class="definition">См. определение в файле <a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a> строка <a class="el" href="../../d2/d89/Database_8php_source.html#l00846">846</a></p>

<p class="reference">Перекрестные ссылки <a class="el" href="../../d2/d89/Database_8php_source.html#l00954">_delete_internal()</a>.</p>
<div id="dynsection-59" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-59-trigger" src="../../closed.png" alt="+"/> Граф вызовов:</div>
<div id="dynsection-59-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-59-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_a73d8e6acdfb996002f980ab7c9c18515_cgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a73d8e6acdfb996002f980ab7c9c18515_cgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a73d8e6acdfb996002f980ab7c9c18515_cgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a73d8e6acdfb996002f980ab7c9c18515_cgraph">
<area shape="rect" title="Удаляет данные из таблицы через вызов внутреннего метода." alt="" coords="5,56,62,81"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#aa4094e522b4780bd58666dba20fdd09d" title="Формирует SQL&#45;запрос на удаление данных из таблицы, проверяет входные данные, обрабатывает недопустим..." alt="" coords="110,56,222,81"/>
<area shape="poly" title=" " alt="" coords="62,66,94,66,94,71,62,71"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a852d15f131983e6f53045146bede2958" title="Формирует строку дополнений для SQL&#45;запроса (например, WHERE, GROUP BY, ORDER BY, LIMIT)." alt="" coords="270,19,391,43"/>
<area shape="poly" title=" " alt="" coords="222,53,258,45,259,50,223,58"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a941629b86b9c9e34bc5926c0db2478b5" title="Выполняет SQL&#45;запрос с использованием подготовленных выражений." alt="" coords="275,80,386,105"/>
<area shape="poly" title=" " alt="" coords="223,74,260,79,259,85,222,79"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a24acdb048ce17d880bd12b0f74567352" title="Формирует группу условий для WHERE с указанным оператором (OR/NOT)." alt="" coords="439,5,576,30"/>
<area shape="poly" title=" " alt="" coords="392,24,424,21,424,27,392,29"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#af1b08f0490df0963b0daac6690d4765f" title="Выполняет преобразование SQL&#45;запроса в зависимости от текущего формата и типа СУБД." alt="" coords="453,55,562,79"/>
<area shape="poly" title=" " alt="" coords="386,82,437,74,438,80,387,87"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a53c8e7da5436bad14f32f64d5b532f60" title="Логирует результат анализа SQL&#45;запроса с помощью EXPLAIN или EXPLAIN ANALYZE." alt="" coords="461,104,554,129"/>
<area shape="poly" title=" " alt="" coords="387,97,446,105,446,111,386,103"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a8f393cc6e7e1b7e6394a9c2d4abdd8e7" title="Логирует медленные запросы, запросы без использования плейсхолдеров и другие запросы в таблицу логов." alt="" coords="466,153,549,178"/>
<area shape="poly" title=" " alt="" coords="361,103,440,138,458,145,456,150,438,143,359,108"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#ad620cb343252ceea735bab03860a0915" title="Производит преобразование SQL&#45;запроса из формата MySQL в целевой формат СУБД (PostgreSQL или SQLite)." alt="" coords="624,5,787,30"/>
<area shape="poly" title=" " alt="" coords="559,51,638,32,639,37,561,57"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a2e93ad3621ba0d7cf06d36c539b6c290" title="Производит преобразование SQL&#45;запроса из формата PostgreSQL в целевой формат СУБД (MySQL или SQLite)." alt="" coords="625,55,786,79"/>
<area shape="poly" title=" " alt="" coords="563,64,609,64,609,70,563,70"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a44e1aec00a15341cd9119261482eeb0d" title="Производит преобразование SQL&#45;запроса из формата SQLite в целевой формат СУБД (MySQL или PostgreSQL)." alt="" coords="625,104,786,129"/>
<area shape="poly" title=" " alt="" coords="561,77,639,97,638,102,559,83"/>
</map>
</div>

</div>
</div>
<a id="ac0e58b1bf2a72bbbaa896b9849ed0e42" name="ac0e58b1bf2a72bbbaa896b9849ed0e42"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac0e58b1bf2a72bbbaa896b9849ed0e42">&#9670;&#160;</a></span>format_date()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">format_date </td>
          <td>(</td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>$column</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>$format</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Формирует SQL-выражение для форматирования даты с учетом специфики используемой СУБД. </p>
<p>Этот публичный метод является обёрткой для защищённого метода <code>_format_date_internal()</code>. Он принимает название столбца с датой и формат даты, а затем вызывает внутренний метод для формирования соответствующего SQL-выражения, учитывая специфику используемой СУБД. Метод предназначен для использования клиентским кодом для получения SQL-выражений для форматирования дат в запросах.</p>
<dl class="params"><dt>Аргументы</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$column</td><td>Название столбца с датой:<ul>
<li>Должен быть непустой строкой в формате имени столбца таблицы в БД. </li>
</ul>
</td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$format</td><td>Формат даты:<ul>
<li>Может быть указан в любом поддерживаемом формате (например, MySQL, PostgreSQL, SQLite).</li>
<li>Преобразование выполняется во внутренней логике в зависимости от типа СУБД.</li>
</ul>
</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Возвращает</dt><dd>string SQL-выражение для форматирования даты.</dd></dl>
<dl class="exception"><dt>Исключения</dt><dd>
  <table class="exception">
    <tr><td class="paramname">InvalidArgumentException</td><td>Выбрасывается, если тип СУБД не поддерживается (выбрасывается из внутренней логики). Пример сообщения: Не поддерживаемый тип СУБД | Тип: unknown</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Заметки</dt><dd>Этот метод является точкой входа для получения SQL-выражений для форматирования даты. Преобразование формата даты и выбор специфичной для СУБД функции выполняются в защищённом методе <code>_format_date_internal()</code>. </dd></dl>
<dl class="section warning"><dt>Предупреждения</dt><dd>Убедитесь, что <code>$column</code> (непустая строка) и <code>$format</code> содержат корректные значения перед вызовом метода. Неверный формат может привести к ошибкам при формировании SQL-запроса.</dd></dl>
<p>Пример использования: </p><div class="fragment"><div class="line"><span class="comment">// Пример использования публичного метода для форматирования даты</span></div>
<div class="line"><a class="code hl_variable" href="../../de/d90/namespacePhotoRigma.html#a1fa3127fc82f96b1436d871ef02be319">$db</a> = new \PhotoRigma\Classes\Database();</div>
<div class="line"> </div>
<div class="line">$formattedDateSql = <a class="code hl_variable" href="../../de/d90/namespacePhotoRigma.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;format_date(<span class="stringliteral">&#39;created_at&#39;</span>, <span class="stringliteral">&#39;%Y-%m-%d&#39;</span>);</div>
<div class="line"><span class="comment">// $formattedDateSql будет содержать SQL-выражение, специфичное для текущей СУБД,</span></div>
<div class="line"><span class="comment">// например: DATE_FORMAT(created_at, &#39;%Y-%m-%d&#39;) для MySQL</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Пример использования в SELECT запросе</span></div>
<div class="line"><span class="comment">// $results = $db-&gt;select([$db-&gt;format_date(&#39;timestamp&#39;, &#39;YYYY-MM-DD&#39;) . &#39; as formatted_date&#39;], &#39;logs&#39;, [...]);</span></div>
</div><!-- fragment --> <dl class="section see"><dt>См. также</dt><dd><a class="el" href="#ad7c3527d920ebf2dbcbc0c51845835d6" title="Формирует SQL-выражение для форматирования даты с учетом специфики используемой СУБД.">PhotoRigma\Classes\Database\_format_date_internal()</a> Защищённый метод, выполняющий основную логику формирования SQL-выражения. </dd></dl>

<p>Замещает <a class="el" href="../../d7/dc2/interfacePhotoRigma_1_1Interfaces_1_1Database__Interface.html#ac0e58b1bf2a72bbbaa896b9849ed0e42">Database_Interface</a>.</p>

<p class="definition">См. определение в файле <a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a> строка <a class="el" href="../../d2/d89/Database_8php_source.html#l02173">2173</a></p>

<p class="reference">Перекрестные ссылки <a class="el" href="../../d2/d89/Database_8php_source.html#l02248">_format_date_internal()</a>.</p>
<div id="dynsection-60" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-60-trigger" src="../../closed.png" alt="+"/> Граф вызовов:</div>
<div id="dynsection-60-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-60-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_ac0e58b1bf2a72bbbaa896b9849ed0e42_cgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_ac0e58b1bf2a72bbbaa896b9849ed0e42_cgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_ac0e58b1bf2a72bbbaa896b9849ed0e42_cgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_ac0e58b1bf2a72bbbaa896b9849ed0e42_cgraph">
<area shape="rect" title="Формирует SQL&#45;выражение для форматирования даты с учетом специфики используемой СУБД." alt="" coords="5,61,96,86"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#ad7c3527d920ebf2dbcbc0c51845835d6" title="Формирует SQL&#45;выражение для форматирования даты с учетом специфики используемой СУБД." alt="" coords="144,61,290,86"/>
<area shape="poly" title=" " alt="" coords="96,71,128,71,128,76,96,76"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a5f4312bd1da12e43a8f9a046ed068ebd" title="Производит преобразование строки формата даты/времени в формат, совместимый с MySQL (DATE_FORMAT)." alt="" coords="338,5,512,30"/>
<area shape="poly" title=" " alt="" coords="265,58,361,32,363,37,267,63"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#ae74eea110900ed128b205a3d0c91687b" title="Преобразует формат даты/времени в формат, совместимый с PostgreSQL." alt="" coords="352,54,498,93"/>
<area shape="poly" title=" " alt="" coords="290,71,336,71,336,76,290,76"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a80464f4180268442d13e5e319274a30a" title="Преобразует формат даты/времени в формат, совместимый с SQLite (strftime)." alt="" coords="362,117,489,156"/>
<area shape="poly" title=" " alt="" coords="262,84,347,110,346,115,260,89"/>
</map>
</div>

</div>
</div>
<a id="a9377cc9a0272aa329e548cc608936bb5" name="a9377cc9a0272aa329e548cc608936bb5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9377cc9a0272aa329e548cc608936bb5">&#9670;&#160;</a></span>full_text_search()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">full_text_search </td>
          <td>(</td>
          <td class="paramtype">array</td>          <td class="paramname"><span class="paramname"><em>$columns_to_return</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">array</td>          <td class="paramname"><span class="paramname"><em>$columns_to_search</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>$search_string</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>$table</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">array</td>          <td class="paramname"><span class="paramname"><em>$options</em></span><span class="paramdefsep"> = </span><span class="paramdefval">[]</span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Выполняет полнотекстовый поиск в указанной таблице. </p>
<p>Этот публичный метод является точкой входа для выполнения полнотекстового поиска. Он вызывает внутреннюю логику поиска, реализованную в защищённом методе <code>_full_text_search_internal()</code>, передавая ему все необходимые параметры и опции. Безопасность запроса обеспечивается использованием подготовленных выражений.</p>
<dl class="params"><dt>Аргументы</dt><dd>
  <table class="params">
    <tr><td class="paramtype">array</td><td class="paramname">$columns_to_return</td><td>Массив строк с именами столбцов, данные из которых нужно вернуть. </td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$columns_to_search</td><td>Массив строк с именами столбцов, по которым выполняется поиск. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$search_string</td><td>Строка для полнотекстового поиска.<ul>
<li>Может содержать <code>*</code> для выбора всех записей. </li>
</ul>
</td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$table</td><td>Строка с именем таблицы, в которой выполняется поиск. </td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$options</td><td>Массив дополнительных опций для формирования запроса. Поддерживаемые ключи:<ul>
<li>where (string|array|false): Условие WHERE.<ul>
<li>string - используется как есть.</li>
<li>array - преобразуется в SQL.</li>
<li>false - игнорируется.</li>
</ul>
</li>
<li>group (string|false): GROUP BY. Игнорируется, если false.</li>
<li>order (string|false): ORDER BY. Игнорируется, если false.</li>
<li>limit (int|string|false): LIMIT.<ul>
<li>int - прямое значение.</li>
<li>string - формат "OFFSET,COUNT".</li>
<li>false - игнорируется.</li>
</ul>
</li>
<li>params (array): Ассоциативный массив параметров ([":имя" =&gt; значение]). Использование параметров <code>params</code> обязательно для защиты от SQL-инъекций.</li>
</ul>
</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Возвращает</dt><dd>array|false Результат выполнения поиска (массив данных или false, если результат пустой).</dd></dl>
<dl class="exception"><dt>Исключения</dt><dd>
  <table class="exception">
    <tr><td class="paramname">RuntimeException</td><td>Если не удалось получить версию БД из таблицы db_version (выбрасывается из внутренней логики). </td></tr>
    <tr><td class="paramname">InvalidArgumentException</td><td>Если переданы недопустимые аргументы или тип СУБД не поддерживается (выбрасывается из внутренней логики). </td></tr>
    <tr><td class="paramname">JsonException</td><td>При ошибках, связанных с кодированием/декодированием JSON. </td></tr>
    <tr><td class="paramname">Exception</td><td>Если произошла ошибка при выполнении запроса на более низких уровнях.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Заметки</dt><dd>Этот метод является точкой входа для выполнения запросов с полнотекстовым поиском. Все проверки и обработка выполняются в защищённом методе <code>_full_text_search_internal()</code>.</dd></dl>
<dl class="section warning"><dt>Предупреждения</dt><dd>Метод чувствителен к корректности входных данных. Убедитесь, что массивы столбцов и имя таблицы не пусты, а строка поиска не пустая (если не <code>*</code>). Использование параметров <code>params</code> в <code>$options</code> обязательно для значений, подставляемых в запросы.</dd></dl>
<p>Пример использования: </p><div class="fragment"><div class="line"><span class="comment">// Пример вызова публичного метода</span></div>
<div class="line"><a class="code hl_variable" href="../../de/d90/namespacePhotoRigma.html#a1fa3127fc82f96b1436d871ef02be319">$db</a> = new \PhotoRigma\Classes\Database();</div>
<div class="line"> </div>
<div class="line">$results = <a class="code hl_variable" href="../../de/d90/namespacePhotoRigma.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;full_text_search(</div>
<div class="line">    [<span class="stringliteral">&#39;id&#39;</span>, <span class="stringliteral">&#39;title&#39;</span>],</div>
<div class="line">    [<span class="stringliteral">&#39;title&#39;</span>, <span class="stringliteral">&#39;content&#39;</span>],</div>
<div class="line">    <span class="stringliteral">&#39;test&#39;</span>,</div>
<div class="line">    <span class="stringliteral">&#39;articles&#39;</span>,</div>
<div class="line">    [</div>
<div class="line">        <span class="stringliteral">&#39;where&#39;</span> =&gt; [<span class="stringliteral">&#39;is_active&#39;</span> =&gt; <span class="keyword">true</span>],</div>
<div class="line">        <span class="stringliteral">&#39;limit&#39;</span> =&gt; 5,</div>
<div class="line">        <span class="stringliteral">&#39;params&#39;</span> =&gt; [<span class="stringliteral">&#39;:is_active&#39;</span> =&gt; <span class="keyword">true</span>]</div>
<div class="line">    ]</div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> ($results !== <span class="keyword">false</span>) {</div>
<div class="line">    print_r($results);</div>
<div class="line">} <span class="keywordflow">else</span> {</div>
<div class="line">    echo <span class="stringliteral">&quot;Ничего не найдено.&quot;</span>;</div>
<div class="line">}</div>
</div><!-- fragment --> <dl class="section see"><dt>См. также</dt><dd><a class="el" href="#a1a9c9d8aa5d7a039660197843f626268" title="Выполняет полнотекстовый поиск в указанной таблице по заданным столбцам.">PhotoRigma\Classes\Database\_full_text_search_internal()</a> Защищённый метод, выполняющий основную логику полнотекстового поиска. </dd></dl>

<p>Замещает <a class="el" href="../../d7/dc2/interfacePhotoRigma_1_1Interfaces_1_1Database__Interface.html#a9377cc9a0272aa329e548cc608936bb5">Database_Interface</a>.</p>

<p class="definition">См. определение в файле <a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a> строка <a class="el" href="../../d2/d89/Database_8php_source.html#l04470">4470</a></p>

<p class="reference">Перекрестные ссылки <a class="el" href="../../d2/d89/Database_8php_source.html#l04615">_full_text_search_internal()</a>.</p>
<div id="dynsection-61" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-61-trigger" src="../../closed.png" alt="+"/> Граф вызовов:</div>
<div id="dynsection-61-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-61-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_a9377cc9a0272aa329e548cc608936bb5_cgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a9377cc9a0272aa329e548cc608936bb5_cgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a9377cc9a0272aa329e548cc608936bb5_cgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a9377cc9a0272aa329e548cc608936bb5_cgraph">
<area shape="rect" title="Выполняет полнотекстовый поиск в указанной таблице." alt="" coords="5,29,118,54"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a1a9c9d8aa5d7a039660197843f626268" title="Выполняет полнотекстовый поиск в указанной таблице по заданным столбцам." alt="" coords="166,29,334,54"/>
<area shape="poly" title=" " alt="" coords="118,39,150,39,150,44,118,44"/>
<area shape="poly" title=" " alt="" coords="219,31,212,21,216,11,228,5,250,3,273,5,285,12,282,17,272,10,250,8,230,10,219,15,217,20,223,27"/>
</map>
</div>

</div>
</div>
<a id="a2c437dae4e310529391e7f5388b133ba" name="a2c437dae4e310529391e7f5388b133ba"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2c437dae4e310529391e7f5388b133ba">&#9670;&#160;</a></span>get_affected_rows()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">get_affected_rows </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Возвращает количество строк, затронутых последним SQL-запросом. </p>
<p>Этот публичный метод является обёрткой для защищённого метода <code>_get_affected_rows_internal()</code>. Он вызывает внутренний метод для получения значения количества строк, затронутых последним выполненным запросом INSERT, UPDATE, DELETE или REPLACE, после соответствующих проверок. Метод предназначен для использования клиентским кодом как точка входа для получения информации о результатах модифицирующих запросов.</p>
<dl class="section return"><dt>Возвращает</dt><dd>int Количество строк, затронутых последним SQL-запросом.</dd></dl>
<dl class="exception"><dt>Исключения</dt><dd>
  <table class="exception">
    <tr><td class="paramname">InvalidArgumentException</td><td>Выбрасывается, если количество затронутых строк не установлено или имеет некорректное значение (выбрасывается из внутренней логики). Пример сообщения: Количество затронутых строк не установлено | Причина: Свойство aff_rows не определено</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Заметки</dt><dd>Этот метод является точкой входа для получения количества затронутых строк. Значение количества строк устанавливается методами выполнения запросов (например, <code>insert()</code>, <code>update()</code>, <code>delete()</code>). Внутренняя логика получения значения и проверки его корректности выполняется в защищённом методе <code>_get_affected_rows_internal()</code>. </dd></dl>
<dl class="section warning"><dt>Предупреждения</dt><dd>Убедитесь, что перед вызовом этого метода был выполнен модифицирующий запрос (INSERT, UPDATE, DELETE или REPLACE), чтобы количество затронутых строк было установлено.</dd></dl>
<p>Пример использования: </p><div class="fragment"><div class="line"><span class="comment">// Предполагается, что перед этим был выполнен INSERT, UPDATE, DELETE или REPLACE запрос</span></div>
<div class="line"><a class="code hl_variable" href="../../de/d90/namespacePhotoRigma.html#a1fa3127fc82f96b1436d871ef02be319">$db</a> = new \PhotoRigma\Classes\Database();</div>
<div class="line"><span class="comment">// ... например: $db-&gt;update(&#39;users&#39;, [&#39;status&#39; =&gt; 1], [&#39;where&#39; =&gt; &#39;id = 5&#39;]);</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Получаем количество затронутых строк</span></div>
<div class="line">$affectedRows = <a class="code hl_variable" href="../../de/d90/namespacePhotoRigma.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;get_affected_rows();</div>
<div class="line">echo <span class="stringliteral">&quot;Affected rows: &quot;</span> . $affectedRows;</div>
</div><!-- fragment --> <dl class="section see"><dt>См. также</dt><dd><a class="el" href="#a834ca0d1c7c60bc9bfae123070b45fbd" title="Возвращает количество строк, затронутых последним SQL-запросом, после проверки состояния свойства $af...">PhotoRigma\Classes\Database\_get_affected_rows_internal()</a> Защищённый метод, выполняющий основную логику получения количества затронутых строк. </dd></dl>

<p>Замещает <a class="el" href="../../d7/dc2/interfacePhotoRigma_1_1Interfaces_1_1Database__Interface.html#a2c437dae4e310529391e7f5388b133ba">Database_Interface</a>.</p>

<p class="definition">См. определение в файле <a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a> строка <a class="el" href="../../d2/d89/Database_8php_source.html#l02656">2656</a></p>

<p class="reference">Перекрестные ссылки <a class="el" href="../../d2/d89/Database_8php_source.html#l02722">_get_affected_rows_internal()</a>.</p>
<div id="dynsection-62" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-62-trigger" src="../../closed.png" alt="+"/> Граф вызовов:</div>
<div id="dynsection-62-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-62-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_a2c437dae4e310529391e7f5388b133ba_cgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a2c437dae4e310529391e7f5388b133ba_cgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a2c437dae4e310529391e7f5388b133ba_cgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a2c437dae4e310529391e7f5388b133ba_cgraph">
<area shape="rect" title="Возвращает количество строк, затронутых последним SQL&#45;запросом." alt="" coords="5,12,133,37"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a834ca0d1c7c60bc9bfae123070b45fbd" title="Возвращает количество строк, затронутых последним SQL&#45;запросом, после проверки состояния свойства $af..." alt="" coords="181,5,315,44"/>
<area shape="poly" title=" " alt="" coords="133,22,165,22,165,27,133,27"/>
</map>
</div>

</div>
</div>
<a id="abafff8c03a52d73e37072449448e5a3c" name="abafff8c03a52d73e37072449448e5a3c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abafff8c03a52d73e37072449448e5a3c">&#9670;&#160;</a></span>get_last_insert_id()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">get_last_insert_id </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Возвращает ID последней вставленной строки. </p>
<p>Этот публичный метод является обёрткой для защищённого метода <code>_get_last_insert_id_internal()</code>. Он вызывает внутренний метод для получения значения ID последней вставленной строки после соответствующих проверок. Метод предназначен для использования клиентским кодом как точка входа для получения информации о результатах операций вставки данных.</p>
<dl class="section return"><dt>Возвращает</dt><dd>int ID последней вставленной строки.</dd></dl>
<dl class="exception"><dt>Исключения</dt><dd>
  <table class="exception">
    <tr><td class="paramname">InvalidArgumentException</td><td>Выбрасывается, если ID последней вставленной строки не установлено или имеет некорректное значение (выбрасывается из внутренней логики). Пример сообщения: ID последней вставленной строки не установлен | Причина: Свойство insert_id не определено</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Заметки</dt><dd>Этот метод является точкой входа для получения ID последней вставленной строки. Значение ID устанавливается методами выполнения INSERT запросов (например, <code>insert()</code>). Внутренняя логика получения значения и проверки его корректности выполняется в защищённом методе <code>_get_last_insert_id_internal()</code>. </dd></dl>
<dl class="section warning"><dt>Предупреждения</dt><dd>Убедитесь, что перед вызовом этого метода был выполнен запрос на вставку данных (INSERT), чтобы ID последней вставленной строки было установлено.</dd></dl>
<p>Пример использования: </p><div class="fragment"><div class="line"><span class="comment">// Предполагается, что перед этим был выполнен INSERT запрос</span></div>
<div class="line"><a class="code hl_variable" href="../../de/d90/namespacePhotoRigma.html#a1fa3127fc82f96b1436d871ef02be319">$db</a> = new \PhotoRigma\Classes\Database();</div>
<div class="line"><span class="comment">// ... например: $db-&gt;insert([&#39;name&#39; =&gt; &#39;New User&#39;], &#39;users&#39;);</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Получаем ID последней вставленной строки</span></div>
<div class="line">$lastInsertId = <a class="code hl_variable" href="../../de/d90/namespacePhotoRigma.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;get_last_insert_id();</div>
<div class="line">echo <span class="stringliteral">&quot;Last insert ID: &quot;</span> . $lastInsertId;</div>
</div><!-- fragment --> <dl class="section see"><dt>См. также</dt><dd><a class="el" href="#ab122f53e8d2ca9d723e32426c9e691e9" title="Возвращает ID последней вставленной строки после проверки состояния свойства $insert_id.">PhotoRigma\Classes\Database\_get_last_insert_id_internal()</a> Защищённый метод, выполняющий основную логику получения ID последней вставленной строки. </dd></dl>

<p>Замещает <a class="el" href="../../d7/dc2/interfacePhotoRigma_1_1Interfaces_1_1Database__Interface.html#abafff8c03a52d73e37072449448e5a3c">Database_Interface</a>.</p>

<p class="definition">См. определение в файле <a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a> строка <a class="el" href="../../d2/d89/Database_8php_source.html#l02773">2773</a></p>

<p class="reference">Перекрестные ссылки <a class="el" href="../../d2/d89/Database_8php_source.html#l02834">_get_last_insert_id_internal()</a>.</p>
<div id="dynsection-63" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-63-trigger" src="../../closed.png" alt="+"/> Граф вызовов:</div>
<div id="dynsection-63-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-63-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_abafff8c03a52d73e37072449448e5a3c_cgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_abafff8c03a52d73e37072449448e5a3c_cgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_abafff8c03a52d73e37072449448e5a3c_cgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_abafff8c03a52d73e37072449448e5a3c_cgraph">
<area shape="rect" title="Возвращает ID последней вставленной строки." alt="" coords="5,12,129,37"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#ab122f53e8d2ca9d723e32426c9e691e9" title="Возвращает ID последней вставленной строки после проверки состояния свойства $insert_id." alt="" coords="177,5,307,44"/>
<area shape="poly" title=" " alt="" coords="129,22,161,22,161,27,129,27"/>
</map>
</div>

</div>
</div>
<a id="a6e5af1f386c0c7968aa10ea928c7a110" name="a6e5af1f386c0c7968aa10ea928c7a110"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6e5af1f386c0c7968aa10ea928c7a110">&#9670;&#160;</a></span>insert()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">insert </td>
          <td>(</td>
          <td class="paramtype">array</td>          <td class="paramname"><span class="paramname"><em>$insert</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>$to_tbl</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>$type</em></span><span class="paramdefsep"> = </span><span class="paramdefval">''</span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">array</td>          <td class="paramname"><span class="paramname"><em>$options</em></span><span class="paramdefsep"> = </span><span class="paramdefval">[]</span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Вставляет данные в таблицу через вызов внутреннего метода. </p>
<p>Этот публичный метод является обёрткой для защищённого метода <code>_insert_internal()</code>. Он передаёт массив данных для вставки, имя таблицы, тип запроса и опции во внутренний метод, который выполняет формирование и выполнение SQL-запроса на вставку. Метод поддерживает различные типы вставок (<code>IGNORE</code>, <code>REPLACE</code>, <code>INTO</code>). Безопасность обеспечивается использованием подготовленных выражений с параметрами. Метод предназначен для использования клиентским кодом как точка входа для выполнения операций вставки данных.</p>
<dl class="params"><dt>Аргументы</dt><dd>
  <table class="params">
    <tr><td class="paramtype">array</td><td class="paramname">$insert</td><td>Ассоциативный массив данных для вставки в формате: 'имя_поля' =&gt; 'значение' или 'имя_поля' =&gt; ':плейсхолдер'. Если передан пустой массив, выбрасывается исключение. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$to_tbl</td><td>Имя таблицы, в которую необходимо вставить данные. Должно быть строкой, содержащей только допустимые имена таблиц без специальных символов. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$type</td><td>Тип запроса (необязательно). Определяет тип SQL-запроса на вставку. Допустимые значения:<ul>
<li>'ignore': Формирует запрос типа "INSERT IGNORE INTO".</li>
<li>'replace': Формирует запрос типа "REPLACE INTO".</li>
<li>'into': Формирует запрос типа "INSERT INTO" (явное указание).</li>
<li>'' (пустая строка): Формирует запрос типа "INSERT INTO" (по умолчанию). Если указан недопустимый тип, выбрасывается исключение InvalidArgumentException. </li>
</ul>
</td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$options</td><td>Массив опций для формирования запроса. Поддерживаемые ключи:<ul>
<li>params (array): Параметры для подготовленного выражения. Ассоциативный массив значений, используемых в запросе (например, [":name" =&gt; "John Doe", ":email" =&gt; "john@local.com"]). Обязателен для использования с данными для вставки, требующими подготовленных выражений. Обеспечивает защиту от SQL-инъекций. Может быть пустым массивом, если параметры не требуются.</li>
<li>where (string|array|false): Условие WHERE. Игнорируется в этом методе.</li>
<li>group (string|false): Группировка GROUP BY. Игнорируется в этом методе.</li>
<li>order (string|false): Сортировка ORDER BY. Игнорируется в этом методе.</li>
<li>limit (int|string|false): Ограничение LIMIT. Игнорируется в этом методе.</li>
</ul>
</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Возвращает</dt><dd>bool Возвращает true, если запрос успешно выполнен (даже если результат пустой). В случае ошибки выбрасывается исключение.</dd></dl>
<dl class="exception"><dt>Исключения</dt><dd>
  <table class="exception">
    <tr><td class="paramname">InvalidArgumentException</td><td>Выбрасывается, если:<ul>
<li><code>$insert</code> не является массивом или является пустым массивом. Пример сообщения: Данные для вставки не могут быть пустыми | Причина: Пустой массив данных</li>
<li><code>$to_tbl</code> не является строкой. Пример сообщения: Недопустимое имя таблицы | Ожидалась строка, получено: [тип]</li>
<li><code>$type</code> содержит недопустимое значение (не '', 'ignore', 'replace', 'into'). Пример сообщения: Недопустимый тип вставки | Разрешённые значения: '', 'ignore', 'replace', 'into'. Получено: '$type'</li>
<li><code>$options</code> не является массивом. Пример сообщения: Недопустимый тип параметра options | Ожидался массив, получено: [тип] </li>
</ul>
</td></tr>
    <tr><td class="paramname">Exception</td><td>Выбрасывается при ошибках выполнения запроса.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Заметки</dt><dd>Этот метод является точкой входа для выполнения операций вставки данных. Все проверки и основная логика выполняются в защищённом методе <code>_insert_internal()</code>. Ключи массива <code>$options</code> (<code>where</code>, <code>group</code>, <code>order</code>, <code>limit</code>) игнорируются в этом методе.</dd></dl>
<dl class="section warning"><dt>Предупреждения</dt><dd>Метод чувствителен к корректности входных данных. Неверные типы данных или некорректные значения могут привести к выбросу исключения. Убедитесь, что массив <code>$insert</code> не пустой и содержит корректные данные. Параметр <code>$type</code> должен быть одним из допустимых значений: '', 'ignore', 'replace', 'into'. Использование параметров <code>params</code> для подготовленных выражений является обязательным для защиты от SQL-инъекций и обеспечения совместимости с различными СУБД.</dd></dl>
<p>Пример использования: </p><div class="fragment"><div class="line"><span class="comment">// Пример безопасного использования публичного метода INSERT</span></div>
<div class="line"><a class="code hl_variable" href="../../de/d90/namespacePhotoRigma.html#a1fa3127fc82f96b1436d871ef02be319">$db</a> = new \PhotoRigma\Classes\Database();</div>
<div class="line"> </div>
<div class="line"><a class="code hl_variable" href="../../de/d90/namespacePhotoRigma.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;insert(</div>
<div class="line">    [<span class="stringliteral">&#39;name&#39;</span> =&gt; <span class="stringliteral">&#39;:name&#39;</span>, <span class="stringliteral">&#39;email&#39;</span> =&gt; <span class="stringliteral">&#39;:email&#39;</span>],</div>
<div class="line">    <span class="stringliteral">&#39;users&#39;</span>,</div>
<div class="line">    <span class="stringliteral">&#39;&#39;</span>, <span class="comment">// или &#39;ignore&#39;, &#39;replace&#39;, &#39;into&#39;</span></div>
<div class="line">    [<span class="stringliteral">&#39;params&#39;</span> =&gt; [<span class="stringliteral">&#39;:name&#39;</span> =&gt; <span class="stringliteral">&#39;John Doe&#39;</span>, <span class="stringliteral">&#39;:email&#39;</span> =&gt; <span class="stringliteral">&#39;john@local.com&#39;</span>]]</div>
<div class="line">);</div>
</div><!-- fragment --> <dl class="section see"><dt>См. также</dt><dd><a class="el" href="#a442c0348c8bd3cd7104cb110cc71348a" title="Формирует SQL-запрос на вставку данных в таблицу, проверяет входные данные, обрабатывает различные ти...">PhotoRigma\Classes\Database\_insert_internal()</a> Защищённый метод, выполняющий основную логику вставки данных. </dd></dl>

<p>Замещает <a class="el" href="../../d7/dc2/interfacePhotoRigma_1_1Interfaces_1_1Database__Interface.html#a6e5af1f386c0c7968aa10ea928c7a110">Database_Interface</a>.</p>

<p class="definition">См. определение в файле <a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a> строка <a class="el" href="../../d2/d89/Database_8php_source.html#l02928">2928</a></p>

<p class="reference">Перекрестные ссылки <a class="el" href="../../d2/d89/Database_8php_source.html#l03029">_insert_internal()</a>.</p>
<div id="dynsection-64" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-64-trigger" src="../../closed.png" alt="+"/> Граф вызовов:</div>
<div id="dynsection-64-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-64-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_a6e5af1f386c0c7968aa10ea928c7a110_cgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a6e5af1f386c0c7968aa10ea928c7a110_cgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a6e5af1f386c0c7968aa10ea928c7a110_cgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a6e5af1f386c0c7968aa10ea928c7a110_cgraph">
<area shape="rect" title="Вставляет данные в таблицу через вызов внутреннего метода." alt="" coords="5,104,59,129"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a442c0348c8bd3cd7104cb110cc71348a" title="Формирует SQL&#45;запрос на вставку данных в таблицу, проверяет входные данные, обрабатывает различные ти..." alt="" coords="107,104,216,129"/>
<area shape="poly" title=" " alt="" coords="59,114,91,114,91,119,59,119"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a941629b86b9c9e34bc5926c0db2478b5" title="Выполняет SQL&#45;запрос с использованием подготовленных выражений." alt="" coords="264,104,375,129"/>
<area shape="poly" title=" " alt="" coords="216,114,249,114,249,119,216,119"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#af1b08f0490df0963b0daac6690d4765f" title="Выполняет преобразование SQL&#45;запроса в зависимости от текущего формата и типа СУБД." alt="" coords="423,55,533,79"/>
<area shape="poly" title=" " alt="" coords="361,101,421,82,422,87,363,106"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a53c8e7da5436bad14f32f64d5b532f60" title="Логирует результат анализа SQL&#45;запроса с помощью EXPLAIN или EXPLAIN ANALYZE." alt="" coords="432,104,524,129"/>
<area shape="poly" title=" " alt="" coords="376,114,416,114,416,119,376,119"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a8f393cc6e7e1b7e6394a9c2d4abdd8e7" title="Логирует медленные запросы, запросы без использования плейсхолдеров и другие запросы в таблицу логов." alt="" coords="436,153,520,178"/>
<area shape="poly" title=" " alt="" coords="363,127,422,146,421,151,361,132"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#ad620cb343252ceea735bab03860a0915" title="Производит преобразование SQL&#45;запроса из формата MySQL в целевой формат СУБД (PostgreSQL или SQLite)." alt="" coords="581,5,744,30"/>
<area shape="poly" title=" " alt="" coords="526,51,598,32,600,37,528,57"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a2e93ad3621ba0d7cf06d36c539b6c290" title="Производит преобразование SQL&#45;запроса из формата PostgreSQL в целевой формат СУБД (MySQL или SQLite)." alt="" coords="582,55,742,79"/>
<area shape="poly" title=" " alt="" coords="533,64,566,64,566,70,533,70"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a44e1aec00a15341cd9119261482eeb0d" title="Производит преобразование SQL&#45;запроса из формата SQLite в целевой формат СУБД (MySQL или PostgreSQL)." alt="" coords="582,104,742,129"/>
<area shape="poly" title=" " alt="" coords="528,77,600,97,598,102,526,83"/>
</map>
</div>

</div>
</div>
<a id="aa2b6c23b3a70e9ef06c22d8a4885d69a" name="aa2b6c23b3a70e9ef06c22d8a4885d69a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa2b6c23b3a70e9ef06c22d8a4885d69a">&#9670;&#160;</a></span>join()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">join </td>
          <td>(</td>
          <td class="paramtype">string|array</td>          <td class="paramname"><span class="paramname"><em>$select</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>$from_tbl</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">array</td>          <td class="paramname"><span class="paramname"><em>$join</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">array</td>          <td class="paramname"><span class="paramname"><em>$options</em></span><span class="paramdefsep"> = </span><span class="paramdefval">[]</span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Выполняет SQL-запрос с использованием JOIN через вызов внутреннего метода. </p>
<p>Этот публичный метод является обёрткой для защищённого метода <code>_join_internal()</code>. Он передаёт список полей, основную таблицу, массив JOIN-операций и опции во внутренний метод, который выполняет формирование и выполнение SQL-запроса с использованием JOIN. Безопасность обеспечивается использованием подготовленных выражений с параметрами. Метод предназначен для использования клиентским кодом как точка входа для выполнения запросов с JOIN.</p>
<dl class="params"><dt>Аргументы</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string&#160;|&#160;array</td><td class="paramname">$select</td><td>Список полей для выборки. Может быть строкой (имя одного поля) или массивом (список полей). Если передан массив, он преобразуется в строку с разделителем <code>,</code>. Пример: "id", ["id", "name"]. Ограничения: массив не может быть пустым. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$from_tbl</td><td>Имя основной таблицы, из которой начинается выборка. Должно быть строкой, содержащей только допустимые имена таблиц без специальных символов. Ограничения: строка должна быть непустой. </td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$join</td><td>Массив описаний JOIN-операций. Каждый элемент массива должен содержать следующие ключи:<ul>
<li>table (string): Имя таблицы для JOIN. Должно быть строкой, содержащей только допустимые имена таблиц.</li>
<li>type (string, optional): Тип JOIN (например, INNER, LEFT, RIGHT). Если тип не указан, используется INNER по умолчанию.</li>
<li>on (string): Условие для JOIN. Должно быть строкой с допустимым условием сравнения полей. Если условие отсутствует, выбрасывается исключение. Пример: [['type' =&gt; 'INNER', 'table' =&gt; 'orders', 'on' =&gt; 'users.id = orders.user_id']]. Ограничения: массив не может быть пустым. </li>
</ul>
</td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$options</td><td>Массив дополнительных опций для формирования запроса. Поддерживаемые ключи:<ul>
<li>where (string|array|false): Условие WHERE.<ul>
<li>string - используется как есть.</li>
<li>array - преобразуется в SQL. Поддерживает простые условия (&lsquo;['поле&rsquo; =&gt; значение]<code>) и логические операторы (</code>'OR' =&gt; [...]<code>, </code>'NOT' =&gt; [...]<code>).</code></li>
<li><code>false - игнорируется.</code></li>
</ul>
</li>
<li><code>group (string|false): Группировка GROUP BY. Игнорируется, если false. Должна быть строкой.</code></li>
<li><code>order (string|false): Сортировка ORDER BY. Игнорируется, если false. Должна быть строкой.</code></li>
<li><code>limit (int|string|false): Ограничение LIMIT.<ul>
<li>int - прямое значение.</li>
<li>string - формат "OFFSET,COUNT".</li>
<li>false - игнорируется.</li>
</ul>
</code></li>
<li><code>params (array): Ассоциативный массив параметров ([":имя" =&gt; значение]). Обязателен для использования с условиями</code>where` и другими частями запроса, требующими подготовленных выражений. Обеспечивает защиту от SQL-инъекций. Может быть пустым массивом, если параметры не требуются.</li>
</ul>
</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Возвращает</dt><dd>bool Возвращает true, если запрос успешно выполнен (даже если результат пустой).</dd></dl>
<dl class="exception"><dt>Исключения</dt><dd>
  <table class="exception">
    <tr><td class="paramname">InvalidArgumentException</td><td>Выбрасывается, если:<ul>
<li><code>$from_tbl</code> не является строкой. Пример сообщения: Недопустимое имя таблицы | Ожидалась строка, получено: [тип]</li>
<li><code>$join</code> не является массивом. Пример сообщения: Недопустимый тип параметра join | Ожидался массив, получено: [тип]</li>
<li><code>$select</code> не является строкой или массивом. Пример сообщения: Недопустимый тип параметра select | Ожидалась строка или массив, получено: [тип]</li>
<li>Отсутствует имя таблицы (<code>table</code>) или условие (<code>on</code>) в описании JOIN. Пример сообщения: Отсутствует имя таблицы или условие для JOIN | Проверьте структуру массива $join</li>
<li><code>$options</code> не является массивом. Пример сообщения: Недопустимый тип параметра options | Ожидался массив, получено: [тип] </li>
</ul>
</td></tr>
    <tr><td class="paramname">Exception</td><td>Выбрасывается при ошибках выполнения запроса.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Заметки</dt><dd>Этот метод является точкой входа для выполнения запросов с JOIN. Все проверки и основная логика выполняются в защищённом методе <code>_join_internal()</code>.</dd></dl>
<dl class="section warning"><dt>Предупреждения</dt><dd>Метод чувствителен к корректности входных данных. Неверные типы данных или некорректные значения могут привести к выбросу исключения. Убедитесь, что массив <code>$join</code> не пустой и содержит корректные данные. Использование параметров <code>params</code> для подготовленных выражений является обязательным для защиты от SQL-инъекций и обеспечения совместимости с различными СУБД.</dd></dl>
<p>Пример использования: </p><div class="fragment"><div class="line"><span class="comment">// Пример безопасного использования публичного метода JOIN</span></div>
<div class="line"><a class="code hl_variable" href="../../de/d90/namespacePhotoRigma.html#a1fa3127fc82f96b1436d871ef02be319">$db</a> = new \PhotoRigma\Classes\Database();</div>
<div class="line"> </div>
<div class="line"><a class="code hl_variable" href="../../de/d90/namespacePhotoRigma.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;join(</div>
<div class="line">    [<span class="stringliteral">&#39;users.id&#39;</span>, <span class="stringliteral">&#39;users.name&#39;</span>, <span class="stringliteral">&#39;orders.order_date&#39;</span>],</div>
<div class="line">    <span class="stringliteral">&#39;users&#39;</span>,</div>
<div class="line">    [</div>
<div class="line">        [<span class="stringliteral">&#39;type&#39;</span> =&gt; <span class="stringliteral">&#39;INNER&#39;</span>, <span class="stringliteral">&#39;table&#39;</span> =&gt; <span class="stringliteral">&#39;orders&#39;</span>, <span class="stringliteral">&#39;on&#39;</span> =&gt; <span class="stringliteral">&#39;users.id = orders.user_id&#39;</span>],</div>
<div class="line">    ],</div>
<div class="line">    [</div>
<div class="line">        <span class="stringliteral">&#39;where&#39;</span> =&gt; [<span class="stringliteral">&#39;users.status&#39;</span> =&gt; 1],</div>
<div class="line">        <span class="stringliteral">&#39;params&#39;</span> =&gt; [<span class="stringliteral">&#39;:status&#39;</span> =&gt; 1],</div>
<div class="line">    ]</div>
<div class="line">);</div>
</div><!-- fragment --> <dl class="section see"><dt>См. также</dt><dd><a class="el" href="#aa3fbbc7c98d1c241e897f0bf80177d2b" title="Формирует SQL-запрос с использованием JOIN для выборки данных из нескольких таблиц,...">PhotoRigma\Classes\Database\_join_internal()</a> Защищённый метод, выполняющий основную логику формирования и выполнения SQL-запроса с JOIN. </dd></dl>

<p>Замещает <a class="el" href="../../d7/dc2/interfacePhotoRigma_1_1Interfaces_1_1Database__Interface.html#aa2b6c23b3a70e9ef06c22d8a4885d69a">Database_Interface</a>.</p>

<p class="definition">См. определение в файле <a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a> строка <a class="el" href="../../d2/d89/Database_8php_source.html#l03165">3165</a></p>

<p class="reference">Перекрестные ссылки <a class="el" href="../../d2/d89/Database_8php_source.html#l03289">_join_internal()</a>.</p>
<div id="dynsection-65" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-65-trigger" src="../../closed.png" alt="+"/> Граф вызовов:</div>
<div id="dynsection-65-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-65-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_aa2b6c23b3a70e9ef06c22d8a4885d69a_cgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_aa2b6c23b3a70e9ef06c22d8a4885d69a_cgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_aa2b6c23b3a70e9ef06c22d8a4885d69a_cgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_aa2b6c23b3a70e9ef06c22d8a4885d69a_cgraph">
<area shape="rect" title="Выполняет SQL&#45;запрос с использованием JOIN через вызов внутреннего метода." alt="" coords="5,56,47,81"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#aa3fbbc7c98d1c241e897f0bf80177d2b" title="Формирует SQL&#45;запрос с использованием JOIN для выборки данных из нескольких таблиц,..." alt="" coords="95,56,192,81"/>
<area shape="poly" title=" " alt="" coords="47,66,79,66,79,71,47,71"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a852d15f131983e6f53045146bede2958" title="Формирует строку дополнений для SQL&#45;запроса (например, WHERE, GROUP BY, ORDER BY, LIMIT)." alt="" coords="240,19,361,43"/>
<area shape="poly" title=" " alt="" coords="192,54,230,45,232,50,193,59"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a941629b86b9c9e34bc5926c0db2478b5" title="Выполняет SQL&#45;запрос с использованием подготовленных выражений." alt="" coords="245,80,356,105"/>
<area shape="poly" title=" " alt="" coords="193,73,230,79,229,84,192,78"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a24acdb048ce17d880bd12b0f74567352" title="Формирует группу условий для WHERE с указанным оператором (OR/NOT)." alt="" coords="409,5,546,30"/>
<area shape="poly" title=" " alt="" coords="362,24,394,21,394,27,362,29"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#af1b08f0490df0963b0daac6690d4765f" title="Выполняет преобразование SQL&#45;запроса в зависимости от текущего формата и типа СУБД." alt="" coords="423,55,532,79"/>
<area shape="poly" title=" " alt="" coords="356,82,407,74,408,80,357,87"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a53c8e7da5436bad14f32f64d5b532f60" title="Логирует результат анализа SQL&#45;запроса с помощью EXPLAIN или EXPLAIN ANALYZE." alt="" coords="431,104,524,129"/>
<area shape="poly" title=" " alt="" coords="357,97,416,105,416,111,356,103"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a8f393cc6e7e1b7e6394a9c2d4abdd8e7" title="Логирует медленные запросы, запросы без использования плейсхолдеров и другие запросы в таблицу логов." alt="" coords="436,153,519,178"/>
<area shape="poly" title=" " alt="" coords="331,103,410,138,428,145,426,150,408,143,329,108"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#ad620cb343252ceea735bab03860a0915" title="Производит преобразование SQL&#45;запроса из формата MySQL в целевой формат СУБД (PostgreSQL или SQLite)." alt="" coords="594,5,757,30"/>
<area shape="poly" title=" " alt="" coords="529,51,608,32,609,37,531,57"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a2e93ad3621ba0d7cf06d36c539b6c290" title="Производит преобразование SQL&#45;запроса из формата PostgreSQL в целевой формат СУБД (MySQL или SQLite)." alt="" coords="595,55,756,79"/>
<area shape="poly" title=" " alt="" coords="533,64,579,64,579,70,533,70"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a44e1aec00a15341cd9119261482eeb0d" title="Производит преобразование SQL&#45;запроса из формата SQLite в целевой формат СУБД (MySQL или PostgreSQL)." alt="" coords="595,104,756,129"/>
<area shape="poly" title=" " alt="" coords="531,77,609,97,608,102,529,83"/>
</map>
</div>

</div>
</div>
<a id="a444f7dd61bfbe3931a7188adad61feae" name="a444f7dd61bfbe3931a7188adad61feae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a444f7dd61bfbe3931a7188adad61feae">&#9670;&#160;</a></span>result_array()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">result_array </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Извлекает все строки результата из подготовленного выражения. </p>
<p>Этот публичный метод является обёрткой для защищённого метода <code>_result_array_internal()</code>. Он вызывает внутренний метод для извлечения всех строк результата последнего выполненного запроса из свойства <code>$res_query</code> в виде массива ассоциативных массивов, после соответствующих проверок. Метод предназначен для использования клиентским кодом как точка входа для получения всех результатов запроса SELECT.</p>
<dl class="section return"><dt>Возвращает</dt><dd>array|false Возвращает массив ассоциативных массивов, содержащих данные всех строк результата, если они доступны. Если результатов нет (запрос не вернул строк), возвращает <code>false</code>.</dd></dl>
<dl class="exception"><dt>Исключения</dt><dd>
  <table class="exception">
    <tr><td class="paramname">InvalidArgumentException</td><td>Выбрасывается, если результат запроса недоступен или имеет некорректный тип (выбрасывается из внутренней логики). Пример сообщения: Результат запроса недоступен | Причина: Свойство $res_query не установлено</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Заметки</dt><dd>Этот метод является точкой входа для получения всех строк результата запроса. Результат запроса (объект PDOStatement в свойстве <code>$res_query</code>) устанавливается методом выполнения запроса (например, <code>_execute_query()</code>). Внутренняя логика получения данных и проверки их корректности выполняется в защищённом методе <code>_result_array_internal()</code>. </dd></dl>
<dl class="section warning"><dt>Предупреждения</dt><dd>Убедитесь, что перед вызовом этого метода был успешно выполнен запрос (например, SELECT), который установил доступный для чтения результат (<code>$res_query</code>).</dd></dl>
<p>Пример использования: </p><div class="fragment"><div class="line"><span class="comment">// Предполагается, что перед этим был выполнен SELECT запрос</span></div>
<div class="line"><a class="code hl_variable" href="../../de/d90/namespacePhotoRigma.html#a1fa3127fc82f96b1436d871ef02be319">$db</a> = new \PhotoRigma\Classes\Database();</div>
<div class="line"><span class="comment">// ... например: $db-&gt;select([&#39;id&#39;, &#39;name&#39;], &#39;users&#39;, [&#39;where&#39; =&gt; &#39;status = 1&#39;]);</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Получаем все строки результата в виде массива</span></div>
<div class="line">$results = <a class="code hl_variable" href="../../de/d90/namespacePhotoRigma.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;result_array();</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> ($results !== <span class="keyword">false</span>) {</div>
<div class="line">    <span class="keywordflow">foreach</span> ($results as $row) {</div>
<div class="line">        echo <span class="stringliteral">&quot;ID: &quot;</span> . $row[<span class="stringliteral">&#39;id&#39;</span>] . <span class="stringliteral">&quot;, Name: &quot;</span> . $row[<span class="stringliteral">&#39;name&#39;</span>] . <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">    }</div>
<div class="line">} <span class="keywordflow">else</span> {</div>
<div class="line">    echo <span class="stringliteral">&quot;No results found.&quot;</span>;</div>
<div class="line">}</div>
</div><!-- fragment --> <dl class="section see"><dt>См. также</dt><dd><a class="el" href="#a31eb9243149eec0d8676bbcf7289538d" title="Извлекает все строки результата из подготовленного выражения, хранящегося в свойстве $res_query,...">PhotoRigma\Classes\Database\_result_array_internal()</a> Защищённый метод, выполняющий основную логику извлечения всех строк результата. </dd></dl>

<p>Замещает <a class="el" href="../../d7/dc2/interfacePhotoRigma_1_1Interfaces_1_1Database__Interface.html#a444f7dd61bfbe3931a7188adad61feae">Database_Interface</a>.</p>

<p class="definition">См. определение в файле <a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a> строка <a class="el" href="../../d2/d89/Database_8php_source.html#l03374">3374</a></p>

<p class="reference">Перекрестные ссылки <a class="el" href="../../d2/d89/Database_8php_source.html#l03446">_result_array_internal()</a>.</p>
<div id="dynsection-66" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-66-trigger" src="../../closed.png" alt="+"/> Граф вызовов:</div>
<div id="dynsection-66-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-66-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_a444f7dd61bfbe3931a7188adad61feae_cgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a444f7dd61bfbe3931a7188adad61feae_cgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a444f7dd61bfbe3931a7188adad61feae_cgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a444f7dd61bfbe3931a7188adad61feae_cgraph">
<area shape="rect" title="Извлекает все строки результата из подготовленного выражения." alt="" coords="5,5,94,30"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a31eb9243149eec0d8676bbcf7289538d" title="Извлекает все строки результата из подготовленного выражения, хранящегося в свойстве $res_query,..." alt="" coords="142,5,286,30"/>
<area shape="poly" title=" " alt="" coords="94,15,126,15,126,20,94,20"/>
</map>
</div>

</div>
</div>
<a id="acc7e70758801658b8c1f6ff0988deebb" name="acc7e70758801658b8c1f6ff0988deebb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acc7e70758801658b8c1f6ff0988deebb">&#9670;&#160;</a></span>result_row()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">result_row </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Извлекает одну строку результата из подготовленного выражения. </p>
<p>Этот публичный метод является обёрткой для защищённого метода <code>_result_row_internal()</code>. Он вызывает внутренний метод для извлечения одной строки результата последнего выполненного запроса из свойства <code>$res_query</code> в виде ассоциативного массива, после соответствующих проверок. При последовательных вызовах метода извлекается следующая строка результата. Метод предназначен для использования клиентским кодом для получения результатов запроса по одной строке.</p>
<dl class="section return"><dt>Возвращает</dt><dd>array|false Возвращает ассоциативный массив, содержащий данные одной строки результата, если она доступна. При последовательных вызовах переходит к следующей строке. Если результатов больше нет (все строки были извлечены), возвращает <code>false</code>.</dd></dl>
<dl class="exception"><dt>Исключения</dt><dd>
  <table class="exception">
    <tr><td class="paramname">InvalidArgumentException</td><td>Выбрасывается, если результат запроса недоступен или имеет некорректный тип (выбрасывается из внутренней логики). Пример сообщения: Результат запроса недоступен | Причина: Свойство $res_query не установлено</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Заметки</dt><dd>Этот метод является точкой входа для получения строк результата запроса по одной. Результат запроса (объект PDOStatement в свойстве <code>$res_query</code>) устанавливается методом выполнения запроса (например, <code>_execute_query()</code>). Внутренняя логика получения данных и проверки их корректности выполняется в защищённом методе <code>_result_row_internal()</code>. </dd></dl>
<dl class="section warning"><dt>Предупреждения</dt><dd>Убедитесь, что перед вызовом этого метода был успешно выполнен запрос (например, SELECT), который установил доступный для чтения результат (<code>$res_query</code>).</dd></dl>
<p>Пример использования: </p><div class="fragment"><div class="line"><span class="comment">// Предполагается, что перед этим был выполнен SELECT запрос</span></div>
<div class="line"><a class="code hl_variable" href="../../de/d90/namespacePhotoRigma.html#a1fa3127fc82f96b1436d871ef02be319">$db</a> = new \PhotoRigma\Classes\Database();</div>
<div class="line"><span class="comment">// ... например: $db-&gt;select([&#39;id&#39;, &#39;name&#39;], &#39;users&#39;, [&#39;where&#39; =&gt; &#39;status = 1&#39;]);</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Извлекаем строки по одной</span></div>
<div class="line"><span class="keywordflow">while</span> ($row = <a class="code hl_variable" href="../../de/d90/namespacePhotoRigma.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;result_row()) {</div>
<div class="line">    echo <span class="stringliteral">&quot;ID: &quot;</span> . $row[<span class="stringliteral">&#39;id&#39;</span>] . <span class="stringliteral">&quot;, Name: &quot;</span> . $row[<span class="stringliteral">&#39;name&#39;</span>] . <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">}</div>
</div><!-- fragment --> <dl class="section see"><dt>См. также</dt><dd><a class="el" href="#aac250b0e3e45a11bc29ad82a9feb64ec" title="Извлекает одну строку результата из подготовленного выражения, хранящегося в свойстве $res_query.">PhotoRigma\Classes\Database\_result_row_internal()</a> Защищённый метод, выполняющий основную логику извлечения одной строки результата. </dd></dl>

<p>Замещает <a class="el" href="../../d7/dc2/interfacePhotoRigma_1_1Interfaces_1_1Database__Interface.html#acc7e70758801658b8c1f6ff0988deebb">Database_Interface</a>.</p>

<p class="definition">См. определение в файле <a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a> строка <a class="el" href="../../d2/d89/Database_8php_source.html#l03504">3504</a></p>

<p class="reference">Перекрестные ссылки <a class="el" href="../../d2/d89/Database_8php_source.html#l03571">_result_row_internal()</a>.</p>
<div id="dynsection-67" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-67-trigger" src="../../closed.png" alt="+"/> Граф вызовов:</div>
<div id="dynsection-67-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-67-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_acc7e70758801658b8c1f6ff0988deebb_cgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_acc7e70758801658b8c1f6ff0988deebb_cgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_acc7e70758801658b8c1f6ff0988deebb_cgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_acc7e70758801658b8c1f6ff0988deebb_cgraph">
<area shape="rect" title="Извлекает одну строку результата из подготовленного выражения." alt="" coords="5,5,87,30"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#aac250b0e3e45a11bc29ad82a9feb64ec" title="Извлекает одну строку результата из подготовленного выражения, хранящегося в свойстве $res_query." alt="" coords="135,5,272,30"/>
<area shape="poly" title=" " alt="" coords="87,15,119,15,119,20,87,20"/>
</map>
</div>

</div>
</div>
<a id="aa54f5f05128d55871aa9303134170376" name="aa54f5f05128d55871aa9303134170376"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa54f5f05128d55871aa9303134170376">&#9670;&#160;</a></span>rollback_transaction()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">rollback_transaction </td>
          <td>(</td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>$context</em></span><span class="paramdefsep"> = </span><span class="paramdefval">''</span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Отменяет транзакцию в базе данных. </p>
<p>Этот публичный метод является обёрткой для защищённого метода <code>_roll_back_transaction_internal()</code>. Он передаёт контекст транзакции во внутренний метод, который выполняет отмену транзакции на уровне PDO и записывает соответствующий лог. Метод предназначен для использования клиентским кодом как точка входа для явного управления транзакциями.</p>
<dl class="params"><dt>Аргументы</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$context</td><td>Контекст транзакции (необязательный параметр). Используется для описания цели или места отмены транзакции. По умолчанию: пустая строка (&lsquo;&rsquo;'`).</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Возвращает</dt><dd>void Метод ничего не возвращает.</dd></dl>
<dl class="exception"><dt>Исключения</dt><dd>
  <table class="exception">
    <tr><td class="paramname">Exception</td><td>Выбрасывается, если произошла ошибка при отмене транзакции на уровне PDO или при логировании (выбрасывается из внутренней логики). Пример сообщения: Ошибка при отмене транзакции | Контекст: [значение контекста]</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Заметки</dt><dd>Этот метод является точкой входа для отмены транзакций. Основная логика и логирование выполняются в защищённом методе <code>_roll_back_transaction_internal()</code>. </dd></dl>
<dl class="section warning"><dt>Предупреждения</dt><dd>Убедитесь, что транзакция была начата перед вызовом метода.</dd></dl>
<p>Пример использования: </p><div class="fragment"><div class="line"><span class="comment">// Пример отмены транзакции из клиентского кода</span></div>
<div class="line"><a class="code hl_variable" href="../../de/d90/namespacePhotoRigma.html#a1fa3127fc82f96b1436d871ef02be319">$db</a> = new \PhotoRigma\Classes\Database();</div>
<div class="line"> </div>
<div class="line"><a class="code hl_variable" href="../../de/d90/namespacePhotoRigma.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;begin_transaction(<span class="stringliteral">&#39;Операция с данными&#39;</span>);</div>
<div class="line"><span class="comment">// ... операции с БД, которые могут вызвать ошибку ...</span></div>
<div class="line"><span class="keywordflow">try</span> {</div>
<div class="line">    <span class="comment">// ...</span></div>
<div class="line">} <span class="keywordflow">catch</span> (\Exception $e) {</div>
<div class="line">    <a class="code hl_variable" href="../../de/d90/namespacePhotoRigma.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;rollback_transaction(<span class="stringliteral">&#39;Операция с данными - Ошибка&#39;</span>);</div>
<div class="line">}</div>
</div><!-- fragment --> <dl class="section see"><dt>См. также</dt><dd>PhotoRigma::Classes::Database::_roll_back_transaction_internal() Защищённый метод, выполняющий основную логику отмены транзакции. </dd></dl>

<p>Замещает <a class="el" href="../../d7/dc2/interfacePhotoRigma_1_1Interfaces_1_1Database__Interface.html#aa54f5f05128d55871aa9303134170376">Database_Interface</a>.</p>

<p class="definition">См. определение в файле <a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a> строка <a class="el" href="../../d2/d89/Database_8php_source.html#l03626">3626</a></p>

<p class="reference">Перекрестные ссылки <a class="el" href="../../d2/d89/Database_8php_source.html#l03671">_rollback_transaction_internal()</a>.</p>
<div id="dynsection-68" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-68-trigger" src="../../closed.png" alt="+"/> Граф вызовов:</div>
<div id="dynsection-68-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-68-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_aa54f5f05128d55871aa9303134170376_cgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_aa54f5f05128d55871aa9303134170376_cgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_aa54f5f05128d55871aa9303134170376_cgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_aa54f5f05128d55871aa9303134170376_cgraph">
<area shape="rect" title="Отменяет транзакцию в базе данных." alt="" coords="5,12,143,37"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#aa3ddd3acf0992e7be12e65460caaa4b6" title="Отменяет транзакцию в базе данных." alt="" coords="191,5,335,44"/>
<area shape="poly" title=" " alt="" coords="143,22,175,22,175,27,143,27"/>
</map>
</div>

</div>
</div>
<a id="aab30d2495bb1362d218cd62e1556b13e" name="aab30d2495bb1362d218cd62e1556b13e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aab30d2495bb1362d218cd62e1556b13e">&#9670;&#160;</a></span>select()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">select </td>
          <td>(</td>
          <td class="paramtype">string|array</td>          <td class="paramname"><span class="paramname"><em>$select</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>$from_tbl</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">array</td>          <td class="paramname"><span class="paramname"><em>$options</em></span><span class="paramdefsep"> = </span><span class="paramdefval">[]</span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Выполняет SQL-запрос на выборку данных из таблицы. </p>
<p>Этот публичный метод является обёрткой для защищённого метода <code>_select_internal()</code>. Он передаёт список полей для выборки, имя таблицы и опции запроса во внутренний метод, который выполняет формирование и выполнение SQL-запроса на выборку. Безопасность обеспечивается использованием подготовленных выражений с параметрами. Метод предназначен для использования клиентским кодом как точка входа для выполнения запросов на выборку данных.</p>
<dl class="params"><dt>Аргументы</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string&#160;|&#160;array</td><td class="paramname">$select</td><td>Список полей для выборки. Может быть строкой (имя одного поля) или массивом (список полей). Если передан массив, он преобразуется в строку с разделителем <code>,</code>. Пример: "id", ["id", "name"]. Ограничения: массив не может содержать элементы, которые не являются строками. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$from_tbl</td><td>Имя таблицы, из которой выбираются данные. Должно быть строкой, содержащей только допустимые имена таблиц без специальных символов. Ограничения: строка должна быть непустой. </td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$options</td><td>Массив дополнительных опций для формирования запроса. Поддерживаемые ключи:<ul>
<li>where (string|array|false): Условие WHERE.<ul>
<li>string - используется как есть.</li>
<li>array - преобразуется в SQL. Поддерживает простые условия (&lsquo;['поле&rsquo; =&gt; значение]<code>) и логические операторы (</code>'OR' =&gt; [...]<code>, </code>'NOT' =&gt; [...]<code>).</code></li>
<li><code>false - игнорируется.</code></li>
</ul>
</li>
<li><code>group (string|false): Группировка GROUP BY. Игнорируется, если false. Должна быть строкой.</code></li>
<li><code>order (string|false): Сортировка ORDER BY. Игнорируется, если false. Должна быть строкой.</code></li>
<li><code>limit (int|string|false): Ограничение LIMIT.<ul>
<li>int - прямое значение.</li>
<li>string - формат "OFFSET,COUNT".</li>
<li>false - игнорируется.</li>
</ul>
</code></li>
<li><code>params (array): Ассоциативный массив параметров ([":имя" =&gt; значение]). Обязателен для использования с условиями</code>where` и другими частями запроса, требующими подготовленных выражений. Обеспечивает защиту от SQL-инъекций. Может быть пустым массивом, если параметры не требуются.</li>
</ul>
</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Возвращает</dt><dd>bool Возвращает true, если запрос успешно выполнен (даже если результат пустой).</dd></dl>
<dl class="exception"><dt>Исключения</dt><dd>
  <table class="exception">
    <tr><td class="paramname">InvalidArgumentException</td><td>Выбрасывается, если:<ul>
<li><code>$from_tbl</code> не является строкой. Пример сообщения: Недопустимое имя таблицы | Ожидалась строка, получено: [тип]</li>
<li><code>$options</code> не является массивом. Пример сообщения: Недопустимый тип параметра options | Ожидался массив, получено: [тип]</li>
<li><code>$select</code> не является строкой или массивом. Пример сообщения: Недопустимый тип параметра select | Ожидалась строка или массив, получено: [тип]</li>
<li>Элемент в списке <code>$select</code> не является строкой. Пример сообщения: Недопустимый элемент в выборке | Ожидалась строка, получено: [тип] </li>
</ul>
</td></tr>
    <tr><td class="paramname">Exception</td><td>Выбрасывается при ошибках выполнения запроса.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Заметки</dt><dd>Этот метод является точкой входа для выполнения запросов на выборку данных. Все проверки и основная логика выполняются в защищённом методе <code>_select_internal()</code>.</dd></dl>
<dl class="section warning"><dt>Предупреждения</dt><dd>Метод чувствителен к корректности входных данных. Неверные типы данных или некорректные значения могут привести к выбросу исключения. Убедитесь, что массив <code>$select</code> содержит только строки. Использование параметров <code>params</code> для подготовленных выражений является обязательным для защиты от SQL-инъекций и обеспечения совместимости с различными СУБД.</dd></dl>
<p>Пример использования: </p><div class="fragment"><div class="line"><span class="comment">// Пример безопасного использования публичного метода SELECT</span></div>
<div class="line"><a class="code hl_variable" href="../../de/d90/namespacePhotoRigma.html#a1fa3127fc82f96b1436d871ef02be319">$db</a> = new \PhotoRigma\Classes\Database();</div>
<div class="line"> </div>
<div class="line"><a class="code hl_variable" href="../../de/d90/namespacePhotoRigma.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;select(</div>
<div class="line">    [<span class="stringliteral">&#39;id&#39;</span>, <span class="stringliteral">&#39;name&#39;</span>],</div>
<div class="line">    <span class="stringliteral">&#39;users&#39;</span>,</div>
<div class="line">    [</div>
<div class="line">        <span class="stringliteral">&#39;where&#39;</span> =&gt; <span class="stringliteral">&#39;status = :status&#39;</span>,</div>
<div class="line">        <span class="stringliteral">&#39;group&#39;</span> =&gt; <span class="stringliteral">&#39;category_id&#39;</span>,</div>
<div class="line">        <span class="stringliteral">&#39;order&#39;</span> =&gt; <span class="stringliteral">&#39;created_at DESC&#39;</span>,</div>
<div class="line">        <span class="stringliteral">&#39;limit&#39;</span> =&gt; 10,</div>
<div class="line">        <span class="stringliteral">&#39;params&#39;</span> =&gt; [<span class="stringliteral">&#39;:status&#39;</span> =&gt; <span class="stringliteral">&#39;active&#39;</span>]</div>
<div class="line">    ]</div>
<div class="line">);</div>
</div><!-- fragment --> <dl class="section see"><dt>См. также</dt><dd><a class="el" href="#a3e40bb61553455b6f52be0ab9a6062b1" title="Формирует SQL-запрос на выборку данных из таблицы, основываясь на полученных аргументах,...">PhotoRigma\Classes\Database\_select_internal()</a> Защищённый метод, выполняющий основную логику формирования и выполнения SQL-запроса на выборку. </dd></dl>

<p>Замещает <a class="el" href="../../d7/dc2/interfacePhotoRigma_1_1Interfaces_1_1Database__Interface.html#aab30d2495bb1362d218cd62e1556b13e">Database_Interface</a>.</p>

<p class="definition">См. определение в файле <a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a> строка <a class="el" href="../../d2/d89/Database_8php_source.html#l03765">3765</a></p>

<p class="reference">Перекрестные ссылки <a class="el" href="../../d2/d89/Database_8php_source.html#l03870">_select_internal()</a>.</p>
<div id="dynsection-69" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-69-trigger" src="../../closed.png" alt="+"/> Граф вызовов:</div>
<div id="dynsection-69-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-69-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_aab30d2495bb1362d218cd62e1556b13e_cgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_aab30d2495bb1362d218cd62e1556b13e_cgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_aab30d2495bb1362d218cd62e1556b13e_cgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_aab30d2495bb1362d218cd62e1556b13e_cgraph">
<area shape="rect" title="Выполняет SQL&#45;запрос на выборку данных из таблицы." alt="" coords="5,56,62,81"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a3e40bb61553455b6f52be0ab9a6062b1" title="Формирует SQL&#45;запрос на выборку данных из таблицы, основываясь на полученных аргументах,..." alt="" coords="110,56,222,81"/>
<area shape="poly" title=" " alt="" coords="62,66,94,66,94,71,62,71"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a852d15f131983e6f53045146bede2958" title="Формирует строку дополнений для SQL&#45;запроса (например, WHERE, GROUP BY, ORDER BY, LIMIT)." alt="" coords="270,19,391,43"/>
<area shape="poly" title=" " alt="" coords="222,53,258,45,259,50,223,58"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a941629b86b9c9e34bc5926c0db2478b5" title="Выполняет SQL&#45;запрос с использованием подготовленных выражений." alt="" coords="275,80,386,105"/>
<area shape="poly" title=" " alt="" coords="223,74,260,79,259,85,222,79"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a24acdb048ce17d880bd12b0f74567352" title="Формирует группу условий для WHERE с указанным оператором (OR/NOT)." alt="" coords="439,5,576,30"/>
<area shape="poly" title=" " alt="" coords="392,24,424,21,424,27,392,29"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#af1b08f0490df0963b0daac6690d4765f" title="Выполняет преобразование SQL&#45;запроса в зависимости от текущего формата и типа СУБД." alt="" coords="453,55,562,79"/>
<area shape="poly" title=" " alt="" coords="386,82,437,74,438,80,387,87"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a53c8e7da5436bad14f32f64d5b532f60" title="Логирует результат анализа SQL&#45;запроса с помощью EXPLAIN или EXPLAIN ANALYZE." alt="" coords="461,104,554,129"/>
<area shape="poly" title=" " alt="" coords="387,97,446,105,446,111,386,103"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a8f393cc6e7e1b7e6394a9c2d4abdd8e7" title="Логирует медленные запросы, запросы без использования плейсхолдеров и другие запросы в таблицу логов." alt="" coords="466,153,549,178"/>
<area shape="poly" title=" " alt="" coords="361,103,440,138,458,145,456,150,438,143,359,108"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#ad620cb343252ceea735bab03860a0915" title="Производит преобразование SQL&#45;запроса из формата MySQL в целевой формат СУБД (PostgreSQL или SQLite)." alt="" coords="624,5,787,30"/>
<area shape="poly" title=" " alt="" coords="559,51,638,32,639,37,561,57"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a2e93ad3621ba0d7cf06d36c539b6c290" title="Производит преобразование SQL&#45;запроса из формата PostgreSQL в целевой формат СУБД (MySQL или SQLite)." alt="" coords="625,55,786,79"/>
<area shape="poly" title=" " alt="" coords="563,64,609,64,609,70,563,70"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a44e1aec00a15341cd9119261482eeb0d" title="Производит преобразование SQL&#45;запроса из формата SQLite в целевой формат СУБД (MySQL или PostgreSQL)." alt="" coords="625,104,786,129"/>
<area shape="poly" title=" " alt="" coords="561,77,639,97,638,102,559,83"/>
</map>
</div>

</div>
</div>
<a id="ad4d4e455d9e4bf865126c72cf23a517b" name="ad4d4e455d9e4bf865126c72cf23a517b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad4d4e455d9e4bf865126c72cf23a517b">&#9670;&#160;</a></span>truncate()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">truncate </td>
          <td>(</td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>$from_tbl</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Очищает таблицу (TRUNCATE) через вызов внутреннего метода. </p>
<p>Этот публичный метод является обёрткой для защищённого метода <code>_truncate_internal()</code>. Он передаёт имя таблицы во внутренний метод, который формирует и выполняет SQL-запрос <code>TRUNCATE TABLE</code>. Запрос TRUNCATE является быстрым способом удаления всех строк из таблицы, но его невозможно отменить через транзакции. Метод предназначен для использования клиентским кодом как точка входа для выполнения операции очистки таблицы.</p>
<dl class="params"><dt>Аргументы</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$from_tbl</td><td>Имя таблицы, которую необходимо очистить. Должно быть строкой, содержащей только допустимые имена таблиц без специальных символов. Ограничения: строка должна быть непустой.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Возвращает</dt><dd>bool Возвращает <code>true</code>, если запрос успешно выполнен (даже если результат пустой или не возвращает строк).</dd></dl>
<dl class="exception"><dt>Исключения</dt><dd>
  <table class="exception">
    <tr><td class="paramname">InvalidArgumentException</td><td>Выбрасывается, если имя таблицы недопустимо (выбрасывается из внутренней логики). Пример сообщения: Недопустимое имя таблицы | Ожидалась непустая строка, получено: [тип/значение] </td></tr>
    <tr><td class="paramname">Exception</td><td>Выбрасывается при ошибках выполнения запроса.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Заметки</dt><dd>Этот метод является точкой входа для очистки таблицы. Основная логика выполняется в защищённом методе <code>_truncate_internal()</code>. Помните, что TRUNCATE - это необратимая операция, которая не участвует в транзакциях. </dd></dl>
<dl class="section warning"><dt>Предупреждения</dt><dd>Метод чувствителен к корректности входных данных. Убедитесь, что <code>$from_tbl</code> содержит корректное имя таблицы. Используйте этот метод с крайней осторожностью, так как данные будут удалены без возможности восстановления через ROLLBACK.</dd></dl>
<p>Пример использования: </p><div class="fragment"><div class="line"><span class="comment">// Пример очистки таблицы из клиентского кода</span></div>
<div class="line"><a class="code hl_variable" href="../../de/d90/namespacePhotoRigma.html#a1fa3127fc82f96b1436d871ef02be319">$db</a> = new \PhotoRigma\Classes\Database();</div>
<div class="line"> </div>
<div class="line"><a class="code hl_variable" href="../../de/d90/namespacePhotoRigma.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;truncate(<span class="stringliteral">&#39;temp_data&#39;</span>);</div>
<div class="line"><span class="comment">// Таблица &#39;temp_data&#39; теперь пуста</span></div>
</div><!-- fragment --> <dl class="section see"><dt>См. также</dt><dd><a class="el" href="#ad353291f086236ab7be0d1edc0ed3ba8" title="Формирует SQL-запрос на очистку таблицы (TRUNCATE), размещает его в свойстве $txt_query и выполняет.">PhotoRigma\Classes\Database\_truncate_internal()</a> Защищённый метод, выполняющий основную логику очистки таблицы. </dd></dl>

<p>Замещает <a class="el" href="../../d7/dc2/interfacePhotoRigma_1_1Interfaces_1_1Database__Interface.html#ad4d4e455d9e4bf865126c72cf23a517b">Database_Interface</a>.</p>

<p class="definition">См. определение в файле <a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a> строка <a class="el" href="../../d2/d89/Database_8php_source.html#l03944">3944</a></p>

<p class="reference">Перекрестные ссылки <a class="el" href="../../d2/d89/Database_8php_source.html#l03993">_truncate_internal()</a>.</p>
<div id="dynsection-70" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-70-trigger" src="../../closed.png" alt="+"/> Граф вызовов:</div>
<div id="dynsection-70-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-70-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_ad4d4e455d9e4bf865126c72cf23a517b_cgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_ad4d4e455d9e4bf865126c72cf23a517b_cgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_ad4d4e455d9e4bf865126c72cf23a517b_cgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_ad4d4e455d9e4bf865126c72cf23a517b_cgraph">
<area shape="rect" title="Очищает таблицу (TRUNCATE) через вызов внутреннего метода." alt="" coords="5,104,74,129"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#ad353291f086236ab7be0d1edc0ed3ba8" title="Формирует SQL&#45;запрос на очистку таблицы (TRUNCATE), размещает его в свойстве $txt_query и выполняет." alt="" coords="122,104,246,129"/>
<area shape="poly" title=" " alt="" coords="74,114,106,114,106,119,74,119"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a941629b86b9c9e34bc5926c0db2478b5" title="Выполняет SQL&#45;запрос с использованием подготовленных выражений." alt="" coords="294,104,405,129"/>
<area shape="poly" title=" " alt="" coords="246,114,278,114,278,119,246,119"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#af1b08f0490df0963b0daac6690d4765f" title="Выполняет преобразование SQL&#45;запроса в зависимости от текущего формата и типа СУБД." alt="" coords="453,55,563,79"/>
<area shape="poly" title=" " alt="" coords="391,101,451,82,452,87,393,106"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a53c8e7da5436bad14f32f64d5b532f60" title="Логирует результат анализа SQL&#45;запроса с помощью EXPLAIN или EXPLAIN ANALYZE." alt="" coords="462,104,554,129"/>
<area shape="poly" title=" " alt="" coords="406,114,446,114,446,119,406,119"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a8f393cc6e7e1b7e6394a9c2d4abdd8e7" title="Логирует медленные запросы, запросы без использования плейсхолдеров и другие запросы в таблицу логов." alt="" coords="466,153,550,178"/>
<area shape="poly" title=" " alt="" coords="393,127,452,146,451,151,391,132"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#ad620cb343252ceea735bab03860a0915" title="Производит преобразование SQL&#45;запроса из формата MySQL в целевой формат СУБД (PostgreSQL или SQLite)." alt="" coords="611,5,774,30"/>
<area shape="poly" title=" " alt="" coords="556,51,628,32,630,37,558,57"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a2e93ad3621ba0d7cf06d36c539b6c290" title="Производит преобразование SQL&#45;запроса из формата PostgreSQL в целевой формат СУБД (MySQL или SQLite)." alt="" coords="612,55,772,79"/>
<area shape="poly" title=" " alt="" coords="563,64,596,64,596,70,563,70"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a44e1aec00a15341cd9119261482eeb0d" title="Производит преобразование SQL&#45;запроса из формата SQLite в целевой формат СУБД (MySQL или PostgreSQL)." alt="" coords="612,104,772,129"/>
<area shape="poly" title=" " alt="" coords="558,77,630,97,628,102,556,83"/>
</map>
</div>

</div>
</div>
<a id="a539e51bc2144b972bfafeccdda56ee9e" name="a539e51bc2144b972bfafeccdda56ee9e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a539e51bc2144b972bfafeccdda56ee9e">&#9670;&#160;</a></span>update()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">update </td>
          <td>(</td>
          <td class="paramtype">array</td>          <td class="paramname"><span class="paramname"><em>$update</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>$from_tbl</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">array</td>          <td class="paramname"><span class="paramname"><em>$options</em></span><span class="paramdefsep"> = </span><span class="paramdefval">[]</span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Обновляет данные в таблице через вызов внутреннего метода. </p>
<p>Этот публичный метод является обёрткой для защищённого метода <code>_update_internal()</code>. Он передаёт массив данных для обновления, имя таблицы и опции запроса во внутренний метод, который выполняет формирование и выполнение SQL-запроса на обновление. Безопасность обеспечивается обязательным указанием условия <code>where</code> в опциях и использованием подготовленных выражений с параметрами. Метод предназначен для использования клиентским кодом как точка входа для выполнения операций обновления данных.</p>
<dl class="params"><dt>Аргументы</dt><dd>
  <table class="params">
    <tr><td class="paramtype">array</td><td class="paramname">$update</td><td>Ассоциативный массив данных для обновления в формате: 'имя_поля' =&gt; 'значение'. Пример: ["name" =&gt; ":name", "status" =&gt; ":status"]. Для защиты от SQL-инъекций рекомендуется использовать плейсхолдеры (например, <code>:name</code>). </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$from_tbl</td><td>Имя таблицы, в которой необходимо обновить данные. Должно быть строкой, содержащей только допустимые имена таблиц без специальных символов. Ограничения: строка должна быть непустой. </td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$options</td><td>Массив опций для формирования запроса. Поддерживаемые ключи:<ul>
<li>where (string|array|false): Условие WHERE.<ul>
<li>string - используется как есть.</li>
<li>array - преобразуется в SQL. Поддерживает простые условия (&lsquo;['поле&rsquo; =&gt; значение]<code>) и логические операторы (</code>'OR' =&gt; [...]<code>, </code>'NOT' =&gt; [...]<code>).</code></li>
<li><code>false - игнорируется. Обязательный параметр для безопасности. Без условия WHERE запрос не будет выполнен.</code></li>
</ul>
</li>
<li><code>group (string|false): Группировка GROUP BY. Игнорируется, если false. Должна быть строкой. Не поддерживается в запросах UPDATE и удаляется с записью в лог.</code></li>
<li><code>order (string|false): Сортировка ORDER BY. Игнорируется, если false. Должна быть строкой.</code></li>
<li><code>limit (int|string|false): Ограничение LIMIT.<ul>
<li>int - прямое значение.</li>
<li>string - формат "OFFSET,COUNT".</li>
<li>false - игнорируется.</li>
</ul>
</code></li>
<li><code>params (array): Ассоциативный массив параметров ([":имя" =&gt; значение]). Обязателен для использования с данными для обновления или условиями</code>where`, требующими подготовленных выражений. Обеспечивает защиту от SQL-инъекций. Может быть пустым массивом, если параметры не требуются.</li>
</ul>
</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Возвращает</dt><dd>bool Возвращает true, если запрос успешно выполнен (даже если результат пустой).</dd></dl>
<dl class="exception"><dt>Исключения</dt><dd>
  <table class="exception">
    <tr><td class="paramname">InvalidArgumentException</td><td>Выбрасывается, если:<ul>
<li><code>$update</code> не является массивом. Пример сообщения: Недопустимый тип параметра update | Ожидался массив, получено: [тип]</li>
<li><code>$from_tbl</code> не является строкой. Пример сообщения: Недопустимое имя таблицы | Ожидалась строка, получено: [тип]</li>
<li><code>$options</code> не является массивом. Пример сообщения: Недопустимый тип параметра options | Ожидался массив, получено: [тип]</li>
<li>Отсутствует обязательное условие <code>where</code> в массиве <code>$options</code>. Пример сообщения: Запрос UPDATE без условия WHERE запрещён | Причина: Соображения безопасности </li>
</ul>
</td></tr>
    <tr><td class="paramname">JsonException</td><td>Выбрасывается при ошибках записи лога. </td></tr>
    <tr><td class="paramname">Exception</td><td>Выбрасывается при ошибках выполнения запроса.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Заметки</dt><dd>Этот метод является точкой входа для выполнения операций обновления данных. Все проверки (включая обязательное <code>where</code>) и основная логика выполняются в защищённом методе <code>_update_internal()</code>. Ключ <code>group</code> игнорируется в этом методе.</dd></dl>
<dl class="section warning"><dt>Предупреждения</dt><dd>Метод чувствителен к корректности входных данных. Неверные типы данных или некорректные значения могут привести к выбросу исключения. Безопасность обеспечивается обязательным указанием условия <code>where</code>. Запрос без условия <code>where</code> не будет выполнен. Ключ <code>group</code> не поддерживается в запросах UPDATE и удаляется с записью в лог во внутренней логике. Использование параметров <code>params</code> для подготовленных выражений является обязательным для защиты от SQL-инъекций и обеспечения совместимости с различными СУБД.</dd></dl>
<p>Пример использования: </p><div class="fragment"><div class="line"><span class="comment">// Пример безопасного использования публичного метода UPDATE</span></div>
<div class="line"><a class="code hl_variable" href="../../de/d90/namespacePhotoRigma.html#a1fa3127fc82f96b1436d871ef02be319">$db</a> = new \PhotoRigma\Classes\Database(); <span class="comment">// Добавил отсутствующий обратный слеш в неймспейсе</span></div>
<div class="line"> </div>
<div class="line"><a class="code hl_variable" href="../../de/d90/namespacePhotoRigma.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;update(</div>
<div class="line">    [<span class="stringliteral">&#39;name&#39;</span> =&gt; <span class="stringliteral">&#39;:name&#39;</span>, <span class="stringliteral">&#39;status&#39;</span> =&gt; <span class="stringliteral">&#39;:status&#39;</span>],</div>
<div class="line">    <span class="stringliteral">&#39;users&#39;</span>,</div>
<div class="line">    [</div>
<div class="line">        <span class="stringliteral">&#39;where&#39;</span> =&gt; <span class="stringliteral">&#39;id = :id&#39;</span>,</div>
<div class="line">        <span class="stringliteral">&#39;params&#39;</span> =&gt; [<span class="stringliteral">&#39;:id&#39;</span> =&gt; 1, <span class="stringliteral">&#39;:name&#39;</span> =&gt; <span class="stringliteral">&#39;John Doe&#39;</span>, <span class="stringliteral">&#39;:status&#39;</span> =&gt; <span class="stringliteral">&#39;active&#39;</span>]</div>
<div class="line">    ]</div>
<div class="line">);</div>
</div><!-- fragment --> <dl class="section see"><dt>См. также</dt><dd><a class="el" href="#ab1dc7ae1ce60a864b1d7c865e99029b0" title="Формирует SQL-запрос на обновление данных в таблице, основываясь на полученных аргументах,...">PhotoRigma\Classes\Database\_update_internal()</a> Защищённый метод, выполняющий основную логику обновления данных. </dd></dl>

<p>Замещает <a class="el" href="../../d7/dc2/interfacePhotoRigma_1_1Interfaces_1_1Database__Interface.html#a539e51bc2144b972bfafeccdda56ee9e">Database_Interface</a>.</p>

<p class="definition">См. определение в файле <a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a> строка <a class="el" href="../../d2/d89/Database_8php_source.html#l04091">4091</a></p>

<p class="reference">Перекрестные ссылки <a class="el" href="../../d2/d89/Database_8php_source.html#l04197">_update_internal()</a>.</p>
<div id="dynsection-71" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-71-trigger" src="../../closed.png" alt="+"/> Граф вызовов:</div>
<div id="dynsection-71-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-71-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_a539e51bc2144b972bfafeccdda56ee9e_cgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a539e51bc2144b972bfafeccdda56ee9e_cgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a539e51bc2144b972bfafeccdda56ee9e_cgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a539e51bc2144b972bfafeccdda56ee9e_cgraph">
<area shape="rect" title="Обновляет данные в таблице через вызов внутреннего метода." alt="" coords="5,56,66,81"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#ab1dc7ae1ce60a864b1d7c865e99029b0" title="Формирует SQL&#45;запрос на обновление данных в таблице, основываясь на полученных аргументах,..." alt="" coords="114,56,230,81"/>
<area shape="poly" title=" " alt="" coords="66,66,98,66,98,71,66,71"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a852d15f131983e6f53045146bede2958" title="Формирует строку дополнений для SQL&#45;запроса (например, WHERE, GROUP BY, ORDER BY, LIMIT)." alt="" coords="278,19,399,43"/>
<area shape="poly" title=" " alt="" coords="230,53,265,45,266,50,231,58"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a941629b86b9c9e34bc5926c0db2478b5" title="Выполняет SQL&#45;запрос с использованием подготовленных выражений." alt="" coords="283,80,394,105"/>
<area shape="poly" title=" " alt="" coords="231,74,268,80,267,85,230,79"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a24acdb048ce17d880bd12b0f74567352" title="Формирует группу условий для WHERE с указанным оператором (OR/NOT)." alt="" coords="447,5,584,30"/>
<area shape="poly" title=" " alt="" coords="400,24,432,21,432,27,400,29"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#af1b08f0490df0963b0daac6690d4765f" title="Выполняет преобразование SQL&#45;запроса в зависимости от текущего формата и типа СУБД." alt="" coords="461,55,570,79"/>
<area shape="poly" title=" " alt="" coords="394,82,445,74,446,80,395,87"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a53c8e7da5436bad14f32f64d5b532f60" title="Логирует результат анализа SQL&#45;запроса с помощью EXPLAIN или EXPLAIN ANALYZE." alt="" coords="469,104,562,129"/>
<area shape="poly" title=" " alt="" coords="395,97,454,105,454,111,394,103"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a8f393cc6e7e1b7e6394a9c2d4abdd8e7" title="Логирует медленные запросы, запросы без использования плейсхолдеров и другие запросы в таблицу логов." alt="" coords="474,153,557,178"/>
<area shape="poly" title=" " alt="" coords="369,103,448,138,466,145,464,150,446,143,367,108"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#ad620cb343252ceea735bab03860a0915" title="Производит преобразование SQL&#45;запроса из формата MySQL в целевой формат СУБД (PostgreSQL или SQLite)." alt="" coords="632,5,795,30"/>
<area shape="poly" title=" " alt="" coords="567,51,646,32,647,37,569,57"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a2e93ad3621ba0d7cf06d36c539b6c290" title="Производит преобразование SQL&#45;запроса из формата PostgreSQL в целевой формат СУБД (MySQL или SQLite)." alt="" coords="633,55,794,79"/>
<area shape="poly" title=" " alt="" coords="571,64,617,64,617,70,571,70"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#a44e1aec00a15341cd9119261482eeb0d" title="Производит преобразование SQL&#45;запроса из формата SQLite в целевой формат СУБД (MySQL или PostgreSQL)." alt="" coords="633,104,794,129"/>
<area shape="poly" title=" " alt="" coords="569,77,647,97,646,102,567,83"/>
</map>
</div>

</div>
</div>
<a id="a5bebc90a5002faea5a85470b3bad406e" name="a5bebc90a5002faea5a85470b3bad406e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5bebc90a5002faea5a85470b3bad406e">&#9670;&#160;</a></span>with_sql_format()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">with_sql_format </td>
          <td>(</td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>$format</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">callable</td>          <td class="paramname"><span class="paramname"><em>$callback</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Временно изменяет формат SQL для выполнения запросов. </p>
<p>Этот публичный метод является обёрткой для защищённого метода <code>_with_sql_format_internal()</code>. Он принимает желаемый временный формат SQL и коллбэк, а затем выполняет внутренний метод. Внутренний метод устанавливает временный формат SQL перед выполнением коллбэка и гарантирует восстановление исходного формата после его завершения, даже в случае исключения. Метод предназначен для использования клиентским кодом для выполнения набора операций с базой данных, которые требуют специфического формата SQL, отличного от текущего.</p>
<dl class="params"><dt>Аргументы</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$format</td><td>Формат SQL, который нужно использовать временно. Поддерживаемые значения: 'mysql', 'pgsql', 'sqlite'. </td></tr>
    <tr><td class="paramtype">callable</td><td class="paramname">$callback</td><td>Коллбэк, содержащий код, который должен выполняться в контексте указанного формата SQL. Коллбэк может принимать ссылку на текущий объект базы данных как аргумент (например, <code>function (\<a class="el" href="../../de/d90/namespacePhotoRigma.html">PhotoRigma</a>\Classes\Database $db) { ... }</code>).</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Возвращает</dt><dd>mixed Результат выполнения коллбэка <code>$callback</code>.</dd></dl>
<dl class="exception"><dt>Исключения</dt><dd>
  <table class="exception">
    <tr><td class="paramname">InvalidArgumentException</td><td>Выбрасывается, если указан неподдерживаемый формат SQL (выбрасывается из внутренней логики). Пример сообщения: Неподдерживаемый формат SQL | Формат: [format] </td></tr>
    <tr><td class="paramname">Exception</td><td>Любые исключения, выброшенные внутри переданного коллбэка, будут автоматически распространены (не перехватываются этим методом).</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Заметки</dt><dd>Этот метод является точкой входа для временного изменения формата SQL. Основная логика смены и восстановления формата выполняется в защищённом методе <code>_with_sql_format_internal()</code>. Убедитесь, что код внутри коллбэка не содержит собственных блоков <code>try/catch</code> для исключений, которые должны быть обработаны на более высоком уровне. </dd></dl>
<dl class="section warning"><dt>Предупреждения</dt><dd>Важные замечания:<ol type="1">
<li>Убедитесь, что все методы текущего класса <code>$db-&gt;...()</code>, вызываемые внутри коллбэка, корректно работают с указанным временным форматом SQL.</li>
<li><b>Особая осторожность:</b> Не используйте внутри коллбэка методы <b>других</b> классов, которые напрямую зависят от объекта <code>$db</code> и при этом написаны с жесткой привязкой к определенному формату SQL (например, парсят SQL-строки, не учитывая временное изменение формата в объекте <code>$db</code>). Это может привести к непредсказуемому поведению или ошибкам.</li>
<li>Исключения, выброшенные внутри коллбэка, <b>не перехватываются</b> этим методом; они будут распространяться (пробрасываться) дальше.</li>
</ol>
</dd></dl>
<p>Пример использования: </p><div class="fragment"><div class="line"><span class="comment">// Пример выполнения запросов в формате PostgreSQL</span></div>
<div class="line"><a class="code hl_variable" href="../../de/d90/namespacePhotoRigma.html#a1fa3127fc82f96b1436d871ef02be319">$db</a> = new \PhotoRigma\Classes\Database();</div>
<div class="line"><span class="comment">// Предполагается, что TBL_NEWS определена как константа</span></div>
<div class="line"> </div>
<div class="line">$years_list = <a class="code hl_variable" href="../../de/d90/namespacePhotoRigma.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;with_sql_format(<span class="stringliteral">&#39;pgsql&#39;</span>, <span class="keyword">function</span> (\<a class="code hl_namespace" href="../../de/d90/namespacePhotoRigma.html">PhotoRigma</a>\<a class="code hl_namespace" href="../../d6/dc3/namespacePhotoRigma_1_1Classes.html">Classes</a>\<a class="code hl_class" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html">Database</a> <a class="code hl_variable" href="../../de/d90/namespacePhotoRigma.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>) {</div>
<div class="line">    <span class="comment">// Внутри этого коллбэка $db-&gt;current_format установлен в &#39;pgsql&#39;</span></div>
<div class="line">    $formatted_date = <a class="code hl_variable" href="../../de/d90/namespacePhotoRigma.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;format_date(<span class="stringliteral">&#39;data_last_edit&#39;</span>, <span class="stringliteral">&#39;YYYY&#39;</span>);</div>
<div class="line">    <a class="code hl_variable" href="../../de/d90/namespacePhotoRigma.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;select(</div>
<div class="line">        <span class="stringliteral">&#39;DISTINCT &#39;</span> . $formatted_date . <span class="stringliteral">&#39; AS year&#39;</span>,</div>
<div class="line">        TBL_NEWS,</div>
<div class="line">        [</div>
<div class="line">            <span class="stringliteral">&#39;order&#39;</span> =&gt; <span class="stringliteral">&#39;year ASC&#39;</span>,</div>
<div class="line">        ]</div>
<div class="line">    );</div>
<div class="line">    <span class="keywordflow">return</span> <a class="code hl_variable" href="../../de/d90/namespacePhotoRigma.html#a1fa3127fc82f96b1436d871ef02be319">$db</a>-&gt;result_array();</div>
<div class="line">});</div>
<div class="line">print_r($years_list);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// После завершения коллбэка, исходный формат SQL восстанавливается автоматически.</span></div>
<div class="ttc" id="aclassPhotoRigma_1_1Classes_1_1Database_html"><div class="ttname"><a href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html">PhotoRigma\Classes\Database</a></div><div class="ttdoc">Класс для работы с базами данных через PDO.</div><div class="ttdef"><b>Определения</b> <a href="../../d2/d89/Database_8php_source.html#l00201">Database.php:202</a></div></div>
<div class="ttc" id="anamespacePhotoRigma_1_1Classes_html"><div class="ttname"><a href="../../d6/dc3/namespacePhotoRigma_1_1Classes.html">PhotoRigma\Classes</a></div><div class="ttdef"><b>Определения</b> <a href="../../db/d06/Cache__Handler_8php_source.html#l00045">Cache_Handler.php:45</a></div></div>
<div class="ttc" id="anamespacePhotoRigma_html"><div class="ttname"><a href="../../de/d90/namespacePhotoRigma.html">PhotoRigma</a></div></div>
</div><!-- fragment --> <dl class="section see"><dt>См. также</dt><dd><a class="el" href="#afc2bc46cdbae22b8f2ebec12797fed6d" title="Метод временно изменяет формат SQL для выполнения запросов в указанном контексте.">PhotoRigma\Classes\Database\_with_sql_format_internal()</a> Защищённый метод, выполняющий основную логику временной смены формата SQL. </dd></dl>

<p>Замещает <a class="el" href="../../d7/dc2/interfacePhotoRigma_1_1Interfaces_1_1Database__Interface.html#a5bebc90a5002faea5a85470b3bad406e">Database_Interface</a>.</p>

<p class="definition">См. определение в файле <a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a> строка <a class="el" href="../../d2/d89/Database_8php_source.html#l04301">4301</a></p>

<p class="reference">Перекрестные ссылки <a class="el" href="../../d2/d89/Database_8php_source.html#l04372">_with_sql_format_internal()</a>.</p>
<div id="dynsection-72" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-72-trigger" src="../../closed.png" alt="+"/> Граф вызовов:</div>
<div id="dynsection-72-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-72-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database_a5bebc90a5002faea5a85470b3bad406e_cgraph.png" border="0" usemap="#ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a5bebc90a5002faea5a85470b3bad406e_cgraph" alt=""/></div>
<map name="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a5bebc90a5002faea5a85470b3bad406e_cgraph" id="ad6/db6/classPhotoRigma_1_1Classes_1_1Database_a5bebc90a5002faea5a85470b3bad406e_cgraph">
<area shape="rect" title="Временно изменяет формат SQL для выполнения запросов." alt="" coords="5,5,119,30"/>
<area shape="rect" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html#afc2bc46cdbae22b8f2ebec12797fed6d" title="Метод временно изменяет формат SQL для выполнения запросов в указанном контексте." alt="" coords="167,5,336,30"/>
<area shape="poly" title=" " alt="" coords="119,15,151,15,151,20,119,20"/>
</map>
</div>

</div>
</div>
<h2 class="groupheader">Данные класса</h2>
<a id="a54ffcc55f5606eeb40e8ac59c881d22b" name="a54ffcc55f5606eeb40e8ac59c881d22b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a54ffcc55f5606eeb40e8ac59c881d22b">&#9670;&#160;</a></span>$aff_rows</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int $aff_rows = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel private">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Количество строк, затронутых последним запросом (INSERT, UPDATE, DELETE) </p>

<p class="definition">См. определение в файле <a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a> строка <a class="el" href="../../d2/d89/Database_8php_source.html#l00207">207</a></p>

<p class="reference">Используется в <a class="el" href="../../d2/d89/Database_8php_source.html#l02722">_get_affected_rows_internal()</a>.</p>

</div>
</div>
<a id="afed869cd253ba3b433a21e07703bf95d" name="afed869cd253ba3b433a21e07703bf95d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afed869cd253ba3b433a21e07703bf95d">&#9670;&#160;</a></span>$allowed_formats</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">array $allowed_formats = ['mysql', 'pgsql', 'sqlite']</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel private">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Список поддерживаемых форматов SQL. </p>

<p class="definition">См. определение в файле <a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a> строка <a class="el" href="../../d2/d89/Database_8php_source.html#l00215">215</a></p>

</div>
</div>
<a id="a252982d004053f182631167a8b39ce88" name="a252982d004053f182631167a8b39ce88"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a252982d004053f182631167a8b39ce88">&#9670;&#160;</a></span>$cache</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d1/d44/interfacePhotoRigma_1_1Interfaces_1_1Cache__Handler__Interface.html">Cache_Handler_Interface</a> $cache</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel private">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Объект для работы с кешем </p>

<p class="definition">См. определение в файле <a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a> строка <a class="el" href="../../d2/d89/Database_8php_source.html#l00216">216</a></p>

<p class="reference">Используется в <a class="el" href="../../d2/d89/Database_8php_source.html#l00362">__construct()</a>.</p>

</div>
</div>
<a id="a8c3cf443d91cde7347577cddf302a9d0" name="a8c3cf443d91cde7347577cddf302a9d0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8c3cf443d91cde7347577cddf302a9d0">&#9670;&#160;</a></span>$current_format</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">string $current_format = 'mysql'</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel private">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Хранит текущий формат SQL (например, 'mysql', 'pgsql', 'sqlite'). </p>

<p class="definition">См. определение в файле <a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a> строка <a class="el" href="../../d2/d89/Database_8php_source.html#l00214">214</a></p>

<p class="reference">Используется в <a class="el" href="../../d2/d89/Database_8php_source.html#l02337">_convert_to_mysql_format()</a>, <a class="el" href="../../d2/d89/Database_8php_source.html#l02453">_convert_to_postgres_format()</a>, <a class="el" href="../../d2/d89/Database_8php_source.html#l02572">_convert_to_sqlite_format()</a> и <a class="el" href="../../d2/d89/Database_8php_source.html#l04372">_with_sql_format_internal()</a>.</p>

</div>
</div>
<a id="a2db215d6cd26a1915e16cb5f7ff1fca3" name="a2db215d6cd26a1915e16cb5f7ff1fca3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2db215d6cd26a1915e16cb5f7ff1fca3">&#9670;&#160;</a></span>$db_name</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">string $db_name</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel private">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Имя базы данных </p>

<p class="definition">См. определение в файле <a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a> строка <a class="el" href="../../d2/d89/Database_8php_source.html#l00210">210</a></p>

</div>
</div>
<a id="a072c45961a79433ff94013278707ade5" name="a072c45961a79433ff94013278707ade5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a072c45961a79433ff94013278707ade5">&#9670;&#160;</a></span>$db_type</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">string $db_type</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel private">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Тип базы данных (mysql, pgsql, sqlite) </p>

<p class="definition">См. определение в файле <a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a> строка <a class="el" href="../../d2/d89/Database_8php_source.html#l00209">209</a></p>

</div>
</div>
<a id="a1dfaf650c7bfa81bd699450d5404c7fd" name="a1dfaf650c7bfa81bd699450d5404c7fd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1dfaf650c7bfa81bd699450d5404c7fd">&#9670;&#160;</a></span>$format_cache</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">array $format_cache = []</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel private">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Кэш для преобразования форматов даты (MariaDB -&gt; PostgreSQL/SQLite) </p>

<p class="definition">См. определение в файле <a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a> строка <a class="el" href="../../d2/d89/Database_8php_source.html#l00211">211</a></p>

<p class="reference">Используется в <a class="el" href="../../d2/d89/Database_8php_source.html#l00564">__destruct()</a>.</p>

</div>
</div>
<a id="a0fb355e7d9e1e7d9ca0b1b83dc960f33" name="a0fb355e7d9e1e7d9ca0b1b83dc960f33"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0fb355e7d9e1e7d9ca0b1b83dc960f33">&#9670;&#160;</a></span>$insert_id</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int $insert_id = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel private">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>ID последней вставленной строки после выполнения INSERT-запроса </p>

<p class="definition">См. определение в файле <a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a> строка <a class="el" href="../../d2/d89/Database_8php_source.html#l00208">208</a></p>

<p class="reference">Используется в <a class="el" href="../../d2/d89/Database_8php_source.html#l02834">_get_last_insert_id_internal()</a>.</p>

</div>
</div>
<a id="a9db61e1721b616500bce6ed60491752a" name="a9db61e1721b616500bce6ed60491752a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9db61e1721b616500bce6ed60491752a">&#9670;&#160;</a></span>$pdo</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">PDO $pdo = null</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel private">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Объект PDO для подключения к базе данных </p>

<p class="definition">См. определение в файле <a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a> строка <a class="el" href="../../d2/d89/Database_8php_source.html#l00204">204</a></p>

</div>
</div>
<a id="aa40b201d601e6753def247ae8fda39e3" name="aa40b201d601e6753def247ae8fda39e3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa40b201d601e6753def247ae8fda39e3">&#9670;&#160;</a></span>$query_cache</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">array $query_cache = []</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel private">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Кэш для хранения результатов проверки существования запросов </p>

<p class="definition">См. определение в файле <a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a> строка <a class="el" href="../../d2/d89/Database_8php_source.html#l00212">212</a></p>

<p class="reference">Используется в <a class="el" href="../../d2/d89/Database_8php_source.html#l00564">__destruct()</a>.</p>

</div>
</div>
<a id="ae87877e5a83ed158cdad137dd27b1ac8" name="ae87877e5a83ed158cdad137dd27b1ac8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae87877e5a83ed158cdad137dd27b1ac8">&#9670;&#160;</a></span>$res_query</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">object null $res_query = null</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel private">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Результат выполнения подготовленного выражения (PDOStatement) </p>

<p class="definition">См. определение в файле <a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a> строка <a class="el" href="../../d2/d89/Database_8php_source.html#l00206">206</a></p>

</div>
</div>
<a id="a556a1b37f162e7e8b576b86c182c7309" name="a556a1b37f162e7e8b576b86c182c7309"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a556a1b37f162e7e8b576b86c182c7309">&#9670;&#160;</a></span>$txt_query</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">string null $txt_query = null</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel private">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Текст последнего SQL-запроса, сформированного методами класса </p>

<p class="definition">См. определение в файле <a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a> строка <a class="el" href="../../d2/d89/Database_8php_source.html#l00205">205</a></p>

<p class="reference">Используется в <a class="el" href="../../d2/d89/Database_8php_source.html#l01674">_convert_from_pgsql_to()</a>, <a class="el" href="../../d2/d89/Database_8php_source.html#l01760">_convert_from_sqlite_to()</a> и <a class="el" href="../../d2/d89/Database_8php_source.html#l02057">_log_query()</a>.</p>

</div>
</div>
<a id="aa6ad7a9ae20f259f85508582d8f15068" name="aa6ad7a9ae20f259f85508582d8f15068"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa6ad7a9ae20f259f85508582d8f15068">&#9670;&#160;</a></span>$unescape_cache</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">array $unescape_cache = []</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel private">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Кэш для хранения результатов снятия экранирования идентификаторов </p>

<p class="definition">См. определение в файле <a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a> строка <a class="el" href="../../d2/d89/Database_8php_source.html#l00213">213</a></p>

<p class="reference">Используется в <a class="el" href="../../d2/d89/Database_8php_source.html#l00564">__destruct()</a>.</p>

</div>
</div>
<hr/>Объявления и описания членов класса находятся в файле:<ul>
<li>include/<a class="el" href="../../d2/d89/Database_8php_source.html">Database.php</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../de/d90/namespacePhotoRigma.html">PhotoRigma</a></li><li class="navelem"><a class="el" href="../../d6/dc3/namespacePhotoRigma_1_1Classes.html">Classes</a></li><li class="navelem"><a class="el" href="../../d6/db6/classPhotoRigma_1_1Classes_1_1Database.html">Database</a></li>
    <li class="footer">Документация по Photo-Rigma-BiZ. Последние изменения: Пн 12 Май 2025. Создано системой <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
