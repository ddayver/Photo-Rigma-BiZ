<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
            <title>Photo-Rigma-BiZ</title>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <base href="../">
    <link rel="icon" href="images/favicon.ico"/>
    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/base.css">
            <link rel="preconnect" href="https://fonts.gstatic.com">
        <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@100;200;300;400;600;700&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:wght@400;600;700&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="css/template.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0/css/all.min.css" integrity="sha256-ybRkN9dBjhcS2qrW1z+hfCxq+1aBdwyQM5wlQoQVt/0=" crossorigin="anonymous" />
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/themes/prism-okaidia.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/line-numbers/prism-line-numbers.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/line-highlight/prism-line-highlight.css">
                <script src="https://cdn.jsdelivr.net/npm/fuse.js@3.4.6"></script>
        <script src="https://cdn.jsdelivr.net/npm/css-vars-ponyfill@2"></script>
        <script src="js/template.js"></script>
        <script src="js/search.js"></script>
        <script defer src="js/searchIndex.js"></script>
    </head>
<body id="top">
    <header class="phpdocumentor-header phpdocumentor-section">
    <h1 class="phpdocumentor-title"><a href="" class="phpdocumentor-title__link">Photo-Rigma-BiZ</a></h1>
    <input class="phpdocumentor-header__menu-button" type="checkbox" id="menu-button" name="menu-button" />
    <label class="phpdocumentor-header__menu-icon" for="menu-button">
        <i class="fas fa-bars"></i>
    </label>
    <section data-search-form class="phpdocumentor-search">
    <label>
        <span class="visually-hidden">Search for</span>
        <svg class="phpdocumentor-search__icon" width="21" height="20" viewBox="0 0 21 20" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="7.5" cy="7.5" r="6.5" stroke="currentColor" stroke-width="2"/>
            <line x1="12.4892" y1="12.2727" x2="19.1559" y2="18.9393" stroke="currentColor" stroke-width="3"/>
        </svg>
        <input type="search" class="phpdocumentor-field phpdocumentor-search__field" placeholder="Loading .." disabled />
    </label>
</section>

    <nav class="phpdocumentor-topnav">
    <ul class="phpdocumentor-topnav__menu">
        </ul>
</nav>
</header>

    <main class="phpdocumentor">
        <div class="phpdocumentor-section">
            <input class="phpdocumentor-sidebar__menu-button" type="checkbox" id="sidebar-button" name="sidebar-button" />
<label class="phpdocumentor-sidebar__menu-icon" for="sidebar-button">
    Menu
</label>
<aside class="phpdocumentor-column -three phpdocumentor-sidebar">
                    <section class="phpdocumentor-sidebar__category -namespaces">
            <h2 class="phpdocumentor-sidebar__category-header">Namespaces</h2>
                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="namespaces/photorigma.html" class="">PhotoRigma</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="namespaces/photorigma-classes.html" class="">Classes</a>
                
            </li>
                    <li>
                <a href="namespaces/photorigma-include.html" class="">Include</a>
                
            </li>
                    <li>
                <a href="namespaces/photorigma-interfaces.html" class="">Interfaces</a>
                
            </li>
            </ul>

                        </section>
                <section class="phpdocumentor-sidebar__category -packages">
            <h2 class="phpdocumentor-sidebar__category-header">Packages</h2>
                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="packages/PhotoRigma.html" class="">PhotoRigma</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="packages/PhotoRigma-Action.html" class="">Action</a>
                
            </li>
                    <li>
                <a href="packages/PhotoRigma-Language.html" class="">Language</a>
                
            </li>
            </ul>

                        </section>
            
    <section class="phpdocumentor-sidebar__category -reports">
        <h2 class="phpdocumentor-sidebar__category-header">Reports</h2>
                <h3 class="phpdocumentor-sidebar__root-package"><a href="reports/deprecated.html">Deprecated</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="reports/errors.html">Errors</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="reports/markers.html">Markers</a></h3>
    </section>

    <section class="phpdocumentor-sidebar__category -indices">
        <h2 class="phpdocumentor-sidebar__category-header">Indices</h2>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="indices/files.html">Files</a></h3>
    </section>
</aside>

            <div class="phpdocumentor-column -nine phpdocumentor-content">
                                <section>
                                        <ul class="phpdocumentor-breadcrumbs">
            <li class="phpdocumentor-breadcrumb"><a href="namespaces/photorigma.html">PhotoRigma</a></li>
            <li class="phpdocumentor-breadcrumb"><a href="namespaces/photorigma-classes.html">Classes</a></li>
    </ul>

    <article class="phpdocumentor-element -class">
        <h2 class="phpdocumentor-content__title">
    User

    
            <div class="phpdocumentor-element__package">
            in package
            <ul class="phpdocumentor-breadcrumbs">
                                    <li class="phpdocumentor-breadcrumb"><a href="packages/PhotoRigma.html">PhotoRigma</a></li>
                            </ul>
        </div>
    
            <span class="phpdocumentor-element__implements">
            implements
                            <a href="classes/PhotoRigma-Interfaces-User-Interface.html"><abbr title="\PhotoRigma\Interfaces\User_Interface">User_Interface</abbr></a>                    </span>
    
    </h2>

<div class="phpdocumentor-label-line">


</div>

        <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/User.php"><a href="files/src-classes-user.html"><abbr title="src/Classes/User.php">User.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">91</span>

    </aside>

            <p class="phpdocumentor-summary">Класс для работы с пользователями и хранения данных о текущем пользователе.</p>


    <section class="phpdocumentor-description"><p>Этот класс реализует интерфейс <code class="prettyprint">User_Interface</code> и предоставляет функционал для работы с данными пользователей.
Идентификация пользователя происходит через данные из глобального массива $_SESSION.
Основные возможности:</p>
<ul>
<li>Управление данными текущего пользователя (добавление, обновление, удаление).</li>
<li>Поддержка мягкого удаления (<code class="prettyprint">deleted_at</code>) и окончательного удаления (<code class="prettyprint">permanently_deleted</code>)</li>
<li>Работа с группами пользователей (добавление, обновление, удаление)</li>
<li>Генерация CSRF-токенов для защиты форм</li>
<li>Обработка прав доступа пользователей и групп</li>
<li>Проверка данных для входа в систему
Все ошибки, возникающие при работе с пользователями, обрабатываются через исключения.</li>
</ul>
</section>







<h3 id="toc">
    Table of Contents
    <a href="classes/PhotoRigma-Classes-User.html#toc" class="headerlink"><i class="fas fa-link"></i></a>

</h3>



    <h4 id="toc-interfaces">
        Interfaces
        <a href="classes/PhotoRigma-Classes-User.html#toc-interfaces" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <dl class="phpdocumentor-table-of-contents">
                    <dt class="phpdocumentor-table-of-contents__entry -interface"><a href="classes/PhotoRigma-Interfaces-User-Interface.html"><abbr title="\PhotoRigma\Interfaces\User_Interface">User_Interface</abbr></a></dt><dd>Интерфейс для работы с пользователями и группами.</dd>    </dl>






<h4 id="toc-properties">
    Properties
    <a href="classes/PhotoRigma-Classes-User.html#toc-properties" class="headerlink"><i class="fas fa-link"></i></a>

</h4>
<dl class="phpdocumentor-table-of-contents">
            <dt class="phpdocumentor-table-of-contents__entry -property -public">
    <a class="" href="classes/PhotoRigma-Classes-User.html#property_session">$session</a>
    <span>
                        &nbsp;: array&lt;string|int, mixed&gt;            </span>
</dt>

            <dt class="phpdocumentor-table-of-contents__entry -property -public">
    <a class="" href="classes/PhotoRigma-Classes-User.html#property_user">$user</a>
    <span>
                        &nbsp;: array&lt;string|int, mixed&gt;            </span>
</dt>

            <dt class="phpdocumentor-table-of-contents__entry -property -public">
    <a class="" href="classes/PhotoRigma-Classes-User.html#property_user_right_fields">$user_right_fields</a>
    <span>
                        &nbsp;: array&lt;string|int, mixed&gt;            </span>
</dt>

            <dt class="phpdocumentor-table-of-contents__entry -property -private">
    <a class="" href="classes/PhotoRigma-Classes-User.html#property_db">$db</a>
    <span>
                        &nbsp;: <a href="classes/PhotoRigma-Interfaces-Database-Interface.html"><abbr title="\PhotoRigma\Interfaces\Database_Interface">Database_Interface</abbr></a>            </span>
</dt>

            <dt class="phpdocumentor-table-of-contents__entry -property -private">
    <a class="" href="classes/PhotoRigma-Classes-User.html#property_session">$session</a>
    <span>
                        &nbsp;: array&lt;string|int, mixed&gt;            </span>
</dt>

            <dt class="phpdocumentor-table-of-contents__entry -property -private">
    <a class="" href="classes/PhotoRigma-Classes-User.html#property_user">$user</a>
    <span>
                        &nbsp;: array&lt;string|int, mixed&gt;            </span>
</dt>

            <dt class="phpdocumentor-table-of-contents__entry -property -private">
    <a class="" href="classes/PhotoRigma-Classes-User.html#property_user_right_fields">$user_right_fields</a>
    <span>
                        &nbsp;: array&lt;string|int, mixed&gt;            </span>
</dt>

            <dt class="phpdocumentor-table-of-contents__entry -property -private">
    <a class="" href="classes/PhotoRigma-Classes-User.html#property_work">$work</a>
    <span>
                        &nbsp;: <a href="classes/PhotoRigma-Interfaces-Work-Interface.html"><abbr title="\PhotoRigma\Interfaces\Work_Interface">Work_Interface</abbr></a>|null            </span>
</dt>

    </dl>

<h4 id="toc-methods">
    Methods
    <a href="classes/PhotoRigma-Classes-User.html#toc-methods" class="headerlink"><i class="fas fa-link"></i></a>

</h4>
<dl class="phpdocumentor-table-of-contents">
            <dt class="phpdocumentor-table-of-contents__entry -method -public">
    <a class="" href="classes/PhotoRigma-Classes-User.html#method___construct">__construct()</a>
    <span>
                                &nbsp;: mixed    </span>
</dt>
<dd>Конструктор класса.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -public">
    <a class="" href="classes/PhotoRigma-Classes-User.html#method___get">__get()</a>
    <span>
                                &nbsp;: array&lt;string|int, mixed&gt;    </span>
</dt>
<dd>Получает значение приватного свойства.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -public">
    <a class="" href="classes/PhotoRigma-Classes-User.html#method___isset">__isset()</a>
    <span>
                                &nbsp;: bool    </span>
</dt>
<dd>Проверяет существование недоступного свойства.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -public">
    <a class="" href="classes/PhotoRigma-Classes-User.html#method___set">__set()</a>
    <span>
                                &nbsp;: void    </span>
</dt>
<dd>Устанавливает значение приватного свойства.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -public">
    <a class="" href="classes/PhotoRigma-Classes-User.html#method_add_new_group">add_new_group()</a>
    <span>
                                &nbsp;: int    </span>
</dt>
<dd>Добавляет новую группу в систему через Админку.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -public">
    <a class="" href="classes/PhotoRigma-Classes-User.html#method_add_new_user">add_new_user()</a>
    <span>
                                &nbsp;: int    </span>
</dt>
<dd>Добавляет нового пользователя в базу данных через вызов внутреннего метода.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -public">
    <a class="" href="classes/PhotoRigma-Classes-User.html#method_cron_user_delete">cron_user_delete()</a>
    <span>
                                &nbsp;: void    </span>
</dt>
<dd>Публичный метод для запуска фоновой задачи окончательного удаления пользователей.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -public">
    <a class="" href="classes/PhotoRigma-Classes-User.html#method_csrf_token">csrf_token()</a>
    <span>
                                &nbsp;: string    </span>
</dt>
<dd>Генерирует или возвращает CSRF-токен через вызов внутреннего метода.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -public">
    <a class="" href="classes/PhotoRigma-Classes-User.html#method_delete_group">delete_group()</a>
    <span>
                                &nbsp;: bool    </span>
</dt>
<dd>Удаляет группу из системы через Админку.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -public">
    <a class="" href="classes/PhotoRigma-Classes-User.html#method_delete_user">delete_user()</a>
    <span>
                                &nbsp;: bool    </span>
</dt>
<dd>Публичный метод-редирект для выполнения мягкого или окончательного удаления пользователя.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -public">
    <a class="" href="classes/PhotoRigma-Classes-User.html#method_encode_user_rights">encode_user_rights()</a>
    <span>
                                &nbsp;: string    </span>
</dt>
<dd>Преобразует массив прав пользователя в строку JSON через вызов внутреннего метода.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -public">
    <a class="" href="classes/PhotoRigma-Classes-User.html#method_hard_delete_user">hard_delete_user()</a>
    <span>
                                &nbsp;: bool    </span>
</dt>
<dd>Публичный метод для окончательного обезличивания личных данных пользователя.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -public">
    <a class="" href="classes/PhotoRigma-Classes-User.html#method_is_soft_delete_expired">is_soft_delete_expired()</a>
    <span>
                                &nbsp;: array&lt;string|int, mixed&gt;    </span>
</dt>
<dd>Проверяет, истёк ли срок восстановления мягкого удаления.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -public">
    <a class="" href="classes/PhotoRigma-Classes-User.html#method_login_user">login_user()</a>
    <span>
                                &nbsp;: int    </span>
</dt>
<dd>Проверяет данные пользователя для входа в систему через вызов внутреннего метода.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -public">
    <a class="" href="classes/PhotoRigma-Classes-User.html#method_process_user_rights">process_user_rights()</a>
    <span>
                                &nbsp;: array&lt;string|int, mixed&gt;    </span>
</dt>
<dd>Обрабатывает поле `user_rights`, преобразуя его из строки JSON в массив прав, через вызов внутреннего метода.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -public">
    <a class="" href="classes/PhotoRigma-Classes-User.html#method_set_property_key">set_property_key()</a>
    <span>
                                &nbsp;: void    </span>
</dt>
<dd>Устанавливает значение свойства в массивах `$user` или `$session` через вызов внутреннего метода.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -public">
    <a class="" href="classes/PhotoRigma-Classes-User.html#method_set_work">set_work()</a>
    <span>
                                &nbsp;: void    </span>
</dt>
<dd>Устанавливает объект Work через вызов внутреннего метода.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -public">
    <a class="" href="classes/PhotoRigma-Classes-User.html#method_unset_property_key">unset_property_key()</a>
    <span>
                                &nbsp;: void    </span>
</dt>
<dd>Удаляет ключ из указанного свойства объекта (user или session) через вызов внутреннего метода.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -public">
    <a class="" href="classes/PhotoRigma-Classes-User.html#method_update_group_data">update_group_data()</a>
    <span>
                                &nbsp;: array&lt;string|int, mixed&gt;    </span>
</dt>
<dd>Обновляет данные группы в системе через вызов внутреннего метода.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -public">
    <a class="" href="classes/PhotoRigma-Classes-User.html#method_update_user_data">update_user_data()</a>
    <span>
                                &nbsp;: int    </span>
</dt>
<dd>Обновляет данные существующего пользователя через вызов внутреннего метода.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -public">
    <a class="" href="classes/PhotoRigma-Classes-User.html#method_update_user_rights">update_user_rights()</a>
    <span>
                                &nbsp;: array&lt;string|int, mixed&gt;    </span>
</dt>
<dd>Обновляет права пользователя или группу через вызов внутреннего метода.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -protected">
    <a class="" href="classes/PhotoRigma-Classes-User.html#method__add_new_group_internal">_add_new_group_internal()</a>
    <span>
                                &nbsp;: int    </span>
</dt>
<dd>Добавляет новую группу в систему через Админку.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -protected">
    <a class="" href="classes/PhotoRigma-Classes-User.html#method__add_new_user_internal">_add_new_user_internal()</a>
    <span>
                                &nbsp;: int    </span>
</dt>
<dd>Добавляет нового пользователя в базу данных, выполняя валидацию входных данных.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -protected">
    <a class="" href="classes/PhotoRigma-Classes-User.html#method__cron_user_delete_internal">_cron_user_delete_internal()</a>
    <span>
                                &nbsp;: void    </span>
</dt>
<dd>Фоновая задача: выполняет окончательное обезличивание пользователей, у которых истёк срок восстановления.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -protected">
    <a class="" href="classes/PhotoRigma-Classes-User.html#method__csrf_token_internal">_csrf_token_internal()</a>
    <span>
                                &nbsp;: string    </span>
</dt>
<dd>Генерирует или возвращает CSRF-токен для защиты от межсайтовой подделки запросов.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -protected">
    <a class="" href="classes/PhotoRigma-Classes-User.html#method__delete_group_internal">_delete_group_internal()</a>
    <span>
                                &nbsp;: bool    </span>
</dt>
<dd>Удаляет группу из базы данных.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -protected">
    <a class="" href="classes/PhotoRigma-Classes-User.html#method__delete_user_internal">_delete_user_internal()</a>
    <span>
                                &nbsp;: bool    </span>
</dt>
<dd>Выполняет мягкое или окончательное удаление пользователя с предварительными проверками.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -protected">
    <a class="" href="classes/PhotoRigma-Classes-User.html#method__encode_user_rights_internal">_encode_user_rights_internal()</a>
    <span>
                                &nbsp;: string    </span>
</dt>
<dd>Метод преобразует массив прав пользователя в строку JSON.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -protected">
    <a class="" href="classes/PhotoRigma-Classes-User.html#method__hard_delete_user_internal">_hard_delete_user_internal()</a>
    <span>
                                &nbsp;: bool    </span>
</dt>
<dd>Выполняет окончательное обезличивание записи пользователя.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -protected">
    <a class="" href="classes/PhotoRigma-Classes-User.html#method__is_soft_delete_expired_internal">_is_soft_delete_expired_internal()</a>
    <span>
                                &nbsp;: array&lt;string|int, mixed&gt;    </span>
</dt>
<dd>Возвращает данные о сроке восстановления аккаунта.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -protected">
    <a class="" href="classes/PhotoRigma-Classes-User.html#method__login_user_internal">_login_user_internal()</a>
    <span>
                                &nbsp;: int    </span>
</dt>
<dd>Проверяет данные пользователя для входа в систему с &quot;мягким&quot; обновлением паролей на новый формат хранения.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -protected">
    <a class="" href="classes/PhotoRigma-Classes-User.html#method__process_user_rights_internal">_process_user_rights_internal()</a>
    <span>
                                &nbsp;: array&lt;string|int, mixed&gt;    </span>
</dt>
<dd>Метод обрабатывает поле `user_rights`, преобразуя его из строки JSON в массив прав.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -protected">
    <a class="" href="classes/PhotoRigma-Classes-User.html#method__set_property_key_internal">_set_property_key_internal()</a>
    <span>
                                &nbsp;: void    </span>
</dt>
<dd>Метод устанавливает значение свойства в массивах `$user` или `$session`.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -protected">
    <a class="" href="classes/PhotoRigma-Classes-User.html#method__set_work_internal">_set_work_internal()</a>
    <span>
                                &nbsp;: void    </span>
</dt>
<dd>Установка объекта Work_Interface через сеттер.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -protected">
    <a class="" href="classes/PhotoRigma-Classes-User.html#method__unset_property_key_internal">_unset_property_key_internal()</a>
    <span>
                                &nbsp;: void    </span>
</dt>
<dd>Удаляет ключ из указанного свойства объекта (user или session).</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -protected">
    <a class="" href="classes/PhotoRigma-Classes-User.html#method__update_group_data_internal">_update_group_data_internal()</a>
    <span>
                                &nbsp;: array&lt;string|int, mixed&gt;    </span>
</dt>
<dd>Обновляет данные группы в системе через Админку.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -protected">
    <a class="" href="classes/PhotoRigma-Classes-User.html#method__update_user_data_internal">_update_user_data_internal()</a>
    <span>
                                &nbsp;: int    </span>
</dt>
<dd>Обновляет данные существующего пользователя, включая пароль, email, имя и аватар.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -protected">
    <a class="" href="classes/PhotoRigma-Classes-User.html#method__update_user_rights_internal">_update_user_rights_internal()</a>
    <span>
                                &nbsp;: array&lt;string|int, mixed&gt;    </span>
</dt>
<dd>Обновляет права пользователя или группу через Админку.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -private">
    <a class="" href="classes/PhotoRigma-Classes-User.html#method__all_right_fields">_all_right_fields()</a>
    <span>
                                &nbsp;: void    </span>
</dt>
<dd>Метод загружает права первого пользователя и первой группы из базы данных, извлекает имена полей (ключи) из
JSON-поля `user_rights`, объединяет их в один массив и сохраняет в свойство `$user_right_fields`.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -private">
    <a class="" href="classes/PhotoRigma-Classes-User.html#method__delete_personal_content">_delete_personal_content()</a>
    <span>
                                &nbsp;: bool    </span>
</dt>
<dd>Удаляет личные фото пользователя (категория 0) через существующий метод `del_photo()`.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -private">
    <a class="" href="classes/PhotoRigma-Classes-User.html#method__edit_avatar">_edit_avatar()</a>
    <span>
                                &nbsp;: string    </span>
</dt>
<dd>Обрабатывает загрузку аватара пользователя и возвращает имя нового аватара или значение по умолчанию
(`DEFAULT_AVATAR`), если загрузка не удалась.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -private">
    <a class="" href="classes/PhotoRigma-Classes-User.html#method__initialize_user">_initialize_user()</a>
    <span>
                                &nbsp;: void    </span>
</dt>
<dd>Инициализация данных пользователя: определение типа пользователя (гость или аутентифицированный) на основе
значения `login_id` из сессии.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -private">
    <a class="" href="classes/PhotoRigma-Classes-User.html#method__load_authenticated_user">_load_authenticated_user()</a>
    <span>
                                &nbsp;: void    </span>
</dt>
<dd>Метод загружает данные аутентифицированного пользователя из базы данных, включая права пользователя и группы,
обновляет дату последней активности, устанавливает язык и тему в сессии, и сохраняет данные в свойство `$user`.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -private">
    <a class="" href="classes/PhotoRigma-Classes-User.html#method__load_guest_user">_load_guest_user()</a>
    <span>
                                &nbsp;: void    </span>
</dt>
<dd>Метод загружает данные группы гостя из базы данных, обрабатывает права (`user_rights`) и сохраняет итоговые
данные в свойство `$user`.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -private">
    <a class="" href="classes/PhotoRigma-Classes-User.html#method__merge_user_with_group">_merge_user_with_group()</a>
    <span>
                                &nbsp;: void    </span>
</dt>
<dd>Метод объединяет данные пользователя с данными его группы, применяя логику перезаписи значений, и изменяет
свойство `$user` класса.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -private">
    <a class="" href="classes/PhotoRigma-Classes-User.html#method__soft_delete">_soft_delete()</a>
    <span>
                                &nbsp;: bool    </span>
</dt>
<dd>Выполняет мягкое удаление пользователя.</dd>

    </dl>



        

        
    <section class="phpdocumentor-properties">
        <h3 class="phpdocumentor-elements__header" id="properties">
            Properties
            <a href="classes/PhotoRigma-Classes-User.html#properties" class="headerlink"><i class="fas fa-link"></i></a>

        </h3>
                    <article
        class="
            phpdocumentor-element
            -property
            -public
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="property_session">
        $session
        <a href="classes/PhotoRigma-Classes-User.html#property_session" class="headerlink"><i class="fas fa-link"></i></a>

        <span class="phpdocumentor-element__modifiers">
                                </span>
    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/User.php"><a href="files/src-classes-user.html"><abbr title="src/Classes/User.php">User.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">0</span>

    </aside>

    
    
    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">public</span>
        <span class="phpdocumentor-signature__type">array&lt;string|int, mixed&gt;</span>
    <span class="phpdocumentor-signature__name">$session</span>
    </code>

        <section class="phpdocumentor-description"><p>Массив, привязанный к глобальному массиву $_SESSION.</p>
</section>

    
    

    

</article>
                    <article
        class="
            phpdocumentor-element
            -property
            -public
                                                -read-only        "
>
    <h4 class="phpdocumentor-element__name" id="property_user">
        $user
        <a href="classes/PhotoRigma-Classes-User.html#property_user" class="headerlink"><i class="fas fa-link"></i></a>

        <span class="phpdocumentor-element__modifiers">
                        <small class="phpdocumentor-element__modifier">read-only</small>        </span>
    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/User.php"><a href="files/src-classes-user.html"><abbr title="src/Classes/User.php">User.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">0</span>

    </aside>

    
    
    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">public</span>
        <span class="phpdocumentor-signature__type">array&lt;string|int, mixed&gt;</span>
    <span class="phpdocumentor-signature__name">$user</span>
    </code>

        <section class="phpdocumentor-description"><p>Массив, содержащий все данные о текущем пользователе.</p>
</section>

    
    

    

</article>
                    <article
        class="
            phpdocumentor-element
            -property
            -public
                                                -read-only        "
>
    <h4 class="phpdocumentor-element__name" id="property_user_right_fields">
        $user_right_fields
        <a href="classes/PhotoRigma-Classes-User.html#property_user_right_fields" class="headerlink"><i class="fas fa-link"></i></a>

        <span class="phpdocumentor-element__modifiers">
                        <small class="phpdocumentor-element__modifier">read-only</small>        </span>
    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/User.php"><a href="files/src-classes-user.html"><abbr title="src/Classes/User.php">User.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">0</span>

    </aside>

    
    
    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">public</span>
        <span class="phpdocumentor-signature__type">array&lt;string|int, mixed&gt;</span>
    <span class="phpdocumentor-signature__name">$user_right_fields</span>
    </code>

        <section class="phpdocumentor-description"><p>Массив с полями наименований прав доступа.</p>
</section>

    
    

    

</article>
                    <article
        class="
            phpdocumentor-element
            -property
            -private
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="property_db">
        $db
        <a href="classes/PhotoRigma-Classes-User.html#property_db" class="headerlink"><i class="fas fa-link"></i></a>

        <span class="phpdocumentor-element__modifiers">
                                </span>
    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/User.php"><a href="files/src-classes-user.html"><abbr title="src/Classes/User.php">User.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">96</span>

    </aside>

    
    
    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">private</span>
        <span class="phpdocumentor-signature__type"><a href="classes/PhotoRigma-Interfaces-Database-Interface.html"><abbr title="\PhotoRigma\Interfaces\Database_Interface">Database_Interface</abbr></a></span>
    <span class="phpdocumentor-signature__name">$db</span>
    </code>

    
        <section class="phpdocumentor-description"><p>Объект для работы с базой данных.</p>
</section>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-User.html#property_db#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method___construct"><abbr title="\PhotoRigma\Classes\User::__construct()">User::__construct()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, содержащее объект для работы с базой данных.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__all_right_fields"><abbr title="\PhotoRigma\Classes\User::_all_right_fields()">User::_all_right_fields()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, содержащее объект для работы с базой данных.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__load_guest_user"><abbr title="\PhotoRigma\Classes\User::_load_guest_user()">User::_load_guest_user()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, содержащее объект для работы с базой данных.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__load_authenticated_user"><abbr title="\PhotoRigma\Classes\User::_load_authenticated_user()">User::_load_authenticated_user()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, содержащее объект для работы с базой данных.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__add_new_user_internal"><abbr title="\PhotoRigma\Classes\User::_add_new_user_internal()">User::_add_new_user_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Объект для работы с базой данных.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__login_user_internal"><abbr title="\PhotoRigma\Classes\User::_login_user_internal()">User::_login_user_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, содержащее объект класса Database.</p>
</section>

                                    </dd>
                                            </dl>

    

</article>
                    <article
        class="
            phpdocumentor-element
            -property
            -private
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="property_session">
        $session
        <a href="classes/PhotoRigma-Classes-User.html#property_session" class="headerlink"><i class="fas fa-link"></i></a>

        <span class="phpdocumentor-element__modifiers">
                                </span>
    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/User.php"><a href="files/src-classes-user.html"><abbr title="src/Classes/User.php">User.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">98</span>

    </aside>

    
    
    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">private</span>
        <span class="phpdocumentor-signature__type">array&lt;string|int, mixed&gt;</span>
    <span class="phpdocumentor-signature__name">$session</span>
    </code>

    
        <section class="phpdocumentor-description"><p>Массив, привязанный к глобальному массиву $_SESSION</p>
</section>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-User.html#property_session#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method___construct"><abbr title="\PhotoRigma\Classes\User::__construct()">User::__construct()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, содержащее ссылку на массив сессии ($_SESSION) по ключу
<code class="prettyprint">KEY_SESSION</code>.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__initialize_user"><abbr title="\PhotoRigma\Classes\User::_initialize_user()">User::_initialize_user()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, содержащее данные сессии.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__load_authenticated_user"><abbr title="\PhotoRigma\Classes\User::_load_authenticated_user()">User::_load_authenticated_user()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, содержащее данные сессии.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__set_property_key_internal"><abbr title="\PhotoRigma\Classes\User::_set_property_key_internal()">User::_set_property_key_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство класса User, содержащее данные сессии.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__set_work_internal"><abbr title="\PhotoRigma\Classes\User::_set_work_internal()">User::_set_work_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство класса User, содержащее данные сессии.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method___get"><abbr title="\PhotoRigma\Classes\User::__get()">User::__get()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, привязанное к глобальному массиву $_SESSION.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method___set"><abbr title="\PhotoRigma\Classes\User::__set()">User::__set()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, привязанное к глобальному массиву $_SESSION.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__add_new_user_internal"><abbr title="\PhotoRigma\Classes\User::_add_new_user_internal()">User::_add_new_user_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство класса User, связанное с $_SESSION.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__unset_property_key_internal"><abbr title="\PhotoRigma\Classes\User::_unset_property_key_internal()">User::_unset_property_key_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство класса User, содержащее данные сессии.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__csrf_token_internal"><abbr title="\PhotoRigma\Classes\User::_csrf_token_internal()">User::_csrf_token_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство класса User, содержащее данные сессии.</p>
</section>

                                    </dd>
                                            </dl>

    

</article>
                    <article
        class="
            phpdocumentor-element
            -property
            -private
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="property_user">
        $user
        <a href="classes/PhotoRigma-Classes-User.html#property_user" class="headerlink"><i class="fas fa-link"></i></a>

        <span class="phpdocumentor-element__modifiers">
                                </span>
    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/User.php"><a href="files/src-classes-user.html"><abbr title="src/Classes/User.php">User.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">94</span>

    </aside>

    
    
    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">private</span>
        <span class="phpdocumentor-signature__type">array&lt;string|int, mixed&gt;</span>
    <span class="phpdocumentor-signature__name">$user</span>
     = <span class="phpdocumentor-signature__default-value">[]</span></code>

    
        <section class="phpdocumentor-description"><p>Массив, содержащий все данные о текущем пользователе.</p>
</section>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-User.html#property_user#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__load_guest_user"><abbr title="\PhotoRigma\Classes\User::_load_guest_user()">User::_load_guest_user()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, содержащее данные текущего пользователя.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__load_authenticated_user"><abbr title="\PhotoRigma\Classes\User::_load_authenticated_user()">User::_load_authenticated_user()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, содержащее данные текущего пользователя.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__merge_user_with_group"><abbr title="\PhotoRigma\Classes\User::_merge_user_with_group()">User::_merge_user_with_group()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, содержащее данные текущего пользователя.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__set_property_key_internal"><abbr title="\PhotoRigma\Classes\User::_set_property_key_internal()">User::_set_property_key_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство класса User, содержащее данные пользователя.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method___get"><abbr title="\PhotoRigma\Classes\User::__get()">User::__get()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, содержащее данные о текущем пользователе.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__unset_property_key_internal"><abbr title="\PhotoRigma\Classes\User::_unset_property_key_internal()">User::_unset_property_key_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство класса User, содержащее данные пользователя.</p>
</section>

                                    </dd>
                                            </dl>

    

</article>
                    <article
        class="
            phpdocumentor-element
            -property
            -private
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="property_user_right_fields">
        $user_right_fields
        <a href="classes/PhotoRigma-Classes-User.html#property_user_right_fields" class="headerlink"><i class="fas fa-link"></i></a>

        <span class="phpdocumentor-element__modifiers">
                                </span>
    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/User.php"><a href="files/src-classes-user.html"><abbr title="src/Classes/User.php">User.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">100</span>

    </aside>

    
    
    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">private</span>
        <span class="phpdocumentor-signature__type">array&lt;string|int, mixed&gt;</span>
    <span class="phpdocumentor-signature__name">$user_right_fields</span>
     = <span class="phpdocumentor-signature__default-value">[]</span></code>

    
        <section class="phpdocumentor-description"><p>Массив с полями наименований прав доступа</p>
</section>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-User.html#property_user_right_fields#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__all_right_fields"><abbr title="\PhotoRigma\Classes\User::_all_right_fields()">User::_all_right_fields()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, содержащее имена полей прав пользователей и групп.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method___get"><abbr title="\PhotoRigma\Classes\User::__get()">User::__get()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, содержащее допустимые значения прав пользователей
и групп.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__update_group_data_internal"><abbr title="\PhotoRigma\Classes\User::_update_group_data_internal()">User::_update_group_data_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, содержащее массив с допустимыми полями прав
пользователя.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__update_user_rights_internal"><abbr title="\PhotoRigma\Classes\User::_update_user_rights_internal()">User::_update_user_rights_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, содержащее массив с допустимыми полями прав
пользователя.</p>
</section>

                                    </dd>
                                            </dl>

    

</article>
                    <article
        class="
            phpdocumentor-element
            -property
            -private
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="property_work">
        $work
        <a href="classes/PhotoRigma-Classes-User.html#property_work" class="headerlink"><i class="fas fa-link"></i></a>

        <span class="phpdocumentor-element__modifiers">
                                </span>
    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/User.php"><a href="files/src-classes-user.html"><abbr title="src/Classes/User.php">User.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">102</span>

    </aside>

    
    
    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">private</span>
        <span class="phpdocumentor-signature__type"><a href="classes/PhotoRigma-Interfaces-Work-Interface.html"><abbr title="\PhotoRigma\Interfaces\Work_Interface">Work_Interface</abbr></a>|null</span>
    <span class="phpdocumentor-signature__name">$work</span>
     = <span class="phpdocumentor-signature__default-value">null</span></code>

    
        <section class="phpdocumentor-description"><p>Свойство для объекта класса Work</p>
</section>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-User.html#property_work#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__set_work_internal"><abbr title="\PhotoRigma\Classes\User::_set_work_internal()">User::_set_work_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство для объекта, реализующего интерфейс Work_Interface.</p>
</section>

                                    </dd>
                                            </dl>

    

</article>
            </section>

            <section class="phpdocumentor-methods">
        <h3 class="phpdocumentor-elements__header" id="methods">
            Methods
            <a href="classes/PhotoRigma-Classes-User.html#methods" class="headerlink"><i class="fas fa-link"></i></a>

        </h3>
                    <article
        class="phpdocumentor-element
            -method
            -public
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method___construct">
        __construct()
        <a href="classes/PhotoRigma-Classes-User.html#method___construct" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/User.php"><a href="files/src-classes-user.html"><abbr title="src/Classes/User.php">User.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">142</span>

    </aside>

        <p class="phpdocumentor-summary">Конструктор класса.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">public</span>
                    <span class="phpdocumentor-signature__name">__construct</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type"><a href="classes/PhotoRigma-Interfaces-Database-Interface.html"><abbr title="\PhotoRigma\Interfaces\Database_Interface">Database_Interface</abbr></a>&nbsp;</span><span class="phpdocumentor-signature__argument__name">$db</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__reference-operator">&amp;</span><span class="phpdocumentor-signature__argument__name">$session</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">mixed</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот метод вызывается автоматически при создании нового объекта класса.
Используется для подключения объекта Database_Interface и глобального массива $_SESSION. После подключения
выполняется инициализация и наполнение данных о текущем пользователе.
Алгоритм работы:</p>
<ol>
<li>Сохраняет объект базы данных в свойство <code class="prettyprint">$db</code>.</li>
<li>Проверяет наличие ключа <code class="prettyprint">KEY_SESSION</code> в массиве сессии:
<ul>
<li>Если ключ отсутствует, инициализирует его пустым массивом.</li>
</ul>
</li>
<li>Создает ссылку на массив сессии по ключу <code class="prettyprint">KEY_SESSION</code> в свойстве <code class="prettyprint">$session</code>.</li>
<li>Вызывает метод <code class="prettyprint">_all_right_fields()</code> для наполнения массива именами полей прав пользователей и групп.</li>
<li>Вызывает метод <code class="prettyprint">_initialize_user()</code> для инициализации данных о текущем пользователе.</li>
</ol>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$db</span>
                : <span class="phpdocumentor-signature__argument__return-type"><a href="classes/PhotoRigma-Interfaces-Database-Interface.html"><abbr title="\PhotoRigma\Interfaces\Database_Interface">Database_Interface</abbr></a></span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Объект для работы с базой данных.
Должен реализовывать интерфейс <code class="prettyprint">Database_Interface</code>.
Пример: <code class="prettyprint">$db = new \PhotoRigma\Classes\Database();</code>.</p>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$session</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Ссылка на массив сессии ($_SESSION).
Должен быть ассоциативным массивом.
Пример: <code class="prettyprint">$_SESSION</code>.</p>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-User.html#method___construct#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\JsonException">JsonException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если произошла ошибка при работе с JSON (например, при сериализации данных
в методах <code class="prettyprint">_initialize_user()</code> или <code class="prettyprint">_all_right_fields()</code>).</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Используется константа <code class="prettyprint">KEY_SESSION</code>: Ключ для использования в глобальном массиве $_SESSION.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Убедитесь, что:</p>
<ul>
<li>Переданный объект <code class="prettyprint">$db</code> реализует интерфейс <code class="prettyprint">Database_Interface</code>.</li>
<li>Массив <code class="prettyprint">$_SESSION</code> является ассоциативным массивом.
Несоблюдение этих условий может привести к ошибкам инициализации.</li>
</ul>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#property_db"><abbr title="\PhotoRigma\Classes\User::$db">User::$db</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, содержащее объект для работы с базой данных.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#property_session"><abbr title="\PhotoRigma\Classes\User::$session">User::$session</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, содержащее ссылку на массив сессии ($_SESSION) по ключу
<code class="prettyprint">KEY_SESSION</code>.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__initialize_user"><abbr title="\PhotoRigma\Classes\User::_initialize_user()">User::_initialize_user()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Метод, выполняющий инициализацию данных о пользователе.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__all_right_fields"><abbr title="\PhotoRigma\Classes\User::_all_right_fields()">User::_all_right_fields()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Метод, наполняющий массив именами полей прав пользователей
и групп.</p>
</section>

                                    </dd>
                        </dl>

    

    
</article>
                    <article
        class="phpdocumentor-element
            -method
            -public
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method___get">
        __get()
        <a href="classes/PhotoRigma-Classes-User.html#method___get" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/User.php"><a href="files/src-classes-user.html"><abbr title="src/Classes/User.php">User.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">807</span>

    </aside>

        <p class="phpdocumentor-summary">Получает значение приватного свойства.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">public</span>
                    <span class="phpdocumentor-signature__name">__get</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$name</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">array&lt;string|int, mixed&gt;</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот метод позволяет получить доступ к приватным свойствам <code class="prettyprint">$user</code>, <code class="prettyprint">$session</code> и <code class="prettyprint">$user_right_fields</code>.
Алгоритм работы:</p>
<ol>
<li>Проверяет, соответствует ли имя свойства допустимым значениям (<code class="prettyprint">user</code>, <code class="prettyprint">session</code>, <code class="prettyprint">user_right_fields</code>).</li>
<li>Если имя свойства корректно, возвращает значение соответствующего свойства.</li>
<li>Если имя свойства некорректно, выбрасывается исключение.
Метод является публичным и предназначен для получения доступа к указанным свойствам.</li>
</ol>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$name</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Имя свойства:</p>
<ul>
<li>Допустимые значения: 'user', 'session', 'user_right_fields'.</li>
<li>Если указано другое имя, выбрасывается исключение.
Пример: 'user'.
Ограничения: только три допустимых значения.</li>
</ul>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-User.html#method___get#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\InvalidArgumentException">InvalidArgumentException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если запрашиваемое свойство не существует.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Этот метод предназначен только для доступа к свойствам <code class="prettyprint">$user</code>, <code class="prettyprint">$session</code> и <code class="prettyprint">$user_right_fields</code>.
Любые другие запросы будут игнорироваться с выбросом исключения.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Убедитесь, что вы запрашиваете только допустимые свойства:</p>
<ul>
<li>'user'</li>
<li>'session'</li>
<li>'user_right_fields'
Некорректные имена свойств вызовут исключение.</li>
</ul>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#property_session"><abbr title="\PhotoRigma\Classes\User::$session">User::$session</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, привязанное к глобальному массиву $_SESSION.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#property_user"><abbr title="\PhotoRigma\Classes\User::$user">User::$user</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, содержащее данные о текущем пользователе.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#property_user_right_fields"><abbr title="\PhotoRigma\Classes\User::$user_right_fields">User::$user_right_fields</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, содержащее допустимые значения прав пользователей
и групп.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">array&lt;string|int, mixed&gt;</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Значение запрашиваемого свойства (<code class="prettyprint">$user</code>, <code class="prettyprint">$session</code> или <code class="prettyprint">$user_right_fields</code>).
Пример:</p>
<ul>
<li>Для <code class="prettyprint">$user</code>: массив данных о текущем пользователе.</li>
<li>Для <code class="prettyprint">$session</code>: массив сессии, связанный с глобальным массивом $_SESSION.</li>
<li>Для <code class="prettyprint">$user_right_fields</code>: массив допустимых значений прав пользователей и групп.</li>
</ul>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -public
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method___isset">
        __isset()
        <a href="classes/PhotoRigma-Classes-User.html#method___isset" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/User.php"><a href="files/src-classes-user.html"><abbr title="src/Classes/User.php">User.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">918</span>

    </aside>

        <p class="phpdocumentor-summary">Проверяет существование недоступного свойства.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">public</span>
                    <span class="phpdocumentor-signature__name">__isset</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$name</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">bool</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот метод вызывается автоматически при использовании оператора <code class="prettyprint">isset()</code> для проверки существования
недоступного свойства. Метод возвращает <code class="prettyprint">true</code>, если свойство существует, и <code class="prettyprint">false</code> в противном случае.</p>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$name</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Имя свойства:</p>
<ul>
<li>Проверяется на существование.</li>
</ul>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-User.html#method___isset#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Этот метод предназначен только для проверки существования свойств.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Если свойство не определено или является недоступным, результат будет <code class="prettyprint">false</code>.</p>
</section>

                                    </dd>
                                            </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">bool</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Результат проверки:</p>
<ul>
<li><code class="prettyprint">true</code>, если свойство существует.</li>
<li><code class="prettyprint">false</code>, если свойство не существует.</li>
</ul>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -public
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method___set">
        __set()
        <a href="classes/PhotoRigma-Classes-User.html#method___set" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/User.php"><a href="files/src-classes-user.html"><abbr title="src/Classes/User.php">User.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">859</span>

    </aside>

        <p class="phpdocumentor-summary">Устанавливает значение приватного свойства.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">public</span>
                    <span class="phpdocumentor-signature__name">__set</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$name</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$value</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">void</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот метод позволяет изменить значение приватного свойства <code class="prettyprint">$session</code>.
Алгоритм работы:</p>
<ol>
<li>Проверяет, соответствует ли имя свойства допустимым значениям (<code class="prettyprint">session</code>).
<ul>
<li>Если имя свойства некорректно, выбрасывается исключение.</li>
</ul>
</li>
<li>Обновляет только те ключи в <code class="prettyprint">$session</code>, которые переданы в <code class="prettyprint">$value</code>.
<ul>
<li>Новые ключи добавляются в массив <code class="prettyprint">$session</code>.</li>
</ul>
</li>
<li>Логирует изменения:
<ul>
<li>Отдельно обновлённые ключи.</li>
<li>Отдельно добавленные ключи.</li>
</ul>
</li>
<li>Все изменения сохраняются в свойстве <code class="prettyprint">$session</code>.
Метод является публичным и предназначен для изменения свойства <code class="prettyprint">$session</code>.</li>
</ol>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$name</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Имя свойства:</p>
<ul>
<li>Допустимые значения: 'session'.</li>
<li>Если указано другое имя, выбрасывается исключение.
Пример: 'session'.
Ограничения: только одно допустимое значение.</li>
</ul>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$value</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Новое значение свойства:</p>
<ul>
<li>Должен быть ассоциативным массивом.
Пример: <code class="prettyprint">['user_id' =&gt; 123]</code>.</li>
</ul>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-User.html#method___set#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\InvalidArgumentException">InvalidArgumentException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если переданное имя свойства некорректно.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\JsonException">JsonException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается при ошибке кодирования данных в JSON (например, при логировании
изменений).</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\Exception">Exception</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если произошла ошибка логирования в функции <code class="prettyprint">log_in_file</code>.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Этот метод предназначен только для изменения свойства <code class="prettyprint">$session</code>.
Любые другие запросы будут игнорироваться с выбросом исключения.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Убедитесь, что:</p>
<ul>
<li>Переданное имя свойства соответствует допустимым значениям.</li>
<li>Значение <code class="prettyprint">$value</code> является ассоциативным массивом.
Несоблюдение этих условий вызовет исключение.</li>
</ul>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#property_session"><abbr title="\PhotoRigma\Classes\User::$session">User::$session</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, привязанное к глобальному массиву $_SESSION.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="namespaces/photorigma-include.html#function_log_in_file"><abbr title="\PhotoRigma\Include\log_in_file()">log_in_file()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Записывает сообщение об ошибке в лог-файл.</p>
</section>

                                    </dd>
                        </dl>

    

    
</article>
                    <article
        class="phpdocumentor-element
            -method
            -public
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method_add_new_group">
        add_new_group()
        <a href="classes/PhotoRigma-Classes-User.html#method_add_new_group" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/User.php"><a href="files/src-classes-user.html"><abbr title="src/Classes/User.php">User.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">955</span>

    </aside>

        <p class="phpdocumentor-summary">Добавляет новую группу в систему через Админку.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">public</span>
                    <span class="phpdocumentor-signature__name">add_new_group</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$group_data</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">int</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Метод является обёрткой для внутреннего метода <code class="prettyprint">_add_new_group_internal()</code>.
Он передаёт данные о:</p>
<ul>
<li>Имени группы (<code class="prettyprint">name_group</code>)</li>
<li>Правах доступа (все поля из <code class="prettyprint">$this-&gt;user_right_fields['all']</code>)
Реализация вызывает:</li>
<li>Валидацию имени</li>
<li>Нормализацию прав доступа (true/false)</li>
<li>Кодирование прав в JSON</li>
<li>Вставку записи в TBL_GROUP
Возвращает ID новой группы.</li>
</ul>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$group_data</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Данные новой группы:</p>
<ul>
<li><code class="prettyprint">name_group</code>: Имя группы (валидируется через REG_NAME).</li>
<li>Все права из <code class="prettyprint">$this-&gt;user_right_fields['all']</code> (true/false или строковые значения).
Пример: ['name_group' =&gt; 'Moderators', 'read' =&gt; 'on', 'write' =&gt; false]</li>
</ul>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-User.html#method_add_new_group#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\RuntimeException">RuntimeException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если имя группы не прошло валидацию.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\JsonException">JsonException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если не удалось кодировать права в JSON.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\Exception">Exception</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается при ошибках SQL-запроса.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Метод использует защищённый <code class="prettyprint">_add_new_group_internal()</code> для выполнения основной логики.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Убедитесь, что все поля прав доступа переданы в <code class="prettyprint">$group_data</code>. Отсутствие полей может привести к ошибкам.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__add_new_group_internal"><abbr title="\PhotoRigma\Classes\User::_add_new_group_internal()">User::_add_new_group_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Защищённый метод, реализующий добавление группы и
валидацию данных.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">int</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Возвращает ID новой группы при успешном добавлении.</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -public
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method_add_new_user">
        add_new_user()
        <a href="classes/PhotoRigma-Classes-User.html#method_add_new_user" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/User.php"><a href="files/src-classes-user.html"><abbr title="src/Classes/User.php">User.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">1083</span>

    </aside>

        <p class="phpdocumentor-summary">Добавляет нового пользователя в базу данных через вызов внутреннего метода.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">public</span>
                    <span class="phpdocumentor-signature__name">add_new_user</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$post_data</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">int</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот публичный метод является обёрткой для защищённого метода _add_new_user_internal().
Он выполняет проверку входных данных, проверяет уникальность логина, email и имени пользователя, добавляет
нового пользователя в базу данных и назначает ему группу по умолчанию. В случае ошибок сохраняет их в сессии и
завершает выполнение. Предназначен для прямого использования извне.</p>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$post_data</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Массив данных из формы ($_POST), содержащий новые значения для полей пользователя:</p>
<ul>
<li>string $login: Логин пользователя (должен соответствовать регулярному выражению
REG_LOGIN).</li>
<li>string $password: Пароль пользователя (не должен быть пустым).</li>
<li>string $re_password: Повтор пароля (должен совпадать с $password).</li>
<li>string $email: Email пользователя (должен соответствовать регулярному выражению
REG_EMAIL).</li>
<li>string $real_name: Реальное имя пользователя (должно соответствовать регулярному
выражению REG_NAME).</li>
<li>string $captcha: Значение CAPTCHA (должно быть числом).
Все поля обязательны для заполнения.</li>
</ul>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-User.html#method_add_new_user#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\RuntimeException">RuntimeException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если группа по умолчанию не найдена в базе данных.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\PDOException">PDOException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если возникает ошибка при работе с базой данных.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\Exception">Exception</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если возникает ошибка при проверке входных данных.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Используется CAPTCHA для защиты от автоматической регистрации.
Константы, используемые в методе:</p>
<ul>
<li><code class="prettyprint">REG_LOGIN</code>: Регулярное выражение для проверки логина.
Пример: <code class="prettyprint">/^[a-zA-Z0-9][a-zA-Z0-9_-]*[a-zA-Z0-9_]$/</code>.</li>
<li><code class="prettyprint">REG_EMAIL</code>: Регулярное выражение для проверки email.
Пример: <code class="prettyprint">/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/</code>.</li>
<li><code class="prettyprint">REG_NAME</code>: Регулярное выражение для проверки реального имени.
Пример: <code class="prettyprint">/^[^\x00-\x1F\x7F&lt;&gt;&amp;&quot;'\\\/</code>=]{1,100}$/`.</li>
<li><code class="prettyprint">DEFAULT_GROUP</code>: Идентификатор группы по умолчанию. Например: <code class="prettyprint">1</code>.</li>
<li><code class="prettyprint">TBL_USERS</code>: Таблица пользователей в базе данных. Например: '<code class="prettyprint">users</code>'.</li>
<li><code class="prettyprint">TBL_GROUP</code>: Таблица групп в базе данных. Например: '<code class="prettyprint">groups</code>'.
Эти константы позволяют гибко настраивать поведение метода.</li>
</ul>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Метод зависит от корректной конфигурации базы данных и таблицы групп. Убедитесь, что все необходимые
константы и таблицы настроены правильно. Невалидные данные могут привести к ошибкам.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__add_new_user_internal"><abbr title="\PhotoRigma\Classes\User::_add_new_user_internal()">User::_add_new_user_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Защищённый метод, реализующий основную логику
добавления нового пользователя.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">int</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>ID нового пользователя, если регистрация успешна, или <code class="prettyprint">0</code> в случае ошибки.</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -public
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method_cron_user_delete">
        cron_user_delete()
        <a href="classes/PhotoRigma-Classes-User.html#method_cron_user_delete" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/User.php"><a href="files/src-classes-user.html"><abbr title="src/Classes/User.php">User.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">3182</span>

    </aside>

        <p class="phpdocumentor-summary">Публичный метод для запуска фоновой задачи окончательного удаления пользователей.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">public</span>
                    <span class="phpdocumentor-signature__name">cron_user_delete</span><span>(</span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">void</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Предназначен для вызова из cron.php. Содержит защиту от запуска через веб-интерфейс.
Передаёт управление защищённому методу <code class="prettyprint">_cron_user_delete_internal()</code>, который реализует логику:</p>
<ul>
<li>Выборка пользователей с истёкшим сроком мягкого удаления</li>
<li>Обезличивание аккаунтов</li>
<li>Удаление личного контента</li>
</ul>
</section>

    
    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-User.html#method_cron_user_delete#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\Exception">Exception</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Меожет выбрасываться:</p>
<ul>
<li>При логировании ошибок.</li>
<li>Из метода <code class="prettyprint">_cron_user_delete_internal()</code>.</li>
</ul>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Метод содержит защиту от запуска через веб-запрос:</p>
<ul>
<li>Проверяется, что скрипт запущен в режиме CLI (через cron).</li>
<li>В случае веб-запроса — выводится ошибка и выполнение прерывается.</li>
</ul>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Этот метод должен запускаться только через cron.php и никогда — из веб-интерфейса.
Он не должен быть доступен извне.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__cron_user_delete_internal"><abbr title="\PhotoRigma\Classes\User::_cron_user_delete_internal()">User::_cron_user_delete_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Защищённый метод, реализующий фоновую логику
окончательного удаления.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">void</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Метод не возвращает значения.</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -public
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method_csrf_token">
        csrf_token()
        <a href="classes/PhotoRigma-Classes-User.html#method_csrf_token" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/User.php"><a href="files/src-classes-user.html"><abbr title="src/Classes/User.php">User.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">1389</span>

    </aside>

        <p class="phpdocumentor-summary">Генерирует или возвращает CSRF-токен через вызов внутреннего метода.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">public</span>
                    <span class="phpdocumentor-signature__name">csrf_token</span><span>(</span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">string</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот публичный метод является обёрткой для защищённого метода _csrf_token_internal().
Он проверяет наличие CSRF-токена в сессии. Если токен отсутствует, он генерируется с использованием
<code class="prettyprint">random_bytes(32)</code> (64 символа) и сохраняется в сессии. Предназначен для прямого использования извне.</p>
</section>

    
    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-User.html#method_csrf_token#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\Random\RandomException">RandomException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если возникает ошибка при генерации случайных байтов.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Токен хранится в сессии и используется для защиты форм от CSRF-атак.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Не используйте этот метод для генерации токенов, если сессия недоступна или не инициализирована.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__csrf_token_internal"><abbr title="\PhotoRigma\Classes\User::_csrf_token_internal()">User::_csrf_token_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Защищённый метод, реализующий основную логику генерации
или получения CSRF-токена.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">string</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>CSRF-токен длиной 64 символа (генерируется с использованием <code class="prettyprint">random_bytes(32)</code>).</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -public
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method_delete_group">
        delete_group()
        <a href="classes/PhotoRigma-Classes-User.html#method_delete_group" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/User.php"><a href="files/src-classes-user.html"><abbr title="src/Classes/User.php">User.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">1452</span>

    </aside>

        <p class="phpdocumentor-summary">Удаляет группу из системы через Админку.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">public</span>
                    <span class="phpdocumentor-signature__name">delete_group</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">int&nbsp;</span><span class="phpdocumentor-signature__argument__name">$group_id</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">bool</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Метод является обёрткой для защищённого метода <code class="prettyprint">_delete_group_internal()</code>.
Он предназначен для вызова из клиентского кода (например, интерфейса Админки). Передаёт управление на
внутренний метод с проверками и логикой удаления. Не требует дополнительных параметров, кроме ID группы.</p>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$group_id</span>
                : <span class="phpdocumentor-signature__argument__return-type">int</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>ID группы, которую нужно удалить.
Должен быть положительным целым числом (<code class="prettyprint">&gt; 0</code>).
Пример: 123.</p>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-User.html#method_delete_group#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\Exception">Exception</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>При ошибках выполнения SQL-запросов или записи в log_in_file().</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Реализация находится в <code class="prettyprint">_delete_group_internal()</code>.
Для защиты от удаления используются константы <code class="prettyprint">PROTECTED_GROUPS</code>.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Убедитесь, что вы действительно хотите удалить группу.
Удаление затрагивает пользователей, состоящих в группе.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__delete_group_internal"><abbr title="\PhotoRigma\Classes\User::_delete_group_internal()">User::_delete_group_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Защищённый метод, реализующий основную логику
удаления группы.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">bool</span>
                    &mdash;
                <section class="phpdocumentor-description"><p><code class="prettyprint">TRUE</code>, если группа успешно удалена.
<code class="prettyprint">FALSE</code>, если:</p>
<ul>
<li>Группа защищена от удаления</li>
<li>Ни одна строка не была изменена при обновлении/удалении</li>
</ul>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -public
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method_delete_user">
        delete_user()
        <a href="classes/PhotoRigma-Classes-User.html#method_delete_user" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/User.php"><a href="files/src-classes-user.html"><abbr title="src/Classes/User.php">User.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">1557</span>

    </aside>

        <p class="phpdocumentor-summary">Публичный метод-редирект для выполнения мягкого или окончательного удаления пользователя.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">public</span>
                    <span class="phpdocumentor-signature__name">delete_user</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">int&nbsp;</span><span class="phpdocumentor-signature__argument__name">$user_id</span></span><span class="phpdocumentor-signature__argument"><span>[</span><span>, </span><span class="phpdocumentor-signature__argument__return-type">bool&nbsp;</span><span class="phpdocumentor-signature__argument__name">$permanent</span><span> = </span><span class="phpdocumentor-signature__argument__default-value">false</span><span> ]</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">bool</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Предназначен для прямого вызова из клиентского кода. Передаёт управление защищённому методу
<code class="prettyprint">_delete_user_internal()</code>, который реализует основную логику:</p>
<ul>
<li>Проверяет, не пытается ли администратор удалить сам себя</li>
<li>При окончательном удалении:
a) Инициатором считается текущий пользователь.
b) Проверяется, что это администратор (<code class="prettyprint">$this-&gt;user['admin']</code>).
c) Сессия админа должна быть подтверждена (<code class="prettyprint">$this-&gt;session['admin_on']</code>).
d) Запрещено удалять последнего админа.
Поддерживает мягкое удаление (пометка <code class="prettyprint">deleted_at</code>) и окончательное удаление (через cron или админку).</li>
</ul>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$user_id</span>
                : <span class="phpdocumentor-signature__argument__return-type">int</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>ID пользователя, которого нужно удалить.
Должен быть положительным целым числом (<code class="prettyprint">&gt; 0</code>).
Пример: 123.</p>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$permanent</span>
                : <span class="phpdocumentor-signature__argument__return-type">bool</span>
                 = <span class="phpdocumentor-signature__argument__default-value">false</span>            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>[optional] Указывает, какое удаление выполнить:</p>
<ul>
<li><code class="prettyprint">FALSE</code> (по умолчанию): мягкое удаление (помечаем <code class="prettyprint">deleted_at</code>)</li>
<li><code class="prettyprint">TRUE</code>: окончательное удаление (удаляем запись из БД)</li>
</ul>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-User.html#method_delete_user#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\Exception">Exception</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если произошла ошибка на уровне СУБД (например, ошибка запроса).
Это позволяет внешнему коду обрабатывать такие ошибки отдельно.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Подробнее о работе удаления см. в защищённом методе <code class="prettyprint">_delete_user_internal()</code>.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__delete_user_internal"><abbr title="\PhotoRigma\Classes\User::_delete_user_internal()">User::_delete_user_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Защищённый метод, реализующий основную логику удаления
пользователя.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">bool</span>
                    &mdash;
                <section class="phpdocumentor-description"><p><code class="prettyprint">TRUE</code>, если удаление прошло успешно, <code class="prettyprint">FALSE</code> в случае ошибки:</p>
<ul>
<li>Пользователь не найден</li>
<li>Ограничение безопасности (самоудаление админа, последний админ)</li>
<li>Не удалось выполнить SQL-запрос</li>
</ul>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -public
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method_encode_user_rights">
        encode_user_rights()
        <a href="classes/PhotoRigma-Classes-User.html#method_encode_user_rights" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/User.php"><a href="files/src-classes-user.html"><abbr title="src/Classes/User.php">User.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">1874</span>

    </aside>

        <p class="phpdocumentor-summary">Преобразует массив прав пользователя в строку JSON через вызов внутреннего метода.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">public</span>
                    <span class="phpdocumentor-signature__name">encode_user_rights</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$rights</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">string</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот публичный метод является обёрткой для защищённого метода _encode_user_rights_internal().
Он проверяет корректность входных данных, преобразует массив прав в строку JSON и возвращает результат.
Предназначен для прямого использования извне.</p>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$rights</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Массив прав пользователя:</p>
<ul>
<li>Может быть ассоциативным массивом, пустым значением или <code class="prettyprint">null</code>.</li>
<li>Пример: ['edit' =&gt; true, 'delete' =&gt; false].
Ограничения: значение должно быть массивом.</li>
</ul>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-User.html#method_encode_user_rights#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\InvalidArgumentException">InvalidArgumentException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если входное значение не является массивом.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\JsonException">JsonException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если возникает ошибка при кодировании массива в JSON.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Метод возвращает пустую строку, если массив прав отсутствует или содержит некорректные данные.
Если кодирование JSON завершается успешно, возвращается строка JSON.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Входные данные должны быть корректным массивом. Некорректные данные могут привести к выбросу
исключения.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__encode_user_rights_internal"><abbr title="\PhotoRigma\Classes\User::_encode_user_rights_internal()">User::_encode_user_rights_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Защищённый метод, реализующий основную логику
преобразования массива прав в строку JSON.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">string</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Строка JSON, представляющая права пользователя. Если массив отсутствует или содержит некорректные
данные, возвращается пустая строка.</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -public
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method_hard_delete_user">
        hard_delete_user()
        <a href="classes/PhotoRigma-Classes-User.html#method_hard_delete_user" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/User.php"><a href="files/src-classes-user.html"><abbr title="src/Classes/User.php">User.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">2888</span>

    </aside>

        <p class="phpdocumentor-summary">Публичный метод для окончательного обезличивания личных данных пользователя.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">public</span>
                    <span class="phpdocumentor-signature__name">hard_delete_user</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">int&nbsp;</span><span class="phpdocumentor-signature__argument__name">$user_id</span></span><span class="phpdocumentor-signature__argument"><span>[</span><span>, </span><span class="phpdocumentor-signature__argument__return-type">bool&nbsp;</span><span class="phpdocumentor-signature__argument__name">$force</span><span> = </span><span class="phpdocumentor-signature__argument__default-value">false</span><span> ]</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">bool</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Предназначен для вызова из клиентского кода:</p>
<ul>
<li>Из фоновой задачи cron → с $force = FALSE</li>
<li>Из админки → с $force = TRUE
Передаёт управление защищённому методу <code class="prettyprint">_hard_delete_user_internal()</code>, который реализует основную логику.
Метод должен использоваться только после истечения срока восстановления мягкого удаления.</li>
</ul>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$user_id</span>
                : <span class="phpdocumentor-signature__argument__return-type">int</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>ID пользователя, которого нужно окончательно удалить.
Должен быть положительным целым числом (<code class="prettyprint">&gt; 0</code>).
Пример: 123.</p>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$force</span>
                : <span class="phpdocumentor-signature__argument__return-type">bool</span>
                 = <span class="phpdocumentor-signature__argument__default-value">false</span>            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>[optional] Режим принудительного удаления:</p>
<ul>
<li>FALSE (по умолчанию): удаление через cron, после истечения срока мягкого удаления.</li>
<li>TRUE: принудительное удаление из админки — требует:
<ul>
<li>наличия прав администратора</li>
<li>подтверждения в интерфейсе</li>
<li>запрет на самоудаление админа</li>
</ul>
</li>
</ul>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-User.html#method_hard_delete_user#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\Exception">Exception</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>При ошибках выполнения SQL-запросов.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Подробнее о работе удаления см. в защищённом методе <code class="prettyprint">_hard_delete_user_internal()</code>.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__hard_delete_user_internal"><abbr title="\PhotoRigma\Classes\User::_hard_delete_user_internal()">User::_hard_delete_user_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Защищённый метод, реализующий окончательное
обезличивание и удаление.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">bool</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>TRUE при успехе, FALSE при ошибке или невозможности удаления.</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -public
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method_is_soft_delete_expired">
        is_soft_delete_expired()
        <a href="classes/PhotoRigma-Classes-User.html#method_is_soft_delete_expired" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/User.php"><a href="files/src-classes-user.html"><abbr title="src/Classes/User.php">User.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">2724</span>

    </aside>

        <p class="phpdocumentor-summary">Проверяет, истёк ли срок восстановления мягкого удаления.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">public</span>
                    <span class="phpdocumentor-signature__name">is_soft_delete_expired</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">string|null&nbsp;</span><span class="phpdocumentor-signature__argument__name">$deleted_at</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">array&lt;string|int, mixed&gt;</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Метод является публичным редиректом для защищённого метода _is_soft_delete_expired_internal(). Он используется
как в веб-интерфейсе, так и фоновыми задачами.</p>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$deleted_at</span>
                : <span class="phpdocumentor-signature__argument__return-type">string|null</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Дата и время мягкого удаления (формат MySQL DATETIME).
Может быть NULL, если пользователь не удален.</p>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-User.html#method_is_soft_delete_expired#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\Exception">Exception</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>При ошибке парсинга даты или других внутренних ошибках.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Реализация находится в <code class="prettyprint">_is_soft_delete_expired_internal()</code>.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Не передавайте невалидные строки как <code class="prettyprint">$deleted_at</code>. Это приведёт к возврату пустых данных.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__is_soft_delete_expired_internal"><abbr title="\PhotoRigma\Classes\User::_is_soft_delete_expired_internal()">User::_is_soft_delete_expired_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Защищённый метод, реализующий основную логику.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">array&lt;string|int, mixed&gt;</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Ассоциативный массив с данными о сроке:</p>
<ul>
<li>'restore_date'   =&gt; ?DateTime Дата мягкого удаления</li>
<li>'restore_expiry' =&gt; ?DateTime Дата истечения срока восстановления</li>
<li>'expired'        =&gt; bool Указывает, истёк ли срок</li>
</ul>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -public
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method_login_user">
        login_user()
        <a href="classes/PhotoRigma-Classes-User.html#method_login_user" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/User.php"><a href="files/src-classes-user.html"><abbr title="src/Classes/User.php">User.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">1976</span>

    </aside>

        <p class="phpdocumentor-summary">Проверяет данные пользователя для входа в систему через вызов внутреннего метода.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">public</span>
                    <span class="phpdocumentor-signature__name">login_user</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$post</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$redirect_url</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">int</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот публичный метод является обёрткой для защищённого метода _login_user_internal().
Он проверяет корректность входных данных (логин и пароль), ищет пользователя в базе данных, проверяет пароль и
выполняет &quot;мягкое&quot; обновление паролей на новый формат хранения (<code class="prettyprint">password_hash()</code>). Поддерживает
восстановление аккаунтов, временно удалённых через мягкое удаление, если срок восстановления ещё не истёк.
Предназначен для прямого использования извне.</p>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$post</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Массив данных из формы ($_POST), содержащий ключи:</p>
<ul>
<li>string $login: Логин пользователя (должен соответствовать регулярному выражению
REG_LOGIN).</li>
<li>string $password: Пароль пользователя (не должен быть пустым).</li>
</ul>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$redirect_url</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>URL для перенаправления пользователя в случае возникновения ошибок.
Ограничения: должен быть валидным URL.</p>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-User.html#method_login_user#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\Exception">Exception</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если:</p>
<ul>
<li>Возникает ошибка при проверке входных данных через <code class="prettyprint">Work::check_input()</code>.</li>
<li>Возникает ошибка при логировании событий через <code class="prettyprint">log_in_file()</code>.</li>
</ul>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Поддерживается совместимость со старым форматом хранения паролей (md5). При обнаружении старого формата
пароль автоматически обновляется до формата <code class="prettyprint">password_hash()</code>.
Также поддерживается восстановление аккаунтов, временно удалённых через мягкое удаление,
если срок восстановления ещё не истёк.
Константы, используемые в методе:</p>
<ul>
<li><code class="prettyprint">REG_LOGIN</code>: Регулярное выражение для проверки логина.
Пример: <code class="prettyprint">/^[a-zA-Z0-9][a-zA-Z0-9_-]*[a-zA-Z0-9_]$/</code>.
<ul>
<li>Допустимые символы: латинские буквы, цифры, подчеркивание (_), дефис (-).</li>
<li>Первый символ должен быть буквой или цифрой.</li>
<li>Последний символ должен быть буквой, цифрой или подчеркиванием.</li>
<li>Максимальная длина: 32 символа.</li>
</ul>
</li>
<li><code class="prettyprint">TBL_USERS</code>: Имя таблицы пользователей в базе данных. Например: '<code class="prettyprint">users</code>'.
Эти константы позволяют гибко настраивать поведение метода.</li>
</ul>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Метод зависит от корректной конфигурации базы данных. Убедитесь, что таблица пользователей и поля
(<code class="prettyprint">id</code>, <code class="prettyprint">login</code>, <code class="prettyprint">password</code>, <code class="prettyprint">deleted_at</code>, <code class="prettyprint">permanently_deleted</code>) настроены правильно.
Невалидные данные могут привести к исключениям.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__login_user_internal"><abbr title="\PhotoRigma\Classes\User::_login_user_internal()">User::_login_user_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Защищённый метод, реализующий основную логику проверки
данных пользователя для входа.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">int</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>ID пользователя, если авторизация успешна, или <code class="prettyprint">0</code> в случае ошибки.</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -public
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method_process_user_rights">
        process_user_rights()
        <a href="classes/PhotoRigma-Classes-User.html#method_process_user_rights" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/User.php"><a href="files/src-classes-user.html"><abbr title="src/Classes/User.php">User.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">270</span>

    </aside>

        <p class="phpdocumentor-summary">Обрабатывает поле `user_rights`, преобразуя его из строки JSON в массив прав, через вызов внутреннего метода.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">public</span>
                    <span class="phpdocumentor-signature__name">process_user_rights</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$user_rights</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">array&lt;string|int, mixed&gt;</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот публичный метод является обёрткой для защищённого метода _process_user_rights_internal().
Он проверяет корректность входных данных, декодирует строку JSON в ассоциативный массив прав и возвращает
результат. Предназначен для прямого использования извне.</p>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$user_rights</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Значение поля <code class="prettyprint">user_rights</code>:</p>
<ul>
<li>Должно быть строкой, содержащей валидный JSON (например, '{&quot;edit&quot;: 1,
&quot;delete&quot;: 0}').</li>
<li>Если значение пустое или некорректное, возвращается пустой массив.</li>
</ul>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-User.html#method_process_user_rights#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\InvalidArgumentException">InvalidArgumentException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если поле <code class="prettyprint">user_rights</code> не является строкой.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\JsonException">JsonException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если поле <code class="prettyprint">user_rights</code> содержит невалидный JSON.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Метод возвращает пустой массив, если поле <code class="prettyprint">user_rights</code> отсутствует или содержит некорректные данные.
Если декодирование JSON завершается успешно, возвращается ассоциативный массив прав.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Поле <code class="prettyprint">user_rights</code> должно содержать валидный JSON. Невалидные данные могут привести к выбросу
исключения.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__process_user_rights_internal"><abbr title="\PhotoRigma\Classes\User::_process_user_rights_internal()">User::_process_user_rights_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Защищённый метод, реализующий основную логику
обработки поля <code class="prettyprint">user_rights</code>.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">array&lt;string|int, mixed&gt;</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Ассоциативный массив прав пользователя. Если поле <code class="prettyprint">user_rights</code> отсутствует или содержит
некорректные данные, возвращается пустой массив.</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -public
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method_set_property_key">
        set_property_key()
        <a href="classes/PhotoRigma-Classes-User.html#method_set_property_key" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/User.php"><a href="files/src-classes-user.html"><abbr title="src/Classes/User.php">User.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">646</span>

    </aside>

        <p class="phpdocumentor-summary">Устанавливает значение свойства в массивах `$user` или `$session` через вызов внутреннего метода.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">public</span>
                    <span class="phpdocumentor-signature__name">set_property_key</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$name</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$key</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">string|int|bool&nbsp;</span><span class="phpdocumentor-signature__argument__name">$value</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">void</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот публичный метод является обёрткой для защищённого метода _set_property_key_internal().
Он проверяет корректность входных данных, определяет целевой массив (<code class="prettyprint">$user</code> или <code class="prettyprint">$session</code>) и устанавливает
значение по указанному ключу. Предназначен для прямого использования извне.</p>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$name</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Имя свойства:</p>
<ul>
<li>Допустимые значения: 'user' (для массива данных пользователя) или 'session'
(для массива данных сессии).</li>
<li>Пример: &quot;user&quot;.
Ограничения: только допустимые значения ('user' или 'session').</li>
</ul>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$key</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Ключ, по которому будет установлено значение:</p>
<ul>
<li>Должен быть строкой.</li>
<li>Пример: &quot;username&quot;.</li>
</ul>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$value</span>
                : <span class="phpdocumentor-signature__argument__return-type">string|int|bool</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Значение, которое будет установлено:</p>
<ul>
<li>Может быть строкой, целым числом или булевым значением.</li>
<li>Пример: &quot;admin&quot; (строка), 123 (целое число), true (булево значение).</li>
</ul>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-User.html#method_set_property_key#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\InvalidArgumentException">InvalidArgumentException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если параметр <code class="prettyprint">$name</code> содержит недопустимое значение.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Метод изменяет внутренние массивы <code class="prettyprint">$user</code> или <code class="prettyprint">$session</code> напрямую.
Перед установкой значения проверяется корректность имени свойства.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Недопустимое значение параметра <code class="prettyprint">$name</code> приведет к выбросу исключения.
Убедитесь, что передаете только допустимые значения ('user' или 'session').</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__set_property_key_internal"><abbr title="\PhotoRigma\Classes\User::_set_property_key_internal()">User::_set_property_key_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Защищённый метод, реализующий основную логику
установки значения свойства.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">void</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Метод ничего не возвращает.</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -public
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method_set_work">
        set_work()
        <a href="classes/PhotoRigma-Classes-User.html#method_set_work" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/User.php"><a href="files/src-classes-user.html"><abbr title="src/Classes/User.php">User.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">724</span>

    </aside>

        <p class="phpdocumentor-summary">Устанавливает объект Work через вызов внутреннего метода.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">public</span>
                    <span class="phpdocumentor-signature__name">set_work</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type"><a href="classes/PhotoRigma-Interfaces-Work-Interface.html"><abbr title="\PhotoRigma\Interfaces\Work_Interface">Work_Interface</abbr></a>&nbsp;</span><span class="phpdocumentor-signature__argument__name">$work</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">void</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот публичный метод является обёрткой для защищённого метода _set_work_internal().
Он проверяет корректность переданного объекта и устанавливает его в свойство <code class="prettyprint">$work</code>. Если в сессии
отсутствует тема (<code class="prettyprint">theme</code>), она инициализируется значением из конфигурации объекта, реализующего интерфейс
<code class="prettyprint">Work_Interface</code>. Предназначен для прямого использования извне.</p>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$work</span>
                : <span class="phpdocumentor-signature__argument__return-type"><a href="classes/PhotoRigma-Interfaces-Work-Interface.html"><abbr title="\PhotoRigma\Interfaces\Work_Interface">Work_Interface</abbr></a></span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Объект, реализующий интерфейс <code class="prettyprint">Work_Interface</code>:</p>
<ul>
<li>Должен быть экземпляром класса, реализующего интерфейс <code class="prettyprint">Work_Interface</code>.</li>
</ul>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-User.html#method_set_work#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Метод проверяет тип переданного объекта.
Объект, реализующий интерфейс <code class="prettyprint">Work_Interface</code>, используется для дальнейшего взаимодействия в текущем
классе.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Некорректный объект (не реализует интерфейс <code class="prettyprint">Work_Interface</code>) вызывает исключение.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__set_work_internal"><abbr title="\PhotoRigma\Classes\User::_set_work_internal()">User::_set_work_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Защищённый метод, реализующий основную логику установки
объекта Work.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">void</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Метод ничего не возвращает.</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -public
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method_unset_property_key">
        unset_property_key()
        <a href="classes/PhotoRigma-Classes-User.html#method_unset_property_key" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/User.php"><a href="files/src-classes-user.html"><abbr title="src/Classes/User.php">User.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">1311</span>

    </aside>

        <p class="phpdocumentor-summary">Удаляет ключ из указанного свойства объекта (user или session) через вызов внутреннего метода.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">public</span>
                    <span class="phpdocumentor-signature__name">unset_property_key</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$name</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$key</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">void</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот публичный метод является обёрткой для защищённого метода _unset_property_key_internal().
Он проверяет корректность входных данных, определяет целевой массив (<code class="prettyprint">$this-&gt;user</code> или <code class="prettyprint">$this-&gt;session</code>) и
удаляет указанный ключ, если он существует. Предназначен для прямого использования извне.</p>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$name</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Имя свойства, из которого удаляется ключ:</p>
<ul>
<li>Допустимые значения: 'user' (для массива данных пользователя) или 'session' (для массива
данных сессии).</li>
<li>Пример: &quot;user&quot;.
Ограничения: только допустимые значения ('user' или 'session').</li>
</ul>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$key</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Ключ, который нужно удалить:</p>
<ul>
<li>Должен быть строкой.</li>
<li>Пример: &quot;email&quot;.
Ограничения: если ключ отсутствует в массиве, метод завершается без ошибок.</li>
</ul>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-User.html#method_unset_property_key#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\InvalidArgumentException">InvalidArgumentException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если указано недопустимое значение для параметра <code class="prettyprint">$name</code>.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Метод изменяет только свойства 'user' и 'session'.
Если ключ отсутствует в массиве, метод завершается без ошибок.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Не используйте этот метод для удаления ключей из других свойств.
Передавайте только допустимые значения для параметра <code class="prettyprint">$name</code>.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__unset_property_key_internal"><abbr title="\PhotoRigma\Classes\User::_unset_property_key_internal()">User::_unset_property_key_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Защищённый метод, реализующий основную логику
удаления ключа из указанного свойства.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">void</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Метод ничего не возвращает.</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -public
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method_update_group_data">
        update_group_data()
        <a href="classes/PhotoRigma-Classes-User.html#method_update_group_data" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/User.php"><a href="files/src-classes-user.html"><abbr title="src/Classes/User.php">User.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">1715</span>

    </aside>

        <p class="phpdocumentor-summary">Обновляет данные группы в системе через вызов внутреннего метода.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">public</span>
                    <span class="phpdocumentor-signature__name">update_group_data</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$group_data</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$post_data</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">array&lt;string|int, mixed&gt;</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот публичный метод является обёрткой для защищённого метода _update_group_data_internal().
Он проверяет и обновляет название группы, если оно изменилось, обновляет права доступа группы и возвращает
обновленные данные. Предназначен для прямого использования извне (например, через Админку).</p>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$group_data</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Данные группы:</p>
<ul>
<li><code class="prettyprint">name</code>: Текущее название группы.</li>
<li><code class="prettyprint">user_rights</code>: JSON-строка с текущими правами группы.
Может также содержать поля, перечисленные в свойстве класса <code class="prettyprint">user_right_fields</code>.</li>
</ul>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$post_data</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Данные, полученные из POST-запроса:</p>
<ul>
<li><code class="prettyprint">id_group</code>: ID группы.
Может также содержать ключ:</li>
<li><code class="prettyprint">name_group</code>: Новое название группы.
И поля, перечисленные в свойстве класса <code class="prettyprint">user_right_fields</code>.</li>
</ul>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-User.html#method_update_group_data#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\RuntimeException">RuntimeException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если произошла ошибка при обновлении данных в БД.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\JsonException">JsonException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если возникает ошибка при кодировании или декодировании JSON.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\Exception">Exception</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если возникает ошибка при проверке входных данных.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Метод использует следующие константы:</p>
<ul>
<li><code class="prettyprint">TBL_GROUP</code>: Имя таблицы групп в базе данных. Например: '<code class="prettyprint">groups</code>'.</li>
<li><code class="prettyprint">REG_NAME</code>: Регулярное выражение для проверки названия группы.
Пример: <code class="prettyprint">/^[^\x00-\x1F\x7F&lt;&gt;&amp;&quot;'\\\/</code>=]{1,100}$/`.
Эти константы позволяют гибко настраивать поведение метода.</li>
</ul>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Убедитесь, что входные данные корректны. Невалидные данные могут привести к исключениям.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__update_group_data_internal"><abbr title="\PhotoRigma\Classes\User::_update_group_data_internal()">User::_update_group_data_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Защищённый метод, реализующий основную логику
обновления данных группы.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">array&lt;string|int, mixed&gt;</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Возвращает массив данных группы:</p>
<ul>
<li><code class="prettyprint">name</code>: Название группы.</li>
<li>Все поля, указанные в свойстве класса <code class="prettyprint">user_right_fields</code>.</li>
</ul>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -public
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method_update_user_data">
        update_user_data()
        <a href="classes/PhotoRigma-Classes-User.html#method_update_user_data" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/User.php"><a href="files/src-classes-user.html"><abbr title="src/Classes/User.php">User.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">2212</span>

    </aside>

        <p class="phpdocumentor-summary">Обновляет данные существующего пользователя через вызов внутреннего метода.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">public</span>
                    <span class="phpdocumentor-signature__name">update_user_data</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">int&nbsp;</span><span class="phpdocumentor-signature__argument__name">$user_id</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$post_data</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$files_data</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">int&nbsp;</span><span class="phpdocumentor-signature__argument__name">$max_size</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">int</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот публичный метод является обёрткой для защищённого метода _update_user_data_internal().
Он проверяет существование пользователя, валидирует и обновляет пароль, email, имя, аватар, язык и тему, а
также удаляет старый аватар при необходимости. Предназначен для прямого использования извне.</p>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$user_id</span>
                : <span class="phpdocumentor-signature__argument__return-type">int</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Идентификатор пользователя, данные которого необходимо обновить:</p>
<ul>
<li>Должен быть положительным целым числом и существовать в базе данных.</li>
<li>Пример: 1.
Ограничения: ID должен быть больше 0.</li>
</ul>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$post_data</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Массив данных из формы ($_POST), содержащий новые значения для полей пользователя:</p>
<ul>
<li>string $password: Текущий пароль пользователя (обязательно для изменения пароля).</li>
<li>string $edit_password: Новый пароль пользователя (необязательно).</li>
<li>string $re_password: Повторный ввод нового пароля (должен совпадать с
<code class="prettyprint">edit_password</code>).</li>
<li>string $email: Новый email пользователя (должен соответствовать регулярному выражению
REG_EMAIL).</li>
<li>string $real_name: Новое имя пользователя (должно быть строкой).
Все поля проходят валидацию перед использованием.</li>
</ul>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$files_data</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Массив данных загруженного файла ($_FILES), содержащий информацию об аватаре:</p>
<ul>
<li>'file_avatar' (array): Информация о загруженном файле (необязательно).
Если файл не передан или не проходит валидацию, аватар остается без изменений.</li>
</ul>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$max_size</span>
                : <span class="phpdocumentor-signature__argument__return-type">int</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Максимальный размер файла для аватара в байтах:</p>
<ul>
<li>Определяется на основе конфигурации приложения и ограничений PHP (например,
post_max_size).</li>
<li>Пример: 5 * 1024 * 1024 (5 MB).
Ограничения: значение должно быть положительным целым числом.</li>
</ul>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-User.html#method_update_user_data#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\RuntimeException">RuntimeException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если пользователь с указанным <code class="prettyprint">$user_id</code> не найден в базе данных.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\Exception">Exception</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если возникает ошибка при проверке входных данных через
<code class="prettyprint">Work::check_input()</code> или при обработке аватара через <code class="prettyprint">_edit_avatar()</code>.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Для обработки аватаров используется метод <code class="prettyprint">_edit_avatar()</code>. Старый аватар удаляется, если новый успешно
загружен и отличается от старого. Константы, используемые в методе:</p>
<ul>
<li><code class="prettyprint">DEFAULT_AVATAR</code>: Имя аватара по умолчанию. Например: <code class="prettyprint">'no_avatar.jpg'</code>.</li>
<li><code class="prettyprint">TBL_USERS</code>: Имя таблицы пользователей в базе данных. Например: '<code class="prettyprint">users</code>'.</li>
<li><code class="prettyprint">REG_EMAIL</code>: Регулярное выражение для проверки email.
Пример: <code class="prettyprint">/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/</code>.
Эти константы позволяют гибко настраивать поведение метода.</li>
</ul>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Не используйте этот метод для массового обновления данных. Он предназначен только для работы с одним
пользователем за раз.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__update_user_data_internal"><abbr title="\PhotoRigma\Classes\User::_update_user_data_internal()">User::_update_user_data_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Защищённый метод, реализующий основную логику
обновления данных пользователя.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">int</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Количество затронутых строк в базе данных после выполнения обновления.
Возвращается <code class="prettyprint">0</code>, если данные не изменились или запрос завершился ошибкой.</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -public
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method_update_user_rights">
        update_user_rights()
        <a href="classes/PhotoRigma-Classes-User.html#method_update_user_rights" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/User.php"><a href="files/src-classes-user.html"><abbr title="src/Classes/User.php">User.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">2541</span>

    </aside>

        <p class="phpdocumentor-summary">Обновляет права пользователя или группу через вызов внутреннего метода.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">public</span>
                    <span class="phpdocumentor-signature__name">update_user_rights</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">int&nbsp;</span><span class="phpdocumentor-signature__argument__name">$user_id</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$user_data</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$post_data</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">array&lt;string|int, mixed&gt;</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот публичный метод является обёрткой для защищённого метода _update_user_rights_internal().
Он проверяет, изменилась ли группа пользователя, обновляет её и связанные права доступа, а также возвращает
обновленные данные пользователя. Предназначен для прямого использования извне (например, через Админку).</p>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$user_id</span>
                : <span class="phpdocumentor-signature__argument__return-type">int</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Идентификатор пользователя:</p>
<ul>
<li>Должен быть положительным целым числом.</li>
<li>Пример: 123.
Ограничения: ID должен быть больше 0.</li>
</ul>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$user_data</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Данные пользователя:</p>
<ul>
<li>Должен содержать ключ <code class="prettyprint">group_id</code> (ID текущей группы пользователя).</li>
<li>Также должен содержать все поля, указанные в свойстве класса <code class="prettyprint">user_right_fields</code>.
Пример: ['group_id' =&gt; 2, 'edit' =&gt; true, 'delete' =&gt; false].</li>
</ul>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$post_data</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Данные, полученные из POST-запроса:</p>
<ul>
<li>Должен содержать ключ <code class="prettyprint">group</code> (ID новой группы пользователя).</li>
<li>Также должен содержать все поля, указанные в свойстве класса <code class="prettyprint">user_right_fields</code>.
Пример: ['group' =&gt; 3, 'edit' =&gt; 'on', 'delete' =&gt; false].</li>
</ul>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-User.html#method_update_user_rights#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\RuntimeException">RuntimeException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если:</p>
<ul>
<li>Не удалось получить данные группы из БД.</li>
<li>Произошла ошибка при обновлении данных пользователя в БД.</li>
</ul>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\JsonException">JsonException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если возникает ошибка при кодировании или декодировании JSON.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\Exception">Exception</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если возникает ошибка при проверке входных данных через
<code class="prettyprint">Work::check_input()</code>.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Метод использует свойство класса <code class="prettyprint">user_right_fields</code> для определения допустимых полей прав
пользователя.
Обновление прав доступа происходит с нормализацией значений (true/false) и их последующим кодированием
в JSON-строку.
Константы, используемые в методе:</p>
<ul>
<li><code class="prettyprint">TBL_USERS</code>: Имя таблицы пользователей в базе данных. Например: '<code class="prettyprint">users</code>'.</li>
<li><code class="prettyprint">TBL_GROUP</code>: Имя таблицы групп в базе данных. Например: '<code class="prettyprint">groups</code>'.
Эти константы позволяют гибко настраивать поведение метода.</li>
</ul>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Убедитесь, что входные данные корректны. Невалидные данные могут привести к исключениям.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__update_user_rights_internal"><abbr title="\PhotoRigma\Classes\User::_update_user_rights_internal()">User::_update_user_rights_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Защищённый метод, реализующий основную логику
обновления прав пользователя или группы.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">array&lt;string|int, mixed&gt;</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Возвращает массив данных пользователя:</p>
<ul>
<li><code class="prettyprint">group_id</code>: ID группы пользователя.</li>
<li>Все поля, указанные в свойстве класса <code class="prettyprint">user_right_fields</code>.</li>
</ul>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -protected
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method__add_new_group_internal">
        _add_new_group_internal()
        <a href="classes/PhotoRigma-Classes-User.html#method__add_new_group_internal" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/User.php"><a href="files/src-classes-user.html"><abbr title="src/Classes/User.php">User.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">1002</span>

    </aside>

        <p class="phpdocumentor-summary">Добавляет новую группу в систему через Админку.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">protected</span>
                    <span class="phpdocumentor-signature__name">_add_new_group_internal</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$group_data</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">int</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Метод:</p>
<ol>
<li>Принимает данные новой группы из <code class="prettyprint">$group_data</code>:
<ul>
<li>name_group — имя группы (валидация через REG_NAME)</li>
<li>права доступа — булевы значения, фильтруются через FILTER_VALIDATE_BOOLEAN</li>
</ul>
</li>
<li>Очищает и проверяет имя группы:
<ul>
<li>Проверка на наличие</li>
<li>Проверка на пустое значение</li>
<li>Валидация через регулярное выражение REG_NAME</li>
</ul>
</li>
<li>Преобразует все поля прав доступа к булевому типу</li>
<li>Кодирует права в JSON-строку через _encode_user_rights_internal()</li>
<li>Выполняет вставку новой записи в TBL_GROUP</li>
<li>Возвращает ID вставленной группы
Метод является защищённым и предназначен для вызова внутри класса или его наследников. Основная логика
вызывается через публичный метод add_new_group().</li>
</ol>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$group_data</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Данные новой группы:</p>
<ul>
<li><code class="prettyprint">name_group</code>: Имя группы (должно быть передано).</li>
<li>Все ключи из <code class="prettyprint">$this-&gt;user_right_fields['all']</code>.
Пример: ['name_group' =&gt; 'Moderators', 'read' =&gt; true, 'write' =&gt; false]</li>
</ul>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-User.html#method__add_new_group_internal#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">protected</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                             
                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\RuntimeException">RuntimeException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если имя группы не прошло валидацию.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\JsonException">JsonException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если не удалось кодировать права в JSON.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\Exception">Exception</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается при ошибках SQL-запроса.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Для работы метода необходимо:</p>
<ul>
<li>Поле <code class="prettyprint">name_group</code> должно быть задано и пройти валидацию</li>
<li>Все поля прав должны быть определены в массиве <code class="prettyprint">$this-&gt;user_right_fields</code></li>
<li>Реализация зависит от констант: TBL_GROUP, REG_NAME
Права доступа кодируются в JSON-строку для хранения в базе данных
с последующим декодированием при работе с группами.</li>
</ul>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Убедитесь, что входные данные корректны. Невалидные данные могут привести к исключениям.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__encode_user_rights_internal"><abbr title="\PhotoRigma\Classes\User::_encode_user_rights_internal()">User::_encode_user_rights_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Для преобразования прав в JSON-строку.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method_add_new_group"><abbr title="\PhotoRigma\Classes\User::add_new_group()">User::add_new_group()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Защищённый метод, реализующий добавление группы и
валидацию данных.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">int</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Возвращает ID новой группы при успешном добавлении.</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -protected
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method__add_new_user_internal">
        _add_new_user_internal()
        <a href="classes/PhotoRigma-Classes-User.html#method__add_new_user_internal" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/User.php"><a href="files/src-classes-user.html"><abbr title="src/Classes/User.php">User.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">1152</span>

    </aside>

        <p class="phpdocumentor-summary">Добавляет нового пользователя в базу данных, выполняя валидацию входных данных.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">protected</span>
                    <span class="phpdocumentor-signature__name">_add_new_user_internal</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$post_data</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">int</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот метод выполняет следующие шаги:</p>
<ol>
<li>Проверяет корректность входных данных с использованием <code class="prettyprint">Work::check_input()</code>:
<ul>
<li>Логин проверяется на соответствие регулярному выражению <code class="prettyprint">REG_LOGIN</code>.</li>
<li>Пароль проверяется на пустоту и совпадение с повторным паролем.</li>
<li>Email проверяется на соответствие регулярному выражению <code class="prettyprint">REG_EMAIL</code>.</li>
<li>Реальное имя проверяется на соответствие регулярному выражению <code class="prettyprint">REG_NAME</code>.</li>
<li>CAPTCHA проверяется на числовое значение и совпадение с хешем из сессии.
Если данные некорректны, ошибки сохраняются в сессии.</li>
</ul>
</li>
<li>Проверяет уникальность логина, email и реального имени в таблице <code class="prettyprint">TBL_USERS</code>:
<ul>
<li>Если одно из значений уже существует, ошибка сохраняется в сессии.</li>
</ul>
</li>
<li>Если возникли ошибки, метод завершает выполнение и возвращает <code class="prettyprint">0</code>.</li>
<li>При успешной валидации добавляет нового пользователя в таблицу <code class="prettyprint">TBL_USERS</code>, назначая ему группу по
умолчанию (<code class="prettyprint">DEFAULT_GROUP</code>).
<ul>
<li>Пароль хэшируется с использованием <code class="prettyprint">password_hash()</code>.</li>
<li>Данные группы по умолчанию загружаются из таблицы <code class="prettyprint">TBL_GROUP</code>.</li>
</ul>
</li>
<li>Возвращает ID нового пользователя или <code class="prettyprint">0</code> в случае ошибки.
Этот метод является защищенным и предназначен для использования внутри класса или его наследников. Основная
логика вызывается через публичный метод-редирект <code class="prettyprint">add_new_user()</code>.</li>
</ol>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$post_data</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Массив данных из формы ($_POST), содержащий новые значения для полей пользователя:</p>
<ul>
<li>string $login: Логин пользователя (должен соответствовать регулярному выражению
REG_LOGIN).</li>
<li>string $password: Пароль пользователя (не должен быть пустым).</li>
<li>string $re_password: Повтор пароля (должен совпадать с $password).</li>
<li>string $email: Email пользователя (должен соответствовать регулярному выражению
REG_EMAIL).</li>
<li>string $real_name: Реальное имя пользователя (должно соответствовать регулярному
выражению REG_NAME).</li>
<li>string $captcha: Значение CAPTCHA (должно быть числом).
Все поля обязательны для заполнения.</li>
</ul>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-User.html#method__add_new_user_internal#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">protected</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                             
                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\RuntimeException">RuntimeException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если группа по умолчанию не найдена в базе данных.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\PDOException">PDOException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если возникает ошибка при работе с базой данных.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\Exception">Exception</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если возникает ошибка при проверке входных данных через
<code class="prettyprint">Work::check_input()</code>.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Используется CAPTCHA для защиты от автоматической регистрации.
Константы, используемые в методе:</p>
<ul>
<li><code class="prettyprint">REG_LOGIN</code>: Регулярное выражение для проверки логина.
Пример: <code class="prettyprint">/^[a-zA-Z0-9][a-zA-Z0-9_-]*[a-zA-Z0-9_]$/</code>.</li>
<li><code class="prettyprint">REG_EMAIL</code>: Регулярное выражение для проверки email.
Пример: <code class="prettyprint">/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/</code>.</li>
<li><code class="prettyprint">REG_NAME</code>: Регулярное выражение для проверки реального имени.
Пример: <code class="prettyprint">/^[^\x00-\x1F\x7F&lt;&gt;&amp;&quot;'\\\/</code>=]{1,100}$/`.</li>
<li><code class="prettyprint">DEFAULT_GROUP</code>: Идентификатор группы по умолчанию. Например: <code class="prettyprint">1</code>.</li>
<li><code class="prettyprint">TBL_USERS</code>: Таблица пользователей в базе данных. Например: '<code class="prettyprint">users</code>'.</li>
<li><code class="prettyprint">TBL_GROUP</code>: Таблица групп в базе данных. Например: '<code class="prettyprint">groups</code>'.
Эти константы позволяют гибко настраивать поведение метода.</li>
</ul>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Метод зависит от корректной конфигурации базы данных и таблицы групп. Убедитесь, что все необходимые
константы и таблицы настроены правильно. Невалидные данные могут привести к ошибкам.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Work.html#method_check_input"><abbr title="\PhotoRigma\Classes\Work::check_input()">Work::check_input()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Метод для проверки правильности входных данных.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="namespaces/photorigma-include.html#function_log_in_file"><abbr title="\PhotoRigma\Include\log_in_file()">log_in_file()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Записывает сообщение об ошибке в лог-файл.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#property_session"><abbr title="\PhotoRigma\Classes\User::$session">User::$session</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство класса User, связанное с $_SESSION.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#property_db"><abbr title="\PhotoRigma\Classes\User::$db">User::$db</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Объект для работы с базой данных.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method_add_new_user"><abbr title="\PhotoRigma\Classes\User::add_new_user()">User::add_new_user()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Защищённый метод, реализующий основную логику
добавления нового пользователя.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">int</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>ID нового пользователя, если регистрация успешна, или <code class="prettyprint">0</code> в случае ошибки.</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -protected
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method__cron_user_delete_internal">
        _cron_user_delete_internal()
        <a href="classes/PhotoRigma-Classes-User.html#method__cron_user_delete_internal" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/User.php"><a href="files/src-classes-user.html"><abbr title="src/Classes/User.php">User.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">3229</span>

    </aside>

        <p class="phpdocumentor-summary">Фоновая задача: выполняет окончательное обезличивание пользователей, у которых истёк срок восстановления.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">protected</span>
                    <span class="phpdocumentor-signature__name">_cron_user_delete_internal</span><span>(</span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">void</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Алгоритм:</p>
<ol>
<li>Выбираем всех пользователей, где:
<ul>
<li>deleted_at ≠ NULL</li>
<li>permanently_deleted = 0</li>
</ul>
</li>
<li>Для каждого пользователя:
<ul>
<li>Проверяем, истёк ли срок мягкого удаления через _is_soft_delete_expired_internal()</li>
<li>Если истёк → вызываем _hard_delete_user_internal()
Все действия логируются через log_in_file()
Этот метод является защищённым и предназначен только для вызова из публичного метода <code class="prettyprint">cron_user_delete()</code>.
Работает строго по PHP-логике, а не SQL, чтобы обеспечить совместимость со всеми СУБД. Должен вызываться
только через cron.php.</li>
</ul>
</li>
</ol>
</section>

    
    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-User.html#method__cron_user_delete_internal#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">protected</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                             
                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\Exception">Exception</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Может выбрасываться:</p>
<ul>
<li>При логировании ошибок.</li>
<li>При выполнении запросов к базе данных.</li>
</ul>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Метод не выбрасывает исключений, но может завершиться досрочно при критических ошибках БД.
Логика реализована на стороне PHP, чтобы сохранить совместимость с разными СУБД.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Этот метод должен запускаться только фоновой задачей (cron).
Он не должен быть доступен из внешнего интерфейса.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__is_soft_delete_expired_internal"><abbr title="\PhotoRigma\Classes\User::_is_soft_delete_expired_internal()">User::_is_soft_delete_expired_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Для проверки истечения срока мягкого удаления.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__hard_delete_user_internal"><abbr title="\PhotoRigma\Classes\User::_hard_delete_user_internal()">User::_hard_delete_user_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Для окончательного обезличивания аккаунта.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method_cron_user_delete"><abbr title="\PhotoRigma\Classes\User::cron_user_delete()">User::cron_user_delete()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Защищённый метод, реализующий фоновую логику
окончательного удаления.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">void</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Метод не возвращает значения.</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -protected
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method__csrf_token_internal">
        _csrf_token_internal()
        <a href="classes/PhotoRigma-Classes-User.html#method__csrf_token_internal" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/User.php"><a href="files/src-classes-user.html"><abbr title="src/Classes/User.php">User.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">1417</span>

    </aside>

        <p class="phpdocumentor-summary">Генерирует или возвращает CSRF-токен для защиты от межсайтовой подделки запросов.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">protected</span>
                    <span class="phpdocumentor-signature__name">_csrf_token_internal</span><span>(</span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">string</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот метод выполняет следующие шаги:</p>
<ol>
<li>Проверяет, существует ли CSRF-токен в сессии (<code class="prettyprint">$session['csrf_token']</code>).</li>
<li>Если токен отсутствует, генерирует новый токен длиной 64 символа с использованием <code class="prettyprint">random_bytes(32)</code>.</li>
<li>Сохраняет сгенерированный токен в сессии.</li>
<li>Возвращает текущий CSRF-токен (либо существующий, либо вновь сгенерированный).
Этот метод является защищенным и предназначен для использования внутри класса или его наследников. Основная
логика вызывается через публичный метод-редирект <code class="prettyprint">csrf_token()</code>.</li>
</ol>
</section>

    
    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-User.html#method__csrf_token_internal#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">protected</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                             
                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\Random\RandomException">RandomException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если возникает ошибка при генерации случайных байтов.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Токен хранится в сессии и используется для защиты форм от CSRF-атак.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Не используйте этот метод для генерации токенов, если сессия недоступна или не инициализирована.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#property_session"><abbr title="\PhotoRigma\Classes\User::$session">User::$session</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство класса User, содержащее данные сессии.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method_csrf_token"><abbr title="\PhotoRigma\Classes\User::csrf_token()">User::csrf_token()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Защищённый метод, реализующий основную логику генерации
или получения CSRF-токена.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">string</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>CSRF-токен длиной 64 символа (генерируется с использованием <code class="prettyprint">random_bytes(32)</code>).</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -protected
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method__delete_group_internal">
        _delete_group_internal()
        <a href="classes/PhotoRigma-Classes-User.html#method__delete_group_internal" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/User.php"><a href="files/src-classes-user.html"><abbr title="src/Classes/User.php">User.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">1490</span>

    </aside>

        <p class="phpdocumentor-summary">Удаляет группу из базы данных.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">protected</span>
                    <span class="phpdocumentor-signature__name">_delete_group_internal</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">int&nbsp;</span><span class="phpdocumentor-signature__argument__name">$group_id</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">bool</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Метод:</p>
<ol>
<li>Проверяет, не находится ли $group_id в PROTECTED_GROUPS → если да → возвращает FALSE.</li>
<li>Переводит всех пользователей этой группы на DEFAULT_GROUP.</li>
<li>Удаляет запись группы из TBL_GROUP.</li>
<li>Возвращает TRUE, если были затронуты строки (то есть группа удалена), иначе FALSE.
Метод является защищённым и предназначен для вызова внутри класса или его наследников. Основная логика
вызывается через публичный метод delete_group().</li>
</ol>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$group_id</span>
                : <span class="phpdocumentor-signature__argument__return-type">int</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>ID группы, которую нужно удалить.
Должен быть положительным целым числом (<code class="prettyprint">&gt; 0</code>).
Пример: 123.</p>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-User.html#method__delete_group_internal#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">protected</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                             
                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\Exception">Exception</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>При ошибках выполнения SQL-запросов или записи в log_in_file()</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Реализация использует следующие константы:</p>
<ul>
<li><code class="prettyprint">TBL_USERS</code>: Таблица пользователей</li>
<li><code class="prettyprint">TBL_GROUP</code>: Таблица групп</li>
<li><code class="prettyprint">PROTECTED_GROUPS</code>: Массив защищённых ID групп</li>
<li><code class="prettyprint">DEFAULT_GROUP</code>: ID группы по умолчанию</li>
</ul>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Убедитесь, что таблицы базы данных содержат корректные данные.
Удаление может повлиять на большое количество пользователей.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method_delete_group"><abbr title="\PhotoRigma\Classes\User::delete_group()">User::delete_group()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Защищённый метод, реализующий основную логику
удаления группы.</p>
</section>

                                    </dd>
                                            </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">bool</span>
                    &mdash;
                <section class="phpdocumentor-description"><p><code class="prettyprint">TRUE</code>, если группа успешно удалена (затронуты строки).
<code class="prettyprint">FALSE</code>, если:</p>
<ul>
<li>Группа защищена от удаления</li>
<li>Ни одна строка не была изменена при обновлении/удалении</li>
</ul>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -protected
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method__delete_user_internal">
        _delete_user_internal()
        <a href="classes/PhotoRigma-Classes-User.html#method__delete_user_internal" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/User.php"><a href="files/src-classes-user.html"><abbr title="src/Classes/User.php">User.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">1615</span>

    </aside>

        <p class="phpdocumentor-summary">Выполняет мягкое или окончательное удаление пользователя с предварительными проверками.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">protected</span>
                    <span class="phpdocumentor-signature__name">_delete_user_internal</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">int&nbsp;</span><span class="phpdocumentor-signature__argument__name">$user_id</span></span><span class="phpdocumentor-signature__argument"><span>[</span><span>, </span><span class="phpdocumentor-signature__argument__return-type">bool&nbsp;</span><span class="phpdocumentor-signature__argument__name">$permanent</span><span> = </span><span class="phpdocumentor-signature__argument__default-value">false</span><span> ]</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">bool</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Метод реализует следующую логику:</p>
<ol>
<li>Получает данные пользователя по <code class="prettyprint">$user_id</code>.
<ul>
<li>Если пользователь не найден — возвращает <code class="prettyprint">FALSE</code>.</li>
</ul>
</li>
<li>Проверяет, не пытается ли пользователь удалить сам себя:
<ul>
<li>Если это администратор — запрещено даже мягкое удаление → возвращает <code class="prettyprint">FALSE</code>.</li>
</ul>
</li>
<li>При попытке окончательного удаления (<code class="prettyprint">$permanent = TRUE</code>):
a) Инициатором считается текущий пользователь
b) Проверяется, что инициатор — администратор (<code class="prettyprint">$this-&gt;user['admin']</code>)
c) Сессия админа должна быть подтверждена (<code class="prettyprint">$this-&gt;session['admin_on']</code>)
d) Самоудаление админом запрещено
e) Если удаляется администратор, дополнительно проверяется наличие других активных админов
<ul>
<li>Если он последний — запрещено → возвращаем <code class="prettyprint">FALSE</code></li>
</ul>
</li>
<li>В зависимости от флага <code class="prettyprint">$permanent</code>, вызывает:
<ul>
<li><code class="prettyprint">_soft_delete($user_id)</code> — для пометки аккаунта как удалённого</li>
<li><code class="prettyprint">_hard_delete_user_internal($user_id, true)</code> — для окончательного удаления
Все действия логируются через функцию <code class="prettyprint">log_in_file()</code>.
Этот метод является защищённым и предназначен для использования внутри класса или его наследников. Он служит
центральной точкой входа для всех типов удаления.</li>
</ul>
</li>
</ol>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$user_id</span>
                : <span class="phpdocumentor-signature__argument__return-type">int</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>ID пользователя, которого нужно удалить.
Должен быть положительным целым числом (<code class="prettyprint">&gt; 0</code>).
Пример: 123.</p>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$permanent</span>
                : <span class="phpdocumentor-signature__argument__return-type">bool</span>
                 = <span class="phpdocumentor-signature__argument__default-value">false</span>            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>[optional] Указывает, какое удаление выполнить:</p>
<ul>
<li><code class="prettyprint">FALSE</code> (по умолчанию): мягкое удаление (помечаем <code class="prettyprint">deleted_at</code>)</li>
<li><code class="prettyprint">TRUE</code>: окончательное удаление (через метод _hard_delete_user_internal())</li>
</ul>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-User.html#method__delete_user_internal#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">protected</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                             
                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\Exception">Exception</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если произошла ошибка на уровне СУБД (например, ошибка запроса).
Это позволяет внешнему коду обрабатывать такие ошибки отдельно.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Для работы метода необходимо:</p>
<ul>
<li>Поле <code class="prettyprint">group_id</code> должно содержать корректную группу пользователя</li>
<li>Константа GROUP_ADMIN должна быть определена</li>
<li>При окончательном удалении должна быть установлена сессия админа (<code class="prettyprint">$this-&gt;session['admin_on']</code>)
Мягкое удаление доступно всем, кроме администраторов (или их попытки самоудаления)
Окончательное удаление доступно только админам, и только если они не являются последним активным админом</li>
</ul>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Метод не выбрасывает исключений при бизнес-ошибках (например, &quot;недостаточно прав&quot;).
Вместо этого он возвращает <code class="prettyprint">FALSE</code> и пишет событие в лог.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__soft_delete"><abbr title="\PhotoRigma\Classes\User::_soft_delete()">User::_soft_delete()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Метод для выполнения мягкого удаления.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__hard_delete_user_internal"><abbr title="\PhotoRigma\Classes\User::_hard_delete_user_internal()">User::_hard_delete_user_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Метод для выполнения окончательного удаления.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="namespaces/photorigma-include.html#function_log_in_file"><abbr title="\PhotoRigma\Include\log_in_file()">log_in_file()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Записывает сообщение об ошибке в лог-файл.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method_delete_user"><abbr title="\PhotoRigma\Classes\User::delete_user()">User::delete_user()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Защищённый метод, реализующий основную логику удаления
пользователя.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">bool</span>
                    &mdash;
                <section class="phpdocumentor-description"><p><code class="prettyprint">TRUE</code>, если удаление прошло успешно, <code class="prettyprint">FALSE</code> в случае ошибки:</p>
<ul>
<li>Пользователь не найден</li>
<li>Нарушены ограничения безопасности (самоудаление админа, последний админ)</li>
<li>Не удалось выполнить SQL-запрос</li>
</ul>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -protected
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method__encode_user_rights_internal">
        _encode_user_rights_internal()
        <a href="classes/PhotoRigma-Classes-User.html#method__encode_user_rights_internal" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/User.php"><a href="files/src-classes-user.html"><abbr title="src/Classes/User.php">User.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">1911</span>

    </aside>

        <p class="phpdocumentor-summary">Метод преобразует массив прав пользователя в строку JSON.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">protected</span>
                    <span class="phpdocumentor-signature__name">_encode_user_rights_internal</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$rights</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">string</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот метод выполняет следующие шаги:</p>
<ol>
<li>Проверяет, существует ли входной массив. Если массив отсутствует или пуст, возвращается пустая строка.</li>
<li>Проверяет, что входное значение является массивом. Если тип данных некорректен, выбрасывается исключение.</li>
<li>Кодирует массив в строку JSON с использованием <code class="prettyprint">json_encode()</code> и флагов:
<ul>
<li><code class="prettyprint">JSON_THROW_ON_ERROR</code>: Генерирует исключение при ошибках кодирования.</li>
<li><code class="prettyprint">JSON_UNESCAPED_UNICODE</code>: Сохраняет Unicode-символы без экранирования.</li>
<li><code class="prettyprint">JSON_UNESCAPED_SLASHES</code>: Не экранирует слеши (<code class="prettyprint">/</code>).</li>
</ul>
</li>
<li>Возвращает строку JSON, готовую для сохранения в поле <code class="prettyprint">user_rights</code>.
Этот метод является защищенным и предназначен для использования внутри класса или его наследников. Основная
логика вызывается через публичный метод-редирект <code class="prettyprint">encode_user_rights()</code>.</li>
</ol>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$rights</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Массив прав пользователя. Может быть ассоциативным массивом, пустым значением или <code class="prettyprint">null</code>.
Пример: ['edit' =&gt; true, 'delete' =&gt; false].
Ограничения: значение должно быть массивом.</p>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-User.html#method__encode_user_rights_internal#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">protected</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                             
                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\InvalidArgumentException">InvalidArgumentException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если входное значение не является массивом.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\JsonException">JsonException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если возникает ошибка при кодировании массива в JSON.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Метод возвращает пустую строку, если массив прав отсутствует или содержит некорректные данные.
Если кодирование JSON завершается успешно, возвращается строка JSON.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Входные данные должны быть корректным массивом. Некорректные данные могут привести к выбросу
исключения.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__add_new_group_internal"><abbr title="\PhotoRigma\Classes\User::_add_new_group_internal()">User::_add_new_group_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Для преобразования прав в JSON-строку.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__update_group_data_internal"><abbr title="\PhotoRigma\Classes\User::_update_group_data_internal()">User::_update_group_data_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Метод, кодирующий массив прав пользователя в
JSON-строку для хранения в БД.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method_encode_user_rights"><abbr title="\PhotoRigma\Classes\User::encode_user_rights()">User::encode_user_rights()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Защищённый метод, реализующий основную логику
преобразования массива прав в строку JSON.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__update_user_rights_internal"><abbr title="\PhotoRigma\Classes\User::_update_user_rights_internal()">User::_update_user_rights_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Метод, кодирующий массив прав пользователя в
JSON-строку для хранения в БД.</p>
</section>

                                    </dd>
                                            </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">string</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Строка JSON, представляющая права пользователя. Если массив отсутствует или содержит некорректные
данные, возвращается пустая строка.</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -protected
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method__hard_delete_user_internal">
        _hard_delete_user_internal()
        <a href="classes/PhotoRigma-Classes-User.html#method__hard_delete_user_internal" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/User.php"><a href="files/src-classes-user.html"><abbr title="src/Classes/User.php">User.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">2936</span>

    </aside>

        <p class="phpdocumentor-summary">Выполняет окончательное обезличивание записи пользователя.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">protected</span>
                    <span class="phpdocumentor-signature__name">_hard_delete_user_internal</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">int&nbsp;</span><span class="phpdocumentor-signature__argument__name">$user_id</span></span><span class="phpdocumentor-signature__argument"><span>[</span><span>, </span><span class="phpdocumentor-signature__argument__return-type">bool&nbsp;</span><span class="phpdocumentor-signature__argument__name">$force</span><span> = </span><span class="phpdocumentor-signature__argument__default-value">false</span><span> ]</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">bool</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Метод:</p>
<ol>
<li>Получает данные пользователя по ID.
<ul>
<li>Если пользователь не найден → возвращает FALSE.</li>
</ul>
</li>
<li>При $force = FALSE:
<ul>
<li>Проверяет, был ли мягко удалён ранее</li>
<li>Убеждается, что срок истёк через _is_soft_delete_expired_internal()</li>
</ul>
</li>
<li>При $force = TRUE:
<ul>
<li>Проверяет, что вызов делает администратор</li>
<li>Проверяет, что админ подтвердил права в админке</li>
<li>НЕ позволяет админу удалить сам себя</li>
</ul>
</li>
<li>Проверяет, не последний ли это админ → если да, запрещаем</li>
<li>Удаляет личный контент через _delete_personal_content()</li>
<li>Обезличивает запись пользователя
<ul>
<li>email → <code class="prettyprint">deleted_{ID}@local.com</code></li>
<li>login → deleted_{ID}</li>
<li>password → случайная строка (до 20 символов)</li>
<li>avatar → DEFAULT_AVATAR</li>
<li>real_name → оставляем для фронтенда</li>
<li>permanently_deleted → устанавливаем в TRUE</li>
</ul>
</li>
<li>Все действия логируются через log_in_file()</li>
</ol>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$user_id</span>
                : <span class="phpdocumentor-signature__argument__return-type">int</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>ID пользователя, которого нужно окончательно удалить</p>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$force</span>
                : <span class="phpdocumentor-signature__argument__return-type">bool</span>
                 = <span class="phpdocumentor-signature__argument__default-value">false</span>            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>[optional] Если TRUE → удаляем без проверок (админка), иначе только после мягкого удаления (cron)</p>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-User.html#method__hard_delete_user_internal#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">protected</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                             
                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\Exception">Exception</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>При ошибках выполнения SQL-запросов</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Этот метод должен вызываться:</p>
<ul>
<li>Из фоновой задачи cron → с $force = FALSE</li>
<li>Из админки → с $force = TRUE</li>
</ul>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Поле real_name остаётся без изменений, так как используется на frontend
Метод использует существующие свойства: $this-&gt;user['admin'], $this-&gt;session['admin_on']</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Не позволяет удалить последнего админа</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__delete_personal_content"><abbr title="\PhotoRigma\Classes\User::_delete_personal_content()">User::_delete_personal_content()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Метод для удаление личных данных.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__delete_user_internal"><abbr title="\PhotoRigma\Classes\User::_delete_user_internal()">User::_delete_user_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Метод для выполнения окончательного удаления.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method_hard_delete_user"><abbr title="\PhotoRigma\Classes\User::hard_delete_user()">User::hard_delete_user()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Защищённый метод, реализующий окончательное
обезличивание и удаление.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__cron_user_delete_internal"><abbr title="\PhotoRigma\Classes\User::_cron_user_delete_internal()">User::_cron_user_delete_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Для окончательного обезличивания аккаунта.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">bool</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>TRUE при успехе, FALSE при ошибке или невозможности удаления</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -protected
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method__is_soft_delete_expired_internal">
        _is_soft_delete_expired_internal()
        <a href="classes/PhotoRigma-Classes-User.html#method__is_soft_delete_expired_internal" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/User.php"><a href="files/src-classes-user.html"><abbr title="src/Classes/User.php">User.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">2762</span>

    </aside>

        <p class="phpdocumentor-summary">Возвращает данные о сроке восстановления аккаунта.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">protected</span>
                    <span class="phpdocumentor-signature__name">_is_soft_delete_expired_internal</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">string|null&nbsp;</span><span class="phpdocumentor-signature__argument__name">$deleted_at</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">array&lt;string|int, mixed&gt;</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Метод:</p>
<ol>
<li>Принимает дату мягкого удаления (<code class="prettyprint">deleted_at</code>).</li>
<li>Если дата не задана → возвращает пустые значения и <code class="prettyprint">expired = false</code>.</li>
<li>Парсит дату удаления в формате UTC.</li>
<li>Вычисляет дату истечения срока восстановления:
<ul>
<li>На основе константы SOFT_DELETE_RETENTION_INTERVAL</li>
<li>Отсчёт от даты <code class="prettyprint">$deleted_at</code></li>
</ul>
</li>
<li>Проверяет, истёк ли срок:
<ul>
<li>TRUE → удаление окончательно</li>
<li>FALSE → пользователь ещё может восстановиться
Все операции выполняются в защищённом методе _is_soft_delete_expired_internal(). Реализация вызывается через
публичный метод is_soft_delete_expired().</li>
</ul>
</li>
</ol>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$deleted_at</span>
                : <span class="phpdocumentor-signature__argument__return-type">string|null</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Дата и время мягкого удаления (формат MySQL DATETIME).
Может быть NULL, если пользователь не удален.</p>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-User.html#method__is_soft_delete_expired_internal#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">protected</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                             
                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\Exception">Exception</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>При ошибке парсинга даты или других внутренних ошибках.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Метод использует константу SOFT_DELETE_RETENTION_INTERVAL для расчёта срока.
Все даты обрабатываются в часовом поясе UTC.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Не передавайте невалидные строки как <code class="prettyprint">$deleted_at</code>. Это приведёт к возврату пустых данных.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__load_authenticated_user"><abbr title="\PhotoRigma\Classes\User::_load_authenticated_user()">User::_load_authenticated_user()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Метод для проверки истечения срока мягкого
удаления.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__login_user_internal"><abbr title="\PhotoRigma\Classes\User::_login_user_internal()">User::_login_user_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Метод для проверки истечения срока мягкого
удаления.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method_is_soft_delete_expired"><abbr title="\PhotoRigma\Classes\User::is_soft_delete_expired()">User::is_soft_delete_expired()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Защищённый метод, реализующий основную логику.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__cron_user_delete_internal"><abbr title="\PhotoRigma\Classes\User::_cron_user_delete_internal()">User::_cron_user_delete_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Для проверки истечения срока мягкого удаления.</p>
</section>

                                    </dd>
                                            </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">array&lt;string|int, mixed&gt;</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Ассоциативный массив с данными о сроке восстановления:</p>
<ul>
<li>'restore_date'   =&gt; ?DateTime Дата мягкого удаления</li>
<li>'restore_expiry' =&gt; ?DateTime Дата истечения срока восстановления</li>
<li>'expired'        =&gt; bool Указывает, истёк ли срок</li>
</ul>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -protected
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method__login_user_internal">
        _login_user_internal()
        <a href="classes/PhotoRigma-Classes-User.html#method__login_user_internal" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/User.php"><a href="files/src-classes-user.html"><abbr title="src/Classes/User.php">User.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">2042</span>

    </aside>

        <p class="phpdocumentor-summary">Проверяет данные пользователя для входа в систему с &quot;мягким&quot; обновлением паролей на новый формат хранения.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">protected</span>
                    <span class="phpdocumentor-signature__name">_login_user_internal</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$post</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$redirect_url</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">int</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот метод выполняет следующие шаги:</p>
<ol>
<li>Проверяет корректность входных данных (логин и пароль) с использованием <code class="prettyprint">Work::check_input()</code>.
<ul>
<li>Логин проверяется на соответствие регулярному выражению <code class="prettyprint">REG_LOGIN</code>.</li>
<li>Пароль проверяется на пустоту.
Если данные некорректны, пользователь перенаправляется на указанный URL (<code class="prettyprint">$redirect_url</code>).</li>
</ul>
</li>
<li>Ищет пользователя в базе данных по логину:
<ul>
<li>Если пользователь не найден, происходит перенаправление на <code class="prettyprint">$redirect_url</code>.</li>
</ul>
</li>
<li>Проверяет статус удаления пользователя:
<ul>
<li>Если установлен флаг <code class="prettyprint">permanently_deleted</code>, доступ запрещён.</li>
<li>Если установлена дата <code class="prettyprint">deleted_at</code> и срок восстановления истёк, доступ запрещён.</li>
<li>Если срок восстановления не истёк, аккаунт восстанавливается (обнуляется <code class="prettyprint">deleted_at</code>).</li>
</ul>
</li>
<li>Проверяет пароль через <code class="prettyprint">password_verify()</code>:
<ul>
<li>Если проверка успешна, возвращается ID пользователя.</li>
<li>Если проверка не проходит, выполняется дополнительная проверка через <code class="prettyprint">md5</code> для поддержки старого формата
хранения паролей.</li>
</ul>
</li>
<li>Если пароль хранится в старом формате (md5), он обновляется до формата <code class="prettyprint">password_hash()</code> и сохраняется в
базе данных.</li>
<li>Возвращает ID пользователя или <code class="prettyprint">0</code> в случае ошибки.
Этот метод является защищённым и предназначен для использования внутри класса или его наследников. Основная
логика вызывается через публичный метод-редирект <code class="prettyprint">login_user()</code>.</li>
</ol>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$post</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Массив данных из формы ($_POST), содержащий ключи:</p>
<ul>
<li>string $login: Логин пользователя (должен соответствовать регулярному выражению
REG_LOGIN).</li>
<li>string $password: Пароль пользователя (не должен быть пустым).</li>
</ul>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$redirect_url</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>URL для перенаправления пользователя в случае возникновения ошибок.
Ограничения: должен быть валидным URL.</p>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-User.html#method__login_user_internal#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">protected</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                             
                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\Exception">Exception</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если:</p>
<ul>
<li>Возникает ошибка при проверке входных данных через <code class="prettyprint">Work::check_input()</code>.</li>
<li>Возникает ошибка при логировании событий через <code class="prettyprint">log_in_file()</code>.</li>
</ul>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Поддерживается совместимость со старым форматом хранения паролей (md5). При обнаружении старого формата
пароль автоматически обновляется до формата <code class="prettyprint">password_hash()</code>.
Константы, используемые в методе:</p>
<ul>
<li><code class="prettyprint">REG_LOGIN</code>: Регулярное выражение для проверки логина.
Пример: <code class="prettyprint">/^[a-zA-Z0-9][a-zA-Z0-9_-]*[a-zA-Z0-9_]$/</code>.
<ul>
<li>Допустимые символы: латинские буквы, цифры, подчеркивание (_), дефис (-).</li>
<li>Первый символ должен быть буквой или цифрой.</li>
<li>Последний символ должен быть буквой, цифрой или подчеркиванием.</li>
<li>Максимальная длина: 32 символа.</li>
</ul>
</li>
<li><code class="prettyprint">TBL_USERS</code>: Имя таблицы пользователей в базе данных. Например: '<code class="prettyprint">users</code>'.
Эти константы позволяют гибко настраивать поведение метода.</li>
</ul>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Метод зависит от корректной конфигурации базы данных. Убедитесь, что таблица пользователей и поля
(<code class="prettyprint">id</code>, <code class="prettyprint">login</code>, <code class="prettyprint">password</code>, <code class="prettyprint">deleted_at</code>, <code class="prettyprint">permanently_deleted</code>) настроены правильно.
Невалидные данные могут привести к исключениям.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Work.html#method_check_input"><abbr title="\PhotoRigma\Classes\Work::check_input()">Work::check_input()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Метод для проверки правильности входных данных.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#property_db"><abbr title="\PhotoRigma\Classes\User::$db">User::$db</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, содержащее объект класса Database.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="namespaces/photorigma-include.html#function_log_in_file"><abbr title="\PhotoRigma\Include\log_in_file()">log_in_file()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Записывает сообщение об ошибке в лог-файл.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__is_soft_delete_expired_internal"><abbr title="\PhotoRigma\Classes\User::_is_soft_delete_expired_internal()">User::_is_soft_delete_expired_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Метод для проверки истечения срока мягкого
удаления.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method_login_user"><abbr title="\PhotoRigma\Classes\User::login_user()">User::login_user()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Защищённый метод, реализующий основную логику проверки
данных пользователя для входа.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">int</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>ID пользователя, если авторизация успешна, или <code class="prettyprint">0</code> в случае ошибки.</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -protected
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method__process_user_rights_internal">
        _process_user_rights_internal()
        <a href="classes/PhotoRigma-Classes-User.html#method__process_user_rights_internal" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/User.php"><a href="files/src-classes-user.html"><abbr title="src/Classes/User.php">User.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">305</span>

    </aside>

        <p class="phpdocumentor-summary">Метод обрабатывает поле `user_rights`, преобразуя его из строки JSON в массив прав.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">protected</span>
                    <span class="phpdocumentor-signature__name">_process_user_rights_internal</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$user_rights</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">array&lt;string|int, mixed&gt;</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот метод выполняет следующие шаги:</p>
<ol>
<li>Проверяет, существует ли поле <code class="prettyprint">user_rights</code>. Если поле отсутствует или пустое, возвращается пустой массив.</li>
<li>Проверяет, что поле является строкой. Если тип данных некорректен, выбрасывается исключение.</li>
<li>Декодирует строку JSON в ассоциативный массив с использованием <code class="prettyprint">json_decode()</code>. Если декодирование
завершается с ошибкой, выбрасывается исключение.</li>
<li>Возвращает массив прав, готовый для добавления в свойство <code class="prettyprint">$user</code>.
Этот метод является защищенным и предназначен для использования внутри класса или его наследников. Основная
логика вызывается через публичный метод-редирект <code class="prettyprint">process_user_rights()</code>.</li>
</ol>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$user_rights</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Значение поля <code class="prettyprint">user_rights</code>. Может быть строкой JSON, пустым значением или <code class="prettyprint">null</code>.
Пример: '{&quot;edit&quot;: 1, &quot;delete&quot;: 0}'.
Ограничения: значение должно быть строкой, содержащей валидный JSON.</p>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-User.html#method__process_user_rights_internal#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">protected</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                             
                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\InvalidArgumentException">InvalidArgumentException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если поле <code class="prettyprint">user_rights</code> не является строкой.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\JsonException">JsonException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если поле <code class="prettyprint">user_rights</code> содержит невалидный JSON.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Метод возвращает пустой массив, если поле <code class="prettyprint">user_rights</code> отсутствует или содержит некорректные данные.
Если декодирование JSON завершается успешно, возвращается ассоциативный массив прав.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Поле <code class="prettyprint">user_rights</code> должно содержать валидный JSON. Невалидные данные могут привести к выбросу
исключения.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__all_right_fields"><abbr title="\PhotoRigma\Classes\User::_all_right_fields()">User::_all_right_fields()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Метод для обработки прав пользователя/группы.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method_process_user_rights"><abbr title="\PhotoRigma\Classes\User::process_user_rights()">User::process_user_rights()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Защищённый метод, реализующий основную логику
обработки поля <code class="prettyprint">user_rights</code>.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__load_guest_user"><abbr title="\PhotoRigma\Classes\User::_load_guest_user()">User::_load_guest_user()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Метод для обработки прав пользователя.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__load_authenticated_user"><abbr title="\PhotoRigma\Classes\User::_load_authenticated_user()">User::_load_authenticated_user()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Метод для обработки прав пользователя/группы.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__update_group_data_internal"><abbr title="\PhotoRigma\Classes\User::_update_group_data_internal()">User::_update_group_data_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Метод, декодирующий JSON-строку прав
пользователя в массив.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__update_user_rights_internal"><abbr title="\PhotoRigma\Classes\User::_update_user_rights_internal()">User::_update_user_rights_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Метод, декодирующий JSON-строку прав пользователя в массив.</p>
</section>

                                    </dd>
                                            </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">array&lt;string|int, mixed&gt;</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Ассоциативный массив прав пользователя. Если поле <code class="prettyprint">user_rights</code> отсутствует или содержит
некорректные данные, возвращается пустой массив.</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -protected
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method__set_property_key_internal">
        _set_property_key_internal()
        <a href="classes/PhotoRigma-Classes-User.html#method__set_property_key_internal" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/User.php"><a href="files/src-classes-user.html"><abbr title="src/Classes/User.php">User.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">685</span>

    </aside>

        <p class="phpdocumentor-summary">Метод устанавливает значение свойства в массивах `$user` или `$session`.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">protected</span>
                    <span class="phpdocumentor-signature__name">_set_property_key_internal</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$name</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$key</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">string|int|bool&nbsp;</span><span class="phpdocumentor-signature__argument__name">$value</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">void</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот метод выполняет следующие шаги:</p>
<ol>
<li>Проверяет, какой массив (<code class="prettyprint">$user</code> или <code class="prettyprint">$session</code>) нужно изменить, на основе параметра <code class="prettyprint">$name</code>.</li>
<li>Устанавливает значение по указанному ключу в выбранном массиве.</li>
<li>Если передано недопустимое имя свойства (не 'user' и не 'session'), выбрасывается исключение.
Этот метод является защищенным и предназначен для использования внутри класса или его наследников.
Основная логика вызывается через публичный метод-редирект <code class="prettyprint">set_property_key()</code>.</li>
</ol>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$name</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Имя свойства. Допустимые значения: 'user' (для массива данных пользователя)
или 'session' (для массива данных сессии).
Пример: &quot;user&quot;.
Ограничения: только допустимые значения ('user' или 'session').</p>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$key</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Ключ, по которому будет установлено значение. Должен быть строкой.
Пример: &quot;username&quot;.
Ограничения: ключ должен быть строкой.</p>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$value</span>
                : <span class="phpdocumentor-signature__argument__return-type">string|int|bool</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Значение, которое будет установлено. Может быть строкой, целым числом
или булевым значением.
Пример: &quot;admin&quot; (строка), 123 (целое число), true (булево значение).</p>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-User.html#method__set_property_key_internal#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">protected</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                             
                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\InvalidArgumentException">InvalidArgumentException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если параметр <code class="prettyprint">$name</code> содержит недопустимое значение.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Метод изменяет внутренние массивы <code class="prettyprint">$user</code> или <code class="prettyprint">$session</code> напрямую.
Перед установкой значения проверяется корректность имени свойства.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Недопустимое значение параметра <code class="prettyprint">$name</code> приведет к выбросу исключения.
Убедитесь, что передаете только допустимые значения ('user' или 'session').</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#property_user"><abbr title="\PhotoRigma\Classes\User::$user">User::$user</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство класса User, содержащее данные пользователя.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#property_session"><abbr title="\PhotoRigma\Classes\User::$session">User::$session</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство класса User, содержащее данные сессии.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method_set_property_key"><abbr title="\PhotoRigma\Classes\User::set_property_key()">User::set_property_key()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Защищённый метод, реализующий основную логику
установки значения свойства.</p>
</section>

                                    </dd>
                        </dl>

    

    
</article>
                    <article
        class="phpdocumentor-element
            -method
            -protected
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method__set_work_internal">
        _set_work_internal()
        <a href="classes/PhotoRigma-Classes-User.html#method__set_work_internal" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/User.php"><a href="files/src-classes-user.html"><abbr title="src/Classes/User.php">User.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">761</span>

    </aside>

        <p class="phpdocumentor-summary">Установка объекта Work_Interface через сеттер.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">protected</span>
                    <span class="phpdocumentor-signature__name">_set_work_internal</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type"><a href="classes/PhotoRigma-Interfaces-Work-Interface.html"><abbr title="\PhotoRigma\Interfaces\Work_Interface">Work_Interface</abbr></a>&nbsp;</span><span class="phpdocumentor-signature__argument__name">$work</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">void</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот метод выполняет следующие шаги:</p>
<ol>
<li>Проверяет, что переданный объект реализует интерфейс <code class="prettyprint">Work_Interface</code>. Если объект некорректен,
выбрасывается исключение.</li>
<li>Присваивает объект свойству <code class="prettyprint">$work</code> текущего класса.</li>
<li>Если в сессии отсутствует тема (<code class="prettyprint">theme</code>), устанавливает её значение из конфигурации объекта, реализующего
интерфейс <code class="prettyprint">Work_Interface</code>.
Этот метод является защищенным и предназначен для использования внутри класса или его наследников.  Основная
логика вызывается через публичный метод-редирект <code class="prettyprint">set_work()</code>.</li>
</ol>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$work</span>
                : <span class="phpdocumentor-signature__argument__return-type"><a href="classes/PhotoRigma-Interfaces-Work-Interface.html"><abbr title="\PhotoRigma\Interfaces\Work_Interface">Work_Interface</abbr></a></span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Объект, реализующий интерфейс <code class="prettyprint">Work_Interface</code>:</p>
<ul>
<li>Должен быть экземпляром класса, реализующего интерфейс <code class="prettyprint">Work_Interface</code>.</li>
<li>После проверки присваивается свойству <code class="prettyprint">$work</code> текущего класса.</li>
</ul>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-User.html#method__set_work_internal#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">protected</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                             
                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\InvalidArgumentException">InvalidArgumentException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если передан некорректный объект (не реализует интерфейс
<code class="prettyprint">Work_Interface</code>).</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Метод проверяет тип переданного объекта.
Объект, реализующий интерфейс <code class="prettyprint">Work_Interface</code>, используется для дальнейшего взаимодействия в текущем
классе. Если в сессии отсутствует тема (<code class="prettyprint">theme</code>), она инициализируется значением из конфигурации
объекта, реализующего интерфейс <code class="prettyprint">Work_Interface</code>.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Некорректный объект (не реализует интерфейс <code class="prettyprint">Work_Interface</code>) вызывает исключение.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><abbr title="\PhotoRigma\Classes\Work_Interface">Work_Interface</abbr></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Интерфейс, который должен реализовывать передаваемый объект.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#property_session"><abbr title="\PhotoRigma\Classes\User::$session">User::$session</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство класса User, содержащее данные сессии.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#property_work"><abbr title="\PhotoRigma\Classes\User::$work">User::$work</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство для объекта, реализующего интерфейс Work_Interface.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method_set_work"><abbr title="\PhotoRigma\Classes\User::set_work()">User::set_work()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Защищённый метод, реализующий основную логику установки
объекта Work.</p>
</section>

                                    </dd>
                        </dl>

    

    
</article>
                    <article
        class="phpdocumentor-element
            -method
            -protected
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method__unset_property_key_internal">
        _unset_property_key_internal()
        <a href="classes/PhotoRigma-Classes-User.html#method__unset_property_key_internal" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/User.php"><a href="files/src-classes-user.html"><abbr title="src/Classes/User.php">User.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">1348</span>

    </aside>

        <p class="phpdocumentor-summary">Удаляет ключ из указанного свойства объекта (user или session).</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">protected</span>
                    <span class="phpdocumentor-signature__name">_unset_property_key_internal</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$name</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$key</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">void</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот метод выполняет следующие шаги:</p>
<ol>
<li>Проверяет, какой массив изменять (<code class="prettyprint">$this-&gt;user</code> или <code class="prettyprint">$this-&gt;session</code>), на основе параметра <code class="prettyprint">$name</code>.</li>
<li>Если ключ существует в выбранном массиве, он удаляется с помощью <code class="prettyprint">unset()</code>.</li>
<li>Если указанный массив недопустим (не 'user' и не 'session'), выбрасывается исключение.
Этот метод является защищенным и предназначен для использования внутри класса или его наследников. Основная
логика вызывается через публичный метод-редирект <code class="prettyprint">unset_property_key()</code>.</li>
</ol>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$name</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Имя свойства, из которого удаляется ключ.
Допустимые значения: 'user' (для массива данных пользователя) или 'session'
(для массива данных сессии).
Пример: &quot;user&quot;.
Ограничения: только допустимые значения ('user' или 'session').</p>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$key</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Ключ, который нужно удалить. Должен быть строкой.
Пример: &quot;email&quot;.
Ограничения: если ключ отсутствует в массиве, метод завершается без ошибок.</p>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-User.html#method__unset_property_key_internal#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">protected</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                             
                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\InvalidArgumentException">InvalidArgumentException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если указано недопустимое значение для параметра <code class="prettyprint">$name</code>.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Метод изменяет только свойства 'user' и 'session'.
Если ключ отсутствует в массиве, метод завершается без ошибок.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Не используйте этот метод для удаления ключей из других свойств.
Передавайте только допустимые значения для параметра <code class="prettyprint">$name</code>.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#property_user"><abbr title="\PhotoRigma\Classes\User::$user">User::$user</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство класса User, содержащее данные пользователя.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#property_session"><abbr title="\PhotoRigma\Classes\User::$session">User::$session</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство класса User, содержащее данные сессии.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method_unset_property_key"><abbr title="\PhotoRigma\Classes\User::unset_property_key()">User::unset_property_key()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Защищённый метод, реализующий основную логику
удаления ключа из указанного свойства.</p>
</section>

                                    </dd>
                        </dl>

    

    
</article>
                    <article
        class="phpdocumentor-element
            -method
            -protected
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method__update_group_data_internal">
        _update_group_data_internal()
        <a href="classes/PhotoRigma-Classes-User.html#method__update_group_data_internal" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/User.php"><a href="files/src-classes-user.html"><abbr title="src/Classes/User.php">User.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">1774</span>

    </aside>

        <p class="phpdocumentor-summary">Обновляет данные группы в системе через Админку.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">protected</span>
                    <span class="phpdocumentor-signature__name">_update_group_data_internal</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$group_data</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$post_data</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">array&lt;string|int, mixed&gt;</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот метод выполняет следующие шаги:</p>
<ol>
<li>Проверяет и обновляет название группы, если оно изменилось в <code class="prettyprint">$post_data</code>:
<ul>
<li>Очищает новое название с помощью <code class="prettyprint">Work::clean_field()</code> для безопасности.</li>
<li>Обновляет поле <code class="prettyprint">name</code> в таблице групп через SQL-запрос.</li>
</ul>
</li>
<li>Обновляет права доступа группы:
<ul>
<li>Проверяет каждое поле прав доступа из свойства класса <code class="prettyprint">user_right_fields</code>.</li>
<li>Нормализует значения прав доступа (true/false).</li>
<li>Кодирует обновленные права доступа в JSON-строку с помощью метода <code class="prettyprint">encode_user_rights()</code>.</li>
</ul>
</li>
<li>Обновляет поле <code class="prettyprint">user_rights</code> в таблице групп через SQL-запрос.</li>
<li>Возвращает обновленные данные группы, включая название и все поля прав доступа.
Этот метод является защищенным и предназначен для использования внутри класса или его наследников. Основная
логика вызывается через публичный метод-редирект <code class="prettyprint">update_group_data()</code>.</li>
</ol>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$group_data</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Данные группы.
Должен содержать ключи:</p>
<ul>
<li><code class="prettyprint">name</code>: Текущее название группы.</li>
<li><code class="prettyprint">user_rights</code>: JSON-строка с текущими правами группы.
Может также содержать поля, перечисленные в свойстве класса <code class="prettyprint">user_right_fields</code>.</li>
</ul>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$post_data</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Данные, полученные из POST-запроса.
Должен содержать ключ:</p>
<ul>
<li><code class="prettyprint">id_group</code>: ID группы.
Может также содержать ключ:</li>
<li><code class="prettyprint">name_group</code>: Новое название группы.
И поля, перечисленные в свойстве класса <code class="prettyprint">user_right_fields</code>.</li>
</ul>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-User.html#method__update_group_data_internal#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">protected</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                             
                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\RuntimeException">RuntimeException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если произошла ошибка при обновлении данных в БД.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\JsonException">JsonException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если возникает ошибка при кодировании или декодировании JSON.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\Exception">Exception</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если возникает ошибка при проверке входных данных через
<code class="prettyprint">Work::check_input()</code>.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Метод использует следующие константы:</p>
<ul>
<li><code class="prettyprint">TBL_GROUP</code>: Имя таблицы групп в базе данных. Например: '<code class="prettyprint">groups</code>'.</li>
<li><code class="prettyprint">REG_NAME</code>: Регулярное выражение для проверки названия группы.
Пример: <code class="prettyprint">/^[^\x00-\x1F\x7F&lt;&gt;&amp;&quot;'\\\/</code>=]{1,100}$/`.
Эти константы позволяют гибко настраивать поведение метода.</li>
</ul>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Убедитесь, что входные данные корректны. Невалидные данные могут привести к исключениям.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#property_user_right_fields"><abbr title="\PhotoRigma\Classes\User::$user_right_fields">User::$user_right_fields</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, содержащее массив с допустимыми полями прав
пользователя.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__process_user_rights_internal"><abbr title="\PhotoRigma\Classes\User::_process_user_rights_internal()">User::_process_user_rights_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Метод, декодирующий JSON-строку прав
пользователя в массив.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__encode_user_rights_internal"><abbr title="\PhotoRigma\Classes\User::_encode_user_rights_internal()">User::_encode_user_rights_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Метод, кодирующий массив прав пользователя в
JSON-строку для хранения в БД.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method_update_group_data"><abbr title="\PhotoRigma\Classes\User::update_group_data()">User::update_group_data()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Защищённый метод, реализующий основную логику
обновления данных группы.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">array&lt;string|int, mixed&gt;</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Возвращает массив данных группы:</p>
<ul>
<li><code class="prettyprint">name</code>: Название группы.</li>
<li>Все поля, указанные в свойстве класса <code class="prettyprint">user_right_fields</code>.</li>
</ul>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -protected
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method__update_user_data_internal">
        _update_user_data_internal()
        <a href="classes/PhotoRigma-Classes-User.html#method__update_user_data_internal" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/User.php"><a href="files/src-classes-user.html"><abbr title="src/Classes/User.php">User.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">2283</span>

    </aside>

        <p class="phpdocumentor-summary">Обновляет данные существующего пользователя, включая пароль, email, имя и аватар.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">protected</span>
                    <span class="phpdocumentor-signature__name">_update_user_data_internal</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">int&nbsp;</span><span class="phpdocumentor-signature__argument__name">$user_id</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$post_data</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$files_data</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">int&nbsp;</span><span class="phpdocumentor-signature__argument__name">$max_size</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">int</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот метод выполняет следующие шаги:</p>
<ol>
<li>Проверяет существование пользователя с указанным <code class="prettyprint">$user_id</code> в базе данных. Если пользователь не найден,
выбрасывается исключение.</li>
<li>Валидирует и обновляет пароль:
<ul>
<li>Проверяет текущий пароль через <code class="prettyprint">password_verify()</code>.</li>
<li>Если новый пароль передан и совпадает с повторным вводом, обновляет его через <code class="prettyprint">password_hash()</code>.</li>
</ul>
</li>
<li>Проверяет уникальность email и имени пользователя в базе данных:
<ul>
<li>Если значения уже заняты другими пользователями, данные не обновляются.</li>
</ul>
</li>
<li>Обрабатывает загрузку нового аватара через метод <code class="prettyprint">_edit_avatar()</code>:
<ul>
<li>Если файл проходит валидацию, загружает новый аватар.</li>
<li>Удаляет старый аватар, если он отличается от нового и не является аватаром по умолчанию.</li>
</ul>
</li>
<li>Проверяет и обновляет язык (<code class="prettyprint">language</code>) и тему (<code class="prettyprint">theme</code>) сайта, если они переданы.</li>
<li>Формирует SQL-запрос для обновления данных пользователя в таблице <code class="prettyprint">TBL_USERS</code>:
<ul>
<li>Использует prepared statements для безопасной вставки данных.</li>
</ul>
</li>
<li>Возвращает количество затронутых строк в базе данных после выполнения обновления.
Этот метод является защищенным и предназначен для использования внутри класса или его наследников. Основная
логика вызывается через публичный метод-редирект <code class="prettyprint">update_user_data()</code>.</li>
</ol>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$user_id</span>
                : <span class="phpdocumentor-signature__argument__return-type">int</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Идентификатор пользователя, данные которого необходимо обновить.
Должен быть положительным целым числом и существовать в базе данных.
Пример: 1.
Ограничения: ID должен быть больше 0.</p>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$post_data</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Массив данных из формы ($_POST), содержащий новые значения для полей пользователя:</p>
<ul>
<li>string $password: Текущий пароль пользователя (обязательно для изменения пароля).</li>
<li>string $edit_password: Новый пароль пользователя (необязательно).</li>
<li>string $re_password: Повторный ввод нового пароля (должен совпадать с
<code class="prettyprint">edit_password</code>).</li>
<li>string $email: Новый email пользователя (должен соответствовать регулярному выражению
REG_EMAIL).</li>
<li>string $real_name: Новое имя пользователя (должно быть строкой).
Все поля проходят валидацию перед использованием.</li>
</ul>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$files_data</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Массив данных загруженного файла ($_FILES), содержащий информацию об аватаре:</p>
<ul>
<li>'file_avatar' (array): Информация о загруженном файле (необязательно).
Если файл не передан или не проходит валидацию, аватар остается без изменений.</li>
</ul>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$max_size</span>
                : <span class="phpdocumentor-signature__argument__return-type">int</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Максимальный размер файла для аватара в байтах. Определяется на основе конфигурации
приложения и ограничений PHP (например, post_max_size). Если размер файла превышает
это значение, загрузка аватара отклоняется.
Пример: 5 * 1024 * 1024 (5 MB).
Ограничения: значение должно быть положительным целым числом.</p>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-User.html#method__update_user_data_internal#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">protected</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                             
                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\RuntimeException">RuntimeException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если пользователь с указанным <code class="prettyprint">$user_id</code> не найден в базе данных.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\Exception">Exception</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если возникает ошибка при проверке входных данных через
<code class="prettyprint">Work::check_input()</code> или при обработке аватара через <code class="prettyprint">_edit_avatar()</code>.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Для обработки аватаров используется метод <code class="prettyprint">_edit_avatar()</code>. Старый аватар удаляется, если новый успешно
загружен и отличается от старого. Константы, используемые в методе:</p>
<ul>
<li><code class="prettyprint">DEFAULT_AVATAR</code>: Имя аватара по умолчанию. Например: <code class="prettyprint">'no_avatar.jpg'</code>.</li>
<li><code class="prettyprint">TBL_USERS</code>: Имя таблицы пользователей в базе данных. Например: '<code class="prettyprint">users</code>'.</li>
<li><code class="prettyprint">REG_EMAIL</code>: Регулярное выражение для проверки email.
Пример: <code class="prettyprint">/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/</code>.
Эти константы позволяют гибко настраивать поведение метода.</li>
</ul>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Не используйте этот метод для массового обновления данных. Он предназначен только для работы с одним
пользователем за раз.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Work.html#method_check_input"><abbr title="\PhotoRigma\Classes\Work::check_input()">Work::check_input()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Метод для проверки корректности входных данных.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__edit_avatar"><abbr title="\PhotoRigma\Classes\User::_edit_avatar()">User::_edit_avatar()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Приватный метод для обработки загрузки аватара.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method_update_user_data"><abbr title="\PhotoRigma\Classes\User::update_user_data()">User::update_user_data()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Защищённый метод, реализующий основную логику
обновления данных пользователя.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">int</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Количество затронутых строк в базе данных после выполнения обновления.
Возвращается <code class="prettyprint">0</code>, если данные не изменились или запрос завершился ошибкой.</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -protected
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method__update_user_rights_internal">
        _update_user_rights_internal()
        <a href="classes/PhotoRigma-Classes-User.html#method__update_user_rights_internal" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/User.php"><a href="files/src-classes-user.html"><abbr title="src/Classes/User.php">User.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">2607</span>

    </aside>

        <p class="phpdocumentor-summary">Обновляет права пользователя или группу через Админку.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">protected</span>
                    <span class="phpdocumentor-signature__name">_update_user_rights_internal</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">int&nbsp;</span><span class="phpdocumentor-signature__argument__name">$user_id</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$user_data</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$post_data</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">array&lt;string|int, mixed&gt;</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот метод выполняет следующие шаги:</p>
<ol>
<li>Проверяет, изменилась ли группа пользователя в <code class="prettyprint">$post_data</code>. Если группа изменилась:
<ul>
<li>Получает данные новой группы из таблицы <code class="prettyprint">TBL_GROUP</code>.</li>
<li>Обновляет ID группы пользователя и связанные права доступа в таблице <code class="prettyprint">TBL_USERS</code>.</li>
<li>Декодирует обновленные права доступа пользователя в массив с помощью <code class="prettyprint">process_user_rights()</code>.</li>
</ul>
</li>
<li>Если группа не изменилась:
<ul>
<li>Проверяет, отличаются ли текущие права пользователя от переданных в <code class="prettyprint">$post_data</code>.</li>
<li>Нормализует значения прав доступа (true/false).</li>
<li>Кодирует обновленные права доступа в JSON-строку с помощью <code class="prettyprint">encode_user_rights()</code>.</li>
<li>Обновляет права доступа пользователя в таблице <code class="prettyprint">TBL_USERS</code>.</li>
</ul>
</li>
<li>Возвращает обновленные данные пользователя, включая все поля прав доступа и ID группы.
Этот метод является защищенным и предназначен для использования внутри класса или его наследников. Основная
логика вызывается через публичный метод-редирект <code class="prettyprint">update_user_rights()</code>.</li>
</ol>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$user_id</span>
                : <span class="phpdocumentor-signature__argument__return-type">int</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Идентификатор пользователя.
Должен быть положительным целым числом.
Пример: 123.
Ограничения: ID должен быть больше 0.</p>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$user_data</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Данные пользователя.
Должен содержать ключ <code class="prettyprint">group_id</code> (ID текущей группы пользователя).
Также должен содержать все поля, указанные в свойстве класса <code class="prettyprint">user_right_fields</code>.
Пример: ['group_id' =&gt; 2, 'edit' =&gt; true, 'delete' =&gt; false].</p>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$post_data</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Данные, полученные из POST-запроса.
Должен содержать ключ <code class="prettyprint">group</code> (ID новой группы пользователя).
Также должен содержать все поля, указанные в свойстве класса <code class="prettyprint">user_right_fields</code>.
Пример: ['group' =&gt; 3, 'edit' =&gt; 'on', 'delete' =&gt; false].</p>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-User.html#method__update_user_rights_internal#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">protected</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                             
                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\RuntimeException">RuntimeException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если:</p>
<ul>
<li>Не удалось получить данные группы из БД.</li>
<li>Произошла ошибка при обновлении данных пользователя в БД.</li>
</ul>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\JsonException">JsonException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если возникает ошибка при кодировании или декодировании JSON.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\Exception">Exception</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если возникает ошибка при проверке входных данных через
<code class="prettyprint">Work::check_input()</code>.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Метод использует свойство класса <code class="prettyprint">user_right_fields</code> для определения допустимых полей прав
пользователя.
Обновление прав доступа происходит с нормализацией значений (true/false) и их последующим кодированием
в JSON-строку.
Константы, используемые в методе:</p>
<ul>
<li><code class="prettyprint">TBL_USERS</code>: Имя таблицы пользователей в базе данных. Например: '<code class="prettyprint">users</code>'.</li>
<li><code class="prettyprint">TBL_GROUP</code>: Имя таблицы групп в базе данных. Например: '<code class="prettyprint">groups</code>'.
Эти константы позволяют гибко настраивать поведение метода.</li>
</ul>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Убедитесь, что входные данные корректны. Невалидные данные могут привести к исключениям.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__encode_user_rights_internal"><abbr title="\PhotoRigma\Classes\User::_encode_user_rights_internal()">User::_encode_user_rights_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Метод, кодирующий массив прав пользователя в
JSON-строку для хранения в БД.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__process_user_rights_internal"><abbr title="\PhotoRigma\Classes\User::_process_user_rights_internal()">User::_process_user_rights_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Метод, декодирующий JSON-строку прав пользователя в массив.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Work.html#method_check_input"><abbr title="\PhotoRigma\Classes\Work::check_input()">Work::check_input()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Метод для проверки правильности входных данных.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#property_user_right_fields"><abbr title="\PhotoRigma\Classes\User::$user_right_fields">User::$user_right_fields</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, содержащее массив с допустимыми полями прав
пользователя.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method_update_user_rights"><abbr title="\PhotoRigma\Classes\User::update_user_rights()">User::update_user_rights()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Защищённый метод, реализующий основную логику
обновления прав пользователя или группы.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">array&lt;string|int, mixed&gt;</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Возвращает массив данных пользователя:</p>
<ul>
<li><code class="prettyprint">group_id</code>: ID группы пользователя.</li>
<li>Все поля, указанные в свойстве класса <code class="prettyprint">user_right_fields</code>.</li>
</ul>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -private
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method__all_right_fields">
        _all_right_fields()
        <a href="classes/PhotoRigma-Classes-User.html#method__all_right_fields" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/User.php"><a href="files/src-classes-user.html"><abbr title="src/Classes/User.php">User.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">196</span>

    </aside>

        <p class="phpdocumentor-summary">Метод загружает права первого пользователя и первой группы из базы данных, извлекает имена полей (ключи) из
JSON-поля `user_rights`, объединяет их в один массив и сохраняет в свойство `$user_right_fields`.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">private</span>
                    <span class="phpdocumentor-signature__name">_all_right_fields</span><span>(</span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">void</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот метод выполняет следующие шаги:</p>
<ol>
<li>Загружает первые доступные записи из таблиц <code class="prettyprint">TBL_USERS</code> и <code class="prettyprint">TBL_GROUP</code>.
<ul>
<li>Если запись не найдена, выбрасывается исключение.</li>
</ul>
</li>
<li>Извлекает поле <code class="prettyprint">user_rights</code> (JSON) из каждой записи.
<ul>
<li>Если поле отсутствует или некорректно, сохраняется пустой массив.</li>
</ul>
</li>
<li>Декодирует JSON с помощью метода <code class="prettyprint">process_user_rights()</code> и сохраняет имена полей (ключи) в свойство
<code class="prettyprint">$user_right_fields</code>.</li>
<li>Объединяет поля прав пользователей и групп в один массив (<code class="prettyprint">$user_right_fields['all']</code>), используя
<code class="prettyprint">array_unique()</code> для удаления дубликатов.</li>
<li>Сохраняет результаты в свойство <code class="prettyprint">$user_right_fields</code>:
<ul>
<li>Права пользователя: <code class="prettyprint">$user_right_fields['user']</code>.</li>
<li>Права группы: <code class="prettyprint">$user_right_fields['group']</code>.</li>
<li>Объединённые уникальные поля: <code class="prettyprint">$user_right_fields['all']</code>.
Этот метод является приватным и предназначен только для использования внутри класса.</li>
</ul>
</li>
</ol>
</section>

    
    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-User.html#method__all_right_fields#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">internal</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                             
                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\RuntimeException">RuntimeException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если:</p>
<ul>
<li>Не удаётся получить права первого пользователя из таблицы <code class="prettyprint">TBL_USERS</code>.</li>
<li>Не удаётся получить права первой группы из таблицы <code class="prettyprint">TBL_GROUP</code>.</li>
</ul>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\JsonException">JsonException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если произошла ошибка при декодировании JSON.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\Exception">Exception</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается при выполнении запросов к СУБД.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Метод сохраняет имена полей прав пользователей и групп в свойство <code class="prettyprint">$user_right_fields</code>:</p>
<ul>
<li>Права пользователя сохраняются в <code class="prettyprint">$user_right_fields['user']</code>.</li>
<li>Права группы сохраняются в <code class="prettyprint">$user_right_fields['group']</code>.</li>
<li>Объединённые уникальные поля сохраняются в <code class="prettyprint">$user_right_fields['all']</code>.
Если данные отсутствуют, сохраняются пустые массивы.
Для указания таблиц базы данных используются константы:</li>
<li><code class="prettyprint">TBL_USERS</code>: Таблица пользователей с их правами. Например: '<code class="prettyprint">users</code>'.</li>
<li><code class="prettyprint">TBL_GROUP</code>: Таблица групп пользователей с их правами. Например: '<code class="prettyprint">groups</code>'.
Эти константы позволяют гибко настраивать работу метода.</li>
</ul>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Поле <code class="prettyprint">user_rights</code> должно содержать валидный JSON. Невалидные данные могут привести к исключению.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#property_user_right_fields"><abbr title="\PhotoRigma\Classes\User::$user_right_fields">User::$user_right_fields</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, содержащее имена полей прав пользователей и групп.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#property_db"><abbr title="\PhotoRigma\Classes\User::$db">User::$db</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, содержащее объект для работы с базой данных.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__process_user_rights_internal"><abbr title="\PhotoRigma\Classes\User::_process_user_rights_internal()">User::_process_user_rights_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Метод для обработки прав пользователя/группы.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method___construct"><abbr title="\PhotoRigma\Classes\User::__construct()">User::__construct()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Метод, наполняющий массив именами полей прав пользователей
и групп.</p>
</section>

                                    </dd>
                        </dl>

    

    
</article>
                    <article
        class="phpdocumentor-element
            -method
            -private
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method__delete_personal_content">
        _delete_personal_content()
        <a href="classes/PhotoRigma-Classes-User.html#method__delete_personal_content" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/User.php"><a href="files/src-classes-user.html"><abbr title="src/Classes/User.php">User.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">3121</span>

    </aside>

        <p class="phpdocumentor-summary">Удаляет личные фото пользователя (категория 0) через существующий метод `del_photo()`.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">private</span>
                    <span class="phpdocumentor-signature__name">_delete_personal_content</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">int&nbsp;</span><span class="phpdocumentor-signature__argument__name">$user_id</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">bool</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Метод:</p>
<ol>
<li>Находит все фото, где user_upload = $user_id и category = 0.</li>
<li>Для каждого photo_id вызывает $this-&gt;work-&gt;del_photo($photo_id).</li>
<li>Считает количество успешно удалённых фото.</li>
<li>Логирует общий результат.
Не работает с альбомами — всё определяется полем category.</li>
</ol>
<p>Этот метод является внутренним и предназначен только для вызова из <code class="prettyprint">_hard_delete_user_internal()</code>. Он не
выбрасывает исключений при ошибке отдельного удаления фото — только общая ошибка БД останавливает выполнение.</p>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$user_id</span>
                : <span class="phpdocumentor-signature__argument__return-type">int</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>ID пользователя, чьи личные фото нужно удалить.
Должен быть положительным целым числом (<code class="prettyprint">&gt; 0</code>).
Пример: 123.</p>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-User.html#method__delete_personal_content#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">internal</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                             
                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\Exception">Exception</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>При ошибках SQL-запроса (например, ошибка выборки фото).</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Личные фото = TBL_PHOTO WHERE user_upload = $user_id AND category = 0.
Метод <code class="prettyprint">$this-&gt;work-&gt;del_photo($photo_id)</code> уже содержит логику удаления файла и записи.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Этот метод должен вызываться только из <code class="prettyprint">_hard_delete_user_internal()</code>.
Он не обеспечивает полной гарантии удаления всех фото — отдельные ошибки игнорируются.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Work.html#method_del_photo"><abbr title="\PhotoRigma\Classes\Work::del_photo()">Work::del_photo()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Внешний метод, реализующий окончательное удаление одного фото.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__hard_delete_user_internal"><abbr title="\PhotoRigma\Classes\User::_hard_delete_user_internal()">User::_hard_delete_user_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Метод для удаление личных данных.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">bool</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>TRUE если удаление начато и выполнено частично или полностью,
FALSE только при критической ошибке БД (например, выборка фото не удалась).</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -private
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method__edit_avatar">
        _edit_avatar()
        <a href="classes/PhotoRigma-Classes-User.html#method__edit_avatar" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/User.php"><a href="files/src-classes-user.html"><abbr title="src/Classes/User.php">User.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">2452</span>

    </aside>

        <p class="phpdocumentor-summary">Обрабатывает загрузку аватара пользователя и возвращает имя нового аватара или значение по умолчанию
(`DEFAULT_AVATAR`), если загрузка не удалась.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">private</span>
                    <span class="phpdocumentor-signature__name">_edit_avatar</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$files_data</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">int&nbsp;</span><span class="phpdocumentor-signature__argument__name">$max_size</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">string</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот приватный метод выполняет следующие действия:</p>
<ol>
<li>Проверяет входные данные через <code class="prettyprint">Work::check_input()</code>:
<ul>
<li>Проверяется наличие и корректность файла.</li>
<li>Проверяется максимальный размер файла.</li>
</ul>
</li>
<li>Генерирует уникальное имя файла для аватара:
<ul>
<li>Используется временная метка (<code class="prettyprint">time()</code>) и метод <code class="prettyprint">Work::encodename()</code> для создания уникального имени.</li>
</ul>
</li>
<li>Перемещает загруженный файл в директорию аватаров:
<ul>
<li>Если директория недоступна для записи, выбрасывается исключение.</li>
</ul>
</li>
<li>Корректирует расширение файла на основе его MIME-типа с помощью <code class="prettyprint">Work::fix_file_extension()</code>:
<ul>
<li>Если расширение изменено, файл переименовывается.</li>
</ul>
</li>
<li>Возвращает имя нового аватара или значение по умолчанию (<code class="prettyprint">DEFAULT_AVATAR</code>), если загрузка не удалась.
Метод является приватным и предназначен только для использования внутри класса.</li>
</ol>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$files_data</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Массив данных загруженного файла ($_FILES), содержащий информацию об аватаре.
Должен содержать ключ 'file_avatar' (массив):</p>
<ul>
<li>'name': Имя файла.</li>
<li>'tmp_name': Временный путь к файлу.</li>
<li>'size': Размер файла в байтах.
Пример: $_FILES['file_avatar'].</li>
</ul>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$max_size</span>
                : <span class="phpdocumentor-signature__argument__return-type">int</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Максимальный размер файла для аватара в байтах.
Определяется на основе конфигурации приложения и ограничений PHP (например,
post_max_size). Пример: 5 * 1024 * 1024 (5 MB).</p>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-User.html#method__edit_avatar#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">internal</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                             
                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\Exception">Exception</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Может быть выброшено вызываемыми методами:</p>
<ul>
<li><code class="prettyprint">Work::check_input()</code>: При проверке входных данных.</li>
<li><code class="prettyprint">rename()</code>: При переименовании файла после корректировки расширения.</li>
</ul>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\RuntimeException">RuntimeException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается исключение в следующих случаях:</p>
<ul>
<li>Директория для аватаров недоступна для записи.</li>
<li>Не удалось переместить загруженный файл.</li>
</ul>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Используются константы:</p>
<ul>
<li><code class="prettyprint">DEFAULT_AVATAR</code>: Значение аватара по умолчанию (например, 'no_avatar.jpg').</li>
</ul>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Убедитесь, что:</p>
<ul>
<li>Массив <code class="prettyprint">$files_data</code> содержит корректные данные о загруженном файле.</li>
<li>Директория для аватаров доступна для записи.
Несоблюдение этих условий может привести к ошибкам загрузки аватара.</li>
</ul>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Work.html#method_encodename"><abbr title="\PhotoRigma\Classes\Work::encodename()">Work::encodename()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Метод для генерации уникального имени файла.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Work.html#method_fix_file_extension"><abbr title="\PhotoRigma\Classes\Work::fix_file_extension()">Work::fix_file_extension()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Метод для корректировки расширения файла на основе его
MIME-типа.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Work.html#method_check_input"><abbr title="\PhotoRigma\Classes\Work::check_input()">Work::check_input()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Метод для проверки корректности входных данных.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__update_user_data_internal"><abbr title="\PhotoRigma\Classes\User::_update_user_data_internal()">User::_update_user_data_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Приватный метод для обработки загрузки аватара.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">string</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Имя нового аватара пользователя или значение по умолчанию (<code class="prettyprint">DEFAULT_AVATAR</code>),
если загрузка аватара была отменена или произошла ошибка.
Пример: '1698765432_encoded_name.jpg'.</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -private
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method__initialize_user">
        _initialize_user()
        <a href="classes/PhotoRigma-Classes-User.html#method__initialize_user" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/User.php"><a href="files/src-classes-user.html"><abbr title="src/Classes/User.php">User.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">355</span>

    </aside>

        <p class="phpdocumentor-summary">Инициализация данных пользователя: определение типа пользователя (гость или аутентифицированный) на основе
значения `login_id` из сессии.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">private</span>
                    <span class="phpdocumentor-signature__name">_initialize_user</span><span>(</span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">void</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот метод выполняет следующие шаги:</p>
<ol>
<li>Проверяет наличие <code class="prettyprint">login_id</code> в массиве сессии:
<ul>
<li>Если <code class="prettyprint">login_id</code> отсутствует, используется значение по умолчанию: 0.</li>
</ul>
</li>
<li>Преобразует <code class="prettyprint">login_id</code> в целое число и сохраняет его обратно в сессию.</li>
<li>Определяет тип пользователя:
<ul>
<li>Если <code class="prettyprint">login_id</code> равен 0, загружается гость с помощью метода <code class="prettyprint">_load_guest_user()</code>.</li>
<li>Если <code class="prettyprint">login_id</code> не равен 0, загружается аутентифицированный пользователь с помощью метода
<code class="prettyprint">_load_authenticated_user($login_id)</code>.
Метод является приватным и предназначен только для использования внутри класса.</li>
</ul>
</li>
</ol>
</section>

    
    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-User.html#method__initialize_user#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">internal</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                             
                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\JsonException">JsonException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если вызываемые методы <code class="prettyprint">_load_guest_user()</code> или <code class="prettyprint">_load_authenticated_user()</code>
выбрасывают исключение при работе с JSON.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Значение <code class="prettyprint">login_id</code> всегда преобразуется в целое число и сохраняется в сессии.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Убедитесь, что:</p>
<ul>
<li>Массив сессии содержит корректные данные.</li>
<li>Методы <code class="prettyprint">_load_guest_user()</code> и <code class="prettyprint">_load_authenticated_user()</code> корректно обрабатывают JSON.
Несоблюдение этих условий может привести к ошибкам инициализации.</li>
</ul>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#property_session"><abbr title="\PhotoRigma\Classes\User::$session">User::$session</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, содержащее данные сессии.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__load_guest_user"><abbr title="\PhotoRigma\Classes\User::_load_guest_user()">User::_load_guest_user()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Метод для загрузки данных гостя.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__load_authenticated_user"><abbr title="\PhotoRigma\Classes\User::_load_authenticated_user()">User::_load_authenticated_user()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Метод для загрузки данных аутентифицированного
пользователя.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method___construct"><abbr title="\PhotoRigma\Classes\User::__construct()">User::__construct()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Метод, выполняющий инициализацию данных о пользователе.</p>
</section>

                                    </dd>
                        </dl>

    

    
</article>
                    <article
        class="phpdocumentor-element
            -method
            -private
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method__load_authenticated_user">
        _load_authenticated_user()
        <a href="classes/PhotoRigma-Classes-User.html#method__load_authenticated_user" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/User.php"><a href="files/src-classes-user.html"><abbr title="src/Classes/User.php">User.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">487</span>

    </aside>

        <p class="phpdocumentor-summary">Метод загружает данные аутентифицированного пользователя из базы данных, включая права пользователя и группы,
обновляет дату последней активности, устанавливает язык и тему в сессии, и сохраняет данные в свойство `$user`.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">private</span>
                    <span class="phpdocumentor-signature__name">_load_authenticated_user</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">int&nbsp;</span><span class="phpdocumentor-signature__argument__name">$user_id</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">void</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Если данные пользователя или группы отсутствуют, сбрасывает сессию до гостя.</p>
<p>Этот метод выполняет следующие шаги:</p>
<ol>
<li>Загружает данные пользователя из таблицы <code class="prettyprint">TBL_USERS</code> по <code class="prettyprint">user_id</code>.
<ul>
<li>Если данные пользователя отсутствуют, сбрасывает сессию до гостя и вызывает метод <code class="prettyprint">_load_guest_user()</code>.</li>
</ul>
</li>
<li>Удаляет поле <code class="prettyprint">user_rights</code> из данных пользователя и обрабатывает его с помощью метода <code class="prettyprint">process_user_rights()</code>.</li>
<li>Сохраняет обработанные права в свойство <code class="prettyprint">$user</code>.</li>
<li>Загружает данные группы пользователя из таблицы <code class="prettyprint">TBL_GROUP</code> по <code class="prettyprint">group_id</code>.
<ul>
<li>Если данные группы отсутствуют, сбрасывает сессию до гостя и вызывает метод <code class="prettyprint">_load_guest_user()</code>.</li>
</ul>
</li>
<li>Удаляет поле <code class="prettyprint">user_rights</code> из данных группы и обрабатывает его с помощью метода <code class="prettyprint">process_user_rights()</code>.</li>
<li>Объединяет данные пользователя и группы через метод <code class="prettyprint">_merge_user_with_group()</code>.</li>
<li>Устанавливает язык и тему сайта в сессии (<code class="prettyprint">$this-&gt;session['language']</code> и <code class="prettyprint">$this-&gt;session['theme']</code>) на
основе данных пользователя.</li>
<li>Обновляет дату последней активности пользователя в таблице <code class="prettyprint">TBL_USERS</code>.</li>
<li>Проверяет статус удаления пользователя:
<ul>
<li>Если пользователь окончательно удален (<code class="prettyprint">permanently_deleted = TRUE</code>), переводит в гости.</li>
<li>Если пользователь был мягко удален, и срок восстановления истек, также переводит в гости.
Этот метод является приватным и предназначен только для использования внутри класса.</li>
</ul>
</li>
</ol>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$user_id</span>
                : <span class="phpdocumentor-signature__argument__return-type">int</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Идентификатор пользователя. Должен быть положительным целым числом.
Пример: 123.
Ограничения: ID должен быть больше 0.</p>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-User.html#method__load_authenticated_user#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">internal</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                             
                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\RuntimeException">RuntimeException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если:</p>
<ul>
<li>Не удаётся получить данные пользователя из таблицы <code class="prettyprint">TBL_USERS</code>.</li>
<li>Не удаётся получить данные группы пользователя из таблицы <code class="prettyprint">TBL_GROUP</code>.</li>
<li>Не удаётся обновить дату последней активности пользователя в таблице <code class="prettyprint">TBL_USERS</code>.</li>
</ul>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\JsonException">JsonException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если произошла ошибка при работе с JSON.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\Exception">Exception</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается при выполнении запросов к СУБД.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Для указания таблиц базы данных используются константы:</p>
<ul>
<li><code class="prettyprint">TBL_USERS</code>: Таблица пользователей с их правами. Например: '<code class="prettyprint">users</code>'.</li>
<li><code class="prettyprint">TBL_GROUP</code>: Таблица групп пользователей с их правами. Например: '<code class="prettyprint">groups</code>'.
Поля <code class="prettyprint">user_rights</code> в данных пользователя и группы должны содержать валидный JSON. После обработки права
объединяются с данными пользователя.</li>
</ul>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Поля <code class="prettyprint">user_rights</code> в данных пользователя и группы обязательно должны содержать валидный JSON.
Невалидные данные могут привести к ошибкам.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#property_db"><abbr title="\PhotoRigma\Classes\User::$db">User::$db</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, содержащее объект для работы с базой данных.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#property_user"><abbr title="\PhotoRigma\Classes\User::$user">User::$user</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, содержащее данные текущего пользователя.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#property_session"><abbr title="\PhotoRigma\Classes\User::$session">User::$session</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, содержащее данные сессии.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__process_user_rights_internal"><abbr title="\PhotoRigma\Classes\User::_process_user_rights_internal()">User::_process_user_rights_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Метод для обработки прав пользователя/группы.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__merge_user_with_group"><abbr title="\PhotoRigma\Classes\User::_merge_user_with_group()">User::_merge_user_with_group()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Метод для объединения данных пользователя и группы.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__is_soft_delete_expired_internal"><abbr title="\PhotoRigma\Classes\User::_is_soft_delete_expired_internal()">User::_is_soft_delete_expired_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Метод для проверки истечения срока мягкого
удаления.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__initialize_user"><abbr title="\PhotoRigma\Classes\User::_initialize_user()">User::_initialize_user()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Метод для загрузки данных аутентифицированного
пользователя.</p>
</section>

                                    </dd>
                        </dl>

    

    
</article>
                    <article
        class="phpdocumentor-element
            -method
            -private
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method__load_guest_user">
        _load_guest_user()
        <a href="classes/PhotoRigma-Classes-User.html#method__load_guest_user" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/User.php"><a href="files/src-classes-user.html"><abbr title="src/Classes/User.php">User.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">403</span>

    </aside>

        <p class="phpdocumentor-summary">Метод загружает данные группы гостя из базы данных, обрабатывает права (`user_rights`) и сохраняет итоговые
данные в свойство `$user`.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">private</span>
                    <span class="phpdocumentor-signature__name">_load_guest_user</span><span>(</span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">void</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот метод выполняет следующие шаги:</p>
<ol>
<li>Выполняет запрос к базе данных для получения данных группы гостя с <code class="prettyprint">id = GROUP_GUEST</code>, используя константу
<code class="prettyprint">GROUP_GUEST</code> и константу <code class="prettyprint">TBL_GROUP</code> для указания таблицы.
<ul>
<li>Если запрос не выполнен или данные отсутствуют, выбрасывается исключение.</li>
</ul>
</li>
<li>Проверяет корректность полученных данных:
<ul>
<li>Данные должны быть массивом. Если данные некорректны, выбрасывается исключение.</li>
</ul>
</li>
<li>Удаляет поле <code class="prettyprint">user_rights</code> из данных группы гостя.</li>
<li>Обрабатывает поле <code class="prettyprint">user_rights</code> с помощью метода <code class="prettyprint">process_user_rights()</code>, преобразуя строку JSON в
ассоциативный массив.</li>
<li>Объединяет данные группы гостя с обработанными правами с помощью <code class="prettyprint">array_merge()</code>.</li>
<li>Сохраняет итоговые данные в свойство <code class="prettyprint">$user</code>.
Этот метод является приватным и предназначен только для использования внутри класса.</li>
</ol>
</section>

    
    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-User.html#method__load_guest_user#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">internal</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                             
                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\RuntimeException">RuntimeException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если:</p>
<ul>
<li>Не удаётся получить данные группы гостя из базы данных.</li>
</ul>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\UnexpectedValueException">UnexpectedValueException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если:</p>
<ul>
<li>Данные группы гостя некорректны (например, пустые или не являются массивом).</li>
</ul>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\JsonException">JsonException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если произошла ошибка при декодировании JSON.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\Exception">Exception</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается при выполнении запросов к СУБД.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Для указания таблицы базы данных используется константа <code class="prettyprint">TBL_GROUP</code>. Например: '<code class="prettyprint">groups</code>'.
Константа <code class="prettyprint">GROUP_GUEST</code> содержит ID группы гостей.
Поле <code class="prettyprint">user_rights</code> должно содержать валидный JSON. После обработки права объединяются с данными группы.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Поле <code class="prettyprint">user_rights</code> обязательно должно содержать валидный JSON. Невалидные данные могут привести к
ошибкам.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#property_user"><abbr title="\PhotoRigma\Classes\User::$user">User::$user</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, содержащее данные текущего пользователя.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#property_db"><abbr title="\PhotoRigma\Classes\User::$db">User::$db</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, содержащее объект для работы с базой данных.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__process_user_rights_internal"><abbr title="\PhotoRigma\Classes\User::_process_user_rights_internal()">User::_process_user_rights_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Метод для обработки прав пользователя.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__initialize_user"><abbr title="\PhotoRigma\Classes\User::_initialize_user()">User::_initialize_user()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Метод для загрузки данных гостя.</p>
</section>

                                    </dd>
                        </dl>

    

    
</article>
                    <article
        class="phpdocumentor-element
            -method
            -private
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method__merge_user_with_group">
        _merge_user_with_group()
        <a href="classes/PhotoRigma-Classes-User.html#method__merge_user_with_group" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/User.php"><a href="files/src-classes-user.html"><abbr title="src/Classes/User.php">User.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">603</span>

    </aside>

        <p class="phpdocumentor-summary">Метод объединяет данные пользователя с данными его группы, применяя логику перезаписи значений, и изменяет
свойство `$user` класса.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">private</span>
                    <span class="phpdocumentor-signature__name">_merge_user_with_group</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$group_data</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">void</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот метод выполняет следующие шаги:</p>
<ol>
<li>Проходит по массиву данных группы (<code class="prettyprint">$group_data</code>) и объединяет их с данными пользователя (<code class="prettyprint">$user</code>) согласно
следующей логике:
<ul>
<li>Ключ <code class="prettyprint">name</code>: Значение сохраняется в <code class="prettyprint">$user['group_name']</code>.</li>
<li>Ключ <code class="prettyprint">id</code>: Игнорируется.</li>
<li>Для всех остальных ключей:
<ul>
<li>Если ключ существует в <code class="prettyprint">$user</code>:
<ul>
<li>Если оба значения равны <code class="prettyprint">false</code>, сохраняется <code class="prettyprint">false</code>.</li>
<li>Иначе сохраняется <code class="prettyprint">true</code>.</li>
</ul>
</li>
<li>Если ключ отсутствует в <code class="prettyprint">$user</code>, значение берётся из <code class="prettyprint">$group_data</code>.</li>
</ul>
</li>
</ul>
</li>
<li>Для обработки ключей используется оператор <code class="prettyprint">match</code>.
Этот метод является приватным и предназначен только для использования внутри класса.</li>
</ol>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$group_data</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Ассоциативный массив, содержащий данные группы пользователя.
Ключи должны соответствовать полям в таблице групп.</p>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-User.html#method__merge_user_with_group#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">internal</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                             
                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Ключ <code class="prettyprint">id</code> в данных группы игнорируется.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Метод предполагает, что структура данных группы совпадает с ожидаемой. Неправильная структура может
привести к ошибкам.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#property_user"><abbr title="\PhotoRigma\Classes\User::$user">User::$user</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, содержащее данные текущего пользователя.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__load_authenticated_user"><abbr title="\PhotoRigma\Classes\User::_load_authenticated_user()">User::_load_authenticated_user()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Метод для объединения данных пользователя и группы.</p>
</section>

                                    </dd>
                        </dl>

    

    
</article>
                    <article
        class="phpdocumentor-element
            -method
            -private
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method__soft_delete">
        _soft_delete()
        <a href="classes/PhotoRigma-Classes-User.html#method__soft_delete" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/User.php"><a href="files/src-classes-user.html"><abbr title="src/Classes/User.php">User.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">2816</span>

    </aside>

        <p class="phpdocumentor-summary">Выполняет мягкое удаление пользователя.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">private</span>
                    <span class="phpdocumentor-signature__name">_soft_delete</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">int&nbsp;</span><span class="phpdocumentor-signature__argument__name">$user_id</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">bool</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Метод устанавливает дату удаления (<code class="prettyprint">deleted_at</code>) для указанного пользователя.
Если пользователь уже помечен как окончательно удалённый (<code class="prettyprint">permanently_deleted = TRUE</code>), мягкое удаление не
выполняется. Все действия логируются.</p>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$user_id</span>
                : <span class="phpdocumentor-signature__argument__return-type">int</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>ID пользователя, которого нужно мягко удалить</p>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-User.html#method__soft_delete#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">internal</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                             
                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\Exception">Exception</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если произошла ошибка на уровне БД</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Этот метод должен вызываться только через <code class="prettyprint">_delete_user_internal()</code>, чтобы соблюсти все проверки.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-User.html#method__delete_user_internal"><abbr title="\PhotoRigma\Classes\User::_delete_user_internal()">User::_delete_user_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Метод для выполнения мягкого удаления.</p>
</section>

                                    </dd>
                                            </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">bool</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>TRUE при успехе, FALSE при ошибке или невозможности удаления</p>
</section>

            </section>

</article>
            </section>

        <div class="phpdocumentor-modal" id="source-view">
    <div class="phpdocumentor-modal-bg" data-exit-button></div>
    <div class="phpdocumentor-modal-container">
        <div class="phpdocumentor-modal-content">
            <pre style="max-height: 500px; overflow-y: scroll" data-src="files/src/Classes/User.php.txt" class="language-php line-numbers linkable-line-numbers"></pre>
        </div>
        <button data-exit-button class="phpdocumentor-modal__close">&times;</button>
    </div>
</div>

    <script type="text/javascript">
        (function () {
            function loadExternalCodeSnippet(el, url, line) {
                Array.prototype.slice.call(el.querySelectorAll('pre[data-src]')).forEach((pre) => {
                    const src = url || pre.getAttribute('data-src').replace(/\\/g, '/');
                    const language = 'php';

                    const code = document.createElement('code');
                    code.className = 'language-' + language;
                    pre.textContent = '';
                    pre.setAttribute('data-line', line)
                    code.textContent = 'Loading…';
                    pre.appendChild(code);

                    var xhr = new XMLHttpRequest();

                    xhr.open('GET', src, true);

                    xhr.onreadystatechange = function () {
                        if (xhr.readyState !== 4) {
                            return;
                        }

                        if (xhr.status < 400 && xhr.responseText) {
                            code.textContent = xhr.responseText;
                            Prism.highlightElement(code);
                            return;
                        }

                        if (xhr.status === 404) {
                            code.textContent = '✖ Error: File could not be found';
                            return;
                        }

                        if (xhr.status >= 400) {
                            code.textContent = '✖ Error ' + xhr.status + ' while fetching file: ' + xhr.statusText;
                            return;
                        }

                        code.textContent = '✖ Error: An unknown error occurred';
                    };

                    xhr.send(null);
                });
            }

            const modalButtons = document.querySelectorAll("[data-modal]");
            const openedAsLocalFile = window.location.protocol === 'file:';
            if (modalButtons.length > 0 && openedAsLocalFile) {
                console.warn(
                    'Viewing the source code is unavailable because you are opening this page from the file:// scheme; ' +
                    'browsers block XHR requests when a page is opened this way'
                );
            }

            modalButtons.forEach(function (trigger) {
                if (openedAsLocalFile) {
                    trigger.setAttribute("hidden", "hidden");
                }

                trigger.addEventListener("click", function (event) {
                    event.preventDefault();
                    const modal = document.getElementById(trigger.dataset.modal);
                    if (!modal) {
                        console.error(`Modal with id "${trigger.dataset.modal}" could not be found`);
                        return;
                    }
                    modal.classList.add("phpdocumentor-modal__open");

                    loadExternalCodeSnippet(modal, trigger.dataset.src || null, trigger.dataset.line)
                    const exits = modal.querySelectorAll("[data-exit-button]");
                    exits.forEach(function (exit) {
                        exit.addEventListener("click", function (event) {
                            event.preventDefault();
                            modal.classList.remove("phpdocumentor-modal__open");
                        });
                    });
                });
            });
        })();
    </script>

    </article>
                                </section>
                <section class="phpdocumentor-on-this-page__sidebar">
                                
    <section class="phpdocumentor-on-this-page__content">
        <strong class="phpdocumentor-on-this-page__title">On this page</strong>

        <ul class="phpdocumentor-list -clean">
            <li class="phpdocumentor-on-this-page-section__title">Table Of Contents</li>
            <li>
                <ul class="phpdocumentor-list -clean">
                                                            <li><a href="classes/PhotoRigma-Classes-User.html#toc-properties">Properties</a></li>
                                                            <li><a href="classes/PhotoRigma-Classes-User.html#toc-methods">Methods</a></li>
                                    </ul>
            </li>
            
                            <li class="phpdocumentor-on-this-page-section__title">Properties</li>
                <li>
                    <ul class="phpdocumentor-list -clean">
                                                    <li class=""><a href="classes/PhotoRigma-Classes-User.html#property_session">$session</a></li>
                                                    <li class=""><a href="classes/PhotoRigma-Classes-User.html#property_user">$user</a></li>
                                                    <li class=""><a href="classes/PhotoRigma-Classes-User.html#property_user_right_fields">$user_right_fields</a></li>
                                                    <li class=""><a href="classes/PhotoRigma-Classes-User.html#property_db">$db</a></li>
                                                    <li class=""><a href="classes/PhotoRigma-Classes-User.html#property_session">$session</a></li>
                                                    <li class=""><a href="classes/PhotoRigma-Classes-User.html#property_user">$user</a></li>
                                                    <li class=""><a href="classes/PhotoRigma-Classes-User.html#property_user_right_fields">$user_right_fields</a></li>
                                                    <li class=""><a href="classes/PhotoRigma-Classes-User.html#property_work">$work</a></li>
                                            </ul>
                </li>
            
                        <li class="phpdocumentor-on-this-page-section__title">Methods</li>
            <li>
                <ul class="phpdocumentor-list -clean">
                                            <li class=""><a href="classes/PhotoRigma-Classes-User.html#method___construct">__construct()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-User.html#method___get">__get()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-User.html#method___isset">__isset()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-User.html#method___set">__set()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-User.html#method_add_new_group">add_new_group()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-User.html#method_add_new_user">add_new_user()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-User.html#method_cron_user_delete">cron_user_delete()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-User.html#method_csrf_token">csrf_token()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-User.html#method_delete_group">delete_group()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-User.html#method_delete_user">delete_user()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-User.html#method_encode_user_rights">encode_user_rights()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-User.html#method_hard_delete_user">hard_delete_user()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-User.html#method_is_soft_delete_expired">is_soft_delete_expired()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-User.html#method_login_user">login_user()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-User.html#method_process_user_rights">process_user_rights()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-User.html#method_set_property_key">set_property_key()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-User.html#method_set_work">set_work()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-User.html#method_unset_property_key">unset_property_key()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-User.html#method_update_group_data">update_group_data()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-User.html#method_update_user_data">update_user_data()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-User.html#method_update_user_rights">update_user_rights()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-User.html#method__add_new_group_internal">_add_new_group_internal()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-User.html#method__add_new_user_internal">_add_new_user_internal()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-User.html#method__cron_user_delete_internal">_cron_user_delete_internal()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-User.html#method__csrf_token_internal">_csrf_token_internal()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-User.html#method__delete_group_internal">_delete_group_internal()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-User.html#method__delete_user_internal">_delete_user_internal()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-User.html#method__encode_user_rights_internal">_encode_user_rights_internal()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-User.html#method__hard_delete_user_internal">_hard_delete_user_internal()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-User.html#method__is_soft_delete_expired_internal">_is_soft_delete_expired_internal()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-User.html#method__login_user_internal">_login_user_internal()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-User.html#method__process_user_rights_internal">_process_user_rights_internal()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-User.html#method__set_property_key_internal">_set_property_key_internal()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-User.html#method__set_work_internal">_set_work_internal()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-User.html#method__unset_property_key_internal">_unset_property_key_internal()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-User.html#method__update_group_data_internal">_update_group_data_internal()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-User.html#method__update_user_data_internal">_update_user_data_internal()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-User.html#method__update_user_rights_internal">_update_user_rights_internal()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-User.html#method__all_right_fields">_all_right_fields()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-User.html#method__delete_personal_content">_delete_personal_content()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-User.html#method__edit_avatar">_edit_avatar()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-User.html#method__initialize_user">_initialize_user()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-User.html#method__load_authenticated_user">_load_authenticated_user()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-User.html#method__load_guest_user">_load_guest_user()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-User.html#method__merge_user_with_group">_merge_user_with_group()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-User.html#method__soft_delete">_soft_delete()</a></li>
                                    </ul>
            </li>
                    </ul>
    </section>

                </section>
                            </div>
            <section data-search-results class="phpdocumentor-search-results phpdocumentor-search-results--hidden">
    <section class="phpdocumentor-search-results__dialog">
        <header class="phpdocumentor-search-results__header">
            <h2 class="phpdocumentor-search-results__title">Search results</h2>
            <button class="phpdocumentor-search-results__close"><i class="fas fa-times"></i></button>
        </header>
        <section class="phpdocumentor-search-results__body">
            <ul class="phpdocumentor-search-results__entries"></ul>
        </section>
    </section>
</section>
        </div>
        <a href="classes/PhotoRigma-Classes-User.html#top" class="phpdocumentor-back-to-top"><i class="fas fa-chevron-circle-up"></i></a>

    </main>

    <script>
        cssVars({});
    </script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/prism.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/line-highlight/prism-line-highlight.min.js"></script>
</body>
</html>
