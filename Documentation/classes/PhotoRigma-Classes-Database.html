<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
            <title>Photo-Rigma-BiZ</title>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <base href="../">
    <link rel="icon" href="images/favicon.ico"/>
    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/base.css">
            <link rel="preconnect" href="https://fonts.gstatic.com">
        <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@100;200;300;400;600;700&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:wght@400;600;700&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="css/template.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0/css/all.min.css" integrity="sha256-ybRkN9dBjhcS2qrW1z+hfCxq+1aBdwyQM5wlQoQVt/0=" crossorigin="anonymous" />
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/themes/prism-okaidia.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/line-numbers/prism-line-numbers.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/line-highlight/prism-line-highlight.css">
                <script src="https://cdn.jsdelivr.net/npm/fuse.js@3.4.6"></script>
        <script src="https://cdn.jsdelivr.net/npm/css-vars-ponyfill@2"></script>
        <script src="js/template.js"></script>
        <script src="js/search.js"></script>
        <script defer src="js/searchIndex.js"></script>
    </head>
<body id="top">
    <header class="phpdocumentor-header phpdocumentor-section">
    <h1 class="phpdocumentor-title"><a href="" class="phpdocumentor-title__link">Photo-Rigma-BiZ</a></h1>
    <input class="phpdocumentor-header__menu-button" type="checkbox" id="menu-button" name="menu-button" />
    <label class="phpdocumentor-header__menu-icon" for="menu-button">
        <i class="fas fa-bars"></i>
    </label>
    <section data-search-form class="phpdocumentor-search">
    <label>
        <span class="visually-hidden">Search for</span>
        <svg class="phpdocumentor-search__icon" width="21" height="20" viewBox="0 0 21 20" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="7.5" cy="7.5" r="6.5" stroke="currentColor" stroke-width="2"/>
            <line x1="12.4892" y1="12.2727" x2="19.1559" y2="18.9393" stroke="currentColor" stroke-width="3"/>
        </svg>
        <input type="search" class="phpdocumentor-field phpdocumentor-search__field" placeholder="Loading .." disabled />
    </label>
</section>

    <nav class="phpdocumentor-topnav">
    <ul class="phpdocumentor-topnav__menu">
        </ul>
</nav>
</header>

    <main class="phpdocumentor">
        <div class="phpdocumentor-section">
            <input class="phpdocumentor-sidebar__menu-button" type="checkbox" id="sidebar-button" name="sidebar-button" />
<label class="phpdocumentor-sidebar__menu-icon" for="sidebar-button">
    Menu
</label>
<aside class="phpdocumentor-column -three phpdocumentor-sidebar">
                    <section class="phpdocumentor-sidebar__category -namespaces">
            <h2 class="phpdocumentor-sidebar__category-header">Namespaces</h2>
                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="namespaces/photorigma.html" class="">PhotoRigma</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="namespaces/photorigma-classes.html" class="">Classes</a>
                
            </li>
                    <li>
                <a href="namespaces/photorigma-include.html" class="">Include</a>
                
            </li>
                    <li>
                <a href="namespaces/photorigma-interfaces.html" class="">Interfaces</a>
                
            </li>
            </ul>

                        </section>
                <section class="phpdocumentor-sidebar__category -packages">
            <h2 class="phpdocumentor-sidebar__category-header">Packages</h2>
                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="packages/PhotoRigma.html" class="">PhotoRigma</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="packages/PhotoRigma-Action.html" class="">Action</a>
                
            </li>
                    <li>
                <a href="packages/PhotoRigma-Language.html" class="">Language</a>
                
            </li>
            </ul>

                        </section>
            
    <section class="phpdocumentor-sidebar__category -reports">
        <h2 class="phpdocumentor-sidebar__category-header">Reports</h2>
                <h3 class="phpdocumentor-sidebar__root-package"><a href="reports/deprecated.html">Deprecated</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="reports/errors.html">Errors</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="reports/markers.html">Markers</a></h3>
    </section>

    <section class="phpdocumentor-sidebar__category -indices">
        <h2 class="phpdocumentor-sidebar__category-header">Indices</h2>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="indices/files.html">Files</a></h3>
    </section>
</aside>

            <div class="phpdocumentor-column -nine phpdocumentor-content">
                                <section>
                                        <ul class="phpdocumentor-breadcrumbs">
            <li class="phpdocumentor-breadcrumb"><a href="namespaces/photorigma.html">PhotoRigma</a></li>
            <li class="phpdocumentor-breadcrumb"><a href="namespaces/photorigma-classes.html">Classes</a></li>
    </ul>

    <article class="phpdocumentor-element -class">
        <h2 class="phpdocumentor-content__title">
    Database

    
            <div class="phpdocumentor-element__package">
            in package
            <ul class="phpdocumentor-breadcrumbs">
                                    <li class="phpdocumentor-breadcrumb"><a href="packages/PhotoRigma.html">PhotoRigma</a></li>
                            </ul>
        </div>
    
            <span class="phpdocumentor-element__implements">
            implements
                            <a href="classes/PhotoRigma-Interfaces-Database-Interface.html"><abbr title="\PhotoRigma\Interfaces\Database_Interface">Database_Interface</abbr></a>                    </span>
    
    </h2>

<div class="phpdocumentor-label-line">


</div>

        <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/Database.php"><a href="files/src-classes-database.html"><abbr title="src/Classes/Database.php">Database.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">108</span>

    </aside>

            <p class="phpdocumentor-summary">Класс для работы с базами данных через PDO.</p>


    <section class="phpdocumentor-description"><p>Этот класс предоставляет полный спектр функционала для эффективной и безопасной работы с реляционными базами
данных, поддерживая следующие СУБД: MySQL (включая MariaDB), PostgreSQL и SQLite. Основные возможности класса
включают:</p>
<ul>
<li>Безопасное и гибкое выполнение стандартных операций с данными (SELECT, INSERT, UPDATE, DELETE, TRUNCATE, JOIN) с
использованием подготовленных выражений и структурированных опций запроса. Поддерживается построение сложных
условий WHERE с использованием операторов <code class="prettyprint">OR</code> и <code class="prettyprint">NOT</code> через удобный массивный синтаксис.</li>
<li>Реализацию <strong>полнотекстового поиска (Full-Text Search - FTS)</strong>, специфичного для каждой поддерживаемой СУБД
(MySQL/MariaDB FTS, PostgreSQL FTS/<code class="prettyprint">tsvector</code>/<code class="prettyprint">tsquery</code>, SQLite FTS5). Включает обработку минимальной длины
строки поиска, кеширование ошибок FTS-индексов и автоматический переход (fallback) на альтернативные методы
поиска (<code class="prettyprint">LIKE</code>, <code class="prettyprint">ILIKE</code> с <code class="prettyprint">similarity()</code> для PostgreSQL) в случае недоступности или ошибок FTS.</li>
<li>Получение метаданных выполненных запросов (например, количество затронутых строк (<code class="prettyprint">$aff_rows</code>) или ID последней вставленной записи (<code class="prettyprint">$insert_id</code>)).</li>
<li>Форматирование дат и времени в SQL-запросах с автоматическим преобразованием форматов (<code class="prettyprint">DATE_FORMAT</code> для MySQL,
<code class="prettyprint">TO_CHAR</code> для PostgreSQL, <code class="prettyprint">strftime</code> для SQLite) на основе текущей или временно установленной СУБД.</li>
<li>Управление транзакциями (начало, фиксация, откат).</li>
<li>Временное изменение формата SQL-синтаксиса (например, экранирования идентификаторов, форматов даты) для
выполнения запросов в контексте другой СУБД (<code class="prettyprint">with_sql_format()</code>), что позволяет использовать один экземпляр для
взаимодействия с разными типами БД без переподключения.</li>
<li>Долгосрочное кеширование внутренних оптимизационных данных (кешей форматов, запросов, снятия экранирования)
через интегрированный объект, реализующий <code class="prettyprint">Cache_Handler_Interface</code>.
Все ошибки, возникающие на уровне работы с базой данных или при обработке запросов, обрабатываются через
исключения (<code class="prettyprint">PDOException</code>, <code class="prettyprint">InvalidArgumentException</code>, <code class="prettyprint">Exception</code> и др.).</li>
</ul>
</section>


    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-Database.html#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Interfaces-Database-Interface.html"><abbr title="\PhotoRigma\Interfaces\Database_Interface">Database_Interface</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Интерфейс, который реализует класс.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Interfaces-Cache-Handler-Interface.html"><abbr title="\PhotoRigma\Interfaces\Cache_Handler_Interface">Cache_Handler_Interface</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Интерфейс обработчика кеша, используемый классом.</p>
</section>

                                    </dd>
                        </dl>





<h3 id="toc">
    Table of Contents
    <a href="classes/PhotoRigma-Classes-Database.html#toc" class="headerlink"><i class="fas fa-link"></i></a>

</h3>



    <h4 id="toc-interfaces">
        Interfaces
        <a href="classes/PhotoRigma-Classes-Database.html#toc-interfaces" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <dl class="phpdocumentor-table-of-contents">
                    <dt class="phpdocumentor-table-of-contents__entry -interface"><a href="classes/PhotoRigma-Interfaces-Database-Interface.html"><abbr title="\PhotoRigma\Interfaces\Database_Interface">Database_Interface</abbr></a></dt><dd>Интерфейс для работы с базами данных через PDO.</dd>    </dl>






<h4 id="toc-properties">
    Properties
    <a href="classes/PhotoRigma-Classes-Database.html#toc-properties" class="headerlink"><i class="fas fa-link"></i></a>

</h4>
<dl class="phpdocumentor-table-of-contents">
            <dt class="phpdocumentor-table-of-contents__entry -property -private">
    <a class="" href="classes/PhotoRigma-Classes-Database.html#property_aff_rows">$aff_rows</a>
    <span>
                        &nbsp;: int            </span>
</dt>

            <dt class="phpdocumentor-table-of-contents__entry -property -private">
    <a class="" href="classes/PhotoRigma-Classes-Database.html#property_allowed_formats">$allowed_formats</a>
    <span>
                        &nbsp;: array&lt;string|int, mixed&gt;|array&lt;string|int, string&gt;            </span>
</dt>

            <dt class="phpdocumentor-table-of-contents__entry -property -private">
    <a class="" href="classes/PhotoRigma-Classes-Database.html#property_cache">$cache</a>
    <span>
                        &nbsp;: <a href="classes/PhotoRigma-Interfaces-Cache-Handler-Interface.html"><abbr title="\PhotoRigma\Interfaces\Cache_Handler_Interface">Cache_Handler_Interface</abbr></a>            </span>
</dt>

            <dt class="phpdocumentor-table-of-contents__entry -property -private">
    <a class="" href="classes/PhotoRigma-Classes-Database.html#property_current_format">$current_format</a>
    <span>
                        &nbsp;: string            </span>
</dt>

            <dt class="phpdocumentor-table-of-contents__entry -property -private">
    <a class="" href="classes/PhotoRigma-Classes-Database.html#property_db_name">$db_name</a>
    <span>
                        &nbsp;: string            </span>
</dt>

            <dt class="phpdocumentor-table-of-contents__entry -property -private">
    <a class="" href="classes/PhotoRigma-Classes-Database.html#property_db_type">$db_type</a>
    <span>
                        &nbsp;: string            </span>
</dt>

            <dt class="phpdocumentor-table-of-contents__entry -property -private">
    <a class="" href="classes/PhotoRigma-Classes-Database.html#property_format_cache">$format_cache</a>
    <span>
                        &nbsp;: array&lt;string|int, mixed&gt;            </span>
</dt>

            <dt class="phpdocumentor-table-of-contents__entry -property -private">
    <a class="" href="classes/PhotoRigma-Classes-Database.html#property_insert_id">$insert_id</a>
    <span>
                        &nbsp;: int            </span>
</dt>

            <dt class="phpdocumentor-table-of-contents__entry -property -private">
    <a class="" href="classes/PhotoRigma-Classes-Database.html#property_pdo">$pdo</a>
    <span>
                        &nbsp;: <abbr title="\PDO">PDO</abbr>|null            </span>
</dt>

            <dt class="phpdocumentor-table-of-contents__entry -property -private">
    <a class="" href="classes/PhotoRigma-Classes-Database.html#property_query_cache">$query_cache</a>
    <span>
                        &nbsp;: array&lt;string|int, mixed&gt;            </span>
</dt>

            <dt class="phpdocumentor-table-of-contents__entry -property -private">
    <a class="" href="classes/PhotoRigma-Classes-Database.html#property_res_query">$res_query</a>
    <span>
                        &nbsp;: object|null            </span>
</dt>

            <dt class="phpdocumentor-table-of-contents__entry -property -private">
    <a class="" href="classes/PhotoRigma-Classes-Database.html#property_txt_query">$txt_query</a>
    <span>
                        &nbsp;: string|null            </span>
</dt>

            <dt class="phpdocumentor-table-of-contents__entry -property -private">
    <a class="" href="classes/PhotoRigma-Classes-Database.html#property_unescape_cache">$unescape_cache</a>
    <span>
                        &nbsp;: array&lt;string|int, mixed&gt;            </span>
</dt>

    </dl>

<h4 id="toc-methods">
    Methods
    <a href="classes/PhotoRigma-Classes-Database.html#toc-methods" class="headerlink"><i class="fas fa-link"></i></a>

</h4>
<dl class="phpdocumentor-table-of-contents">
            <dt class="phpdocumentor-table-of-contents__entry -method -public">
    <a class="" href="classes/PhotoRigma-Classes-Database.html#method___construct">__construct()</a>
    <span>
                                &nbsp;: mixed    </span>
</dt>
<dd>Конструктор класса.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -public">
    <a class="" href="classes/PhotoRigma-Classes-Database.html#method___destruct">__destruct()</a>
    <span>
                                &nbsp;: mixed    </span>
</dt>
<dd>Деструктор класса Database.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -public">
    <a class="" href="classes/PhotoRigma-Classes-Database.html#method_begin_transaction">begin_transaction()</a>
    <span>
                                &nbsp;: void    </span>
</dt>
<dd>Начинает транзакцию в базе данных.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -public">
    <a class="" href="classes/PhotoRigma-Classes-Database.html#method_commit_transaction">commit_transaction()</a>
    <span>
                                &nbsp;: void    </span>
</dt>
<dd>Подтверждает транзакцию в базе данных.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -public">
    <a class="" href="classes/PhotoRigma-Classes-Database.html#method_delete">delete()</a>
    <span>
                                &nbsp;: bool    </span>
</dt>
<dd>Удаляет данные из таблицы через вызов внутреннего метода.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -public">
    <a class="" href="classes/PhotoRigma-Classes-Database.html#method_format_date">format_date()</a>
    <span>
                                &nbsp;: string    </span>
</dt>
<dd>Формирует SQL-выражение для форматирования даты с учетом специфики используемой СУБД.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -public">
    <a class="" href="classes/PhotoRigma-Classes-Database.html#method_full_text_search">full_text_search()</a>
    <span>
                                &nbsp;: array&lt;string|int, mixed&gt;|false    </span>
</dt>
<dd>Выполняет полнотекстовый поиск в указанной таблице.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -public">
    <a class="" href="classes/PhotoRigma-Classes-Database.html#method_get_affected_rows">get_affected_rows()</a>
    <span>
                                &nbsp;: int    </span>
</dt>
<dd>Возвращает количество строк, затронутых последним SQL-запросом.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -public">
    <a class="" href="classes/PhotoRigma-Classes-Database.html#method_get_last_insert_id">get_last_insert_id()</a>
    <span>
                                &nbsp;: int    </span>
</dt>
<dd>Возвращает ID последней вставленной строки.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -public">
    <a class="" href="classes/PhotoRigma-Classes-Database.html#method_insert">insert()</a>
    <span>
                                &nbsp;: bool    </span>
</dt>
<dd>Вставляет данные в таблицу через вызов внутреннего метода.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -public">
    <a class="" href="classes/PhotoRigma-Classes-Database.html#method_join">join()</a>
    <span>
                                &nbsp;: bool    </span>
</dt>
<dd>Выполняет SQL-запрос с использованием JOIN через вызов внутреннего метода.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -public">
    <a class="" href="classes/PhotoRigma-Classes-Database.html#method_result_array">result_array()</a>
    <span>
                                &nbsp;: array&lt;string|int, mixed&gt;|false    </span>
</dt>
<dd>Извлекает все строки результата из подготовленного выражения.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -public">
    <a class="" href="classes/PhotoRigma-Classes-Database.html#method_result_row">result_row()</a>
    <span>
                                &nbsp;: array&lt;string|int, mixed&gt;|false    </span>
</dt>
<dd>Извлекает одну строку результата из подготовленного выражения.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -public">
    <a class="" href="classes/PhotoRigma-Classes-Database.html#method_rollback_transaction">rollback_transaction()</a>
    <span>
                                &nbsp;: void    </span>
</dt>
<dd>Отменяет транзакцию в базе данных.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -public">
    <a class="" href="classes/PhotoRigma-Classes-Database.html#method_select">select()</a>
    <span>
                                &nbsp;: bool    </span>
</dt>
<dd>Выполняет SQL-запрос на выборку данных из таблицы.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -public">
    <a class="" href="classes/PhotoRigma-Classes-Database.html#method_truncate">truncate()</a>
    <span>
                                &nbsp;: bool    </span>
</dt>
<dd>Очищает таблицу (TRUNCATE) через вызов внутреннего метода.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -public">
    <a class="" href="classes/PhotoRigma-Classes-Database.html#method_update">update()</a>
    <span>
                                &nbsp;: bool    </span>
</dt>
<dd>Обновляет данные в таблице через вызов внутреннего метода.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -public">
    <a class="" href="classes/PhotoRigma-Classes-Database.html#method_with_sql_format">with_sql_format()</a>
    <span>
                                &nbsp;: mixed    </span>
</dt>
<dd>Временно изменяет формат SQL для выполнения запросов.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -protected">
    <a class="" href="classes/PhotoRigma-Classes-Database.html#method__begin_transaction_internal">_begin_transaction_internal()</a>
    <span>
                                &nbsp;: void    </span>
</dt>
<dd>Начинает транзакцию в базе данных и записывает лог с указанием контекста.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -protected">
    <a class="" href="classes/PhotoRigma-Classes-Database.html#method__commit_transaction_internal">_commit_transaction_internal()</a>
    <span>
                                &nbsp;: void    </span>
</dt>
<dd>Подтверждает транзакцию в базе данных и записывает лог с указанием контекста.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -protected">
    <a class="" href="classes/PhotoRigma-Classes-Database.html#method__delete_internal">_delete_internal()</a>
    <span>
                                &nbsp;: bool    </span>
</dt>
<dd>Формирует SQL-запрос на удаление данных из таблицы, проверяет входные данные, обрабатывает недопустимые
ключи, сохраняет текст запроса в свойстве `$txt_query` и выполняет его.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -protected">
    <a class="" href="classes/PhotoRigma-Classes-Database.html#method__format_date_internal">_format_date_internal()</a>
    <span>
                                &nbsp;: string    </span>
</dt>
<dd>Формирует SQL-выражение для форматирования даты с учетом специфики используемой СУБД.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -protected">
    <a class="" href="classes/PhotoRigma-Classes-Database.html#method__full_text_search_internal">_full_text_search_internal()</a>
    <span>
                                &nbsp;: array&lt;string|int, mixed&gt;|false    </span>
</dt>
<dd>Выполняет полнотекстовый поиск в указанной таблице по заданным столбцам.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -protected">
    <a class="" href="classes/PhotoRigma-Classes-Database.html#method__get_affected_rows_internal">_get_affected_rows_internal()</a>
    <span>
                                &nbsp;: int    </span>
</dt>
<dd>Возвращает количество строк, затронутых последним SQL-запросом, после проверки состояния свойства `$aff_rows`.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -protected">
    <a class="" href="classes/PhotoRigma-Classes-Database.html#method__get_last_insert_id_internal">_get_last_insert_id_internal()</a>
    <span>
                                &nbsp;: int    </span>
</dt>
<dd>Возвращает ID последней вставленной строки после проверки состояния свойства `$insert_id`.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -protected">
    <a class="" href="classes/PhotoRigma-Classes-Database.html#method__insert_internal">_insert_internal()</a>
    <span>
                                &nbsp;: bool    </span>
</dt>
<dd>Формирует SQL-запрос на вставку данных в таблицу, проверяет входные данные, обрабатывает различные типы
запросов, сохраняет текст запроса в свойстве `$txt_query` и выполняет его.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -protected">
    <a class="" href="classes/PhotoRigma-Classes-Database.html#method__join_internal">_join_internal()</a>
    <span>
                                &nbsp;: bool    </span>
</dt>
<dd>Формирует SQL-запрос с использованием JOIN для выборки данных из нескольких таблиц, проверяет входные данные,
сохраняет текст запроса в свойстве `$txt_query` и выполняет его.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -protected">
    <a class="" href="classes/PhotoRigma-Classes-Database.html#method__result_array_internal">_result_array_internal()</a>
    <span>
                                &nbsp;: array&lt;string|int, mixed&gt;|false    </span>
</dt>
<dd>Извлекает все строки результата из подготовленного выражения, хранящегося в свойстве `$res_query`, и
возвращает их как массив.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -protected">
    <a class="" href="classes/PhotoRigma-Classes-Database.html#method__result_row_internal">_result_row_internal()</a>
    <span>
                                &nbsp;: array&lt;string|int, mixed&gt;|false    </span>
</dt>
<dd>Извлекает одну строку результата из подготовленного выражения, хранящегося в свойстве `$res_query`.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -protected">
    <a class="" href="classes/PhotoRigma-Classes-Database.html#method__rollback_transaction_internal">_rollback_transaction_internal()</a>
    <span>
                                &nbsp;: void    </span>
</dt>
<dd>Отменяет транзакцию в базе данных.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -protected">
    <a class="" href="classes/PhotoRigma-Classes-Database.html#method__select_internal">_select_internal()</a>
    <span>
                                &nbsp;: bool    </span>
</dt>
<dd>Формирует SQL-запрос на выборку данных из таблицы, основываясь на полученных аргументах, размещает его в
свойстве `$txt_query` и выполняет.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -protected">
    <a class="" href="classes/PhotoRigma-Classes-Database.html#method__truncate_internal">_truncate_internal()</a>
    <span>
                                &nbsp;: bool    </span>
</dt>
<dd>Формирует SQL-запрос на очистку таблицы (TRUNCATE), размещает его в свойстве `$txt_query` и выполняет.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -protected">
    <a class="" href="classes/PhotoRigma-Classes-Database.html#method__update_internal">_update_internal()</a>
    <span>
                                &nbsp;: bool    </span>
</dt>
<dd>Формирует SQL-запрос на обновление данных в таблице, основываясь на полученных аргументах, размещает его в
свойстве `$txt_query` и выполняет.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -protected">
    <a class="" href="classes/PhotoRigma-Classes-Database.html#method__with_sql_format_internal">_with_sql_format_internal()</a>
    <span>
                                &nbsp;: mixed    </span>
</dt>
<dd>Метод временно изменяет формат SQL для выполнения запросов в указанном контексте.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -private">
    <a class="" href="classes/PhotoRigma-Classes-Database.html#method__build_conditions">_build_conditions()</a>
    <span>
                                &nbsp;: array&lt;string|int, mixed&gt;    </span>
</dt>
<dd>Формирует строку дополнений для SQL-запроса (например, WHERE, GROUP BY, ORDER BY, LIMIT).</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -private">
    <a class="" href="classes/PhotoRigma-Classes-Database.html#method__build_where_group">_build_where_group()</a>
    <span>
                                &nbsp;: string    </span>
</dt>
<dd>Формирует группу условий для WHERE с указанным оператором (OR/NOT).</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -private">
    <a class="" href="classes/PhotoRigma-Classes-Database.html#method__convert_from_mysql_to">_convert_from_mysql_to()</a>
    <span>
                                &nbsp;: void    </span>
</dt>
<dd>Производит преобразование SQL-запроса из формата MySQL в целевой формат СУБД (PostgreSQL или SQLite).</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -private">
    <a class="" href="classes/PhotoRigma-Classes-Database.html#method__convert_from_pgsql_to">_convert_from_pgsql_to()</a>
    <span>
                                &nbsp;: void    </span>
</dt>
<dd>Производит преобразование SQL-запроса из формата PostgreSQL в целевой формат СУБД (MySQL или SQLite).</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -private">
    <a class="" href="classes/PhotoRigma-Classes-Database.html#method__convert_from_sqlite_to">_convert_from_sqlite_to()</a>
    <span>
                                &nbsp;: void    </span>
</dt>
<dd>Производит преобразование SQL-запроса из формата SQLite в целевой формат СУБД (MySQL или PostgreSQL).</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -private">
    <a class="" href="classes/PhotoRigma-Classes-Database.html#method__convert_query">_convert_query()</a>
    <span>
                                &nbsp;: void    </span>
</dt>
<dd>Выполняет преобразование SQL-запроса в зависимости от текущего формата и типа СУБД.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -private">
    <a class="" href="classes/PhotoRigma-Classes-Database.html#method__convert_to_mysql_format">_convert_to_mysql_format()</a>
    <span>
                                &nbsp;: string    </span>
</dt>
<dd>Производит преобразование строки формата даты/времени в формат, совместимый с MySQL (`DATE_FORMAT`).</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -private">
    <a class="" href="classes/PhotoRigma-Classes-Database.html#method__convert_to_postgres_format">_convert_to_postgres_format()</a>
    <span>
                                &nbsp;: string    </span>
</dt>
<dd>Преобразует формат даты/времени в формат, совместимый с PostgreSQL.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -private">
    <a class="" href="classes/PhotoRigma-Classes-Database.html#method__convert_to_sqlite_format">_convert_to_sqlite_format()</a>
    <span>
                                &nbsp;: string    </span>
</dt>
<dd>Преобразует формат даты/времени в формат, совместимый с SQLite (`strftime`).</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -private">
    <a class="" href="classes/PhotoRigma-Classes-Database.html#method__execute_query">_execute_query()</a>
    <span>
                                &nbsp;: bool    </span>
</dt>
<dd>Выполняет SQL-запрос с использованием подготовленных выражений.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -private">
    <a class="" href="classes/PhotoRigma-Classes-Database.html#method__fallback_to_ilike_pgsql">_fallback_to_ilike_pgsql()</a>
    <span>
                                &nbsp;: array&lt;string|int, mixed&gt;|false    </span>
</dt>
<dd>Выполняет альтернативный поиск по ILIKE с ранжированием similarity() для PostgreSQL.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -private">
    <a class="" href="classes/PhotoRigma-Classes-Database.html#method__fallback_to_like_mysql">_fallback_to_like_mysql()</a>
    <span>
                                &nbsp;: array&lt;string|int, mixed&gt;|false    </span>
</dt>
<dd>Выполняет альтернативный поиск по LIKE для MySQL.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -private">
    <a class="" href="classes/PhotoRigma-Classes-Database.html#method__fallback_to_like_sqlite">_fallback_to_like_sqlite()</a>
    <span>
                                &nbsp;: array&lt;string|int, mixed&gt;|false    </span>
</dt>
<dd>Выполняет альтернативный LIKE-поиск для SQLite.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -private">
    <a class="" href="classes/PhotoRigma-Classes-Database.html#method__fts_check_options">_fts_check_options()</a>
    <span>
                                &nbsp;: array&lt;string|int, mixed&gt;    </span>
</dt>
<dd>Формирует финальный массив опций для запроса с учетом базовых FTS-опций и внешних условий/дополнений.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -private">
    <a class="" href="classes/PhotoRigma-Classes-Database.html#method__full_text_search_mysql">_full_text_search_mysql()</a>
    <span>
                                &nbsp;: array&lt;string|int, mixed&gt;|false    </span>
</dt>
<dd>Выполняет полнотекстовый поиск в MySQL с обработкой минимальной длины строки, кешированием ошибок и fallback
на LIKE.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -private">
    <a class="" href="classes/PhotoRigma-Classes-Database.html#method__full_text_search_pgsql">_full_text_search_pgsql()</a>
    <span>
                                &nbsp;: array&lt;string|int, mixed&gt;|false    </span>
</dt>
<dd>Выполняет полнотекстовый поиск в PostgreSQL с обработкой минимальной длины строки, кешированием ошибок и
fallback на ILIKE.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -private">
    <a class="" href="classes/PhotoRigma-Classes-Database.html#method__full_text_search_sqlite">_full_text_search_sqlite()</a>
    <span>
                                &nbsp;: array&lt;string|int, mixed&gt;|false    </span>
</dt>
<dd>Выполняет полнотекстовый поиск в SQLite через FTS5.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -private">
    <a class="" href="classes/PhotoRigma-Classes-Database.html#method__log_explain">_log_explain()</a>
    <span>
                                &nbsp;: void    </span>
</dt>
<dd>Логирует результат анализа SQL-запроса с помощью EXPLAIN или EXPLAIN ANALYZE.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -private">
    <a class="" href="classes/PhotoRigma-Classes-Database.html#method__log_query">_log_query()</a>
    <span>
                                &nbsp;: void    </span>
</dt>
<dd>Логирует медленные запросы, запросы без использования плейсхолдеров и другие запросы в таблицу логов.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -private">
    <a class="" href="classes/PhotoRigma-Classes-Database.html#method__unescape_identifiers">_unescape_identifiers()</a>
    <span>
                                &nbsp;: array&lt;string|int, mixed&gt;    </span>
</dt>
<dd>Снятие экранирования идентификаторов (например, имён таблиц или столбцов).</dd>

    </dl>



        

        
    <section class="phpdocumentor-properties">
        <h3 class="phpdocumentor-elements__header" id="properties">
            Properties
            <a href="classes/PhotoRigma-Classes-Database.html#properties" class="headerlink"><i class="fas fa-link"></i></a>

        </h3>
                    <article
        class="
            phpdocumentor-element
            -property
            -private
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="property_aff_rows">
        $aff_rows
        <a href="classes/PhotoRigma-Classes-Database.html#property_aff_rows" class="headerlink"><i class="fas fa-link"></i></a>

        <span class="phpdocumentor-element__modifiers">
                                </span>
    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/Database.php"><a href="files/src-classes-database.html"><abbr title="src/Classes/Database.php">Database.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">117</span>

    </aside>

    
    
    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">private</span>
        <span class="phpdocumentor-signature__type">int</span>
    <span class="phpdocumentor-signature__name">$aff_rows</span>
     = <span class="phpdocumentor-signature__default-value">0</span></code>

    
        <section class="phpdocumentor-description"><p>Количество строк, затронутых последним запросом (INSERT, UPDATE, DELETE)</p>
</section>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-Database.html#property_aff_rows#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__execute_query"><abbr title="\PhotoRigma\Classes\Database::_execute_query()">Database::_execute_query()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, хранящее количество строк, затронутых последним запросом.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__get_affected_rows_internal"><abbr title="\PhotoRigma\Classes\Database::_get_affected_rows_internal()">Database::_get_affected_rows_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, хранящее количество строк, затронутых последним запросом.</p>
</section>

                                    </dd>
                                            </dl>

    

</article>
                    <article
        class="
            phpdocumentor-element
            -property
            -private
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="property_allowed_formats">
        $allowed_formats
        <a href="classes/PhotoRigma-Classes-Database.html#property_allowed_formats" class="headerlink"><i class="fas fa-link"></i></a>

        <span class="phpdocumentor-element__modifiers">
                                </span>
    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/Database.php"><a href="files/src-classes-database.html"><abbr title="src/Classes/Database.php">Database.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">133</span>

    </aside>

    
    
    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">private</span>
        <span class="phpdocumentor-signature__type">array&lt;string|int, mixed&gt;|array&lt;string|int, string&gt;</span>
    <span class="phpdocumentor-signature__name">$allowed_formats</span>
     = <span class="phpdocumentor-signature__default-value">[&#039;mysql&#039;, &#039;pgsql&#039;, &#039;sqlite&#039;]</span></code>

    
        <section class="phpdocumentor-description"><p>Список поддерживаемых форматов SQL.</p>
</section>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-Database.html#property_allowed_formats#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method___construct"><abbr title="\PhotoRigma\Classes\Database::__construct()">Database::__construct()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Массив допустимых форматов базы данных (например,
'mysql', 'sqlite', 'pgsql').</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__format_date_internal"><abbr title="\PhotoRigma\Classes\Database::_format_date_internal()">Database::_format_date_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Список допустимых форматов SQL.</p>
</section>

                                    </dd>
                                            </dl>

    

</article>
                    <article
        class="
            phpdocumentor-element
            -property
            -private
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="property_cache">
        $cache
        <a href="classes/PhotoRigma-Classes-Database.html#property_cache" class="headerlink"><i class="fas fa-link"></i></a>

        <span class="phpdocumentor-element__modifiers">
                                </span>
    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/Database.php"><a href="files/src-classes-database.html"><abbr title="src/Classes/Database.php">Database.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">135</span>

    </aside>

    
    
    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">private</span>
        <span class="phpdocumentor-signature__type"><a href="classes/PhotoRigma-Interfaces-Cache-Handler-Interface.html"><abbr title="\PhotoRigma\Interfaces\Cache_Handler_Interface">Cache_Handler_Interface</abbr></a></span>
    <span class="phpdocumentor-signature__name">$cache</span>
    </code>

    
        <section class="phpdocumentor-description"><p>Объект для работы с кешем</p>
</section>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-Database.html#property_cache#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method___destruct"><abbr title="\PhotoRigma\Classes\Database::__destruct()">Database::__destruct()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, хранящее объект, реализующий <code class="prettyprint">Cache_Handler_Interface</code>.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__full_text_search_mysql"><abbr title="\PhotoRigma\Classes\Database::_full_text_search_mysql()">Database::_full_text_search_mysql()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, хранящее объект, реализующий <code class="prettyprint">Cache_Handler_Interface</code>.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__full_text_search_pgsql"><abbr title="\PhotoRigma\Classes\Database::_full_text_search_pgsql()">Database::_full_text_search_pgsql()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, хранящее объект, реализующий <code class="prettyprint">Cache_Handler_Interface</code>.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__full_text_search_sqlite"><abbr title="\PhotoRigma\Classes\Database::_full_text_search_sqlite()">Database::_full_text_search_sqlite()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, хранящее объект, реализующий <code class="prettyprint">Cache_Handler_Interface</code>.</p>
</section>

                                    </dd>
                                            </dl>

    

</article>
                    <article
        class="
            phpdocumentor-element
            -property
            -private
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="property_current_format">
        $current_format
        <a href="classes/PhotoRigma-Classes-Database.html#property_current_format" class="headerlink"><i class="fas fa-link"></i></a>

        <span class="phpdocumentor-element__modifiers">
                                </span>
    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/Database.php"><a href="files/src-classes-database.html"><abbr title="src/Classes/Database.php">Database.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">131</span>

    </aside>

    
    
    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">private</span>
        <span class="phpdocumentor-signature__type">string</span>
    <span class="phpdocumentor-signature__name">$current_format</span>
     = <span class="phpdocumentor-signature__default-value">&#039;mysql&#039;</span></code>

    
        <section class="phpdocumentor-description"><p>Хранит текущий формат SQL (например, 'mysql', 'pgsql', 'sqlite').</p>
</section>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-Database.html#property_current_format#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__convert_query"><abbr title="\PhotoRigma\Classes\Database::_convert_query()">Database::_convert_query()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, определяющее исходный формат строки запроса.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__format_date_internal"><abbr title="\PhotoRigma\Classes\Database::_format_date_internal()">Database::_format_date_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Текущий формат SQL.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__convert_to_mysql_format"><abbr title="\PhotoRigma\Classes\Database::_convert_to_mysql_format()">Database::_convert_to_mysql_format()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, определяющее исходный формат строки для
преобразования.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__convert_to_postgres_format"><abbr title="\PhotoRigma\Classes\Database::_convert_to_postgres_format()">Database::_convert_to_postgres_format()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, определяющее исходный формат строки для
преобразования.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__convert_to_sqlite_format"><abbr title="\PhotoRigma\Classes\Database::_convert_to_sqlite_format()">Database::_convert_to_sqlite_format()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, определяющее исходный формат строки для
преобразования.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__with_sql_format_internal"><abbr title="\PhotoRigma\Classes\Database::_with_sql_format_internal()">Database::_with_sql_format_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, хранящее текущий формат SQL.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__full_text_search_mysql"><abbr title="\PhotoRigma\Classes\Database::_full_text_search_mysql()">Database::_full_text_search_mysql()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, хранящее текущий формат SQL.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__unescape_identifiers"><abbr title="\PhotoRigma\Classes\Database::_unescape_identifiers()">Database::_unescape_identifiers()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, хранящее текущий формат SQL, определяющий
правила снятия экранирования.</p>
</section>

                                    </dd>
                                            </dl>

    

</article>
                    <article
        class="
            phpdocumentor-element
            -property
            -private
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="property_db_name">
        $db_name
        <a href="classes/PhotoRigma-Classes-Database.html#property_db_name" class="headerlink"><i class="fas fa-link"></i></a>

        <span class="phpdocumentor-element__modifiers">
                                </span>
    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/Database.php"><a href="files/src-classes-database.html"><abbr title="src/Classes/Database.php">Database.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">123</span>

    </aside>

    
    
    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">private</span>
        <span class="phpdocumentor-signature__type">string</span>
    <span class="phpdocumentor-signature__name">$db_name</span>
    </code>

    
        <section class="phpdocumentor-description"><p>Имя базы данных</p>
</section>

    

    

</article>
                    <article
        class="
            phpdocumentor-element
            -property
            -private
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="property_db_type">
        $db_type
        <a href="classes/PhotoRigma-Classes-Database.html#property_db_type" class="headerlink"><i class="fas fa-link"></i></a>

        <span class="phpdocumentor-element__modifiers">
                                </span>
    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/Database.php"><a href="files/src-classes-database.html"><abbr title="src/Classes/Database.php">Database.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">121</span>

    </aside>

    
    
    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">private</span>
        <span class="phpdocumentor-signature__type">string</span>
    <span class="phpdocumentor-signature__name">$db_type</span>
    </code>

    
        <section class="phpdocumentor-description"><p>Тип базы данных (mysql, pgsql, sqlite)</p>
</section>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-Database.html#property_db_type#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method___construct"><abbr title="\PhotoRigma\Classes\Database::__construct()">Database::__construct()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, хранящее тип используемой базы данных (например,
'mysql' или 'sqlite').</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__convert_query"><abbr title="\PhotoRigma\Classes\Database::_convert_query()">Database::_convert_query()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, определяющее целевой тип используемой СУБД.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__log_explain"><abbr title="\PhotoRigma\Classes\Database::_log_explain()">Database::_log_explain()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, определяющее тип используемой СУБД.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__format_date_internal"><abbr title="\PhotoRigma\Classes\Database::_format_date_internal()">Database::_format_date_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Тип используемой СУБД.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__full_text_search_internal"><abbr title="\PhotoRigma\Classes\Database::_full_text_search_internal()">Database::_full_text_search_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, хранящее тип текущей СУБД.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__full_text_search_mysql"><abbr title="\PhotoRigma\Classes\Database::_full_text_search_mysql()">Database::_full_text_search_mysql()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, хранящее тип текущей СУБД.</p>
</section>

                                    </dd>
                                            </dl>

    

</article>
                    <article
        class="
            phpdocumentor-element
            -property
            -private
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="property_format_cache">
        $format_cache
        <a href="classes/PhotoRigma-Classes-Database.html#property_format_cache" class="headerlink"><i class="fas fa-link"></i></a>

        <span class="phpdocumentor-element__modifiers">
                                </span>
    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/Database.php"><a href="files/src-classes-database.html"><abbr title="src/Classes/Database.php">Database.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">125</span>

    </aside>

    
    
    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">private</span>
        <span class="phpdocumentor-signature__type">array&lt;string|int, mixed&gt;</span>
    <span class="phpdocumentor-signature__name">$format_cache</span>
     = <span class="phpdocumentor-signature__default-value">[]</span></code>

    
        <section class="phpdocumentor-description"><p>Кэш для преобразования форматов даты (MariaDB&lt;-&gt;PostgreSQL&lt;-&gt;SQLite)</p>
</section>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-Database.html#property_format_cache#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method___construct"><abbr title="\PhotoRigma\Classes\Database::__construct()">Database::__construct()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, хранящее кеш преобразования форматов даты.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method___destruct"><abbr title="\PhotoRigma\Classes\Database::__destruct()">Database::__destruct()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Внутреннее свойство, хранящее кеш преобразования форматов даты.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__convert_to_mysql_format"><abbr title="\PhotoRigma\Classes\Database::_convert_to_mysql_format()">Database::_convert_to_mysql_format()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Внутреннее свойство, используемое для кэширования
преобразований форматов.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__convert_to_postgres_format"><abbr title="\PhotoRigma\Classes\Database::_convert_to_postgres_format()">Database::_convert_to_postgres_format()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Внутреннее свойство, используемое для кэширования
преобразований форматов.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__convert_to_sqlite_format"><abbr title="\PhotoRigma\Classes\Database::_convert_to_sqlite_format()">Database::_convert_to_sqlite_format()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Внутреннее свойство, используемое для кэширования
преобразований форматов.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__full_text_search_mysql"><abbr title="\PhotoRigma\Classes\Database::_full_text_search_mysql()">Database::_full_text_search_mysql()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Внутреннее свойство, используемое для кэширования форматов
(используется косвенно через _select_internal).</p>
</section>

                                    </dd>
                                            </dl>

    

</article>
                    <article
        class="
            phpdocumentor-element
            -property
            -private
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="property_insert_id">
        $insert_id
        <a href="classes/PhotoRigma-Classes-Database.html#property_insert_id" class="headerlink"><i class="fas fa-link"></i></a>

        <span class="phpdocumentor-element__modifiers">
                                </span>
    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/Database.php"><a href="files/src-classes-database.html"><abbr title="src/Classes/Database.php">Database.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">119</span>

    </aside>

    
    
    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">private</span>
        <span class="phpdocumentor-signature__type">int</span>
    <span class="phpdocumentor-signature__name">$insert_id</span>
     = <span class="phpdocumentor-signature__default-value">0</span></code>

    
        <section class="phpdocumentor-description"><p>ID последней вставленной строки после выполнения INSERT-запроса</p>
</section>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-Database.html#property_insert_id#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__execute_query"><abbr title="\PhotoRigma\Classes\Database::_execute_query()">Database::_execute_query()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, хранящее ID последней вставленной записи (для INSERT).</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__get_last_insert_id_internal"><abbr title="\PhotoRigma\Classes\Database::_get_last_insert_id_internal()">Database::_get_last_insert_id_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, хранящее ID последней вставленной строки.</p>
</section>

                                    </dd>
                                            </dl>

    

</article>
                    <article
        class="
            phpdocumentor-element
            -property
            -private
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="property_pdo">
        $pdo
        <a href="classes/PhotoRigma-Classes-Database.html#property_pdo" class="headerlink"><i class="fas fa-link"></i></a>

        <span class="phpdocumentor-element__modifiers">
                                </span>
    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/Database.php"><a href="files/src-classes-database.html"><abbr title="src/Classes/Database.php">Database.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">111</span>

    </aside>

    
    
    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">private</span>
        <span class="phpdocumentor-signature__type"><abbr title="\PDO">PDO</abbr>|null</span>
    <span class="phpdocumentor-signature__name">$pdo</span>
     = <span class="phpdocumentor-signature__default-value">null</span></code>

    
        <section class="phpdocumentor-description"><p>PDO для подключения к базе данных</p>
</section>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-Database.html#property_pdo#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method___construct"><abbr title="\PhotoRigma\Classes\Database::__construct()">Database::__construct()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, хранящее объект PDO для подключения к базе данных.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__begin_transaction_internal"><abbr title="\PhotoRigma\Classes\Database::_begin_transaction_internal()">Database::_begin_transaction_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Объект PDO для подключения к базе данных.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__commit_transaction_internal"><abbr title="\PhotoRigma\Classes\Database::_commit_transaction_internal()">Database::_commit_transaction_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Объект PDO для подключения к базе данных.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__execute_query"><abbr title="\PhotoRigma\Classes\Database::_execute_query()">Database::_execute_query()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Объект PDO, используемый для выполнения запроса.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__log_explain"><abbr title="\PhotoRigma\Classes\Database::_log_explain()">Database::_log_explain()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Объект PDO, используемый для выполнения команды анализа.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__log_query"><abbr title="\PhotoRigma\Classes\Database::_log_query()">Database::_log_query()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Объект PDO, используемый для выполнения запросов к таблице логов.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__rollback_transaction_internal"><abbr title="\PhotoRigma\Classes\Database::_rollback_transaction_internal()">Database::_rollback_transaction_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Объект PDO для подключения к базе данных.</p>
</section>

                                    </dd>
                                            </dl>

    

</article>
                    <article
        class="
            phpdocumentor-element
            -property
            -private
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="property_query_cache">
        $query_cache
        <a href="classes/PhotoRigma-Classes-Database.html#property_query_cache" class="headerlink"><i class="fas fa-link"></i></a>

        <span class="phpdocumentor-element__modifiers">
                                </span>
    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/Database.php"><a href="files/src-classes-database.html"><abbr title="src/Classes/Database.php">Database.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">127</span>

    </aside>

    
    
    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">private</span>
        <span class="phpdocumentor-signature__type">array&lt;string|int, mixed&gt;</span>
    <span class="phpdocumentor-signature__name">$query_cache</span>
     = <span class="phpdocumentor-signature__default-value">[]</span></code>

    
        <section class="phpdocumentor-description"><p>Кэш для хранения результатов проверки существования запросов</p>
</section>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-Database.html#property_query_cache#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method___construct"><abbr title="\PhotoRigma\Classes\Database::__construct()">Database::__construct()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, хранящее кеш уже выполненных запросов.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method___destruct"><abbr title="\PhotoRigma\Classes\Database::__destruct()">Database::__destruct()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Внутреннее свойство, хранящее кеш уже обработанных (например,
экранированных) частей запросов.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__log_query"><abbr title="\PhotoRigma\Classes\Database::_log_query()">Database::_log_query()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Внутреннее свойство, используемое для кэширования результатов
проверки существования запросов.</p>
</section>

                                    </dd>
                                            </dl>

    

</article>
                    <article
        class="
            phpdocumentor-element
            -property
            -private
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="property_res_query">
        $res_query
        <a href="classes/PhotoRigma-Classes-Database.html#property_res_query" class="headerlink"><i class="fas fa-link"></i></a>

        <span class="phpdocumentor-element__modifiers">
                                </span>
    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/Database.php"><a href="files/src-classes-database.html"><abbr title="src/Classes/Database.php">Database.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">115</span>

    </aside>

    
    
    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">private</span>
        <span class="phpdocumentor-signature__type">object|null</span>
    <span class="phpdocumentor-signature__name">$res_query</span>
     = <span class="phpdocumentor-signature__default-value">null</span></code>

    
        <section class="phpdocumentor-description"><p>Результат выполнения подготовленного выражения (PDOStatement)</p>
</section>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-Database.html#property_res_query#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__execute_query"><abbr title="\PhotoRigma\Classes\Database::_execute_query()">Database::_execute_query()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, хранящее результат выполненного запроса (объект
PDOStatement для SELECT/JOIN).</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__result_array_internal"><abbr title="\PhotoRigma\Classes\Database::_result_array_internal()">Database::_result_array_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, хранящее результат подготовленного выражения (объект
PDOStatement).</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__result_row_internal"><abbr title="\PhotoRigma\Classes\Database::_result_row_internal()">Database::_result_row_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, хранящее результат подготовленного выражения (объект
PDOStatement).</p>
</section>

                                    </dd>
                                            </dl>

    

</article>
                    <article
        class="
            phpdocumentor-element
            -property
            -private
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="property_txt_query">
        $txt_query
        <a href="classes/PhotoRigma-Classes-Database.html#property_txt_query" class="headerlink"><i class="fas fa-link"></i></a>

        <span class="phpdocumentor-element__modifiers">
                                </span>
    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/Database.php"><a href="files/src-classes-database.html"><abbr title="src/Classes/Database.php">Database.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">113</span>

    </aside>

    
    
    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">private</span>
        <span class="phpdocumentor-signature__type">string|null</span>
    <span class="phpdocumentor-signature__name">$txt_query</span>
     = <span class="phpdocumentor-signature__default-value">null</span></code>

    
        <section class="phpdocumentor-description"><p>Текст последнего SQL-запроса, сформированного методами класса</p>
</section>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-Database.html#property_txt_query#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__delete_internal"><abbr title="\PhotoRigma\Classes\Database::_delete_internal()">Database::_delete_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, в которое помещается текст SQL-запроса.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__execute_query"><abbr title="\PhotoRigma\Classes\Database::_execute_query()">Database::_execute_query()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, хранящее текст SQL-запроса для выполнения.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__convert_query"><abbr title="\PhotoRigma\Classes\Database::_convert_query()">Database::_convert_query()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, содержащее текст SQL-запроса, которое модифицируется
методом.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__convert_from_mysql_to"><abbr title="\PhotoRigma\Classes\Database::_convert_from_mysql_to()">Database::_convert_from_mysql_to()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, содержащее текст SQL-запроса, которое модифицируется
методом.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__convert_from_pgsql_to"><abbr title="\PhotoRigma\Classes\Database::_convert_from_pgsql_to()">Database::_convert_from_pgsql_to()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, содержащее текст SQL-запроса, которое модифицируется
методом (или остается без изменений).</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__convert_from_sqlite_to"><abbr title="\PhotoRigma\Classes\Database::_convert_from_sqlite_to()">Database::_convert_from_sqlite_to()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, содержащее текст SQL-запроса, которое модифицируется
методом.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__log_explain"><abbr title="\PhotoRigma\Classes\Database::_log_explain()">Database::_log_explain()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, содержащее текст SQL-запроса для анализа.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__log_query"><abbr title="\PhotoRigma\Classes\Database::_log_query()">Database::_log_query()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, содержащее текст SQL-запроса, который логируется.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__insert_internal"><abbr title="\PhotoRigma\Classes\Database::_insert_internal()">Database::_insert_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, в которое помещается текст SQL-запроса.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__join_internal"><abbr title="\PhotoRigma\Classes\Database::_join_internal()">Database::_join_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, в которое помещается текст SQL-запроса.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__select_internal"><abbr title="\PhotoRigma\Classes\Database::_select_internal()">Database::_select_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, в которое помещается текст SQL-запроса.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__truncate_internal"><abbr title="\PhotoRigma\Classes\Database::_truncate_internal()">Database::_truncate_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, в которое помещается текст SQL-запроса.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__update_internal"><abbr title="\PhotoRigma\Classes\Database::_update_internal()">Database::_update_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, в которое помещается текст SQL-запроса.</p>
</section>

                                    </dd>
                                            </dl>

    

</article>
                    <article
        class="
            phpdocumentor-element
            -property
            -private
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="property_unescape_cache">
        $unescape_cache
        <a href="classes/PhotoRigma-Classes-Database.html#property_unescape_cache" class="headerlink"><i class="fas fa-link"></i></a>

        <span class="phpdocumentor-element__modifiers">
                                </span>
    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/Database.php"><a href="files/src-classes-database.html"><abbr title="src/Classes/Database.php">Database.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">129</span>

    </aside>

    
    
    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">private</span>
        <span class="phpdocumentor-signature__type">array&lt;string|int, mixed&gt;</span>
    <span class="phpdocumentor-signature__name">$unescape_cache</span>
     = <span class="phpdocumentor-signature__default-value">[]</span></code>

    
        <section class="phpdocumentor-description"><p>Кэш для хранения результатов снятия экранирования идентификаторов</p>
</section>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-Database.html#property_unescape_cache#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method___construct"><abbr title="\PhotoRigma\Classes\Database::__construct()">Database::__construct()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, хранящее кеш результатов снятия экранирования
идентификаторов.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method___destruct"><abbr title="\PhotoRigma\Classes\Database::__destruct()">Database::__destruct()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Внутреннее свойство, хранящее кеш результатов снятия
экранирования идентификаторов.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__full_text_search_mysql"><abbr title="\PhotoRigma\Classes\Database::_full_text_search_mysql()">Database::_full_text_search_mysql()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Внутреннее свойство, используемое для кэширования снятия
экранирования (используется косвенно через _select_internal).</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__unescape_identifiers"><abbr title="\PhotoRigma\Classes\Database::_unescape_identifiers()">Database::_unescape_identifiers()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Внутреннее свойство, используемое для кэширования
результатов снятия экранирования идентификаторов.</p>
</section>

                                    </dd>
                                            </dl>

    

</article>
            </section>

            <section class="phpdocumentor-methods">
        <h3 class="phpdocumentor-elements__header" id="methods">
            Methods
            <a href="classes/PhotoRigma-Classes-Database.html#methods" class="headerlink"><i class="fas fa-link"></i></a>

        </h3>
                    <article
        class="phpdocumentor-element
            -method
            -public
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method___construct">
        __construct()
        <a href="classes/PhotoRigma-Classes-Database.html#method___construct" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/Database.php"><a href="files/src-classes-database.html"><abbr title="src/Classes/Database.php">Database.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">220</span>

    </aside>

        <p class="phpdocumentor-summary">Конструктор класса.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">public</span>
                    <span class="phpdocumentor-signature__name">__construct</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$db_config</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type"><a href="classes/PhotoRigma-Interfaces-Cache-Handler-Interface.html"><abbr title="\PhotoRigma\Interfaces\Cache_Handler_Interface">Cache_Handler_Interface</abbr></a>&nbsp;</span><span class="phpdocumentor-signature__argument__name">$cache</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">mixed</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот метод вызывается автоматически при создании нового объекта класса.
Используется для установки соединения с базой данных на основе переданных параметров <code class="prettyprint">$db_config</code> и
инициализации механизма кеширования с использованием объекта <code class="prettyprint">$cache</code>.</p>
<p>Подключение к базе данных выполняется в следующем порядке:</p>
<ol>
<li>
<p>Попытка подключения к SQLite, если <code class="prettyprint">dbtype</code> установлен в 'sqlite'. Включает проверку существования и
доступности файла базы данных для записи.</p>
</li>
<li>
<p>Для MySQL/PostgreSQL:</p>
<ul>
<li>Первая попытка подключения через сокет, если указан параметр <code class="prettyprint">dbsock</code>. Если путь к сокету некорректен или
файл не существует, записывается предупреждение в лог, и выполняется попытка подключения через хост и порт.</li>
<li>Вторая попытка подключения через хост и порт, если подключение через сокет не используется или не
удалось, или если <code class="prettyprint">dbsock</code> не был указан.</li>
</ul>
</li>
</ol>
<p>При возникновении ошибок валидации параметров конфигурации или ошибок подключения на уровне PDO выбрасывается
соответствующее исключение.</p>
<p>После инициализации PDO, конструктор проверяет наличие сохранённого кеша (<code class="prettyprint">db_cache</code>) через переданный объект
<code class="prettyprint">$cache</code>. Если кеш действителен (пользовательская логика валидации кеша) и имеет корректную структуру, из него
загружаются данные в внутренние свойства класса: <code class="prettyprint">format_cache</code>, <code class="prettyprint">query_cache</code>, <code class="prettyprint">unescape_cache</code>. Это
позволяет избежать повторной обработки некоторых данных (например, преобразование форматов SQL) при каждом
запуске скрипта.</p>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$db_config</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Массив с конфигурацией подключения к базе данных. Обязательный параметр.
Поддерживаемые ключи:</p>
<ul>
<li>string <code class="prettyprint">dbtype</code>: Тип базы данных ('mysql', 'pgsql', 'sqlite'). Обязательный параметр.
Если передан недопустимый тип, выбрасывается исключение <code class="prettyprint">InvalidArgumentException</code>.</li>
<li>string <code class="prettyprint">dbsock</code> (опционально): Путь к файлу сокета для подключения (для MySQL/PostgreSQL).
При некорректном пути или отсутствии файла записывается лог и выполняется попытка подключения через хост/порт.</li>
<li>string <code class="prettyprint">dbname</code>: Имя базы данных. Обязательный параметр. Для SQLite это полный путь к файлу базы данных.
Если имя не указано, выбрасывается исключение <code class="prettyprint">InvalidArgumentException</code>.</li>
<li>string <code class="prettyprint">dbuser</code> (опционально для SQLite): Имя пользователя базы данных. Обязательный параметр для
MySQL/PostgreSQL. Если имя не указано, выбрасывается исключение <code class="prettyprint">InvalidArgumentException</code>.</li>
<li>string <code class="prettyprint">dbpass</code> (опционально для SQLite): Пароль пользователя базы данных. Обязательный параметр для
MySQL/PostgreSQL.</li>
<li>string <code class="prettyprint">dbhost</code> (опционально, если используется сокет): Хост базы данных. Обязателен, если подключение
через сокет не используется или не удалось. Если хост некорректен, выбрасывается исключение <code class="prettyprint">InvalidArgumentException</code>.</li>
<li>int <code class="prettyprint">dbport</code> (опционально): Порт базы данных. Если порт некорректен, выбрасывается исключение <code class="prettyprint">InvalidArgumentException</code>.</li>
</ul>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$cache</span>
                : <span class="phpdocumentor-signature__argument__return-type"><a href="classes/PhotoRigma-Interfaces-Cache-Handler-Interface.html"><abbr title="\PhotoRigma\Interfaces\Cache_Handler_Interface">Cache_Handler_Interface</abbr></a></span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Объект, реализующий интерфейс <code class="prettyprint">Cache_Handler_Interface</code>. Обязательный параметр.
Используется для временного хранения и загрузки кеша (<code class="prettyprint">db_cache</code>) между запусками
скрипта. При наличии актуального кеша он загружается в свойства:</p>
<ul>
<li><code class="prettyprint">$this-&gt;format_cache</code></li>
<li><code class="prettyprint">$this-&gt;query_cache</code></li>
<li><code class="prettyprint">$this-&gt;unescape_cache</code></li>
</ul>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-Database.html#method___construct#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\InvalidArgumentException">InvalidArgumentException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если параметры конфигурации <code class="prettyprint">$db_config</code> неверны или отсутствуют обязательные поля:</p>
<ul>
<li>Недопустимый тип базы данных (<code class="prettyprint">dbtype</code>).</li>
<li>Не указано имя базы данных (<code class="prettyprint">dbname</code>) или пользователь (<code class="prettyprint">dbuser</code>) (кроме SQLite).</li>
<li>Некорректный хост (<code class="prettyprint">dbhost</code>) или порт (<code class="prettyprint">dbport</code>).</li>
<li>Не указан путь к файлу базы данных для SQLite (<code class="prettyprint">dbname</code>).</li>
</ul>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\RuntimeException">RuntimeException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается при ошибках, связанных с файловой системой для SQLite:</p>
<ul>
<li>Файл базы данных не существует по указанному пути (<code class="prettyprint">dbname</code>).</li>
<li>Файл базы данных недоступен для записи по указанному пути (<code class="prettyprint">dbname</code>).</li>
</ul>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\PDOException">PDOException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если произошла ошибка при установлении соединения с базой данных через PDO:</p>
<ul>
<li>Ошибка подключения через сокет.</li>
<li>Ошибка подключения через хост и порт.</li>
<li>Ошибка подключения к SQLite.</li>
</ul>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\JsonException">JsonException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если возникает ошибка при кодировании конфигурации в JSON для сообщений исключений (например, для логирования или сообщений об ошибках).</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\Exception">Exception</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если возникает общая ошибка или ошибка при логировании событий через функцию <code class="prettyprint">log_in_file()</code>.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Если параметр <code class="prettyprint">dbsock</code> указан для MySQL/PostgreSQL, но файл сокета не существует или некорректен,
выполняется попытка подключения через хост и порт. Проверьте путь <code class="prettyprint">dbsock</code>.
Для SQLite убедитесь, что файл базы данных существует и доступен для записи по указанному пути (<code class="prettyprint">dbname</code>).
Некорректные параметры конфигурации приведут к выбросу исключения.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#property_pdo"><abbr title="\PhotoRigma\Classes\Database::$pdo">Database::$pdo</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, хранящее объект PDO для подключения к базе данных.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#property_db_type"><abbr title="\PhotoRigma\Classes\Database::$db_type">Database::$db_type</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, хранящее тип используемой базы данных (например,
'mysql' или 'sqlite').</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#property_allowed_formats"><abbr title="\PhotoRigma\Classes\Database::$allowed_formats">Database::$allowed_formats</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Массив допустимых форматов базы данных (например,
'mysql', 'sqlite', 'pgsql').</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Interfaces-Cache-Handler-Interface.html"><abbr title="\PhotoRigma\Interfaces\Cache_Handler_Interface">Cache_Handler_Interface</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Интерфейс, реализуемый классом, который отвечает за
работу с кешированием.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#property_format_cache"><abbr title="\PhotoRigma\Classes\Database::$format_cache">Database::$format_cache</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, хранящее кеш преобразования форматов даты.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#property_query_cache"><abbr title="\PhotoRigma\Classes\Database::$query_cache">Database::$query_cache</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, хранящее кеш уже выполненных запросов.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#property_unescape_cache"><abbr title="\PhotoRigma\Classes\Database::$unescape_cache">Database::$unescape_cache</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, хранящее кеш результатов снятия экранирования
идентификаторов.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Interfaces-Cache-Handler-Interface.html#method_is_valid"><abbr title="\PhotoRigma\Interfaces\Cache_Handler_Interface::is_valid()">Cache_Handler_Interface::is_valid()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Метод интерфейса кеширования, используемый
для проверки валидности кеша.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="namespaces/photorigma-include.html#function_log_in_file"><abbr title="\PhotoRigma\Include\log_in_file()">log_in_file()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Записывает сообщение об ошибке в лог-файл.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method___destruct"><abbr title="\PhotoRigma\Classes\Database::__destruct()">Database::__destruct()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Конструктор класса, используемый для инициализации объекта и
кеширования.</p>
</section>

                                    </dd>
                        </dl>

    

    
</article>
                    <article
        class="phpdocumentor-element
            -method
            -public
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method___destruct">
        __destruct()
        <a href="classes/PhotoRigma-Classes-Database.html#method___destruct" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/Database.php"><a href="files/src-classes-database.html"><abbr title="src/Classes/Database.php">Database.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">408</span>

    </aside>

        <p class="phpdocumentor-summary">Деструктор класса Database.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">public</span>
                    <span class="phpdocumentor-signature__name">__destruct</span><span>(</span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">mixed</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Метод вызывается автоматически интерпретатором PHP при уничтожении объекта. Основная задача — сохранение
содержимого внутренних кешей класса (<code class="prettyprint">format_cache</code>, <code class="prettyprint">query_cache</code>, <code class="prettyprint">unescape_cache</code>).</p>
<p>Сохранение выполняется через вызов метода <code class="prettyprint">update_cache()</code> переданного в конструкторе объекта, реализующего
интерфейс <code class="prettyprint">Cache_Handler_Interface</code>.</p>
<p>Возможность сохранения кешей может быть отключена на уровне приложения через соответствующие параметры
конфигурации, которые обрабатываются менеджером кеширования.</p>
</section>

    
    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-Database.html#method___destruct#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Данный метод не требует явного вызова. PHP автоматически исполняет его при освобождении объекта из памяти.
Убедитесь, что доступ к менеджеру кеширования (<code class="prettyprint">$this-&gt;cache</code>) корректен и объект кеширования был
успешно инициализирован в конструкторе.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\JsonException">JsonException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается методом <code class="prettyprint">Cache_Handler_Interface::update_cache()</code>
в случае невозможности сериализации данных кешей перед сохранением.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Interfaces-Cache-Handler-Interface.html#method_update_cache"><abbr title="\PhotoRigma\Interfaces\Cache_Handler_Interface::update_cache()">Cache_Handler_Interface::update_cache()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Метод интерфейса кеширования,
ответственный за сохранение данных во
внешнюю систему кеширования.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#property_format_cache"><abbr title="\PhotoRigma\Classes\Database::$format_cache">Database::$format_cache</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Внутреннее свойство, хранящее кеш преобразования форматов даты.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#property_query_cache"><abbr title="\PhotoRigma\Classes\Database::$query_cache">Database::$query_cache</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Внутреннее свойство, хранящее кеш уже обработанных (например,
экранированных) частей запросов.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#property_unescape_cache"><abbr title="\PhotoRigma\Classes\Database::$unescape_cache">Database::$unescape_cache</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Внутреннее свойство, хранящее кеш результатов снятия
экранирования идентификаторов.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#property_cache"><abbr title="\PhotoRigma\Classes\Database::$cache">Database::$cache</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, хранящее объект, реализующий <code class="prettyprint">Cache_Handler_Interface</code>.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method___construct"><abbr title="\PhotoRigma\Classes\Database::__construct()">Database::__construct()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Конструктор класса, используемый для инициализации объекта и
кеширования.</p>
</section>

                                    </dd>
                        </dl>

    

    
</article>
                    <article
        class="phpdocumentor-element
            -method
            -public
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method_begin_transaction">
        begin_transaction()
        <a href="classes/PhotoRigma-Classes-Database.html#method_begin_transaction" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/Database.php"><a href="files/src-classes-database.html"><abbr title="src/Classes/Database.php">Database.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">440</span>

    </aside>

        <p class="phpdocumentor-summary">Начинает транзакцию в базе данных.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">public</span>
                    <span class="phpdocumentor-signature__name">begin_transaction</span><span>(</span><span class="phpdocumentor-signature__argument"><span>[</span><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$context</span><span> = </span><span class="phpdocumentor-signature__argument__default-value">&#039;&#039;</span><span> ]</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">void</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот публичный метод является обёрткой для защищённого метода <code class="prettyprint">_begin_transaction_internal()</code>. Он передаёт
контекст транзакции во внутренний метод, который выполняет начало транзакции на уровне PDO и записывает
соответствующий лог. Метод предназначен для использования клиентским кодом как точка входа для явного управления
транзакциями.</p>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$context</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                 = <span class="phpdocumentor-signature__argument__default-value">&#039;&#039;</span>            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Контекст транзакции (необязательный параметр).
Используется для описания цели или места начала транзакции.
По умолчанию: пустая строка (<code class="prettyprint">''</code>).</p>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-Database.html#method_begin_transaction#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\Exception">Exception</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если произошла ошибка при начале транзакции на уровне PDO (выбрасывается из
внутренней логики).</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Этот метод является точкой входа для начала транзакций.
Основная логика и логирование выполняются в защищённом методе <code class="prettyprint">_begin_transaction_internal()</code>.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Убедитесь, что соединение с базой данных установлено перед вызовом метода.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__begin_transaction_internal"><abbr title="\PhotoRigma\Classes\Database::_begin_transaction_internal()">Database::_begin_transaction_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Защищённый метод, выполняющий основную
логику начала транзакции.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">void</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Метод ничего не возвращает.</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -public
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method_commit_transaction">
        commit_transaction()
        <a href="classes/PhotoRigma-Classes-Database.html#method_commit_transaction" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/Database.php"><a href="files/src-classes-database.html"><abbr title="src/Classes/Database.php">Database.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">505</span>

    </aside>

        <p class="phpdocumentor-summary">Подтверждает транзакцию в базе данных.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">public</span>
                    <span class="phpdocumentor-signature__name">commit_transaction</span><span>(</span><span class="phpdocumentor-signature__argument"><span>[</span><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$context</span><span> = </span><span class="phpdocumentor-signature__argument__default-value">&#039;&#039;</span><span> ]</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">void</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот публичный метод является обёрткой для защищённого метода <code class="prettyprint">_commit_transaction_internal()</code>. Он передаёт
контекст транзакции во внутренний метод, который выполняет подтверждение транзакции на уровне PDO и записывает
соответствующий лог. Метод предназначен для использования клиентским кодом как точка входа для явного
управления транзакциями.</p>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$context</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                 = <span class="phpdocumentor-signature__argument__default-value">&#039;&#039;</span>            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Контекст транзакции (необязательный параметр).
Используется для описания цели или места подтверждения транзакции.
По умолчанию: пустая строка (<code class="prettyprint">''</code>).</p>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-Database.html#method_commit_transaction#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\Exception">Exception</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если произошла ошибка при подтверждении транзакции на уровне PDO
(выбрасывается из внутренней логики).</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Этот метод является точкой входа для подтверждения транзакций.
Основная логика и логирование выполняются в защищённом методе <code class="prettyprint">_commit_transaction_internal()</code>.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Убедитесь, что транзакция была начата перед вызовом метода.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__commit_transaction_internal"><abbr title="\PhotoRigma\Classes\Database::_commit_transaction_internal()">Database::_commit_transaction_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Защищённый метод, выполняющий основную
логику подтверждения транзакции.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">void</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Метод ничего не возвращает.</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -public
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method_delete">
        delete()
        <a href="classes/PhotoRigma-Classes-Database.html#method_delete" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/Database.php"><a href="files/src-classes-database.html"><abbr title="src/Classes/Database.php">Database.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">607</span>

    </aside>

        <p class="phpdocumentor-summary">Удаляет данные из таблицы через вызов внутреннего метода.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">public</span>
                    <span class="phpdocumentor-signature__name">delete</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$from_tbl</span></span><span class="phpdocumentor-signature__argument"><span>[</span><span>, </span><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$options</span><span> = </span><span class="phpdocumentor-signature__argument__default-value">[]</span><span> ]</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">bool</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот публичный метод является обёрткой для защищённого метода <code class="prettyprint">_delete_internal()</code>. Он передаёт имя таблицы и
опции запроса во внутренний метод, который выполняет формирование и выполнение SQL-запроса на удаление.
Безопасность обеспечивается обязательным указанием условия <code class="prettyprint">where</code> в опциях и использованием подготовленных
выражений с параметрами. Метод предназначен для использования клиентским кодом как точка входа для выполнения
операций удаления данных.</p>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$from_tbl</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Имя таблицы, из которой необходимо удалить данные.
Должно быть строкой, содержащей только допустимые имена таблиц без специальных символов.</p>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$options</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                 = <span class="phpdocumentor-signature__argument__default-value">[]</span>            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Массив дополнительных опций для формирования запроса. Поддерживаемые ключи:</p>
<ul>
<li>where (string|array|false): Условие WHERE.
<ul>
<li>string - используется как есть.</li>
<li>array - преобразуется в SQL. Поддерживает простые условия
(<code class="prettyprint">['поле' =&gt; значение]</code>) и логические операторы (<code class="prettyprint">'OR' =&gt; [...]</code>,
<code class="prettyprint">'NOT' =&gt; [...]</code>).</li>
<li>false - игнорируется.
Обязательный параметр для безопасности. Без условия WHERE запрос не будет выполнен.</li>
</ul>
</li>
<li>group (string|false): Группировка GROUP BY. Игнорируется, если false.
Должна быть строкой.
Не поддерживается в запросах DELETE и удаляется с записью в лог.</li>
<li>order (string|false): Сортировка ORDER BY. Игнорируется, если false.
Должна быть строкой.
Может использоваться только вместе с <code class="prettyprint">limit</code>. Если указан только один из них, оба
игнорируются с записью в лог.</li>
<li>limit (int|string|false): Ограничение LIMIT.
<ul>
<li>int - прямое значение.</li>
<li>string - формат &quot;OFFSET,COUNT&quot;.</li>
<li>false - игнорируется.
Может использоваться только вместе с <code class="prettyprint">order</code>. Если указан только один из них, оба
игнорируются с записью в лог.</li>
</ul>
</li>
<li>params (array): Ассоциативный массив параметров
([&quot;:имя&quot; =&gt; значение]).
Обязателен для использования с условиями <code class="prettyprint">where</code> и другими частями запроса,
требующими подготовленных выражений. Обеспечивает защиту от SQL-инъекций.
Может быть пустым массивом, если параметры не требуются.</li>
</ul>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-Database.html#method_delete#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\InvalidArgumentException">InvalidArgumentException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если:</p>
<ul>
<li><code class="prettyprint">$from_tbl</code> не является строкой.</li>
<li><code class="prettyprint">$options</code> не является массивом.</li>
<li>Отсутствует обязательное условие <code class="prettyprint">where</code> в массиве <code class="prettyprint">$options</code>.</li>
</ul>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\JsonException">JsonException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается при ошибках кодирования JSON (например, при записи в лог).</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\Exception">Exception</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается при ошибках выполнения запроса или записи в лог.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Этот метод является точкой входа для выполнения операций удаления данных.
Все проверки (включая обязательное <code class="prettyprint">where</code>) и основная логика выполняются в защищённом методе
<code class="prettyprint">_delete_internal()</code>.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Метод чувствителен к корректности входных данных. Неверные типы данных или некорректные значения
могут привести к выбросу исключения. Безопасность обеспечивается обязательным указанием условия <code class="prettyprint">where</code>.
Запрос без условия <code class="prettyprint">where</code> не будет выполнен. Ключи <code class="prettyprint">group</code>, <code class="prettyprint">order</code> и <code class="prettyprint">limit</code> проверяются на
корректность во внутренней логике.
Использование параметров <code class="prettyprint">params</code> для подготовленных выражений является обязательным для защиты от
SQL-инъекций и обеспечения совместимости с различными СУБД.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__delete_internal"><abbr title="\PhotoRigma\Classes\Database::_delete_internal()">Database::_delete_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Защищённый метод, выполняющий основную логику удаления
данных.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">bool</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Возвращает true, если запрос успешно выполнен (даже если результат пустой). В случае ошибки
выбрасывается исключение.</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -public
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method_format_date">
        format_date()
        <a href="classes/PhotoRigma-Classes-Database.html#method_format_date" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/Database.php"><a href="files/src-classes-database.html"><abbr title="src/Classes/Database.php">Database.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">1627</span>

    </aside>

        <p class="phpdocumentor-summary">Формирует SQL-выражение для форматирования даты с учетом специфики используемой СУБД.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">public</span>
                    <span class="phpdocumentor-signature__name">format_date</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$column</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$format</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">string</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот публичный метод является обёрткой для защищённого метода <code class="prettyprint">_format_date_internal()</code>. Он принимает название
столбца с датой и формат даты, а затем вызывает внутренний метод для формирования соответствующего
SQL-выражения, учитывая специфику используемой СУБД. Метод предназначен для использования клиентским кодом для
получения SQL-выражений для форматирования дат в запросах.</p>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$column</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Название столбца с датой:</p>
<ul>
<li>Должен быть непустой строкой в формате имени столбца таблицы в БД.</li>
</ul>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$format</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Формат даты:</p>
<ul>
<li>Может быть указан в любом поддерживаемом формате (например, MySQL, PostgreSQL, SQLite).</li>
<li>Преобразование выполняется во внутренней логике в зависимости от типа СУБД.</li>
</ul>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-Database.html#method_format_date#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\InvalidArgumentException">InvalidArgumentException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если тип СУБД не поддерживается (выбрасывается из внутренней
логики).</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Этот метод является точкой входа для получения SQL-выражений для форматирования даты.
Преобразование формата даты и выбор специфичной для СУБД функции выполняются в защищённом методе
<code class="prettyprint">_format_date_internal()</code>.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Убедитесь, что <code class="prettyprint">$column</code> (непустая строка) и <code class="prettyprint">$format</code> содержат корректные значения перед вызовом метода.
Неверный формат может привести к ошибкам при формировании SQL-запроса.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__format_date_internal"><abbr title="\PhotoRigma\Classes\Database::_format_date_internal()">Database::_format_date_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Защищённый метод, выполняющий основную логику
формирования SQL-выражения.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">string</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>SQL-выражение для форматирования даты.</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -public
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method_full_text_search">
        full_text_search()
        <a href="classes/PhotoRigma-Classes-Database.html#method_full_text_search" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/Database.php"><a href="files/src-classes-database.html"><abbr title="src/Classes/Database.php">Database.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">3313</span>

    </aside>

        <p class="phpdocumentor-summary">Выполняет полнотекстовый поиск в указанной таблице.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">public</span>
                    <span class="phpdocumentor-signature__name">full_text_search</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$columns_to_return</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$columns_to_search</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$search_string</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$table</span></span><span class="phpdocumentor-signature__argument"><span>[</span><span>, </span><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$options</span><span> = </span><span class="phpdocumentor-signature__argument__default-value">[]</span><span> ]</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">array&lt;string|int, mixed&gt;|false</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот публичный метод является точкой входа для выполнения полнотекстового поиска.
Он вызывает внутреннюю логику поиска, реализованную в защищённом методе <code class="prettyprint">_full_text_search_internal()</code>,
передавая ему все необходимые параметры и опции. Безопасность запроса обеспечивается использованием
подготовленных выражений.</p>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$columns_to_return</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Массив строк с именами столбцов, данные из которых нужно вернуть.</p>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$columns_to_search</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Массив строк с именами столбцов, по которым выполняется поиск.</p>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$search_string</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Строка для полнотекстового поиска.</p>
<ul>
<li>Может содержать <code class="prettyprint">*</code> для выбора всех записей.</li>
</ul>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$table</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Строка с именем таблицы, в которой выполняется поиск.</p>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$options</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                 = <span class="phpdocumentor-signature__argument__default-value">[]</span>            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Массив дополнительных опций для формирования запроса. Поддерживаемые ключи:</p>
<ul>
<li>where (string|array|false): Условие WHERE.
<ul>
<li>string - используется как есть.</li>
<li>array - преобразуется в SQL.</li>
<li>false - игнорируется.</li>
</ul>
</li>
<li>group (string|false): GROUP BY. Игнорируется, если false.</li>
<li>order (string|false): ORDER BY. Игнорируется, если false.</li>
<li>limit (int|string|false): LIMIT.
<ul>
<li>int - прямое значение.</li>
<li>string - формат &quot;OFFSET,COUNT&quot;.</li>
<li>false - игнорируется.</li>
</ul>
</li>
<li>params (array): Ассоциативный массив параметров
([&quot;:имя&quot; =&gt; значение]).
Использование параметров <code class="prettyprint">params</code> обязательно
для защиты от SQL-инъекций.</li>
</ul>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-Database.html#method_full_text_search#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\RuntimeException">RuntimeException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Если не удалось получить версию БД из таблицы db_version (выбрасывается из
внутренней логики).</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\InvalidArgumentException">InvalidArgumentException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Если переданы недопустимые аргументы или тип СУБД не поддерживается
(выбрасывается из внутренней логики).</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\JsonException">JsonException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>При ошибках, связанных с кодированием/декодированием JSON.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\Exception">Exception</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Если произошла ошибка при выполнении запроса на более низких уровнях.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Этот метод является точкой входа для выполнения запросов с полнотекстовым поиском.
Все проверки и обработка выполняются в защищённом методе <code class="prettyprint">_full_text_search_internal()</code>.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Метод чувствителен к корректности входных данных.
Убедитесь, что массивы столбцов и имя таблицы не пусты, а строка поиска не пустая (если не <code class="prettyprint">*</code>).
Использование параметров <code class="prettyprint">params</code> в <code class="prettyprint">$options</code> обязательно для значений, подставляемых в запросы.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__full_text_search_internal"><abbr title="\PhotoRigma\Classes\Database::_full_text_search_internal()">Database::_full_text_search_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Защищённый метод, выполняющий основную логику
полнотекстового поиска.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">array&lt;string|int, mixed&gt;|false</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Результат выполнения поиска (массив данных или false, если результат пустой).</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -public
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method_get_affected_rows">
        get_affected_rows()
        <a href="classes/PhotoRigma-Classes-Database.html#method_get_affected_rows" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/Database.php"><a href="files/src-classes-database.html"><abbr title="src/Classes/Database.php">Database.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">1996</span>

    </aside>

        <p class="phpdocumentor-summary">Возвращает количество строк, затронутых последним SQL-запросом.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">public</span>
                    <span class="phpdocumentor-signature__name">get_affected_rows</span><span>(</span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">int</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот публичный метод является обёрткой для защищённого метода <code class="prettyprint">_get_affected_rows_internal()</code>. Он вызывает
внутренний метод для получения значения количества строк, затронутых последним выполненным запросом INSERT,
UPDATE, DELETE или REPLACE, после соответствующих проверок. Метод предназначен для использования клиентским
кодом как точка входа для получения информации о результатах модифицирующих запросов.</p>
</section>

    
    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-Database.html#method_get_affected_rows#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\InvalidArgumentException">InvalidArgumentException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если количество затронутых строк не установлено
или имеет некорректное значение (выбрасывается из внутренней логики).</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Этот метод является точкой входа для получения количества затронутых строк.
Значение количества строк устанавливается методами выполнения запросов (например,
<code class="prettyprint">insert()</code>, <code class="prettyprint">update()</code>, <code class="prettyprint">delete()</code>). Внутренняя логика получения значения
и проверки его корректности выполняется в защищённом методе <code class="prettyprint">_get_affected_rows_internal()</code>.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Убедитесь, что перед вызовом этого метода был выполнен модифицирующий запрос
(INSERT, UPDATE, DELETE или REPLACE), чтобы количество затронутых строк было установлено.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__get_affected_rows_internal"><abbr title="\PhotoRigma\Classes\Database::_get_affected_rows_internal()">Database::_get_affected_rows_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Защищённый метод, выполняющий основную
логику получения количества затронутых строк.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">int</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Количество строк, затронутых последним SQL-запросом.</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -public
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method_get_last_insert_id">
        get_last_insert_id()
        <a href="classes/PhotoRigma-Classes-Database.html#method_get_last_insert_id" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/Database.php"><a href="files/src-classes-database.html"><abbr title="src/Classes/Database.php">Database.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">2069</span>

    </aside>

        <p class="phpdocumentor-summary">Возвращает ID последней вставленной строки.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">public</span>
                    <span class="phpdocumentor-signature__name">get_last_insert_id</span><span>(</span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">int</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот публичный метод является обёрткой для защищённого метода <code class="prettyprint">_get_last_insert_id_internal()</code>. Он вызывает
внутренний метод для получения значения ID последней вставленной строки после соответствующих проверок.
Метод предназначен для использования клиентским кодом как точка входа для получения информации о результатах
операций вставки данных.</p>
</section>

    
    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-Database.html#method_get_last_insert_id#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\InvalidArgumentException">InvalidArgumentException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если ID последней вставленной строки не установлено
или имеет некорректное значение (выбрасывается из внутренней логики).</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Этот метод является точкой входа для получения ID последней вставленной строки.
Значение ID устанавливается методами выполнения INSERT запросов (например, <code class="prettyprint">insert()</code>).
Внутренняя логика получения значения и проверки его корректности выполняется в
защищённом методе <code class="prettyprint">_get_last_insert_id_internal()</code>.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Убедитесь, что перед вызовом этого метода был выполнен запрос на вставку данных
(INSERT), чтобы ID последней вставленной строки было установлено.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__get_last_insert_id_internal"><abbr title="\PhotoRigma\Classes\Database::_get_last_insert_id_internal()">Database::_get_last_insert_id_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Защищённый метод, выполняющий основную
логику получения ID последней вставленной
строки.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">int</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>ID последней вставленной строки.</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -public
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method_insert">
        insert()
        <a href="classes/PhotoRigma-Classes-Database.html#method_insert" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/Database.php"><a href="files/src-classes-database.html"><abbr title="src/Classes/Database.php">Database.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">2174</span>

    </aside>

        <p class="phpdocumentor-summary">Вставляет данные в таблицу через вызов внутреннего метода.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">public</span>
                    <span class="phpdocumentor-signature__name">insert</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$insert</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$to_tbl</span></span><span class="phpdocumentor-signature__argument"><span>[</span><span>, </span><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$type</span><span> = </span><span class="phpdocumentor-signature__argument__default-value">&#039;&#039;</span><span> ]</span></span><span class="phpdocumentor-signature__argument"><span>[</span><span>, </span><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$options</span><span> = </span><span class="phpdocumentor-signature__argument__default-value">[]</span><span> ]</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">bool</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот публичный метод является обёрткой для защищённого метода <code class="prettyprint">_insert_internal()</code>. Он передаёт массив данных
для вставки, имя таблицы, тип запроса и опции во внутренний метод, который выполняет формирование и выполнение
SQL-запроса на вставку. Метод поддерживает различные типы вставок (<code class="prettyprint">IGNORE</code>, <code class="prettyprint">REPLACE</code>, <code class="prettyprint">INTO</code>). Безопасность
обеспечивается использованием подготовленных выражений с параметрами. Метод предназначен для использования
клиентским кодом как точка входа для выполнения операций вставки данных.</p>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$insert</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Ассоциативный массив данных для вставки в формате: 'имя_поля' =&gt; 'значение' или
'имя_поля' =&gt; ':плейсхолдер'.
Если передан пустой массив, выбрасывается исключение.</p>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$to_tbl</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Имя таблицы, в которую необходимо вставить данные.
Должно быть строкой, содержащей только допустимые имена таблиц без специальных
символов.</p>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$type</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                 = <span class="phpdocumentor-signature__argument__default-value">&#039;&#039;</span>            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Тип запроса (необязательно). Определяет тип SQL-запроса на вставку. Допустимые
значения:</p>
<ul>
<li>'ignore': Формирует запрос типа &quot;INSERT IGNORE INTO&quot;.</li>
<li>'replace': Формирует запрос типа &quot;REPLACE INTO&quot;.</li>
<li>'into': Формирует запрос типа &quot;INSERT INTO&quot; (явное указание).</li>
<li>'' (пустая строка): Формирует запрос типа &quot;INSERT INTO&quot; (по умолчанию).
Если указан недопустимый тип, выбрасывается исключение InvalidArgumentException.</li>
</ul>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$options</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                 = <span class="phpdocumentor-signature__argument__default-value">[]</span>            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Массив опций для формирования запроса. Поддерживаемые ключи:</p>
<ul>
<li>params (array): Параметры для подготовленного выражения. Ассоциативный массив
значений, используемых в запросе (например, [&quot;:name&quot; =&gt; &quot;John Doe&quot;, &quot;:email&quot; =&gt;
&quot;john@local.com&quot;]).
Обязателен для использования с данными для вставки, требующими
подготовленных выражений. Обеспечивает защиту от SQL-инъекций.
Может быть пустым массивом, если параметры не требуются.</li>
<li>where (string|array|false): Условие WHERE. Игнорируется в этом методе.</li>
<li>group (string|false): Группировка GROUP BY. Игнорируется в этом методе.</li>
<li>order (string|false): Сортировка ORDER BY. Игнорируется в этом методе.</li>
<li>limit (int|string|false): Ограничение LIMIT. Игнорируется в этом методе.</li>
</ul>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-Database.html#method_insert#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\InvalidArgumentException">InvalidArgumentException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если:</p>
<ul>
<li><code class="prettyprint">$insert</code> не является массивом или является пустым массивом.</li>
<li><code class="prettyprint">$to_tbl</code> не является строкой.</li>
<li><code class="prettyprint">$type</code> содержит недопустимое значение (не '', 'ignore', 'replace', 'into').</li>
<li><code class="prettyprint">$options</code> не является массивом.</li>
</ul>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\Exception">Exception</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается при ошибках выполнения запроса.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Этот метод является точкой входа для выполнения операций вставки данных.
Все проверки и основная логика выполняются в защищённом методе <code class="prettyprint">_insert_internal()</code>.
Ключи массива <code class="prettyprint">$options</code> (<code class="prettyprint">where</code>, <code class="prettyprint">group</code>, <code class="prettyprint">order</code>, <code class="prettyprint">limit</code>) игнорируются в этом методе.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Метод чувствителен к корректности входных данных. Неверные типы данных или некорректные значения могут
привести к выбросу исключения. Убедитесь, что массив <code class="prettyprint">$insert</code> не пустой и содержит корректные данные.
Параметр <code class="prettyprint">$type</code> должен быть одним из допустимых значений: '', 'ignore', 'replace', 'into'.
Использование параметров <code class="prettyprint">params</code> для подготовленных выражений является обязательным для защиты от
SQL-инъекций и обеспечения совместимости с различными СУБД.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__insert_internal"><abbr title="\PhotoRigma\Classes\Database::_insert_internal()">Database::_insert_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Защищённый метод, выполняющий основную логику вставки
данных.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">bool</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Возвращает true, если запрос успешно выполнен (даже если результат пустой). В случае ошибки
выбрасывается исключение.</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -public
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method_join">
        join()
        <a href="classes/PhotoRigma-Classes-Database.html#method_join" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/Database.php"><a href="files/src-classes-database.html"><abbr title="src/Classes/Database.php">Database.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">2355</span>

    </aside>

        <p class="phpdocumentor-summary">Выполняет SQL-запрос с использованием JOIN через вызов внутреннего метода.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">public</span>
                    <span class="phpdocumentor-signature__name">join</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">string|array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$select</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$from_tbl</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$join</span></span><span class="phpdocumentor-signature__argument"><span>[</span><span>, </span><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$options</span><span> = </span><span class="phpdocumentor-signature__argument__default-value">[]</span><span> ]</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">bool</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот публичный метод является обёрткой для защищённого метода <code class="prettyprint">_join_internal()</code>. Он передаёт список полей,
основную таблицу, массив JOIN-операций и опции во внутренний метод, который выполняет формирование и
выполнение SQL-запроса с использованием JOIN. Безопасность обеспечивается использованием подготовленных
выражений с параметрами. Метод предназначен для использования клиентским кодом как точка входа для выполнения
запросов с JOIN.</p>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$select</span>
                : <span class="phpdocumentor-signature__argument__return-type">string|array&lt;string|int, mixed&gt;</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Список полей для выборки. Может быть строкой (имя одного поля) или массивом
(список полей). Если передан массив, он преобразуется в строку с разделителем
<code class="prettyprint">,</code>. Пример: &quot;id&quot;, [&quot;id&quot;, &quot;name&quot;]. Ограничения: массив не может быть пустым.</p>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$from_tbl</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Имя основной таблицы, из которой начинается выборка.
Должно быть строкой, содержащей только допустимые имена таблиц без специальных
символов. Ограничения: строка должна быть непустой.</p>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$join</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Массив описаний JOIN-операций. Каждый элемент массива должен содержать следующие
ключи:</p>
<ul>
<li>table (string): Имя таблицы для JOIN. Должно быть строкой, содержащей только
допустимые имена таблиц.</li>
<li>type (string, optional): Тип JOIN (например, INNER, LEFT, RIGHT). Если тип не
указан, используется INNER по умолчанию.</li>
<li>on (string): Условие для JOIN. Должно быть строкой с допустимым условием
сравнения полей. Если условие отсутствует, выбрасывается исключение.
Пример:
[['type' =&gt; 'INNER', 'table' =&gt; 'orders', 'on' =&gt; 'users.id = orders.user_id']].
Ограничения: массив не может быть пустым.</li>
</ul>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$options</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                 = <span class="phpdocumentor-signature__argument__default-value">[]</span>            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Массив дополнительных опций для формирования запроса. Поддерживаемые ключи:</p>
<ul>
<li>where (string|array|false): Условие WHERE.
<ul>
<li>string - используется как есть.</li>
<li>array - преобразуется в SQL. Поддерживает простые условия
(<code class="prettyprint">['поле' =&gt; значение]</code>) и логические операторы (<code class="prettyprint">'OR' =&gt; [...]</code>,
<code class="prettyprint">'NOT' =&gt; [...]</code>).</li>
<li>false - игнорируется.</li>
</ul>
</li>
<li>group (string|false): Группировка GROUP BY. Игнорируется, если false.
Должна быть строкой.</li>
<li>order (string|false): Сортировка ORDER BY. Игнорируется, если false.
Должна быть строкой.</li>
<li>limit (int|string|false): Ограничение LIMIT.
<ul>
<li>int - прямое значение.</li>
<li>string - формат &quot;OFFSET,COUNT&quot;.</li>
<li>false - игнорируется.</li>
</ul>
</li>
<li>params (array): Ассоциативный массив параметров
([&quot;:имя&quot; =&gt; значение]).
Обязателен для использования с условиями <code class="prettyprint">where</code> и другими частями запроса,
требующими подготовленных выражений. Обеспечивает защиту от SQL-инъекций.
Может быть пустым массивом, если параметры не требуются.</li>
</ul>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-Database.html#method_join#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\InvalidArgumentException">InvalidArgumentException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если:</p>
<ul>
<li><code class="prettyprint">$from_tbl</code> не является строкой.</li>
<li><code class="prettyprint">$join</code> не является массивом.</li>
<li><code class="prettyprint">$select</code> не является строкой или массивом.</li>
<li>Отсутствует имя таблицы (<code class="prettyprint">table</code>) или условие (<code class="prettyprint">on</code>) в описании JOIN.</li>
<li><code class="prettyprint">$options</code> не является массивом.</li>
</ul>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\Exception">Exception</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается при ошибках выполнения запроса.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Этот метод является точкой входа для выполнения запросов с JOIN.
Все проверки и основная логика выполняются в защищённом методе <code class="prettyprint">_join_internal()</code>.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Метод чувствителен к корректности входных данных. Неверные типы данных или некорректные значения могут
привести к выбросу исключения. Убедитесь, что массив <code class="prettyprint">$join</code> не пустой и содержит корректные данные.
Использование параметров <code class="prettyprint">params</code> для подготовленных выражений является обязательным для защиты от
SQL-инъекций и обеспечения совместимости с различными СУБД.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__join_internal"><abbr title="\PhotoRigma\Classes\Database::_join_internal()">Database::_join_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Защищённый метод, выполняющий основную логику
формирования и выполнения SQL-запроса с JOIN.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">bool</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Возвращает true, если запрос успешно выполнен (даже если результат пустой).</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -public
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method_result_array">
        result_array()
        <a href="classes/PhotoRigma-Classes-Database.html#method_result_array" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/Database.php"><a href="files/src-classes-database.html"><abbr title="src/Classes/Database.php">Database.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">2507</span>

    </aside>

        <p class="phpdocumentor-summary">Извлекает все строки результата из подготовленного выражения.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">public</span>
                    <span class="phpdocumentor-signature__name">result_array</span><span>(</span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">array&lt;string|int, mixed&gt;|false</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот публичный метод является обёрткой для защищённого метода <code class="prettyprint">_result_array_internal()</code>. Он вызывает
внутренний метод для извлечения всех строк результата последнего выполненного запроса из свойства <code class="prettyprint">$res_query</code>
в виде массива ассоциативных массивов, после соответствующих проверок. Метод предназначен для использования
клиентским кодом как точка входа для получения всех результатов запроса SELECT.</p>
</section>

    
    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-Database.html#method_result_array#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\InvalidArgumentException">InvalidArgumentException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если результат запроса недоступен или имеет некорректный тип
(выбрасывается из внутренней логики).</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Этот метод является точкой входа для получения всех строк результата запроса.
Результат запроса (объект PDOStatement в свойстве <code class="prettyprint">$res_query</code>) устанавливается методом выполнения
запроса (например, <code class="prettyprint">_execute_query()</code>). Внутренняя логика получения данных и проверки их корректности
выполняется в защищённом методе <code class="prettyprint">_result_array_internal()</code>.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Убедитесь, что перед вызовом этого метода был успешно выполнен запрос (например, SELECT), который
установил доступный для чтения результат (<code class="prettyprint">$res_query</code>).</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__result_array_internal"><abbr title="\PhotoRigma\Classes\Database::_result_array_internal()">Database::_result_array_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Защищённый метод, выполняющий основную логику
извлечения всех строк результата.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">array&lt;string|int, mixed&gt;|false</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Возвращает массив ассоциативных массивов, содержащих данные всех строк результата, если
они доступны. Если результатов нет (запрос не вернул строк), возвращает <code class="prettyprint">false</code>.</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -public
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method_result_row">
        result_row()
        <a href="classes/PhotoRigma-Classes-Database.html#method_result_row" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/Database.php"><a href="files/src-classes-database.html"><abbr title="src/Classes/Database.php">Database.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">2590</span>

    </aside>

        <p class="phpdocumentor-summary">Извлекает одну строку результата из подготовленного выражения.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">public</span>
                    <span class="phpdocumentor-signature__name">result_row</span><span>(</span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">array&lt;string|int, mixed&gt;|false</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот публичный метод является обёрткой для защищённого метода <code class="prettyprint">_result_row_internal()</code>. Он вызывает внутренний
метод для извлечения одной строки результата последнего выполненного запроса из свойства <code class="prettyprint">$res_query</code> в виде
ассоциативного массива, после соответствующих проверок. При последовательных вызовах метода извлекается
следующая строка результата. Метод предназначен для использования клиентским кодом для получения результатов
запроса по одной строке.</p>
</section>

    
    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-Database.html#method_result_row#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\InvalidArgumentException">InvalidArgumentException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если результат запроса недоступен или имеет некорректный тип
(выбрасывается из внутренней логики).</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Этот метод является точкой входа для получения строк результата запроса по одной.
Результат запроса (объект PDOStatement в свойстве <code class="prettyprint">$res_query</code>) устанавливается методом выполнения
запроса (например, <code class="prettyprint">_execute_query()</code>). Внутренняя логика получения данных и проверки их корректности
выполняется в защищённом методе <code class="prettyprint">_result_row_internal()</code>.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Убедитесь, что перед вызовом этого метода был успешно выполнен запрос (например, SELECT), который
установил доступный для чтения результат (<code class="prettyprint">$res_query</code>).</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__result_row_internal"><abbr title="\PhotoRigma\Classes\Database::_result_row_internal()">Database::_result_row_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Защищённый метод, выполняющий основную логику
извлечения одной строки результата.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">array&lt;string|int, mixed&gt;|false</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Возвращает ассоциативный массив, содержащий данные одной строки результата, если она
доступна. При последовательных вызовах переходит к следующей строке.
Если результатов больше нет (все строки были извлечены), возвращает <code class="prettyprint">false</code>.</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -public
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method_rollback_transaction">
        rollback_transaction()
        <a href="classes/PhotoRigma-Classes-Database.html#method_rollback_transaction" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/Database.php"><a href="files/src-classes-database.html"><abbr title="src/Classes/Database.php">Database.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">2668</span>

    </aside>

        <p class="phpdocumentor-summary">Отменяет транзакцию в базе данных.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">public</span>
                    <span class="phpdocumentor-signature__name">rollback_transaction</span><span>(</span><span class="phpdocumentor-signature__argument"><span>[</span><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$context</span><span> = </span><span class="phpdocumentor-signature__argument__default-value">&#039;&#039;</span><span> ]</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">void</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот публичный метод является обёрткой для защищённого метода <code class="prettyprint">_roll_back_transaction_internal()</code>. Он передаёт
контекст транзакции во внутренний метод, который выполняет отмену транзакции на уровне PDO и записывает
соответствующий лог. Метод предназначен для использования клиентским кодом как точка входа для явного
управления транзакциями.</p>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$context</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                 = <span class="phpdocumentor-signature__argument__default-value">&#039;&#039;</span>            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Контекст транзакции (необязательный параметр).
Используется для описания цели или места отмены транзакции.
По умолчанию: пустая строка (<code class="prettyprint">''</code>).</p>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-Database.html#method_rollback_transaction#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\Exception">Exception</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если произошла ошибка при отмене транзакции на уровне PDO или при логировании
(выбрасывается из внутренней логики).</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Этот метод является точкой входа для отмены транзакций.
Основная логика и логирование выполняются в защищённом методе <code class="prettyprint">_roll_back_transaction_internal()</code>.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Убедитесь, что транзакция была начата перед вызовом метода.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><abbr title="\PhotoRigma\Classes\Database::_roll_back_transaction_internal()">Database::_roll_back_transaction_internal()</abbr></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Защищённый метод, выполняющий основную
логику отмены транзакции.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">void</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Метод ничего не возвращает.</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -public
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method_select">
        select()
        <a href="classes/PhotoRigma-Classes-Database.html#method_select" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/Database.php"><a href="files/src-classes-database.html"><abbr title="src/Classes/Database.php">Database.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">2763</span>

    </aside>

        <p class="phpdocumentor-summary">Выполняет SQL-запрос на выборку данных из таблицы.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">public</span>
                    <span class="phpdocumentor-signature__name">select</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">string|array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$select</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$from_tbl</span></span><span class="phpdocumentor-signature__argument"><span>[</span><span>, </span><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$options</span><span> = </span><span class="phpdocumentor-signature__argument__default-value">[]</span><span> ]</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">bool</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот публичный метод является обёрткой для защищённого метода <code class="prettyprint">_select_internal()</code>. Он передаёт список полей
для выборки, имя таблицы и опции запроса во внутренний метод, который выполняет формирование и выполнение
SQL-запроса на выборку. Безопасность обеспечивается использованием подготовленных выражений с параметрами.
Метод предназначен для использования клиентским кодом как точка входа для выполнения запросов на выборку данных.</p>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$select</span>
                : <span class="phpdocumentor-signature__argument__return-type">string|array&lt;string|int, mixed&gt;</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Список полей для выборки. Может быть строкой (имя одного поля) или массивом
(список полей). Если передан массив, он преобразуется в строку с разделителем
<code class="prettyprint">,</code>. Пример: &quot;id&quot;, [&quot;id&quot;, &quot;name&quot;]. Ограничения: массив не может содержать
элементы, которые не являются строками.</p>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$from_tbl</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Имя таблицы, из которой выбираются данные.
Должно быть строкой, содержащей только допустимые имена таблиц без специальных
символов. Ограничения: строка должна быть непустой.</p>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$options</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                 = <span class="phpdocumentor-signature__argument__default-value">[]</span>            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Массив дополнительных опций для формирования запроса. Поддерживаемые ключи:</p>
<ul>
<li>where (string|array|false): Условие WHERE.
<ul>
<li>string - используется как есть.</li>
<li>array - преобразуется в SQL. Поддерживает простые условия
(<code class="prettyprint">['поле' =&gt; значение]</code>) и логические операторы (<code class="prettyprint">'OR' =&gt; [...]</code>,
<code class="prettyprint">'NOT' =&gt; [...]</code>).</li>
<li>false - игнорируется.</li>
</ul>
</li>
<li>group (string|false): Группировка GROUP BY. Игнорируется, если false.
Должна быть строкой.</li>
<li>order (string|false): Сортировка ORDER BY. Игнорируется, если false.
Должна быть строкой.</li>
<li>limit (int|string|false): Ограничение LIMIT.
<ul>
<li>int - прямое значение.</li>
<li>string - формат &quot;OFFSET,COUNT&quot;.</li>
<li>false - игнорируется.</li>
</ul>
</li>
<li>params (array): Ассоциативный массив параметров
([&quot;:имя&quot; =&gt; значение]).
Обязателен для использования с условиями <code class="prettyprint">where</code> и другими частями запроса,
требующими подготовленных выражений. Обеспечивает защиту от SQL-инъекций.
Может быть пустым массивом, если параметры не требуются.</li>
</ul>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-Database.html#method_select#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\InvalidArgumentException">InvalidArgumentException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если:</p>
<ul>
<li><code class="prettyprint">$from_tbl</code> не является строкой.</li>
<li><code class="prettyprint">$options</code> не является массивом.</li>
<li><code class="prettyprint">$select</code> не является строкой или массивом.</li>
<li>Элемент в списке <code class="prettyprint">$select</code> не является строкой.</li>
</ul>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\Exception">Exception</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается при ошибках выполнения запроса.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Этот метод является точкой входа для выполнения запросов на выборку данных.
Все проверки и основная логика выполняются в защищённом методе <code class="prettyprint">_select_internal()</code>.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Метод чувствителен к корректности входных данных. Неверные типы данных или некорректные значения могут
привести к выбросу исключения. Убедитесь, что массив <code class="prettyprint">$select</code> содержит только строки.
Использование параметров <code class="prettyprint">params</code> для подготовленных выражений является обязательным для защиты от
SQL-инъекций и обеспечения совместимости с различными СУБД.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__select_internal"><abbr title="\PhotoRigma\Classes\Database::_select_internal()">Database::_select_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Защищённый метод, выполняющий основную логику
формирования и выполнения SQL-запроса на выборку.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">bool</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Возвращает true, если запрос успешно выполнен (даже если результат пустой).</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -public
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method_truncate">
        truncate()
        <a href="classes/PhotoRigma-Classes-Database.html#method_truncate" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/Database.php"><a href="files/src-classes-database.html"><abbr title="src/Classes/Database.php">Database.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">2896</span>

    </aside>

        <p class="phpdocumentor-summary">Очищает таблицу (TRUNCATE) через вызов внутреннего метода.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">public</span>
                    <span class="phpdocumentor-signature__name">truncate</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$from_tbl</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">bool</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот публичный метод является обёрткой для защищённого метода <code class="prettyprint">_truncate_internal()</code>. Он передаёт имя таблицы
во внутренний метод, который формирует и выполняет SQL-запрос <code class="prettyprint">TRUNCATE TABLE</code>. Запрос TRUNCATE является
быстрым способом удаления всех строк из таблицы, но его невозможно отменить через транзакции. Метод
предназначен для использования клиентским кодом как точка входа для выполнения операции очистки таблицы.</p>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$from_tbl</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Имя таблицы, которую необходимо очистить.
Должно быть строкой, содержащей только допустимые имена таблиц без специальных символов.
Ограничения: строка должна быть непустой.</p>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-Database.html#method_truncate#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\InvalidArgumentException">InvalidArgumentException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если имя таблицы недопустимо (выбрасывается из внутренней логики).</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\Exception">Exception</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается при ошибках выполнения запроса.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Этот метод является точкой входа для очистки таблицы.
Основная логика выполняется в защищённом методе <code class="prettyprint">_truncate_internal()</code>.
Помните, что TRUNCATE - это необратимая операция, которая не участвует в транзакциях.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Метод чувствителен к корректности входных данных. Убедитесь, что <code class="prettyprint">$from_tbl</code> содержит корректное имя
таблицы.
Используйте этот метод с крайней осторожностью, так как данные будут удалены без возможности
восстановления через ROLLBACK.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__truncate_internal"><abbr title="\PhotoRigma\Classes\Database::_truncate_internal()">Database::_truncate_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Защищённый метод, выполняющий основную логику очистки
таблицы.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">bool</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Возвращает <code class="prettyprint">true</code>, если запрос успешно выполнен (даже если результат пустой или не возвращает строк).</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -public
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method_update">
        update()
        <a href="classes/PhotoRigma-Classes-Database.html#method_update" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/Database.php"><a href="files/src-classes-database.html"><abbr title="src/Classes/Database.php">Database.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">3003</span>

    </aside>

        <p class="phpdocumentor-summary">Обновляет данные в таблице через вызов внутреннего метода.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">public</span>
                    <span class="phpdocumentor-signature__name">update</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$update</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$from_tbl</span></span><span class="phpdocumentor-signature__argument"><span>[</span><span>, </span><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$options</span><span> = </span><span class="phpdocumentor-signature__argument__default-value">[]</span><span> ]</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">bool</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот публичный метод является обёрткой для защищённого метода <code class="prettyprint">_update_internal()</code>. Он передаёт массив данных
для обновления, имя таблицы и опции запроса во внутренний метод, который выполняет формирование и выполнение
SQL-запроса на обновление. Безопасность обеспечивается обязательным указанием условия <code class="prettyprint">where</code> в опциях и
использованием подготовленных выражений с параметрами. Метод предназначен для использования клиентским кодом
как точка входа для выполнения операций обновления данных.</p>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$update</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Ассоциативный массив данных для обновления в формате: 'имя_поля' =&gt; 'значение'.
Пример: [&quot;name&quot; =&gt; &quot;:name&quot;, &quot;status&quot; =&gt; &quot;:status&quot;].
Для защиты от SQL-инъекций рекомендуется использовать плейсхолдеры (например,
<code class="prettyprint">:name</code>).</p>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$from_tbl</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Имя таблицы, в которой необходимо обновить данные.
Должно быть строкой, содержащей только допустимые имена таблиц без специальных
символов. Ограничения: строка должна быть непустой.</p>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$options</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                 = <span class="phpdocumentor-signature__argument__default-value">[]</span>            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Массив опций для формирования запроса. Поддерживаемые ключи:</p>
<ul>
<li>where (string|array|false): Условие WHERE.
<ul>
<li>string - используется как есть.</li>
<li>array - преобразуется в SQL. Поддерживает простые условия
(<code class="prettyprint">['поле' =&gt; значение]</code>) и логические операторы (<code class="prettyprint">'OR' =&gt; [...]</code>,
<code class="prettyprint">'NOT' =&gt; [...]</code>).</li>
<li>false - игнорируется.
Обязательный параметр для безопасности. Без условия WHERE запрос не будет выполнен.</li>
</ul>
</li>
<li>group (string|false): Группировка GROUP BY. Игнорируется, если false.
Должна быть строкой.
Не поддерживается в запросах UPDATE и удаляется с записью в лог.</li>
<li>order (string|false): Сортировка ORDER BY. Игнорируется, если false.
Должна быть строкой.</li>
<li>limit (int|string|false): Ограничение LIMIT.
<ul>
<li>int - прямое значение.</li>
<li>string - формат &quot;OFFSET,COUNT&quot;.</li>
<li>false - игнорируется.</li>
</ul>
</li>
<li>params (array): Ассоциативный массив параметров
([&quot;:имя&quot; =&gt; значение]).
Обязателен для использования с данными для обновления или условиями <code class="prettyprint">where</code>,
требующими подготовленных выражений. Обеспечивает защиту от SQL-инъекций.
Может быть пустым массивом, если параметры не требуются.</li>
</ul>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-Database.html#method_update#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\InvalidArgumentException">InvalidArgumentException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если:</p>
<ul>
<li><code class="prettyprint">$update</code> не является массивом.</li>
<li><code class="prettyprint">$from_tbl</code> не является строкой.</li>
<li><code class="prettyprint">$options</code> не является массивом.</li>
<li>Отсутствует обязательное условие <code class="prettyprint">where</code> в массиве <code class="prettyprint">$options</code>.</li>
</ul>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\JsonException">JsonException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается при ошибках записи лога.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\Exception">Exception</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается при ошибках выполнения запроса.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Этот метод является точкой входа для выполнения операций обновления данных.
Все проверки (включая обязательное <code class="prettyprint">where</code>) и основная логика выполняются в защищённом методе
<code class="prettyprint">_update_internal()</code>. Ключ <code class="prettyprint">group</code> игнорируется в этом методе.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Метод чувствителен к корректности входных данных. Неверные типы данных или некорректные значения могут
привести к выбросу исключения. Безопасность обеспечивается обязательным указанием условия <code class="prettyprint">where</code>.
Запрос без условия <code class="prettyprint">where</code> не будет выполнен. Ключ <code class="prettyprint">group</code> не поддерживается в запросах UPDATE и
удаляется с записью в лог во внутренней логике.
Использование параметров <code class="prettyprint">params</code> для подготовленных выражений является обязательным для защиты от
SQL-инъекций и обеспечения совместимости с различными СУБД.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__update_internal"><abbr title="\PhotoRigma\Classes\Database::_update_internal()">Database::_update_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Защищённый метод, выполняющий основную логику
обновления данных.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">bool</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Возвращает true, если запрос успешно выполнен (даже если результат пустой).</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -public
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method_with_sql_format">
        with_sql_format()
        <a href="classes/PhotoRigma-Classes-Database.html#method_with_sql_format" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/Database.php"><a href="files/src-classes-database.html"><abbr title="src/Classes/Database.php">Database.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">3178</span>

    </aside>

        <p class="phpdocumentor-summary">Временно изменяет формат SQL для выполнения запросов.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">public</span>
                    <span class="phpdocumentor-signature__name">with_sql_format</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$format</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">callable&nbsp;</span><span class="phpdocumentor-signature__argument__name">$callback</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">mixed</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот публичный метод является обёрткой для защищённого метода <code class="prettyprint">_with_sql_format_internal()</code>.
Он принимает желаемый временный формат SQL и коллбэк, а затем выполняет внутренний метод.
Внутренний метод устанавливает временный формат SQL перед выполнением коллбэка и гарантирует восстановление
исходного формата после его завершения, даже в случае исключения.
Метод предназначен для использования клиентским кодом для выполнения набора операций с базой данных, которые
требуют специфического формата SQL, отличного от текущего.</p>
<pre class="prettyprint"><code class="language-php">// Пример выполнения запросов в формате PostgreSQL
$db = new \PhotoRigma\Classes\Database();
// Предполагается, что TBL_NEWS определена как константа

$years_list = $db-&gt;with_sql_format('pgsql', function (\PhotoRigma\Classes\Database $db) {
    // Внутри этого коллбэка $db-&gt;current_format установлен в 'pgsql'
    $formatted_date = $db-&gt;format_date('data_last_edit', 'YYYY');
    $db-&gt;select(
        'DISTINCT ' . $formatted_date . ' AS year',
        TBL_NEWS,
        [
            'order' =&gt; 'year ASC',
        ]
    );
    return $db-&gt;result_array();
});
print_r($years_list);

// После завершения коллбэка, исходный формат SQL восстанавливается автоматически.
</code></pre>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$format</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Формат SQL, который нужно использовать временно.
Поддерживаемые значения: 'mysql', 'pgsql', 'sqlite'.</p>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$callback</span>
                : <span class="phpdocumentor-signature__argument__return-type">callable</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Коллбэк, содержащий код, который должен выполняться
в контексте указанного формата SQL. Коллбэк может принимать ссылку на текущий
объект базы данных как аргумент (например, <code class="prettyprint">function (\PhotoRigma\Classes\Database $db) { ... }</code>).</p>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-Database.html#method_with_sql_format#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\InvalidArgumentException">InvalidArgumentException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если указан неподдерживаемый формат SQL (выбрасывается из
внутренней логики).</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\Exception">Exception</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Любые исключения, выброшенные внутри переданного коллбэка, будут автоматически
распространены (не перехватываются этим методом).</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Этот метод является точкой входа для временного изменения формата SQL.
Основная логика смены и восстановления формата выполняется в защищённом методе
<code class="prettyprint">_with_sql_format_internal()</code>. Убедитесь, что код внутри коллбэка не содержит собственных блоков
<code class="prettyprint">try/catch</code> для исключений, которые должны быть обработаны на более высоком уровне.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Важные замечания:</p>
<ol>
<li>Убедитесь, что все методы текущего класса <code class="prettyprint">$db-&gt;...()</code>, вызываемые внутри коллбэка, корректно
работают с указанным временным форматом SQL.</li>
<li><strong>Особая осторожность:</strong> Не используйте внутри коллбэка методы <strong>других</strong> классов,
которые напрямую зависят от объекта <code class="prettyprint">$db</code> и при этом написаны с жесткой привязкой к
определенному формату SQL (например, парсят SQL-строки, не учитывая временное изменение формата
в объекте <code class="prettyprint">$db</code>). Это может привести к непредсказуемому поведению или ошибкам.</li>
<li>Исключения, выброшенные внутри коллбэка, <strong>не перехватываются</strong> этим методом; они
будут распространяться (пробрасываться) дальше.</li>
</ol>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__with_sql_format_internal"><abbr title="\PhotoRigma\Classes\Database::_with_sql_format_internal()">Database::_with_sql_format_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Защищённый метод, выполняющий основную логику
временной смены формата SQL.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">mixed</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Результат выполнения коллбэка <code class="prettyprint">$callback</code>.</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -protected
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method__begin_transaction_internal">
        _begin_transaction_internal()
        <a href="classes/PhotoRigma-Classes-Database.html#method__begin_transaction_internal" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/Database.php"><a href="files/src-classes-database.html"><abbr title="src/Classes/Database.php">Database.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">472</span>

    </aside>

        <p class="phpdocumentor-summary">Начинает транзакцию в базе данных и записывает лог с указанием контекста.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">protected</span>
                    <span class="phpdocumentor-signature__name">_begin_transaction_internal</span><span>(</span><span class="phpdocumentor-signature__argument"><span>[</span><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$context</span><span> = </span><span class="phpdocumentor-signature__argument__default-value">&#039;&#039;</span><span> ]</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">void</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот защищённый метод выполняет следующие действия:</p>
<ol>
<li>Начинает транзакцию в базе данных через объект PDO (<code class="prettyprint">$this-&gt;pdo</code>).</li>
<li>Записывает лог с указанием контекста начала транзакции с использованием функции <code class="prettyprint">log_in_file()</code>.
Этот метод предназначен для использования внутри класса или его наследников. Основная логика метода вызывается
через публичный метод-редирект <code class="prettyprint">begin_transaction()</code>.</li>
</ol>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$context</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                 = <span class="phpdocumentor-signature__argument__default-value">&#039;&#039;</span>            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Контекст транзакции (необязательный параметр).
Используется для описания цели или места начала транзакции.
По умолчанию: пустая строка (<code class="prettyprint">''</code>).</p>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-Database.html#method__begin_transaction_internal#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">protected</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                             
                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\Exception">Exception</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если произошла ошибка при начале транзакции на уровне PDO.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Метод использует функцию логирования <code class="prettyprint">log_in_file()</code> для записи информации о начале транзакции.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Убедитесь, что соединение с базой данных установлено (<code class="prettyprint">$this-&gt;pdo</code> является валидным объектом PDO)
перед вызовом метода. Неправильное состояние соединения может привести к ошибке.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#property_pdo"><abbr title="\PhotoRigma\Classes\Database::$pdo">Database::$pdo</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Объект PDO для подключения к базе данных.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="namespaces/photorigma-include.html#function_log_in_file"><abbr title="\PhotoRigma\Include\log_in_file()">log_in_file()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Записывает сообщение об ошибке в лог-файл.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method_begin_transaction"><abbr title="\PhotoRigma\Classes\Database::begin_transaction()">Database::begin_transaction()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Защищённый метод, выполняющий основную
логику начала транзакции.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">void</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Метод ничего не возвращает.</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -protected
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method__commit_transaction_internal">
        _commit_transaction_internal()
        <a href="classes/PhotoRigma-Classes-Database.html#method__commit_transaction_internal" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/Database.php"><a href="files/src-classes-database.html"><abbr title="src/Classes/Database.php">Database.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">537</span>

    </aside>

        <p class="phpdocumentor-summary">Подтверждает транзакцию в базе данных и записывает лог с указанием контекста.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">protected</span>
                    <span class="phpdocumentor-signature__name">_commit_transaction_internal</span><span>(</span><span class="phpdocumentor-signature__argument"><span>[</span><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$context</span><span> = </span><span class="phpdocumentor-signature__argument__default-value">&#039;&#039;</span><span> ]</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">void</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот защищённый метод выполняет следующие действия:</p>
<ol>
<li>Подтверждает транзакцию в базе данных через объект PDO (<code class="prettyprint">$this-&gt;pdo</code>).</li>
<li>Записывает лог с указанием контекста подтверждения транзакции с использованием функции <code class="prettyprint">log_in_file()</code>.
Этот метод предназначен для использования внутри класса или его наследников. Основная логика метода вызывается
через публичный метод-редирект <code class="prettyprint">commit_transaction()</code>.</li>
</ol>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$context</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                 = <span class="phpdocumentor-signature__argument__default-value">&#039;&#039;</span>            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Контекст транзакции (необязательный параметр).
Используется для описания цели или места подтверждения транзакции.
По умолчанию: пустая строка (<code class="prettyprint">''</code>).</p>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-Database.html#method__commit_transaction_internal#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">protected</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                             
                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\Exception">Exception</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если произошла ошибка при подтверждении транзакции на уровне PDO.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Метод использует функцию логирования <code class="prettyprint">log_in_file()</code> для записи информации о подтверждении транзакции.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Убедитесь, что транзакция была начата (<code class="prettyprint">$this-&gt;pdo-&gt;inTransaction()</code> возвращает <code class="prettyprint">true</code>) перед вызовом
этого метода. Попытка подтвердить несуществующую транзакцию приведёт к ошибке.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#property_pdo"><abbr title="\PhotoRigma\Classes\Database::$pdo">Database::$pdo</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Объект PDO для подключения к базе данных.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="namespaces/photorigma-include.html#function_log_in_file"><abbr title="\PhotoRigma\Include\log_in_file()">log_in_file()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Записывает сообщение об ошибке в лог-файл.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method_commit_transaction"><abbr title="\PhotoRigma\Classes\Database::commit_transaction()">Database::commit_transaction()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Защищённый метод, выполняющий основную
логику подтверждения транзакции.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">void</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Метод ничего не возвращает.</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -protected
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method__delete_internal">
        _delete_internal()
        <a href="classes/PhotoRigma-Classes-Database.html#method__delete_internal" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/Database.php"><a href="files/src-classes-database.html"><abbr title="src/Classes/Database.php">Database.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">688</span>

    </aside>

        <p class="phpdocumentor-summary">Формирует SQL-запрос на удаление данных из таблицы, проверяет входные данные, обрабатывает недопустимые
ключи, сохраняет текст запроса в свойстве `$txt_query` и выполняет его.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">protected</span>
                    <span class="phpdocumentor-signature__name">_delete_internal</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$from_tbl</span></span><span class="phpdocumentor-signature__argument"><span>[</span><span>, </span><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$options</span><span> = </span><span class="phpdocumentor-signature__argument__default-value">[]</span><span> ]</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">bool</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот метод выполняет следующие шаги:</p>
<ol>
<li>Проверяет типы входных данных: <code class="prettyprint">$from_tbl</code> (строка), <code class="prettyprint">$options</code> (массив).</li>
<li>Проверяет наличие обязательного условия <code class="prettyprint">where</code> в массиве <code class="prettyprint">$options</code>. Если условие отсутствует,
выбрасывается исключение для предотвращения случайного удаления всех данных.</li>
<li>Проверяет и удаляет недопустимые ключи из массива <code class="prettyprint">$options</code>:
<ul>
<li>Ключ <code class="prettyprint">group</code> не поддерживается в запросах DELETE и удаляется с записью в лог.</li>
<li>Ключи <code class="prettyprint">order</code> и <code class="prettyprint">limit</code> должны использоваться совместно. Если указан только один из них, оба удаляются с
записью в лог.</li>
</ul>
</li>
<li>Формирует базовый SQL-запрос на удаление данных и сохраняет его в свойстве <code class="prettyprint">$txt_query</code>.</li>
<li>Добавляет условия WHERE, ORDER BY и LIMIT (если они корректны) через метод <code class="prettyprint">_build_conditions</code>.</li>
<li>Выполняет сформированный запрос через метод <code class="prettyprint">_execute_query</code>, передавая параметры <code class="prettyprint">params</code> для
подготовленного выражения.</li>
</ol>
<p>Использование параметров <code class="prettyprint">params</code> является обязательным для подготовленных выражений, так как это обеспечивает
защиту от SQL-инъекций и совместимость с различными СУБД.
Этот метод является защищенным и предназначен для использования внутри класса или его наследников. Основная
логика вызывается через публичный метод-редирект <code class="prettyprint">delete()</code>.</p>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$from_tbl</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Имя таблицы, из которой необходимо удалить данные.
Должно быть строкой, содержащей только допустимые имена таблиц без специальных символов.</p>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$options</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                 = <span class="phpdocumentor-signature__argument__default-value">[]</span>            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Массив дополнительных опций для формирования запроса. Поддерживаемые ключи:</p>
<ul>
<li>where (string|array|false): Условие WHERE.
<ul>
<li>string - используется как есть.</li>
<li>array - преобразуется в SQL. Поддерживает простые условия
(<code class="prettyprint">['поле' =&gt; значение]</code>) и логические операторы (<code class="prettyprint">'OR' =&gt; [...]</code>,
<code class="prettyprint">'NOT' =&gt; [...]</code>).</li>
<li>false - игнорируется.
Обязательный параметр для безопасности. Без условия WHERE запрос не будет выполнен.</li>
</ul>
</li>
<li>group (string|false): Группировка GROUP BY. Игнорируется, если false.
Должна быть строкой.
Не поддерживается в запросах DELETE и удаляется с записью в лог.</li>
<li>order (string|false): Сортировка ORDER BY. Игнорируется, если false.
Должна быть строкой.
Может использоваться только вместе с <code class="prettyprint">limit</code>. Если указан только один из них, оба
игнорируются с записью в лог.</li>
<li>limit (int|string|false): Ограничение LIMIT.
<ul>
<li>int - прямое значение.</li>
<li>string - формат &quot;OFFSET,COUNT&quot;.</li>
<li>false - игнорируется.
Может использоваться только вместе с <code class="prettyprint">order</code>. Если указан только один из них, оба
игнорируются с записью в лог.</li>
</ul>
</li>
<li>params (array): Ассоциативный массив параметров
([&quot;:имя&quot; =&gt; значение]).
Обязателен для использования с условиями <code class="prettyprint">where</code> и другими частями запроса,
требующими подготовленных выражений. Обеспечивает защиту от SQL-инъекций.
Может быть пустым массивом, если параметры не требуются.</li>
</ul>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-Database.html#method__delete_internal#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">protected</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                             
                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\InvalidArgumentException">InvalidArgumentException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если:</p>
<ul>
<li><code class="prettyprint">$from_tbl</code> не является строкой.</li>
<li><code class="prettyprint">$options</code> не является массивом.</li>
<li>Отсутствует обязательное условие <code class="prettyprint">where</code> в массиве <code class="prettyprint">$options</code>.</li>
</ul>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\JsonException">JsonException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается при ошибках кодирования JSON (например, при записи в лог).</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\Exception">Exception</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается при ошибках выполнения запроса или записи в лог.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Метод чувствителен к корректности входных данных. Неверные типы данных или некорректные значения могут
привести к выбросу исключения. Безопасность обеспечивается обязательным указанием условия <code class="prettyprint">where</code>.
Запрос без условия <code class="prettyprint">where</code> не будет выполнен. Ключи <code class="prettyprint">group</code>, <code class="prettyprint">order</code> и <code class="prettyprint">limit</code> проверяются на
корректность. Недопустимые ключи удаляются с записью в лог.
Использование параметров <code class="prettyprint">params</code> для подготовленных выражений является обязательным для защиты от
SQL-инъекций и обеспечения совместимости с различными СУБД. Игнорирование этого правила может привести
к уязвимостям безопасности и неправильной работе с базой данных.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__execute_query"><abbr title="\PhotoRigma\Classes\Database::_execute_query()">Database::_execute_query()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Выполняет SQL-запрос.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__build_conditions"><abbr title="\PhotoRigma\Classes\Database::_build_conditions()">Database::_build_conditions()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Формирует условия WHERE, ORDER BY и LIMIT для запроса.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#property_txt_query"><abbr title="\PhotoRigma\Classes\Database::$txt_query">Database::$txt_query</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, в которое помещается текст SQL-запроса.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="namespaces/photorigma-include.html#function_log_in_file"><abbr title="\PhotoRigma\Include\log_in_file()">log_in_file()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Записывает сообщение об ошибке в лог-файл.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method_delete"><abbr title="\PhotoRigma\Classes\Database::delete()">Database::delete()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Защищённый метод, выполняющий основную логику удаления
данных.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">bool</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Возвращает true, если запрос успешно выполнен (даже если результат пустой). В случае ошибки
выбрасывается исключение.</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -protected
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method__format_date_internal">
        _format_date_internal()
        <a href="classes/PhotoRigma-Classes-Database.html#method__format_date_internal" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/Database.php"><a href="files/src-classes-database.html"><abbr title="src/Classes/Database.php">Database.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">1674</span>

    </aside>

        <p class="phpdocumentor-summary">Формирует SQL-выражение для форматирования даты с учетом специфики используемой СУБД.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">protected</span>
                    <span class="phpdocumentor-signature__name">_format_date_internal</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$column</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$format</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">string</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот защищённый метод выполняет следующие шаги:</p>
<ol>
<li>Проверяет тип СУБД через свойство <code class="prettyprint">$this-&gt;db_type</code>.</li>
<li>Для MariaDB (MySQL) преобразует переданный формат <code class="prettyprint">$format</code> через метод <code class="prettyprint">_convert_to_mysql_format()</code> и
использует функцию <code class="prettyprint">DATE_FORMAT</code>.</li>
<li>Для PostgreSQL преобразует формат через метод <code class="prettyprint">_convert_to_postgres_format()</code> и использует функцию
<code class="prettyprint">TO_CHAR</code>. Метод принимает формат не только в стиле MySQL, но и другие поддерживаемые форматы.</li>
<li>Для SQLite преобразует формат через метод <code class="prettyprint">_convert_to_sqlite_format()</code> и использует функцию <code class="prettyprint">strftime</code>.
Метод принимает формат не только в стиле MySQL, но и другие поддерживаемые форматы.</li>
<li>Если тип СУБД не поддерживается, выбрасывает исключение InvalidArgumentException.
Этот метод является защищенным и предназначен для использования внутри класса или его наследников. Основная
логика вызывается через публичный метод-редирект <code class="prettyprint">format_date()</code>.</li>
</ol>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$column</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Название столбца с датой:</p>
<ul>
<li>Должен быть непустой строкой в формате имени столбца таблицы в БД.</li>
</ul>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$format</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Формат даты:</p>
<ul>
<li>Может быть указан в любом поддерживаемом формате (например, MySQL, PostgreSQL, SQLite).</li>
<li>Текущий формат определяется через свойство <code class="prettyprint">$this-&gt;current_format</code>.</li>
<li>Преобразование выполняется в зависимости от типа СУБД.</li>
</ul>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-Database.html#method__format_date_internal#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">protected</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                             
                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\InvalidArgumentException">InvalidArgumentException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если тип СУБД (<code class="prettyprint">$this-&gt;db_type</code>) не поддерживается.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Метод использует функции форматирования даты, специфичные для каждой СУБД. Текущий формат хранится в
свойстве <code class="prettyprint">$this-&gt;current_format</code>, а список допустимых форматов — в свойстве <code class="prettyprint">$this-&gt;allowed_formats</code>.
Для временного изменения текущего формата используется метод <code class="prettyprint">_with_sql_format_internal()</code>.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Убедитесь, что <code class="prettyprint">$column</code> (непустая строка) и <code class="prettyprint">$format</code> содержат корректные значения перед вызовом метода.
Неверный формат может привести к ошибкам при формировании SQL-запроса.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#property_db_type"><abbr title="\PhotoRigma\Classes\Database::$db_type">Database::$db_type</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Тип используемой СУБД.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#property_current_format"><abbr title="\PhotoRigma\Classes\Database::$current_format">Database::$current_format</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Текущий формат SQL.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#property_allowed_formats"><abbr title="\PhotoRigma\Classes\Database::$allowed_formats">Database::$allowed_formats</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Список допустимых форматов SQL.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__convert_to_mysql_format"><abbr title="\PhotoRigma\Classes\Database::_convert_to_mysql_format()">Database::_convert_to_mysql_format()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Преобразовывает формат даты в стиль MySQL.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__convert_to_postgres_format"><abbr title="\PhotoRigma\Classes\Database::_convert_to_postgres_format()">Database::_convert_to_postgres_format()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Преобразовывает формат даты в стиль PostgreSQL.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__convert_to_sqlite_format"><abbr title="\PhotoRigma\Classes\Database::_convert_to_sqlite_format()">Database::_convert_to_sqlite_format()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Преобразовывает формат даты в стиль SQLite.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method_format_date"><abbr title="\PhotoRigma\Classes\Database::format_date()">Database::format_date()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Защищённый метод, выполняющий основную логику
формирования SQL-выражения.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">string</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>SQL-выражение для форматирования даты.</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -protected
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method__full_text_search_internal">
        _full_text_search_internal()
        <a href="classes/PhotoRigma-Classes-Database.html#method__full_text_search_internal" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/Database.php"><a href="files/src-classes-database.html"><abbr title="src/Classes/Database.php">Database.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">3426</span>

    </aside>

        <p class="phpdocumentor-summary">Выполняет полнотекстовый поиск в указанной таблице по заданным столбцам.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">protected</span>
                    <span class="phpdocumentor-signature__name">_full_text_search_internal</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$columns_to_return</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$columns_to_search</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$search_string</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$table</span></span><span class="phpdocumentor-signature__argument"><span>[</span><span>, </span><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$options</span><span> = </span><span class="phpdocumentor-signature__argument__default-value">[]</span><span> ]</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">array&lt;string|int, mixed&gt;|false</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот защищённый метод является основной логикой для выполнения полнотекстового поиска и предназначен для
использования внутри класса или его наследников. Он выполняет следующие шаги:</p>
<ol>
<li>Валидация входных аргументов (<code class="prettyprint">$columns_to_return</code>, <code class="prettyprint">$columns_to_search</code>, <code class="prettyprint">$table</code>, <code class="prettyprint">$search_string</code>).
Проверяется их заполненность и тип.</li>
<li>Обработка специального символа <code class="prettyprint">*</code> в <code class="prettyprint">$search_string</code>: если строка поиска равна <code class="prettyprint">*</code>, выполняется обычный
запрос на выборку всех записей из таблицы с помощью внутреннего метода <code class="prettyprint">_select_internal()</code>, применяя при
этом фильтрацию опций через <code class="prettyprint">_fts_check_options()</code>, и возвращается результат через <code class="prettyprint">_result_array_internal()</code>.</li>
<li>Получение текущей версии базы данных из таблицы <code class="prettyprint">db_version</code> с использованием <code class="prettyprint">_select_internal()</code> и
<code class="prettyprint">_result_row_internal()</code>. Это необходимо для выбора корректного метода полнотекстового поиска в зависимости
от версии СУБД.</li>
<li>Снятие экранирования идентификаторов (имен столбцов и таблицы) с использованием метода
<code class="prettyprint">_unescape_identifiers()</code> для обеспечения корректности SQL-запроса.</li>
<li>Выбор и вызов специфического метода полнотекстового поиска в зависимости от типа используемой СУБД
(<code class="prettyprint">$this-&gt;db_type</code>). Используется конструкция <code class="prettyprint">match</code>.</li>
<li>Передача всех необходимых параметров в выбранный специфический метод поиска.</li>
</ol>
<p>Метод зависит от наличия и доступности таблицы <code class="prettyprint">db_version</code> и внутренних методов для работы с БД и кешем.</p>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$columns_to_return</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Массив строк с именами столбцов, данные из которых необходимо включить в
результат запроса.
Ограничения: массив не может быть пустым.</p>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$columns_to_search</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Массив строк с именами столбцов, по которым должен выполняться полнотекстовый
поиск.
Ограничения: массив не может быть пустым.</p>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$search_string</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Строка для полнотекстового поиска.</p>
<ul>
<li>Может содержать <code class="prettyprint">*</code> для выбора всех записей из таблицы (аналогично
обычному SELECT).
Ограничения: строка не может быть пустой (если не <code class="prettyprint">*</code>).</li>
</ul>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$table</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Строка с именем таблицы, в которой выполняется полнотекстовый поиск.
Ограничения: строка не может быть пустой и должна содержать допустимое имя
таблицы.</p>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$options</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                 = <span class="phpdocumentor-signature__argument__default-value">[]</span>            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Массив дополнительных опций для формирования запроса. Поддерживаемые ключи:</p>
<ul>
<li>where (string|array|false): Условие WHERE.
<ul>
<li>string - используется как есть.</li>
<li>array - преобразуется в SQL. Поддерживает простые условия
(<code class="prettyprint">['поле' =&gt; значение]</code>) и логические операторы (<code class="prettyprint">'OR' =&gt; [...]</code>,
<code class="prettyprint">'NOT' =&gt; [...]</code>).</li>
<li>false - игнорируется.</li>
</ul>
</li>
<li>group (string|false): Группировка GROUP BY. Игнорируется, если false.
Должна быть строкой.</li>
<li>order (string|false): Сортировка ORDER BY. Игнорируется, если false.
Должна быть строкой.</li>
<li>limit (int|string|false): Ограничение LIMIT.
<ul>
<li>int - прямое значение.</li>
<li>string - формат &quot;OFFSET,COUNT&quot;.</li>
<li>false - игнорируется.</li>
</ul>
</li>
<li>params (array): Ассоциативный массив параметров
([&quot;:имя&quot; =&gt; значение]).
Обязателен для использования с условиями <code class="prettyprint">where</code> и другими частями запроса,
требующими подготовленных выражений. Обеспечивает защиту от SQL-инъекций.
Может быть пустым массивом, если параметры не требуются.</li>
</ul>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-Database.html#method__full_text_search_internal#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">protected</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                             
                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\InvalidArgumentException">InvalidArgumentException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если:</p>
<ul>
<li>Один из обязательных аргументов (<code class="prettyprint">$columns_to_return</code>, <code class="prettyprint">$columns_to_search</code>,
<code class="prettyprint">$table</code>) пуст.</li>
<li><code class="prettyprint">$search_string</code> является пустой строкой (кроме символа <code class="prettyprint">*</code>).</li>
<li>Тип используемой СУБД (<code class="prettyprint">$this-&gt;db_type</code>) не поддерживается для полнотекстового
поиска.</li>
</ul>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\RuntimeException">RuntimeException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если не удалось получить корректную версию из таблицы <code class="prettyprint">db_version</code>.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\JsonException">JsonException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается при ошибках, связанных с кодированием/декодированием JSON,
например, при логировании конфигурации в сообщении об ошибке.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\Exception">Exception</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается при возникновении общих ошибок выполнения запроса на более
низких уровнях.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Убедитесь, что массивы <code class="prettyprint">$columns_to_return</code> и <code class="prettyprint">$columns_to_search</code> не пусты.
Проверьте, что <code class="prettyprint">$table</code> содержит корректное и непустое имя таблицы.
Строка поиска <code class="prettyprint">$search_string</code> не может быть пустой (за исключением <code class="prettyprint">*</code>).
Использование параметров <code class="prettyprint">params</code> в <code class="prettyprint">$options</code> обязательно для значений, подставляемых в запросы
(например, в условии <code class="prettyprint">where</code>), для предотвращения SQL-инъекций.
Метод зависит от наличия таблицы <code class="prettyprint">db_version</code> и корректного типа СУБД.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__select_internal"><abbr title="\PhotoRigma\Classes\Database::_select_internal()">Database::_select_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Используется для выборки всех записей при
<code class="prettyprint">$search_string = '*'</code> и для получения версии БД.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__result_array_internal"><abbr title="\PhotoRigma\Classes\Database::_result_array_internal()">Database::_result_array_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Используется для получения результата в виде
массива при <code class="prettyprint">$search_string = '*'</code>.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__result_row_internal"><abbr title="\PhotoRigma\Classes\Database::_result_row_internal()">Database::_result_row_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Используется для получения одной строки результата
(версии БД).</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__fts_check_options"><abbr title="\PhotoRigma\Classes\Database::_fts_check_options()">Database::_fts_check_options()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Используется для фильтрации опций при
<code class="prettyprint">$search_string = '*'</code>.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__unescape_identifiers"><abbr title="\PhotoRigma\Classes\Database::_unescape_identifiers()">Database::_unescape_identifiers()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Используется для снятия экранирования имен
столбцов и таблицы.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__full_text_search_mysql"><abbr title="\PhotoRigma\Classes\Database::_full_text_search_mysql()">Database::_full_text_search_mysql()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Специфический метод для полнотекстового поиска в
MySQL.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__full_text_search_pgsql"><abbr title="\PhotoRigma\Classes\Database::_full_text_search_pgsql()">Database::_full_text_search_pgsql()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Специфический метод для полнотекстового поиска в
PostgreSQL.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__full_text_search_sqlite"><abbr title="\PhotoRigma\Classes\Database::_full_text_search_sqlite()">Database::_full_text_search_sqlite()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Специфический метод для полнотекстового поиска
в SQLite.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#property_db_type"><abbr title="\PhotoRigma\Classes\Database::$db_type">Database::$db_type</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, хранящее тип текущей СУБД.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method_full_text_search"><abbr title="\PhotoRigma\Classes\Database::full_text_search()">Database::full_text_search()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Защищённый метод, выполняющий основную логику
полнотекстового поиска.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">array&lt;string|int, mixed&gt;|false</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Возвращает результат выполнения запроса в виде ассоциативного массива строк или false,
если результат пустой или произошла ошибка.</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -protected
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method__get_affected_rows_internal">
        _get_affected_rows_internal()
        <a href="classes/PhotoRigma-Classes-Database.html#method__get_affected_rows_internal" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/Database.php"><a href="files/src-classes-database.html"><abbr title="src/Classes/Database.php">Database.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">2033</span>

    </aside>

        <p class="phpdocumentor-summary">Возвращает количество строк, затронутых последним SQL-запросом, после проверки состояния свойства `$aff_rows`.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">protected</span>
                    <span class="phpdocumentor-signature__name">_get_affected_rows_internal</span><span>(</span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">int</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот защищённый метод выполняет следующие шаги:</p>
<ol>
<li>Проверяет, что свойство <code class="prettyprint">$this-&gt;aff_rows</code> установлено. Если это не так, выбрасывается исключение
InvalidArgumentException.</li>
<li>Проверяет, что значение свойства <code class="prettyprint">$this-&gt;aff_rows</code> является целым числом. Если это не так, выбрасывается
исключение InvalidArgumentException.</li>
<li>Возвращает значение свойства <code class="prettyprint">$this-&gt;aff_rows</code>, которое представляет собой количество строк, затронутых
последним SQL-запросом (операциями INSERT, UPDATE, DELETE, REPLACE).
Метод только читает значение свойства <code class="prettyprint">$this-&gt;aff_rows</code> и не выполняет дополнительной логики для его
обновления. Значение <code class="prettyprint">$this-&gt;aff_rows</code> должно быть установлено внешними методами, такими как
<code class="prettyprint">_execute_query()</code>, <code class="prettyprint">delete()</code>, <code class="prettyprint">update()</code> или <code class="prettyprint">insert()</code>.
Этот метод является защищенным и предназначен для использования внутри класса или его наследников. Основная
логика вызывается через публичный метод-редирект <code class="prettyprint">get_affected_rows()</code>.</li>
</ol>
</section>

    
    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-Database.html#method__get_affected_rows_internal#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">protected</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                             
                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\InvalidArgumentException">InvalidArgumentException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если:</p>
<ul>
<li>Свойство <code class="prettyprint">$this-&gt;aff_rows</code> не установлено (т.е. не было выполнено запроса,
обновляющего его).</li>
<li>Значение свойства <code class="prettyprint">$this-&gt;aff_rows</code> не является целым числом (указывает на
некорректное состояние).</li>
</ul>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Метод чувствителен к состоянию свойства <code class="prettyprint">$this-&gt;aff_rows</code>. Убедитесь, что перед вызовом метода был
выполнен запрос (например, INSERT, UPDATE, DELETE), который корректно установил значение
<code class="prettyprint">$this-&gt;aff_rows</code> как целое число.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#property_aff_rows"><abbr title="\PhotoRigma\Classes\Database::$aff_rows">Database::$aff_rows</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, хранящее количество строк, затронутых последним запросом.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method_get_affected_rows"><abbr title="\PhotoRigma\Classes\Database::get_affected_rows()">Database::get_affected_rows()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Защищённый метод, выполняющий основную
логику получения количества затронутых строк.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">int</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Количество строк, затронутых последним SQL-запросом.</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -protected
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method__get_last_insert_id_internal">
        _get_last_insert_id_internal()
        <a href="classes/PhotoRigma-Classes-Database.html#method__get_last_insert_id_internal" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/Database.php"><a href="files/src-classes-database.html"><abbr title="src/Classes/Database.php">Database.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">2105</span>

    </aside>

        <p class="phpdocumentor-summary">Возвращает ID последней вставленной строки после проверки состояния свойства `$insert_id`.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">protected</span>
                    <span class="phpdocumentor-signature__name">_get_last_insert_id_internal</span><span>(</span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">int</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот защищённый метод выполняет следующие шаги:</p>
<ol>
<li>Проверяет, что свойство <code class="prettyprint">$this-&gt;insert_id</code> установлено. Если это не так, выбрасывается исключение
InvalidArgumentException.</li>
<li>Проверяет, что значение свойства <code class="prettyprint">$this-&gt;insert_id</code> является целым числом. Если это не так, выбрасывается
исключение InvalidArgumentException.</li>
<li>Возвращает значение свойства <code class="prettyprint">$this-&gt;insert_id</code>, которое представляет собой ID последней вставленной строки.
Метод только читает значение свойства <code class="prettyprint">$this-&gt;insert_id</code> и не выполняет дополнительной логики для его
обновления. Значение <code class="prettyprint">$this-&gt;insert_id</code> должно быть установлено внешними методами, такими как
<code class="prettyprint">_execute_query()</code> или <code class="prettyprint">insert()</code>.
Этот метод является защищенным и предназначен для использования внутри класса или его наследников. Основная
логика вызывается через публичный метод-редирект <code class="prettyprint">get_last_insert_id()</code>.</li>
</ol>
</section>

    
    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-Database.html#method__get_last_insert_id_internal#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">protected</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                             
                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\InvalidArgumentException">InvalidArgumentException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если:</p>
<ul>
<li>Свойство <code class="prettyprint">$this-&gt;insert_id</code> не установлено (т.е. не было выполнено запроса,
устанавливающего его).</li>
<li>Значение свойства <code class="prettyprint">$this-&gt;insert_id</code> не является целым числом (указывает на
некорректное состояние).</li>
</ul>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Метод чувствителен к состоянию свойства <code class="prettyprint">$this-&gt;insert_id</code>. Убедитесь, что перед вызовом метода был
выполнен запрос (например, INSERT), который корректно установил значение <code class="prettyprint">$this-&gt;insert_id</code> как целое
число.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#property_insert_id"><abbr title="\PhotoRigma\Classes\Database::$insert_id">Database::$insert_id</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, хранящее ID последней вставленной строки.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method_get_last_insert_id"><abbr title="\PhotoRigma\Classes\Database::get_last_insert_id()">Database::get_last_insert_id()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Защищённый метод, выполняющий основную
логику получения ID последней вставленной
строки.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">int</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>ID последней вставленной строки.</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -protected
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method__insert_internal">
        _insert_internal()
        <a href="classes/PhotoRigma-Classes-Database.html#method__insert_internal" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/Database.php"><a href="files/src-classes-database.html"><abbr title="src/Classes/Database.php">Database.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">2250</span>

    </aside>

        <p class="phpdocumentor-summary">Формирует SQL-запрос на вставку данных в таблицу, проверяет входные данные, обрабатывает различные типы
запросов, сохраняет текст запроса в свойстве `$txt_query` и выполняет его.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">protected</span>
                    <span class="phpdocumentor-signature__name">_insert_internal</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$insert</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$to_tbl</span></span><span class="phpdocumentor-signature__argument"><span>[</span><span>, </span><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$type</span><span> = </span><span class="phpdocumentor-signature__argument__default-value">&#039;&#039;</span><span> ]</span></span><span class="phpdocumentor-signature__argument"><span>[</span><span>, </span><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$options</span><span> = </span><span class="phpdocumentor-signature__argument__default-value">[]</span><span> ]</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">bool</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот защищённый метод выполняет следующие шаги:</p>
<ol>
<li>Валидация входных данных: <code class="prettyprint">$insert</code> (ассоциативный массив), <code class="prettyprint">$to_tbl</code> (строка), <code class="prettyprint">$type</code> (строка),
<code class="prettyprint">$options</code> (массив).</li>
<li>Проверяет, что массив <code class="prettyprint">$insert</code> не пустой. Если массив пустой, выбрасывается исключение.</li>
<li>Нормализует параметр <code class="prettyprint">$type</code>, приводя его к нижнему регистру, и проверяет на допустимые значения:
<code class="prettyprint">'ignore'</code>, <code class="prettyprint">'replace'</code>, <code class="prettyprint">'into'</code>, <code class="prettyprint">''</code>. Если указан недопустимый тип, выбрасывается исключение.</li>
<li>Определяет тип запроса на основе параметра <code class="prettyprint">$type</code>:
<ul>
<li><code class="prettyprint">'ignore'</code>: Формирует запрос типа &quot;INSERT IGNORE INTO&quot;.</li>
<li><code class="prettyprint">'replace'</code>: Формирует запрос типа &quot;REPLACE INTO&quot;.</li>
<li><code class="prettyprint">'into'</code> или пустая строка (<code class="prettyprint">''</code>): Формирует запрос типа &quot;INSERT INTO&quot; (по умолчанию).</li>
</ul>
</li>
<li>Формирует базовый SQL-запрос INSERT с использованием преобразованных данных и сохраняет его в свойстве
<code class="prettyprint">$txt_query</code>.</li>
<li>Выполняет сформированный запрос через метод <code class="prettyprint">_execute_query</code>, передавая параметры <code class="prettyprint">params</code> из <code class="prettyprint">$options</code>
для подготовленного выражения.
Использование параметров <code class="prettyprint">params</code> является обязательным для подготовленных выражений, так как это обеспечивает
защиту от SQL-инъекций и совместимость с различными СУБД. Этот метод является защищенным и предназначен для
использования внутри класса или его наследников. Основная логика вызывается через публичный метод-редирект
<code class="prettyprint">insert()</code>.</li>
</ol>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$insert</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Ассоциативный массив данных для вставки в формате: 'имя_поля' =&gt; 'значение' или
'имя_поля' =&gt; ':плейсхолдер'.
Если передан пустой массив, выбрасывается исключение.</p>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$to_tbl</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Имя таблицы, в которую необходимо вставить данные.
Должно быть строкой, содержащей только допустимые имена таблиц без специальных
символов.</p>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$type</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                 = <span class="phpdocumentor-signature__argument__default-value">&#039;&#039;</span>            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Тип запроса (необязательно). Определяет тип SQL-запроса на вставку. Допустимые
значения:</p>
<ul>
<li>'ignore': Формирует запрос типа &quot;INSERT IGNORE INTO&quot;.</li>
<li>'replace': Формирует запрос типа &quot;REPLACE INTO&quot;.</li>
<li>'into': Формирует запрос типа &quot;INSERT INTO&quot; (явное указание).</li>
<li>'' (пустая строка): Формирует запрос типа &quot;INSERT INTO&quot; (по умолчанию).
Если указан недопустимый тип, выбрасывается исключение InvalidArgumentException.</li>
</ul>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$options</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                 = <span class="phpdocumentor-signature__argument__default-value">[]</span>            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Массив опций для формирования запроса. Поддерживаемые ключи:</p>
<ul>
<li>params (array): Параметры для подготовленного выражения. Ассоциативный массив
значений, используемых в запросе (например, [&quot;:name&quot; =&gt; &quot;John Doe&quot;, &quot;:email&quot; =&gt;
&quot;john@local.com&quot;]).
Обязателен для использования с данными для вставки, требующими
подготовленных выражений. Обеспечивает защиту от SQL-инъекций.
Может быть пустым массивом, если параметры не требуются.</li>
<li>where (string|array|false): Условие WHERE. Игнорируется в этом методе.</li>
<li>group (string|false): Группировка GROUP BY. Игнорируется в этом методе.</li>
<li>order (string|false): Сортировка ORDER BY. Игнорируется в этом методе.</li>
<li>limit (int|string|false): Ограничение LIMIT. Игнорируется в этом методе.</li>
</ul>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-Database.html#method__insert_internal#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">protected</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                             
                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\InvalidArgumentException">InvalidArgumentException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если:</p>
<ul>
<li><code class="prettyprint">$insert</code> не является массивом или является пустым массивом.</li>
<li><code class="prettyprint">$to_tbl</code> не является строкой.</li>
<li><code class="prettyprint">$type</code> содержит недопустимое значение (не '', 'ignore', 'replace', 'into').</li>
<li><code class="prettyprint">$options</code> не является массивом.</li>
</ul>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\Exception">Exception</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается при ошибках выполнения запроса.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Метод чувствителен к корректности входных данных. Неверные типы данных или некорректные значения могут
привести к выбросу исключения. Убедитесь, что массив <code class="prettyprint">$insert</code> не пустой и содержит корректные данные.
Параметр <code class="prettyprint">$type</code> должен быть одним из допустимых значений: '', 'ignore', 'replace', 'into'.
Использование параметров <code class="prettyprint">params</code> для подготовленных выражений является обязательным для защиты от
SQL-инъекций и обеспечения совместимости с различными СУБД. Игнорирование этого правила может привести
к уязвимостям безопасности и неправильной работе с базой данных.
Другие ключи массива <code class="prettyprint">$options</code> (<code class="prettyprint">where</code>, <code class="prettyprint">group</code>, <code class="prettyprint">order</code>, <code class="prettyprint">limit</code>) игнорируются в этом методе.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#property_txt_query"><abbr title="\PhotoRigma\Classes\Database::$txt_query">Database::$txt_query</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, в которое помещается текст SQL-запроса.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__execute_query"><abbr title="\PhotoRigma\Classes\Database::_execute_query()">Database::_execute_query()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Выполняет SQL-запрос.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method_insert"><abbr title="\PhotoRigma\Classes\Database::insert()">Database::insert()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Защищённый метод, выполняющий основную логику вставки
данных.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">bool</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Возвращает true, если запрос успешно выполнен (даже если результат пустой). В случае ошибки
выбрасывается исключение.</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -protected
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method__join_internal">
        _join_internal()
        <a href="classes/PhotoRigma-Classes-Database.html#method__join_internal" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/Database.php"><a href="files/src-classes-database.html"><abbr title="src/Classes/Database.php">Database.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">2445</span>

    </aside>

        <p class="phpdocumentor-summary">Формирует SQL-запрос с использованием JOIN для выборки данных из нескольких таблиц, проверяет входные данные,
сохраняет текст запроса в свойстве `$txt_query` и выполняет его.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">protected</span>
                    <span class="phpdocumentor-signature__name">_join_internal</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">string|array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$select</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$from_tbl</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$join</span></span><span class="phpdocumentor-signature__argument"><span>[</span><span>, </span><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$options</span><span> = </span><span class="phpdocumentor-signature__argument__default-value">[]</span><span> ]</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">bool</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот метод выполняет следующие шаги:</p>
<ol>
<li>Проверяет типы входных данных: <code class="prettyprint">$select</code> (строка или массив), <code class="prettyprint">$from_tbl</code> (строка), <code class="prettyprint">$join</code> (массив),
<code class="prettyprint">$options</code> (массив).</li>
<li>Проверяет, что массив <code class="prettyprint">$join</code> не пустой. Если массив пустой, выбрасывается исключение.</li>
<li>Обрабатывает список полей для выборки (<code class="prettyprint">$select</code>):
<ul>
<li>Если <code class="prettyprint">$select</code> является строкой, она используется как есть.</li>
<li>Если <code class="prettyprint">$select</code> является массивом, он преобразуется в строку с разделителем <code class="prettyprint">, </code>. Каждое имя поля
оборачивается в обратные кавычки (<code class="prettyprint"> </code>).</li>
</ul>
</li>
<li>Обрабатывает массив JOIN-операций (<code class="prettyprint">$join</code>):
<ul>
<li>Для каждой операции проверяется наличие имени таблицы (<code class="prettyprint">table</code>) и условия (<code class="prettyprint">on</code>).</li>
<li>Если тип JOIN не указан, используется <code class="prettyprint">INNER</code> по умолчанию.</li>
</ul>
</li>
<li>Формирует базовый SQL-запрос с использованием JOIN-операций.</li>
<li>Добавляет условия WHERE, GROUP BY, ORDER BY и LIMIT, если они указаны в параметре <code class="prettyprint">$options</code>.</li>
<li>Сохраняет сформированный запрос в свойстве <code class="prettyprint">$txt_query</code>.</li>
<li>Выполняет запрос через метод <code class="prettyprint">_execute_query</code>, передавая параметры <code class="prettyprint">params</code> для подготовленного выражения.
Использование параметров <code class="prettyprint">params</code> является обязательным для подготовленных выражений, так как это обеспечивает
защиту от SQL-инъекций и совместимость с различными СУБД. Этот метод является защищенным и предназначен для
использования внутри класса или его наследников. Основная логика вызывается через публичный метод-редирект
<code class="prettyprint">join()</code>.</li>
</ol>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$select</span>
                : <span class="phpdocumentor-signature__argument__return-type">string|array&lt;string|int, mixed&gt;</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Список полей для выборки. Может быть строкой (имя одного поля) или массивом
(список полей). Если передан массив, он преобразуется в строку с разделителем
<code class="prettyprint">,</code>. Пример: &quot;id&quot;, [&quot;id&quot;, &quot;name&quot;]. Ограничения: массив не может быть пустым.</p>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$from_tbl</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Имя основной таблицы, из которой начинается выборка.
Должно быть строкой, содержащей только допустимые имена таблиц без специальных
символов. Ограничения: строка должна быть непустой.</p>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$join</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Массив описаний JOIN-операций. Каждый элемент массива должен содержать следующие
ключи:</p>
<ul>
<li>table (string): Имя таблицы для JOIN. Должно быть строкой, содержащей только
допустимые имена таблиц.</li>
<li>type (string, optional): Тип JOIN (например, INNER, LEFT, RIGHT). Если тип не
указан, используется INNER по умолчанию.</li>
<li>on (string): Условие для JOIN. Должно быть строкой с допустимым условием
сравнения полей. Если условие отсутствует, выбрасывается исключение.
Пример:
[['type' =&gt; 'INNER', 'table' =&gt; 'orders', 'on' =&gt; 'users.id = orders.user_id']].
Ограничения: массив не может быть пустым.</li>
</ul>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$options</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                 = <span class="phpdocumentor-signature__argument__default-value">[]</span>            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Массив дополнительных опций для формирования запроса. Поддерживаемые ключи:</p>
<ul>
<li>where (string|array|false): Условие WHERE.
<ul>
<li>string - используется как есть.</li>
<li>array - преобразуется в SQL. Поддерживает простые условия
(<code class="prettyprint">['поле' =&gt; значение]</code>) и логические операторы (<code class="prettyprint">'OR' =&gt; [...]</code>,
<code class="prettyprint">'NOT' =&gt; [...]</code>).</li>
<li>false - игнорируется.</li>
</ul>
</li>
<li>group (string|false): Группировка GROUP BY. Игнорируется, если false.
Должна быть строкой.</li>
<li>order (string|false): Сортировка ORDER BY. Игнорируется, если false.
Должна быть строкой.</li>
<li>limit (int|string|false): Ограничение LIMIT.
<ul>
<li>int - прямое значение.</li>
<li>string - формат &quot;OFFSET,COUNT&quot;.</li>
<li>false - игнорируется.</li>
</ul>
</li>
<li>params (array): Ассоциативный массив параметров
([&quot;:имя&quot; =&gt; значение]).
Обязателен для использования с условиями <code class="prettyprint">where</code> и другими частями запроса,
требующими подготовленных выражений. Обеспечивает защиту от SQL-инъекций.
Может быть пустым массивом, если параметры не требуются.</li>
</ul>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-Database.html#method__join_internal#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">protected</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                             
                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\InvalidArgumentException">InvalidArgumentException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если:</p>
<ul>
<li><code class="prettyprint">$from_tbl</code> не является строкой.</li>
<li><code class="prettyprint">$join</code> не является массивом.</li>
<li><code class="prettyprint">$select</code> не является строкой или массивом.</li>
<li>Отсутствует имя таблицы (<code class="prettyprint">table</code>) или условие (<code class="prettyprint">on</code>) в описании JOIN.</li>
<li><code class="prettyprint">$options</code> не является массивом.</li>
</ul>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\Exception">Exception</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается при ошибках выполнения запроса.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Метод чувствителен к корректности входных данных. Неверные типы данных или некорректные значения могут
привести к выбросу исключения. Убедитесь, что массив <code class="prettyprint">$join</code> не пустой и содержит корректные данные.
Использование параметров <code class="prettyprint">params</code> для подготовленных выражений является обязательным для защиты от
SQL-инъекций и обеспечения совместимости с различными СУБД. Игнорирование этого правила может привести
к уязвимостям безопасности и неправильной работе с базой данных.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#property_txt_query"><abbr title="\PhotoRigma\Classes\Database::$txt_query">Database::$txt_query</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, в которое помещается текст SQL-запроса.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__execute_query"><abbr title="\PhotoRigma\Classes\Database::_execute_query()">Database::_execute_query()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Выполняет SQL-запрос.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__build_conditions"><abbr title="\PhotoRigma\Classes\Database::_build_conditions()">Database::_build_conditions()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Формирует условия WHERE, GROUP BY, ORDER BY и LIMIT
для запроса.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method_join"><abbr title="\PhotoRigma\Classes\Database::join()">Database::join()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Защищённый метод, выполняющий основную логику
формирования и выполнения SQL-запроса с JOIN.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">bool</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Возвращает true, если запрос успешно выполнен (даже если результат пустой).</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -protected
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method__result_array_internal">
        _result_array_internal()
        <a href="classes/PhotoRigma-Classes-Database.html#method__result_array_internal" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/Database.php"><a href="files/src-classes-database.html"><abbr title="src/Classes/Database.php">Database.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">2547</span>

    </aside>

        <p class="phpdocumentor-summary">Извлекает все строки результата из подготовленного выражения, хранящегося в свойстве `$res_query`, и
возвращает их как массив.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">protected</span>
                    <span class="phpdocumentor-signature__name">_result_array_internal</span><span>(</span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">array&lt;string|int, mixed&gt;|false</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот защищённый метод выполняет следующие шаги:</p>
<ol>
<li>Проверяет, что свойство <code class="prettyprint">$this-&gt;res_query</code> установлено и является объектом типа <code class="prettyprint">PDOStatement</code>. Если это не
так, выбрасывается исключение InvalidArgumentException.</li>
<li>Использует метод <code class="prettyprint">fetchAll(PDO::FETCH_ASSOC)</code> для извлечения всех строк результата из <code class="prettyprint">$this-&gt;res_query</code> в
виде массива ассоциативных массивов.</li>
<li>Если результатов нет (метод <code class="prettyprint">fetchAll()</code> возвращает пустой массив), явно возвращается <code class="prettyprint">false</code>.</li>
<li>В противном случае возвращается массив, содержащий все строки результата.
Метод только читает значение свойства <code class="prettyprint">$this-&gt;res_query</code> и не выполняет дополнительной логики для его
обновления. Значение <code class="prettyprint">$this-&gt;res_query</code> должно быть установлено внешними методами, такими как
<code class="prettyprint">_execute_query()</code>, <code class="prettyprint">delete()</code>, <code class="prettyprint">update()</code> или <code class="prettyprint">insert()</code>.
Этот метод является защищенным и предназначен для использования внутри класса или его наследников. Основная
логика вызывается через публичный метод-редирект <code class="prettyprint">result_array()</code>.</li>
</ol>
</section>

    
    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-Database.html#method__result_array_internal#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">protected</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                             
                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\InvalidArgumentException">InvalidArgumentException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если:</p>
<ul>
<li>Свойство <code class="prettyprint">$this-&gt;res_query</code> не установлено (т.е. не был выполнен запрос,
устанавливающий его).</li>
<li>Свойство <code class="prettyprint">$this-&gt;res_query</code> не является объектом типа <code class="prettyprint">PDOStatement</code>
(указывает на некорректное состояние).</li>
</ul>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Метод чувствителен к состоянию свойства <code class="prettyprint">$this-&gt;res_query</code>. Убедитесь, что перед вызовом метода был
выполнен запрос (например, SELECT), который корректно установил значение <code class="prettyprint">$this-&gt;res_query</code> как
объект <code class="prettyprint">PDOStatement</code>.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#property_res_query"><abbr title="\PhotoRigma\Classes\Database::$res_query">Database::$res_query</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, хранящее результат подготовленного выражения (объект
PDOStatement).</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method_result_array"><abbr title="\PhotoRigma\Classes\Database::result_array()">Database::result_array()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Защищённый метод, выполняющий основную логику
извлечения всех строк результата.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__full_text_search_internal"><abbr title="\PhotoRigma\Classes\Database::_full_text_search_internal()">Database::_full_text_search_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Используется для получения результата в виде
массива при <code class="prettyprint">$search_string = '*'</code>.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__full_text_search_mysql"><abbr title="\PhotoRigma\Classes\Database::_full_text_search_mysql()">Database::_full_text_search_mysql()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Приватный метод для получения всех строк
результата запроса.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__fallback_to_like_mysql"><abbr title="\PhotoRigma\Classes\Database::_fallback_to_like_mysql()">Database::_fallback_to_like_mysql()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Приватный метод для получения всех строк
результата запроса.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__full_text_search_pgsql"><abbr title="\PhotoRigma\Classes\Database::_full_text_search_pgsql()">Database::_full_text_search_pgsql()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Приватный метод для получения всех строк
результата запроса.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__fallback_to_ilike_pgsql"><abbr title="\PhotoRigma\Classes\Database::_fallback_to_ilike_pgsql()">Database::_fallback_to_ilike_pgsql()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Приватный метод для получения всех строк
результата запроса.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__full_text_search_sqlite"><abbr title="\PhotoRigma\Classes\Database::_full_text_search_sqlite()">Database::_full_text_search_sqlite()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Приватный метод для получения всех строк
результата запроса.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__fallback_to_like_sqlite"><abbr title="\PhotoRigma\Classes\Database::_fallback_to_like_sqlite()">Database::_fallback_to_like_sqlite()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Приватный метод для получения всех строк
результата запроса.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">array&lt;string|int, mixed&gt;|false</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Возвращает массив ассоциативных массивов, содержащих данные всех строк результата, если они
доступны. Если результатов нет (запрос не вернул строк), возвращает <code class="prettyprint">false</code>.</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -protected
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method__result_row_internal">
        _result_row_internal()
        <a href="classes/PhotoRigma-Classes-Database.html#method__result_row_internal" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/Database.php"><a href="files/src-classes-database.html"><abbr title="src/Classes/Database.php">Database.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">2631</span>

    </aside>

        <p class="phpdocumentor-summary">Извлекает одну строку результата из подготовленного выражения, хранящегося в свойстве `$res_query`.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">protected</span>
                    <span class="phpdocumentor-signature__name">_result_row_internal</span><span>(</span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">array&lt;string|int, mixed&gt;|false</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот защищённый метод выполняет следующие шаги:</p>
<ol>
<li>Проверяет, что свойство <code class="prettyprint">$this-&gt;res_query</code> установлено и является объектом типа <code class="prettyprint">PDOStatement</code>. Если это не
так, выбрасывается исключение InvalidArgumentException.</li>
<li>Использует метод <code class="prettyprint">fetch(PDO::FETCH_ASSOC)</code> для извлечения одной строки результата из <code class="prettyprint">$this-&gt;res_query</code> в
виде ассоциативного массива.</li>
<li>Если результатов больше нет (метод <code class="prettyprint">fetch()</code> возвращает <code class="prettyprint">false</code>), явно возвращается <code class="prettyprint">false</code>.</li>
<li>В противном случае возвращается ассоциативный массив, содержащий данные одной строки.
Метод только читает значение свойства <code class="prettyprint">$this-&gt;res_query</code> и не выполняет дополнительной логики для его
обновления. Значение <code class="prettyprint">$this-&gt;res_query</code> должно быть установлено внешними методами, такими как
<code class="prettyprint">_execute_query()</code>, <code class="prettyprint">delete()</code>, <code class="prettyprint">update()</code> или <code class="prettyprint">insert()</code>.
Этот метод является защищенным и предназначен для использования внутри класса или его наследников. Основная
логика вызывается через публичный метод-редирект <code class="prettyprint">result_row()</code>.</li>
</ol>
</section>

    
    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-Database.html#method__result_row_internal#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">protected</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                             
                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\InvalidArgumentException">InvalidArgumentException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если:</p>
<ul>
<li>Свойство <code class="prettyprint">$this-&gt;res_query</code> не установлено (т.е. не был выполнен запрос,
устанавливающий его).</li>
<li>Свойство <code class="prettyprint">$this-&gt;res_query</code> не является объектом типа <code class="prettyprint">PDOStatement</code>
(указывает на некорректное состояние).</li>
</ul>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Метод чувствителен к состоянию свойства <code class="prettyprint">$this-&gt;res_query</code>. Убедитесь, что перед вызовом метода был
выполнен запрос (например, SELECT), который корректно установил значение <code class="prettyprint">$this-&gt;res_query</code> как
объект <code class="prettyprint">PDOStatement</code>. Последовательные вызовы извлекают следующую строку; для начала извлечения
сначала нужно выполнить запрос.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#property_res_query"><abbr title="\PhotoRigma\Classes\Database::$res_query">Database::$res_query</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, хранящее результат подготовленного выражения (объект
PDOStatement).</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method_result_row"><abbr title="\PhotoRigma\Classes\Database::result_row()">Database::result_row()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Защищённый метод, выполняющий основную логику
извлечения одной строки результата.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__full_text_search_internal"><abbr title="\PhotoRigma\Classes\Database::_full_text_search_internal()">Database::_full_text_search_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Используется для получения одной строки результата
(версии БД).</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">array&lt;string|int, mixed&gt;|false</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Возвращает ассоциативный массив, содержащий данные одной строки результата, если она
доступна. При последовательных вызовах переходит к следующей строке.
Если результатов больше нет (все строки были извлечены), возвращает <code class="prettyprint">false</code>.</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -protected
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method__rollback_transaction_internal">
        _rollback_transaction_internal()
        <a href="classes/PhotoRigma-Classes-Database.html#method__rollback_transaction_internal" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/Database.php"><a href="files/src-classes-database.html"><abbr title="src/Classes/Database.php">Database.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">2699</span>

    </aside>

        <p class="phpdocumentor-summary">Отменяет транзакцию в базе данных.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">protected</span>
                    <span class="phpdocumentor-signature__name">_rollback_transaction_internal</span><span>(</span><span class="phpdocumentor-signature__argument"><span>[</span><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$context</span><span> = </span><span class="phpdocumentor-signature__argument__default-value">&#039;&#039;</span><span> ]</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">void</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот защищённый метод выполняет следующие шаги:</p>
<ol>
<li>Отменяет транзакцию в базе данных через объект PDO с использованием метода <code class="prettyprint">rollBack()</code>.</li>
<li>Логирует информацию об отмене транзакции с указанием контекста через функцию <code class="prettyprint">log_in_file()</code>.
Этот метод предназначен для использования внутри класса или его наследников. Основная логика вызывается через
публичный метод-редирект <code class="prettyprint">rollback_transaction()</code>.</li>
</ol>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$context</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                 = <span class="phpdocumentor-signature__argument__default-value">&#039;&#039;</span>            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Контекст транзакции (необязательный параметр).
Используется для описания цели или места отмены транзакции.
По умолчанию: пустая строка (<code class="prettyprint">''</code>).</p>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-Database.html#method__rollback_transaction_internal#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">protected</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                             
                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\Exception">Exception</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если произошла ошибка при отмене транзакции на уровне PDO или при логировании.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Метод использует функцию логирования <code class="prettyprint">log_in_file()</code> для записи информации об отмене транзакции.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Убедитесь, что транзакция была начата (<code class="prettyprint">$this-&gt;pdo-&gt;inTransaction()</code> возвращает <code class="prettyprint">true</code>)
перед вызовом этого метода. Попытка отменить несуществующую транзакцию приведёт к ошибке на уровне PDO.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#property_pdo"><abbr title="\PhotoRigma\Classes\Database::$pdo">Database::$pdo</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Объект PDO для подключения к базе данных.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="namespaces/photorigma-include.html#function_log_in_file"><abbr title="\PhotoRigma\Include\log_in_file()">log_in_file()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Записывает сообщение об ошибке в лог-файл.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">void</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Метод ничего не возвращает.</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -protected
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method__select_internal">
        _select_internal()
        <a href="classes/PhotoRigma-Classes-Database.html#method__select_internal" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/Database.php"><a href="files/src-classes-database.html"><abbr title="src/Classes/Database.php">Database.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">2836</span>

    </aside>

        <p class="phpdocumentor-summary">Формирует SQL-запрос на выборку данных из таблицы, основываясь на полученных аргументах, размещает его в
свойстве `$txt_query` и выполняет.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">protected</span>
                    <span class="phpdocumentor-signature__name">_select_internal</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">string|array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$select</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$from_tbl</span></span><span class="phpdocumentor-signature__argument"><span>[</span><span>, </span><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$options</span><span> = </span><span class="phpdocumentor-signature__argument__default-value">[]</span><span> ]</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">bool</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот метод выполняет следующие шаги:</p>
<ol>
<li>Проверяет типы входных данных: <code class="prettyprint">$select</code> (строка или массив), <code class="prettyprint">$from_tbl</code> (строка), <code class="prettyprint">$options</code> (массив).</li>
<li>Обрабатывает список полей для выборки (<code class="prettyprint">$select</code>):
<ul>
<li>Если <code class="prettyprint">$select</code> является строкой, она разбивается по запятым и преобразуется в массив.</li>
<li>Каждое имя поля проверяется на корректность и преобразуется в строку с разделителем <code class="prettyprint">,</code>.</li>
</ul>
</li>
<li>Формирует базовый SQL-запрос <code class="prettyprint">SELECT ... FROM ...</code>.</li>
<li>Добавляет условия WHERE, GROUP BY, ORDER BY и LIMIT, если они указаны в параметре <code class="prettyprint">$options</code>.</li>
<li>Сохраняет сформированный запрос в свойстве <code class="prettyprint">$txt_query</code>.</li>
<li>Выполняет запрос через метод <code class="prettyprint">_execute_query</code>, передавая параметры <code class="prettyprint">params</code> для подготовленного выражения.
Использование параметров <code class="prettyprint">params</code> является обязательным для подготовленных выражений, так как это обеспечивает
защиту от SQL-инъекций и совместимость с различными СУБД. Этот метод является защищенным и предназначен для
использования внутри класса или его наследников. Основная логика вызывается через публичный метод-редирект
<code class="prettyprint">select()</code>.</li>
</ol>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$select</span>
                : <span class="phpdocumentor-signature__argument__return-type">string|array&lt;string|int, mixed&gt;</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Список полей для выборки. Может быть строкой (имя одного поля) или массивом
(список полей). Если передан массив, он преобразуется в строку с разделителем
<code class="prettyprint">,</code>. Пример: &quot;id&quot;, [&quot;id&quot;, &quot;name&quot;]. Ограничения: массив не может содержать
элементы, которые не являются строками.</p>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$from_tbl</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Имя таблицы, из которой выбираются данные.
Должно быть строкой, содержащей только допустимые имена таблиц без специальных
символов. Ограничения: строка должна быть непустой.</p>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$options</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                 = <span class="phpdocumentor-signature__argument__default-value">[]</span>            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Массив дополнительных опций для формирования запроса. Поддерживаемые ключи:</p>
<ul>
<li>where (string|array|false): Условие WHERE.
<ul>
<li>string - используется как есть.</li>
<li>array - преобразуется в SQL. Поддерживает простые условия
(<code class="prettyprint">['поле' =&gt; значение]</code>) и логические операторы (<code class="prettyprint">'OR' =&gt; [...]</code>,
<code class="prettyprint">'NOT' =&gt; [...]</code>).</li>
<li>false - игнорируется.</li>
</ul>
</li>
<li>group (string|false): Группировка GROUP BY. Игнорируется, если false.
Должна быть строкой.</li>
<li>order (string|false): Сортировка ORDER BY. Игнорируется, если false.
Должна быть строкой.</li>
<li>limit (int|string|false): Ограничение LIMIT.
<ul>
<li>int - прямое значение.</li>
<li>string - формат &quot;OFFSET,COUNT&quot;.</li>
<li>false - игнорируется.</li>
</ul>
</li>
<li>params (array): Ассоциативный массив параметров
([&quot;:имя&quot; =&gt; значение]).
Обязателен для использования с условиями <code class="prettyprint">where</code> и другими частями запроса,
требующими подготовленных выражений. Обеспечивает защиту от SQL-инъекций.
Может быть пустым массивом, если параметры не требуются.</li>
</ul>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-Database.html#method__select_internal#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">protected</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                             
                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\InvalidArgumentException">InvalidArgumentException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если:</p>
<ul>
<li><code class="prettyprint">$from_tbl</code> не является строкой.</li>
<li><code class="prettyprint">$options</code> не является массивом.</li>
<li><code class="prettyprint">$select</code> не является строкой или массивом.</li>
<li>Элемент в списке <code class="prettyprint">$select</code> не является строкой.</li>
</ul>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\Exception">Exception</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается при ошибках выполнения запроса.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Метод чувствителен к корректности входных данных. Неверные типы данных или некорректные значения могут
привести к выбросу исключения. Убедитесь, что массив <code class="prettyprint">$select</code> содержит только строки.
Использование параметров <code class="prettyprint">params</code> для подготовленных выражений является обязательным для защиты от
SQL-инъекций и обеспечения совместимости с различными СУБД. Игнорирование этого правила может привести
к уязвимостям безопасности и неправильной работе с базой данных.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#property_txt_query"><abbr title="\PhotoRigma\Classes\Database::$txt_query">Database::$txt_query</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, в которое помещается текст SQL-запроса.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__execute_query"><abbr title="\PhotoRigma\Classes\Database::_execute_query()">Database::_execute_query()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Выполняет SQL-запрос.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__build_conditions"><abbr title="\PhotoRigma\Classes\Database::_build_conditions()">Database::_build_conditions()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Формирует условия WHERE, GROUP BY, ORDER BY и LIMIT
для запроса.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method_select"><abbr title="\PhotoRigma\Classes\Database::select()">Database::select()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Защищённый метод, выполняющий основную логику
формирования и выполнения SQL-запроса на выборку.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__full_text_search_internal"><abbr title="\PhotoRigma\Classes\Database::_full_text_search_internal()">Database::_full_text_search_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Используется для выборки всех записей при
<code class="prettyprint">$search_string = '*'</code> и для получения версии БД.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__full_text_search_mysql"><abbr title="\PhotoRigma\Classes\Database::_full_text_search_mysql()">Database::_full_text_search_mysql()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Приватный метод для выполнения SELECT-запроса.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__fallback_to_like_mysql"><abbr title="\PhotoRigma\Classes\Database::_fallback_to_like_mysql()">Database::_fallback_to_like_mysql()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Приватный метод для выполнения SELECT-запроса.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__full_text_search_pgsql"><abbr title="\PhotoRigma\Classes\Database::_full_text_search_pgsql()">Database::_full_text_search_pgsql()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Приватный метод для выполнения SELECT-запроса.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__fallback_to_ilike_pgsql"><abbr title="\PhotoRigma\Classes\Database::_fallback_to_ilike_pgsql()">Database::_fallback_to_ilike_pgsql()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Приватный метод для выполнения SELECT-запроса.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__full_text_search_sqlite"><abbr title="\PhotoRigma\Classes\Database::_full_text_search_sqlite()">Database::_full_text_search_sqlite()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Приватный метод для выполнения SELECT-запроса к FTS5
таблице.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__fallback_to_like_sqlite"><abbr title="\PhotoRigma\Classes\Database::_fallback_to_like_sqlite()">Database::_fallback_to_like_sqlite()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Приватный метод для выполнения SELECT-запроса.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">bool</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Возвращает true, если запрос успешно выполнен (даже если результат пустой).</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -protected
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method__truncate_internal">
        _truncate_internal()
        <a href="classes/PhotoRigma-Classes-Database.html#method__truncate_internal" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/Database.php"><a href="files/src-classes-database.html"><abbr title="src/Classes/Database.php">Database.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">2932</span>

    </aside>

        <p class="phpdocumentor-summary">Формирует SQL-запрос на очистку таблицы (TRUNCATE), размещает его в свойстве `$txt_query` и выполняет.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">protected</span>
                    <span class="phpdocumentor-signature__name">_truncate_internal</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$from_tbl</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">bool</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот защищённый метод выполняет следующие шаги:</p>
<ol>
<li>Проверяет тип входных данных: <code class="prettyprint">$from_tbl</code> должен быть строкой. Если передан неверный тип, выбрасывается
исключение InvalidArgumentException.</li>
<li>Формирует базовый SQL-запрос <code class="prettyprint">TRUNCATE TABLE</code> для очистки таблицы с использованием <code class="prettyprint">$from_tbl</code>.</li>
<li>Сохраняет сформированный запрос в свойстве <code class="prettyprint">$this-&gt;txt_query</code>.</li>
<li>Выполняет запрос через метод <code class="prettyprint">_execute_query()</code>.
Этот метод является защищенным и предназначен для использования внутри класса или его наследников. Основная
логика вызывается через публичный метод-редирект <code class="prettyprint">truncate()</code>.</li>
</ol>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$from_tbl</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Имя таблицы, которую необходимо очистить.
Должно быть строкой, содержащей только допустимые имена таблиц без специальных символов.
Ограничения: строка должна быть непустой.</p>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-Database.html#method__truncate_internal#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">protected</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                             
                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\InvalidArgumentException">InvalidArgumentException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если <code class="prettyprint">$from_tbl</code> не является непустой строкой.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\Exception">Exception</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается при ошибках выполнения запроса.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Метод чувствителен к корректности входных данных. Неверные типы данных или некорректные значения могут
привести к выбросу исключения. Запрос TRUNCATE полностью очищает таблицу, удаляя все строки без
возможности восстановления. Этот метод следует использовать с осторожностью, так как он не поддерживает
откат операции через транзакции.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#property_txt_query"><abbr title="\PhotoRigma\Classes\Database::$txt_query">Database::$txt_query</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, в которое помещается текст SQL-запроса.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__execute_query"><abbr title="\PhotoRigma\Classes\Database::_execute_query()">Database::_execute_query()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Выполняет SQL-запрос.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method_truncate"><abbr title="\PhotoRigma\Classes\Database::truncate()">Database::truncate()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Защищённый метод, выполняющий основную логику очистки
таблицы.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">bool</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Возвращает <code class="prettyprint">true</code>, если запрос успешно выполнен (даже если результат пустой или не возвращает строк).</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -protected
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method__update_internal">
        _update_internal()
        <a href="classes/PhotoRigma-Classes-Database.html#method__update_internal" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/Database.php"><a href="files/src-classes-database.html"><abbr title="src/Classes/Database.php">Database.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">3079</span>

    </aside>

        <p class="phpdocumentor-summary">Формирует SQL-запрос на обновление данных в таблице, основываясь на полученных аргументах, размещает его в
свойстве `$txt_query` и выполняет.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">protected</span>
                    <span class="phpdocumentor-signature__name">_update_internal</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$update</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$from_tbl</span></span><span class="phpdocumentor-signature__argument"><span>[</span><span>, </span><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$options</span><span> = </span><span class="phpdocumentor-signature__argument__default-value">[]</span><span> ]</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">bool</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот защищённый метод выполняет следующие шаги:</p>
<ol>
<li>Проверяет типы входных данных: <code class="prettyprint">$update</code> (ассоциативный массив), <code class="prettyprint">$from_tbl</code> (строка), <code class="prettyprint">$options</code> (массив).</li>
<li>Проверяет наличие обязательного условия <code class="prettyprint">where</code> в массиве <code class="prettyprint">$options</code>. Если условие отсутствует,
выбрасывается исключение для предотвращения случайного обновления всех данных.</li>
<li>Удаляет недопустимый ключ <code class="prettyprint">group</code> из массива <code class="prettyprint">$options</code> с записью в лог, так как GROUP BY не поддерживается
в запросах UPDATE.</li>
<li>Формирует базовый SQL-запрос UPDATE с использованием преобразованных данных.</li>
<li>Добавляет условия WHERE, ORDER BY и LIMIT, если они указаны в параметре <code class="prettyprint">$options</code>.</li>
<li>Сохраняет сформированный запрос в свойстве <code class="prettyprint">$txt_query</code>.</li>
<li>Выполняет запрос через метод <code class="prettyprint">_execute_query</code>, передавая параметры <code class="prettyprint">params</code> для подготовленного выражения.
Использование параметров <code class="prettyprint">params</code> является обязательным для подготовленных выражений, так как это обеспечивает
защиту от SQL-инъекций и совместимость с различными СУБД. Этот метод является защищенным и предназначен для
использования внутри класса или его наследников. Основная логика вызывается через публичный метод-редирект
<code class="prettyprint">update()</code>.</li>
</ol>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$update</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Ассоциативный массив данных для обновления в формате: 'имя_поля' =&gt; 'значение'.
Пример: [&quot;name&quot; =&gt; &quot;:name&quot;, &quot;status&quot; =&gt; &quot;:status&quot;].
Для защиты от SQL-инъекций рекомендуется использовать плейсхолдеры (например, <code class="prettyprint">:name</code>).</p>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$from_tbl</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Имя таблицы, в которой необходимо обновить данные.
Должно быть строкой, содержащей только допустимые имена таблиц без специальных
символов. Ограничения: строка должна быть непустой.</p>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$options</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                 = <span class="phpdocumentor-signature__argument__default-value">[]</span>            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Массив опций для формирования запроса. Поддерживаемые ключи:</p>
<ul>
<li>where (string|array|false): Условие WHERE.
<ul>
<li>string - используется как есть.</li>
<li>array - преобразуется в SQL. Поддерживает простые условия
(<code class="prettyprint">['поле' =&gt; значение]</code>) и логические операторы (<code class="prettyprint">'OR' =&gt; [...]</code>,
<code class="prettyprint">'NOT' =&gt; [...]</code>).</li>
<li>false - игнорируется.
Обязательный параметр для безопасности. Без условия WHERE запрос не будет выполнен.</li>
</ul>
</li>
<li>group (string|false): Группировка GROUP BY. Игнорируется, если false.
Должна быть строкой.
Не поддерживается в запросах UPDATE и удаляется с записью в лог.</li>
<li>order (string|false): Сортировка ORDER BY. Игнорируется, если false.
Должна быть строкой.</li>
<li>limit (int|string|false): Ограничение LIMIT.
<ul>
<li>int - прямое значение.</li>
<li>string - формат &quot;OFFSET,COUNT&quot;.</li>
<li>false - игнорируется.</li>
</ul>
</li>
<li>params (array): Ассоциативный массив параметров
([&quot;:имя&quot; =&gt; значение]).
Обязателен для использования с данными для обновления или условиями <code class="prettyprint">where</code>,
требующими подготовленных выражений. Обеспечивает защиту от SQL-инъекций.
Может быть пустым массивом, если параметры не требуются.</li>
</ul>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-Database.html#method__update_internal#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">protected</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                             
                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\InvalidArgumentException">InvalidArgumentException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если:</p>
<ul>
<li><code class="prettyprint">$update</code> не является массивом.</li>
<li><code class="prettyprint">$from_tbl</code> не является строкой.</li>
<li><code class="prettyprint">$options</code> не является массивом.</li>
<li>Отсутствует обязательное условие <code class="prettyprint">where</code> в массиве <code class="prettyprint">$options</code>.</li>
</ul>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\JsonException">JsonException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается при ошибках записи лога.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\Exception">Exception</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается при ошибках выполнения запроса.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Метод чувствителен к корректности входных данных. Неверные типы данных или некорректные значения могут
привести к выбросу исключения. Безопасность обеспечивается обязательным указанием условия <code class="prettyprint">where</code>.
Запрос без условия <code class="prettyprint">where</code> не будет выполнен. Ключ <code class="prettyprint">group</code> не поддерживается в запросах UPDATE и
удаляется с записью в лог. Использование параметров <code class="prettyprint">params</code> для подготовленных выражений является
обязательным для защиты от SQL-инъекций и обеспечения совместимости с различными СУБД. Игнорирование
этого правила может привести к уязвимостям безопасности и неправильной работе с базой данных.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#property_txt_query"><abbr title="\PhotoRigma\Classes\Database::$txt_query">Database::$txt_query</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, в которое помещается текст SQL-запроса.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__execute_query"><abbr title="\PhotoRigma\Classes\Database::_execute_query()">Database::_execute_query()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Выполняет SQL-запрос.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__build_conditions"><abbr title="\PhotoRigma\Classes\Database::_build_conditions()">Database::_build_conditions()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Формирует условия WHERE, ORDER BY и LIMIT для запроса.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method_update"><abbr title="\PhotoRigma\Classes\Database::update()">Database::update()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Защищённый метод, выполняющий основную логику
обновления данных.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">bool</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Возвращает true, если запрос успешно выполнен (даже если результат пустой).</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -protected
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method__with_sql_format_internal">
        _with_sql_format_internal()
        <a href="classes/PhotoRigma-Classes-Database.html#method__with_sql_format_internal" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/Database.php"><a href="files/src-classes-database.html"><abbr title="src/Classes/Database.php">Database.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">3240</span>

    </aside>

        <p class="phpdocumentor-summary">Метод временно изменяет формат SQL для выполнения запросов в указанном контексте.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">protected</span>
                    <span class="phpdocumentor-signature__name">_with_sql_format_internal</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$format</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">callable&nbsp;</span><span class="phpdocumentor-signature__argument__name">$callback</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">mixed</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот защищённый метод выполняет следующие шаги:</p>
<ol>
<li>Проверяет поддерживаемость указанного формата SQL <code class="prettyprint">$format</code>. Если формат не поддерживается, выбрасывается
исключение <code class="prettyprint">InvalidArgumentException</code>.</li>
<li>Сохраняет текущий формат SQL из свойства <code class="prettyprint">$this-&gt;current_format</code> во временную переменную.</li>
<li>Устанавливает временный формат SQL в свойство <code class="prettyprint">$this-&gt;current_format</code>, используя значение из <code class="prettyprint">$format</code>.</li>
<li>Выполняет переданный коллбэк <code class="prettyprint">$callback</code>. Код внутри коллбэка будет использовать новый временный формат SQL.</li>
<li>Восстанавливает исходный формат SQL в свойстве <code class="prettyprint">$this-&gt;current_format</code> после завершения коллбэка (даже если
внутри коллбэка произошла ошибка благодаря использованию <code class="prettyprint">finally</code>).
Этот метод является защищенным и предназначен для использования внутри класса или его наследников. Основная
логика вызывается через публичный метод-редирект <code class="prettyprint">with_sql_format()</code>.</li>
</ol>
<pre class="prettyprint"><code class="language-php">// Выполнение запроса в формате PostgreSQL
// Предполагается, что TBL_NEWS определена как константа
$years_list = $this-&gt;_with_sql_format_internal('pgsql', function () { // Можно использовать `use ($this)` или передать $this в коллбэк
    // Форматирование даты для PostgreSQL с учетом временного формата
    $formatted_date = $this-&gt;format_date('data_last_edit', 'YYYY');
    // Выборка данных
    $this-&gt;select(
        'DISTINCT ' . $formatted_date . ' AS year',
        TBL_NEWS, // Используем константу TBL_NEWS
        [
            'order' =&gt; 'year ASC',
        ]
    );
    // Получение результата
    return $this-&gt;result_array();
});
print_r($years_list);
</code></pre>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$format</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Формат SQL, который нужно использовать временно.
Поддерживаемые значения: 'mysql', 'pgsql', 'sqlite'.</p>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$callback</span>
                : <span class="phpdocumentor-signature__argument__return-type">callable</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Коллбэк, содержащий код, который должен выполняться
в контексте указанного формата SQL. Коллбэк может принимать ссылку на текущий
объект базы данных как аргумент (например, <code class="prettyprint">function (\PhotoRigma\Classes\Database $db) { ... }</code>).</p>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-Database.html#method__with_sql_format_internal#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">protected</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                             
                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\InvalidArgumentException">InvalidArgumentException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если указан неподдерживаемый формат SQL.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Важные замечания:</p>
<ol>
<li>Убедитесь, что все методы текущего класса <code class="prettyprint">$this-&gt;...()</code>, вызываемые внутри коллбэка,
корректно работают с указанным временным форматом SQL.</li>
<li><strong>Особая осторожность:</strong> Не используйте внутри коллбэка методы <strong>других</strong> классов,
которые напрямую зависят от объекта <code class="prettyprint">$db</code> и при этом написаны с жесткой привязкой к
определенному формату SQL (например, парсят SQL-строки, не учитывая временное изменение формата
в объекте <code class="prettyprint">$db</code>). Это может привести к непредсказуемому поведению или ошибкам.</li>
<li>Для выполнения группы запросов в одном и том же временном формате оберните их в один коллбэк.</li>
</ol>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#property_current_format"><abbr title="\PhotoRigma\Classes\Database::$current_format">Database::$current_format</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, хранящее текущий формат SQL.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method_with_sql_format"><abbr title="\PhotoRigma\Classes\Database::with_sql_format()">Database::with_sql_format()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Защищённый метод, выполняющий основную логику
временной смены формата SQL.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">mixed</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Результат выполнения коллбэка <code class="prettyprint">$callback</code>.</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -private
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method__build_conditions">
        _build_conditions()
        <a href="classes/PhotoRigma-Classes-Database.html#method__build_conditions" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/Database.php"><a href="files/src-classes-database.html"><abbr title="src/Classes/Database.php">Database.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">798</span>

    </aside>

        <p class="phpdocumentor-summary">Формирует строку дополнений для SQL-запроса (например, WHERE, GROUP BY, ORDER BY, LIMIT).</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">private</span>
                    <span class="phpdocumentor-signature__name">_build_conditions</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$options</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">array&lt;string|int, mixed&gt;</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот приватный метод обрабатывает опции запроса из массива <code class="prettyprint">$options</code> и формирует соответствующие
SQL-фрагменты для добавления к основному запросу (такому как SELECT, UPDATE, DELETE).</p>
<p>Метод выполняет следующие шаги:</p>
<ol>
<li>Обрабатывает условие <code class="prettyprint">WHERE</code> из <code class="prettyprint">$options['where']</code>:
<ul>
<li>Игнорируется, если значение равно <code class="prettyprint">false</code>.</li>
<li>Если значение является строкой, она используется как есть.</li>
<li>Если значение является массивом, он преобразуется в SQL-условие. Поддерживаются простые условия (<code class="prettyprint">['поле' =&gt; значение]</code>), которые автоматически преобразуются с использованием плейсхолдеров (<code class="prettyprint">&quot;поле = :поле&quot;</code>) и
добавляются к возвращаемому массиву параметров. Также поддерживаются логические операторы <code class="prettyprint">'OR'</code> и
<code class="prettyprint">'NOT'</code> с массивами условий внутри.</li>
</ul>
</li>
<li>Обрабатывает группировку <code class="prettyprint">GROUP BY</code> из <code class="prettyprint">$options['group']</code>:
<ul>
<li>Игнорируется, если значение равно <code class="prettyprint">false</code>.</li>
<li>Если значение является строкой, добавляется к строке условий.</li>
</ul>
</li>
<li>Обрабатывает сортировку <code class="prettyprint">ORDER BY</code> из <code class="prettyprint">$options['order']</code>:
<ul>
<li>Игнорируется, если значение равно <code class="prettyprint">false</code>.</li>
<li>Если значение является строкой, добавляется к строке условий.</li>
</ul>
</li>
<li>Обрабатывает ограничение <code class="prettyprint">LIMIT</code> из <code class="prettyprint">$options['limit']</code>:
<ul>
<li>Игнорируется, если значение равно <code class="prettyprint">false</code>.</li>
<li>Если значение является числом, добавляется напрямую.</li>
<li>Если значение является строкой формата &quot;OFFSET, COUNT&quot;, она разбирается и добавляется.</li>
</ul>
</li>
<li>Возвращает сформированную строку дополнений и обновлённый массив параметров. Массив параметров для возврата
инициализируется значениями из <code class="prettyprint">$options['params']</code> (если они были предоставлены) и дополняется
параметрами, автоматически созданными для простых условий WHERE.</li>
</ol>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$options</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Опции запроса. Поддерживаемые ключи:</p>
<ul>
<li>where (string|array|false): Условие WHERE.
Может быть:
<ul>
<li>Строкой (используется как есть)</li>
<li>Массивом:
<ul>
<li>Простые условия: <code class="prettyprint">['поле' =&gt; значение]</code> (автоматически создаются плейсхолдеры и
добавляются в возвращаемый массив параметров)</li>
<li>Сложные условия: <code class="prettyprint">['OR' =&gt; [условия], 'NOT' =&gt; [условия]]</code></li>
</ul>
</li>
<li><code class="prettyprint">false</code>: Игнорируется.</li>
</ul>
</li>
<li>group (string|false): Группировка GROUP BY.
Должна быть строкой. Игнорируется, если равно <code class="prettyprint">false</code>.</li>
<li>order (string|false): Сортировка ORDER BY.
Должна быть строкой. Игнорируется, если равно <code class="prettyprint">false</code>.</li>
<li>limit (int|string|false): Ограничение LIMIT.
Должно быть целым числом или строкой формата <code class="prettyprint">'OFFSET, COUNT'</code>. Игнорируется, если
равно <code class="prettyprint">false</code>.</li>
<li>params (array): Исходный ассоциативный массив параметров для подготовленного выражения
([&quot;:имя&quot; =&gt; значение]). Необязательный параметр. Эти параметры используются как основа
для возвращаемого массива параметров.</li>
</ul>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-Database.html#method__build_conditions#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">internal</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                             
                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\InvalidArgumentException">InvalidArgumentException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если значение одной из опций (<code class="prettyprint">where</code>, <code class="prettyprint">group</code>, <code class="prettyprint">order</code>, <code class="prettyprint">limit</code>)
имеет недопустимый тип, который не может быть обработан методом.
Например:</p>
<ul>
<li>Неверное условие 'where' | Ожидалась строка или массив, получено: [тип]</li>
<li>Неверное значение 'group' | Ожидалась строка, получено: [тип]</li>
<li>Неверное значение 'order' | Ожидалась строка, получено: [тип]</li>
<li>Неверное значение 'limit' | Ожидалось число или строка формата 'OFFSET,
COUNT', получено: [тип/значение]</li>
</ul>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__build_where_group"><abbr title="\PhotoRigma\Classes\Database::_build_where_group()">Database::_build_where_group()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Приватный метод, используемый для рекурсивной
обработки групп условий (OR, NOT) внутри WHERE.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__delete_internal"><abbr title="\PhotoRigma\Classes\Database::_delete_internal()">Database::_delete_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Формирует условия WHERE, ORDER BY и LIMIT для запроса.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__join_internal"><abbr title="\PhotoRigma\Classes\Database::_join_internal()">Database::_join_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Формирует условия WHERE, GROUP BY, ORDER BY и LIMIT
для запроса.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__select_internal"><abbr title="\PhotoRigma\Classes\Database::_select_internal()">Database::_select_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Формирует условия WHERE, GROUP BY, ORDER BY и LIMIT
для запроса.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__update_internal"><abbr title="\PhotoRigma\Classes\Database::_update_internal()">Database::_update_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Формирует условия WHERE, ORDER BY и LIMIT для запроса.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__fts_check_options"><abbr title="\PhotoRigma\Classes\Database::_fts_check_options()">Database::_fts_check_options()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Приватный метод, используемый для обработки внешней
части условия WHERE.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">array&lt;string|int, mixed&gt;</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Массив с двумя элементами:</p>
<ul>
<li>string $conditions: Строка дополнений SQL (например, <code class="prettyprint"> WHERE ... GROUP BY ... ORDER BY ... LIMIT ...</code>).</li>
<li>array $params: Обновлённый ассоциативный массив параметров для подготовленного выражения.
Включает параметры из <code class="prettyprint">$options['params']</code> и параметры, сгенерированные для простых условий
WHERE.</li>
</ul>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -private
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method__build_where_group">
        _build_where_group()
        <a href="classes/PhotoRigma-Classes-Database.html#method__build_where_group" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/Database.php"><a href="files/src-classes-database.html"><abbr title="src/Classes/Database.php">Database.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">917</span>

    </aside>

        <p class="phpdocumentor-summary">Формирует группу условий для WHERE с указанным оператором (OR/NOT).</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">private</span>
                    <span class="phpdocumentor-signature__name">_build_where_group</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$conditions</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$operator</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">string</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот приватный метод используется для построения сложных SQL-условий внутри части WHERE.
Метод выполняет следующие задачи:</p>
<ul>
<li>Для оператора OR: объединяет условия из массива <code class="prettyprint">$conditions</code> через <code class="prettyprint">OR</code>.</li>
<li>Для оператора NOT: объединяет условия из массива <code class="prettyprint">$conditions</code> через <code class="prettyprint">AND</code> и добавляет отрицание <code class="prettyprint">NOT</code> к
группе.</li>
</ul>
<p>Поддерживает два формата условий в массиве <code class="prettyprint">$conditions</code>:</p>
<ul>
<li>Готовые строки условий (если ключ числовой) — используются как есть.</li>
<li>Ассоциативные массивы в формате <code class="prettyprint">['поле' =&gt; значение]</code> (если ключ строковый) — преобразуются в синтаксис для
подготовленного выражения: <code class="prettyprint">&quot;поле = :поле&quot;</code>. (Подстановка и экранирование значений происходят на этапе
выполнения запроса в методе <code class="prettyprint">_execute_query()</code>).</li>
</ul>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$conditions</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Массив условий для группы.</p>
<ul>
<li>Если ключ числовой: значение используется как готовая строка условия (например,
<code class="prettyprint">&quot;views &gt; 1000&quot;</code>).</li>
<li>Если ключ строковый: <code class="prettyprint">['поле' =&gt; значение]</code> — значение используется для генерации
синтаксиса плейсхолдера (например, <code class="prettyprint">&quot;deleted = :deleted&quot;</code>).</li>
</ul>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$operator</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Логический оператор для объединения условий в группе ('OR' или 'NOT').</p>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-Database.html#method__build_where_group#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">internal</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                             
                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\InvalidArgumentException">InvalidArgumentException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Если передан недопустимый оператор (не 'OR' или 'NOT').</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__build_conditions"><abbr title="\PhotoRigma\Classes\Database::_build_conditions()">Database::_build_conditions()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Приватный метод, используемый для рекурсивной
обработки групп условий (OR, NOT) внутри WHERE.</p>
</section>

                                    </dd>
                                            </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">string</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Сформированная строка условий для группы WHERE.</p>
<ul>
<li>Для OR: <code class="prettyprint">&quot;(условие1 OR условие2)&quot;</code></li>
<li>Для NOT: <code class="prettyprint">&quot;NOT (условие1 AND условие2)&quot;</code>
Возвращает пустую строку (<code class="prettyprint">''</code>), если массив условий пуст.</li>
</ul>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -private
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method__convert_from_mysql_to">
        _convert_from_mysql_to()
        <a href="classes/PhotoRigma-Classes-Database.html#method__convert_from_mysql_to" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/Database.php"><a href="files/src-classes-database.html"><abbr title="src/Classes/Database.php">Database.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">1173</span>

    </aside>

        <p class="phpdocumentor-summary">Производит преобразование SQL-запроса из формата MySQL в целевой формат СУБД (PostgreSQL или SQLite).</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">private</span>
                    <span class="phpdocumentor-signature__name">_convert_from_mysql_to</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$target_db_type</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">void</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот приватный метод выполняет преобразование текста SQL-запроса, хранящегося в свойстве <code class="prettyprint">$this-&gt;txt_query</code>,
из формата MySQL в формат целевой СУБД.
Метод выполняет следующие шаги:</p>
<ol>
<li>Проверяет тип целевой СУБД через параметр <code class="prettyprint">$target_db_type</code>. Метод поддерживает преобразование только в
форматы PostgreSQL ('pgsql') и SQLite ('sqlite').</li>
<li>Для поддерживаемых целевых СУБД (PostgreSQL и SQLite) находит все необратимые обратные кавычки (<code class="prettyprint">) в строке запроса и заменяет их на двойные кавычки (&quot;). Экранированные кавычки (например, \</code> ) остаются без изменений.
Преобразованный запрос сохраняется обратно в свойство <code class="prettyprint">$this-&gt;txt_query</code>.</li>
<li>Если тип целевой СУБД (<code class="prettyprint">$target_db_type</code>) не поддерживается методом для преобразования из MySQL,
выбрасывается исключение InvalidArgumentException.
Этот метод является приватным и предназначен только для использования внутри класса. Вызывается из метода
<code class="prettyprint">_convert_query()</code>.</li>
</ol>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$target_db_type</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Тип целевой СУБД, в которую нужно преобразовать запрос.
Поддерживаемые значения: 'pgsql', 'sqlite'.
Ограничения: входной тип должен быть допустимым значением из списка.</p>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-Database.html#method__convert_from_mysql_to#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">internal</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                             
                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\InvalidArgumentException">InvalidArgumentException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если тип целевой СУБД (<code class="prettyprint">$target_db_type</code>) не поддерживается
методом <code class="prettyprint">_convert_from_mysql_to</code>.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Метод использует регулярное выражение для поиска и замены необратимых обратных кавычек на двойные
кавычки. Преобразованный запрос сохраняется в свойстве <code class="prettyprint">$this-&gt;txt_query</code>.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Убедитесь, что входной тип <code class="prettyprint">$target_db_type</code> соответствует поддерживаемым значениям ('pgsql' или
'sqlite'). Недопустимый тип может привести к выбросу исключения. Метод предполагает, что
<code class="prettyprint">$this-&gt;txt_query</code> содержит SQL-запрос, использующий синтаксис идентификаторов MySQL (обратные кавычки).</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#property_txt_query"><abbr title="\PhotoRigma\Classes\Database::$txt_query">Database::$txt_query</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, содержащее текст SQL-запроса, которое модифицируется
методом.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__convert_query"><abbr title="\PhotoRigma\Classes\Database::_convert_query()">Database::_convert_query()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Приватный метод для преобразования запросов из
формата MySQL в другие.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">void</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Метод ничего не возвращает напрямую. Результат преобразования сохраняется в свойстве
<code class="prettyprint">$this-&gt;txt_query</code>.</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -private
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method__convert_from_pgsql_to">
        _convert_from_pgsql_to()
        <a href="classes/PhotoRigma-Classes-Database.html#method__convert_from_pgsql_to" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/Database.php"><a href="files/src-classes-database.html"><abbr title="src/Classes/Database.php">Database.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">1229</span>

    </aside>

        <p class="phpdocumentor-summary">Производит преобразование SQL-запроса из формата PostgreSQL в целевой формат СУБД (MySQL или SQLite).</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">private</span>
                    <span class="phpdocumentor-signature__name">_convert_from_pgsql_to</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$target_db_type</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">void</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот приватный метод выполняет преобразование текста SQL-запроса, хранящегося в свойстве <code class="prettyprint">$this-&gt;txt_query</code>,
из формата PostgreSQL в формат целевой СУБД.
Метод выполняет следующие шаги:</p>
<ol>
<li>Проверяет тип целевой СУБД через параметр <code class="prettyprint">$target_db_type</code>. Метод поддерживает преобразование только в
форматы MySQL ('mysql') и SQLite ('sqlite').</li>
<li>Для целевой СУБД MySQL находит все необратимые двойные кавычки (&quot;) в строке запроса и заменяет их на
обратные апострофы (<code class="prettyprint">). Экранированные кавычки (например, \&quot;) остаются без изменений. Преобразованный запрос сохраняется обратно в свойство </code>$this-&gt;txt_query`.</li>
<li>Для целевой СУБД SQLite запрос остается без изменений, свойство <code class="prettyprint">$this-&gt;txt_query</code> не модифицируется.</li>
<li>Если тип целевой СУБД (<code class="prettyprint">$target_db_type</code>) не поддерживается методом для преобразования из PostgreSQL,
выбрасывается исключение InvalidArgumentException.
Этот метод является приватным и предназначен только для использования внутри класса. Вызывается из метода
<code class="prettyprint">_convert_query()</code>.</li>
</ol>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$target_db_type</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Тип целевой СУБД, в которую нужно преобразовать запрос.
Поддерживаемые значения: 'mysql', 'sqlite'.
Ограничения: входной тип должен быть допустимым значением из списка.</p>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-Database.html#method__convert_from_pgsql_to#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">internal</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                             
                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\InvalidArgumentException">InvalidArgumentException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если тип целевой СУБД (<code class="prettyprint">$target_db_type</code>) не поддерживается
методом <code class="prettyprint">_convert_from_pgsql_to</code>.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Метод использует регулярное выражение для поиска и замены необратимых двойных кавычек на обратные
апострофы при преобразовании в MySQL. Преобразованный запрос (или исходный, если целевая СУБД -
SQLite) сохраняется в свойстве <code class="prettyprint">$this-&gt;txt_query</code>.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Убедитесь, что входной тип <code class="prettyprint">$target_db_type</code> соответствует поддерживаемым значениям ('mysql' или
'sqlite'). Недопустимый тип может привести к выбросу исключения. Метод предполагает, что
<code class="prettyprint">$this-&gt;txt_query</code> содержит SQL-запрос, использующий синтаксис идентификаторов PostgreSQL (двойные
кавычки).</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#property_txt_query"><abbr title="\PhotoRigma\Classes\Database::$txt_query">Database::$txt_query</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, содержащее текст SQL-запроса, которое модифицируется
методом (или остается без изменений).</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__convert_query"><abbr title="\PhotoRigma\Classes\Database::_convert_query()">Database::_convert_query()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Приватный метод для преобразования запросов из
формата PostgreSQL в другие.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">void</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Метод ничего не возвращает напрямую. Результат преобразования сохраняется в свойстве
<code class="prettyprint">$this-&gt;txt_query</code> (если было преобразование).</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -private
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method__convert_from_sqlite_to">
        _convert_from_sqlite_to()
        <a href="classes/PhotoRigma-Classes-Database.html#method__convert_from_sqlite_to" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/Database.php"><a href="files/src-classes-database.html"><abbr title="src/Classes/Database.php">Database.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">1288</span>

    </aside>

        <p class="phpdocumentor-summary">Производит преобразование SQL-запроса из формата SQLite в целевой формат СУБД (MySQL или PostgreSQL).</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">private</span>
                    <span class="phpdocumentor-signature__name">_convert_from_sqlite_to</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$target_db_type</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">void</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот приватный метод выполняет преобразование текста SQL-запроса, хранящегося в свойстве <code class="prettyprint">$this-&gt;txt_query</code>,
из формата SQLite в формат целевой СУБД. SQLite поддерживает экранирование идентификаторов с помощью двойных
кавычек (&quot;) или квадратных скобок ([ ]).
Метод выполняет следующие шаги:</p>
<ol>
<li>Проверяет тип целевой СУБД через параметр <code class="prettyprint">$target_db_type</code>. Метод поддерживает преобразование только в
форматы MySQL ('mysql') и PostgreSQL ('pgsql').</li>
<li>Для целевой СУБД MySQL находит идентификаторы, экранированные двойными кавычками (&quot;) или квадратными
скобками ([ ]), и заменяет их на обратные апострофы (`).</li>
<li>Для целевой СУБД PostgreSQL находит идентификаторы, экранированные квадратными скобками ([ ]), и заменяет
их на двойные кавычки (&quot;). Идентификаторы в двойных кавычках (&quot;) остаются без изменений, так как они
допустимы в PostgreSQL.</li>
<li>Если тип целевой СУБД (<code class="prettyprint">$target_db_type</code>) не поддерживается методом для преобразования из SQLite,
выбрасывается исключение InvalidArgumentException. Преобразованный запрос сохраняется обратно в свойство
<code class="prettyprint">$this-&gt;txt_query</code>.
Этот метод является приватным и предназначен только для использования внутри класса. Вызывается из метода
<code class="prettyprint">_convert_query()</code>.</li>
</ol>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$target_db_type</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Тип целевой СУБД, в которую нужно преобразовать запрос.
Поддерживаемые значения: 'mysql', 'pgsql'.
Ограничения: входной тип должен быть допустимым значением из списка.</p>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-Database.html#method__convert_from_sqlite_to#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">internal</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                             
                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\InvalidArgumentException">InvalidArgumentException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если тип целевой СУБД (<code class="prettyprint">$target_db_type</code>) не поддерживается
методом <code class="prettyprint">_convert_from_sqlite_to</code>.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Метод использует регулярные выражения для поиска идентификаторов в двойных кавычках или квадратных
скобках и их замены. Преобразованный запрос сохраняется в свойстве <code class="prettyprint">$this-&gt;txt_query</code>.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Убедитесь, что входной тип <code class="prettyprint">$target_db_type</code> соответствует поддерживаемым значениям ('mysql' или
'pgsql'). Недопустимый тип может привести к выбросу исключения. Метод предполагает, что
<code class="prettyprint">$this-&gt;txt_query</code> содержит SQL-запрос, использующий синтаксис идентификаторов SQLite (двойные
кавычки или квадратные скобки).</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#property_txt_query"><abbr title="\PhotoRigma\Classes\Database::$txt_query">Database::$txt_query</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, содержащее текст SQL-запроса, которое модифицируется
методом.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__convert_query"><abbr title="\PhotoRigma\Classes\Database::_convert_query()">Database::_convert_query()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Приватный метод для преобразования запросов из
формата SQLite в другие.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">void</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Метод ничего не возвращает напрямую. Результат преобразования сохраняется в свойстве
<code class="prettyprint">$this-&gt;txt_query</code>.</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -private
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method__convert_query">
        _convert_query()
        <a href="classes/PhotoRigma-Classes-Database.html#method__convert_query" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/Database.php"><a href="files/src-classes-database.html"><abbr title="src/Classes/Database.php">Database.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">1116</span>

    </aside>

        <p class="phpdocumentor-summary">Выполняет преобразование SQL-запроса в зависимости от текущего формата и типа СУБД.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">private</span>
                    <span class="phpdocumentor-signature__name">_convert_query</span><span>(</span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">void</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот приватный метод выполняет преобразование текста SQL-запроса, хранящегося в свойстве <code class="prettyprint">$this-&gt;txt_query</code>,
для обеспечения совместимости с целевой базой данных.
Метод выполняет следующие шаги:</p>
<ol>
<li>Проверяет, совпадает ли текущий формат строки запроса (<code class="prettyprint">$this-&gt;current_format</code>) с типом базы данных
(<code class="prettyprint">$this-&gt;db_type</code>). Если форматы совпадают, преобразование не требуется, и метод завершает работу.</li>
<li>Если форматы не совпадают, вызывает соответствующий приватный метод для выполнения преобразования из
текущего формата (<code class="prettyprint">$this-&gt;current_format</code>) в формат целевой СУБД (<code class="prettyprint">$this-&gt;db_type</code>). Вызываемые методы
(<code class="prettyprint">_convert_from_mysql_to()</code>, <code class="prettyprint">_convert_from_pgsql_to()</code>, <code class="prettyprint">_convert_from_sqlite_to()</code>) модифицируют свойство
<code class="prettyprint">$this-&gt;txt_query</code> с преобразованным текстом запроса.</li>
<li>Если текущий формат строки (<code class="prettyprint">$this-&gt;current_format</code>) не поддерживается для преобразования, выбрасывается
исключение InvalidArgumentException.
Этот метод является приватным и предназначен только для использования внутри класса. Основной вызывающий метод</li>
</ol>
<ul>
<li><code class="prettyprint">_execute_query()</code>.</li>
</ul>
</section>

    
    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-Database.html#method__convert_query#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">internal</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                             
                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\InvalidArgumentException">InvalidArgumentException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если текущий формат строки (<code class="prettyprint">$this-&gt;current_format</code>) не
поддерживается для преобразования.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Метод зависит от свойств <code class="prettyprint">$this-&gt;current_format</code> и <code class="prettyprint">$this-&gt;db_type</code> для определения необходимости и
типа преобразования.
Преобразованный текст запроса всегда сохраняется обратно в свойство <code class="prettyprint">$this-&gt;txt_query</code>.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Убедитесь, что свойство <code class="prettyprint">$this-&gt;current_format</code> содержит одно из допустимых значений форматов
('mysql', 'pgsql', 'sqlite') перед вызовом этого метода.
Недопустимый формат может привести к выбросу исключения. Убедитесь также, что <code class="prettyprint">$this-&gt;txt_query</code>
содержит исходный текст запроса, который требуется преобразовать.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#property_txt_query"><abbr title="\PhotoRigma\Classes\Database::$txt_query">Database::$txt_query</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, содержащее текст SQL-запроса, которое модифицируется
методом.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#property_current_format"><abbr title="\PhotoRigma\Classes\Database::$current_format">Database::$current_format</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, определяющее исходный формат строки запроса.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#property_db_type"><abbr title="\PhotoRigma\Classes\Database::$db_type">Database::$db_type</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, определяющее целевой тип используемой СУБД.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__convert_from_mysql_to"><abbr title="\PhotoRigma\Classes\Database::_convert_from_mysql_to()">Database::_convert_from_mysql_to()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Приватный метод для преобразования запросов из
формата MySQL в другие.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__convert_from_pgsql_to"><abbr title="\PhotoRigma\Classes\Database::_convert_from_pgsql_to()">Database::_convert_from_pgsql_to()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Приватный метод для преобразования запросов из
формата PostgreSQL в другие.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__convert_from_sqlite_to"><abbr title="\PhotoRigma\Classes\Database::_convert_from_sqlite_to()">Database::_convert_from_sqlite_to()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Приватный метод для преобразования запросов из
формата SQLite в другие.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__execute_query"><abbr title="\PhotoRigma\Classes\Database::_execute_query()">Database::_execute_query()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Приватный метод для преобразования запроса в нужный
формат СУБД перед выполнением.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">void</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Метод ничего не возвращает напрямую. Результат преобразования сохраняется в свойстве <code class="prettyprint">$this-&gt;txt_query</code>.</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -private
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method__convert_to_mysql_format">
        _convert_to_mysql_format()
        <a href="classes/PhotoRigma-Classes-Database.html#method__convert_to_mysql_format" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/Database.php"><a href="files/src-classes-database.html"><abbr title="src/Classes/Database.php">Database.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">1741</span>

    </aside>

        <p class="phpdocumentor-summary">Производит преобразование строки формата даты/времени в формат, совместимый с MySQL (`DATE_FORMAT`).</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">private</span>
                    <span class="phpdocumentor-signature__name">_convert_to_mysql_format</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$format</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">string</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот приватный метод преобразует строку формата даты или времени из формата, соответствующего текущему формату
строки (<code class="prettyprint">$this-&gt;current_format</code>), в формат, совместимый с функцией MySQL <code class="prettyprint">DATE_FORMAT()</code>.
Метод выполняет следующие шаги:</p>
<ol>
<li>Проверяет, совпадает ли текущий формат строки (<code class="prettyprint">$this-&gt;current_format</code>) с 'mysql'. Если форматы совпадают,
входная строка <code class="prettyprint">$format</code> уже считается MySQL-совместимой и возвращается без изменений.</li>
<li>Проверяет, существует ли уже преобразованная строка формата в кэше <code class="prettyprint">$this-&gt;format_cache</code> для текущего
исходного формата (<code class="prettyprint">$this-&gt;current_format</code>) и входной строки <code class="prettyprint">$format</code>. Если найдено в кэше,
преобразованное значение возвращается немедленно.</li>
<li>Если формат не 'mysql' и не найден в кэше, определяет карту соответствия символов формата для
преобразования из <code class="prettyprint">$this-&gt;current_format</code> в MySQL. Поддерживаемые исходные форматы: 'pgsql' и 'sqlite'.</li>
<li>Если текущий формат (<code class="prettyprint">$this-&gt;current_format</code>) не является поддерживаемым исходным форматом для
преобразования в MySQL, выбрасывается исключение InvalidArgumentException.</li>
<li>Использует карту соответствия для преобразования входной строки <code class="prettyprint">$format</code> с помощью <code class="prettyprint">strtr()</code>.</li>
<li>Сохраняет результат преобразования в кэше <code class="prettyprint">$this-&gt;format_cache</code> для будущего использования.</li>
<li>Возвращает преобразованную строку формата, совместимую с MySQL <code class="prettyprint">DATE_FORMAT()</code>.
Этот метод является приватным и предназначен только для использования внутри класса. Вызывается из метода
<code class="prettyprint">_format_date_internal()</code> при работе с СУБД MySQL.</li>
</ol>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$format</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Строка формата даты/времени в стиле текущего формата строки (<code class="prettyprint">$this-&gt;current_format</code>).
Пример: 'YYYY-MM-DD' для формата PostgreSQL или '%Y-%m-%d' для формата SQLite/MySQL.</p>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-Database.html#method__convert_to_mysql_format#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">internal</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                             
                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\InvalidArgumentException">InvalidArgumentException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если текущий формат строки (<code class="prettyprint">$this-&gt;current_format</code>) не
поддерживается методом <code class="prettyprint">_convert_to_mysql_format</code> в качестве исходного формата
для преобразования в MySQL.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Метод использует кэширование (<code class="prettyprint">$this-&gt;format_cache</code>) для хранения результатов преобразования форматов
и избежания повторных вычислений. Используется строковая замена (<code class="prettyprint">strtr()</code>) на основе
предопределенных карт соответствия.
Поведение метода зависит от свойства <code class="prettyprint">$this-&gt;current_format</code>.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Убедитесь, что свойство <code class="prettyprint">$this-&gt;current_format</code> содержит одно из допустимых значений ('mysql',
'pgsql', 'sqlite') перед вызовом этого метода.
Убедитесь, что входная строка <code class="prettyprint">$format</code> соответствует синтаксису формата, ожидаемому для
<code class="prettyprint">$this-&gt;current_format</code>. Неподдерживаемый исходный формат приведет к исключению.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#property_format_cache"><abbr title="\PhotoRigma\Classes\Database::$format_cache">Database::$format_cache</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Внутреннее свойство, используемое для кэширования
преобразований форматов.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#property_current_format"><abbr title="\PhotoRigma\Classes\Database::$current_format">Database::$current_format</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, определяющее исходный формат строки для
преобразования.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__format_date_internal"><abbr title="\PhotoRigma\Classes\Database::_format_date_internal()">Database::_format_date_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Преобразовывает формат даты в стиль MySQL.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">string</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Строка формата даты/времени, преобразованная в стиль, совместимый с функцией MySQL
<code class="prettyprint">DATE_FORMAT ()</code>. Пример: '%Y-%m-%d'.</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -private
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method__convert_to_postgres_format">
        _convert_to_postgres_format()
        <a href="classes/PhotoRigma-Classes-Database.html#method__convert_to_postgres_format" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/Database.php"><a href="files/src-classes-database.html"><abbr title="src/Classes/Database.php">Database.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">1835</span>

    </aside>

        <p class="phpdocumentor-summary">Преобразует формат даты/времени в формат, совместимый с PostgreSQL.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">private</span>
                    <span class="phpdocumentor-signature__name">_convert_to_postgres_format</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$format</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">string</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот приватный метод преобразует строку формата даты или времени из формата, соответствующего текущему формату
строки (<code class="prettyprint">$this-&gt;current_format</code>), в формат, совместимый с функциями PostgreSQL (например, <code class="prettyprint">TO_CHAR</code>).
Метод выполняет следующие шаги:</p>
<ol>
<li>Проверяет, совпадает ли текущий формат строки (<code class="prettyprint">$this-&gt;current_format</code>) с 'pgsql'. Если форматы совпадают,
входная строка <code class="prettyprint">$format</code> уже считается PostgreSQL-совместимой и возвращается без изменений.</li>
<li>Проверяет, существует ли уже преобразованная строка формата в кэше <code class="prettyprint">$this-&gt;format_cache</code> для текущего
исходного формата (<code class="prettyprint">$this-&gt;current_format</code>) и входной строки <code class="prettyprint">$format</code>. Если найдено в кэше,
преобразованное значение возвращается немедленно.</li>
<li>Если формат не 'pgsql' и не найден в кэше, определяет карту соответствия символов формата для
преобразования из <code class="prettyprint">$this-&gt;current_format</code> (который может быть 'mysql' или 'sqlite') в PostgreSQL.</li>
<li>Если текущий формат (<code class="prettyprint">$this-&gt;current_format</code>) не является поддерживаемым исходным форматом для
преобразования в PostgreSQL, выбрасывается исключение InvalidArgumentException.</li>
<li>Использует карту соответствия для преобразования входной строки <code class="prettyprint">$format</code> с помощью <code class="prettyprint">strtr()</code>.</li>
<li>Сохраняет результат преобразования в кэше <code class="prettyprint">$this-&gt;format_cache</code> для будущего использования.</li>
<li>Возвращает преобразованную строку формата, совместимую с функциями PostgreSQL.
Этот метод является приватным и предназначен только для использования внутри класса. Вызывается из метода
<code class="prettyprint">_format_date_internal()</code> при работе с СУБД PostgreSQL.</li>
</ol>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$format</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Строка формата даты/времени в стиле текущего формата строки (<code class="prettyprint">$this-&gt;current_format</code>).
Пример: '%Y-%m-%d' для формата MySQL/SQLite или 'YYYY-MM-DD' для формата PostgreSQL (в
случае, если current_format уже pgsql).</p>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-Database.html#method__convert_to_postgres_format#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">internal</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                             
                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\InvalidArgumentException">InvalidArgumentException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если текущий формат строки (<code class="prettyprint">$this-&gt;current_format</code>) не
поддерживается методом <code class="prettyprint">_convert_to_postgres_format</code> в качестве исходного
формата для преобразования в PostgreSQL (т.е., не 'mysql' и не 'sqlite').</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Метод использует кэширование (<code class="prettyprint">$this-&gt;format_cache</code>) для хранения результатов преобразования форматов
и избежания повторных вычислений. Используется строковая замена (<code class="prettyprint">strtr()</code>) на основе
предопределенных карт соответствия.
Поведение метода зависит от свойства <code class="prettyprint">$this-&gt;current_format</code>.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Убедитесь, что свойство <code class="prettyprint">$this-&gt;current_format</code> содержит одно из допустимых значений ('mysql',
'pgsql', 'sqlite') перед вызовом этого метода.
Убедитесь, что входная строка <code class="prettyprint">$format</code> соответствует синтаксису формата, ожидаемому для
<code class="prettyprint">$this-&gt;current_format</code>. Неподдерживаемый исходный формат приведет к исключению.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#property_format_cache"><abbr title="\PhotoRigma\Classes\Database::$format_cache">Database::$format_cache</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Внутреннее свойство, используемое для кэширования
преобразований форматов.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#property_current_format"><abbr title="\PhotoRigma\Classes\Database::$current_format">Database::$current_format</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, определяющее исходный формат строки для
преобразования.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__format_date_internal"><abbr title="\PhotoRigma\Classes\Database::_format_date_internal()">Database::_format_date_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Преобразовывает формат даты в стиль PostgreSQL.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">string</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Строка формата даты/времени, преобразованная в стиль, совместимый с функциями PostgreSQL
(например, TO_CHAR).
Пример: 'YYYY-MM-DD HH24:MI:SS'.</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -private
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method__convert_to_sqlite_format">
        _convert_to_sqlite_format()
        <a href="classes/PhotoRigma-Classes-Database.html#method__convert_to_sqlite_format" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/Database.php"><a href="files/src-classes-database.html"><abbr title="src/Classes/Database.php">Database.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">1928</span>

    </aside>

        <p class="phpdocumentor-summary">Преобразует формат даты/времени в формат, совместимый с SQLite (`strftime`).</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">private</span>
                    <span class="phpdocumentor-signature__name">_convert_to_sqlite_format</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$format</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">string</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот приватный метод преобразует строку формата даты или времени из формата, соответствующего текущему формату
строки (<code class="prettyprint">$this-&gt;current_format</code>), в формат, совместимый с функцией SQLite <code class="prettyprint">strftime()</code>.
Метод выполняет следующие шаги:</p>
<ol>
<li>Проверяет, совпадает ли текущий формат строки (<code class="prettyprint">$this-&gt;current_format</code>) с 'sqlite'. Если форматы совпадают,
входная строка <code class="prettyprint">$format</code> уже считается SQLite-совместимой и возвращается без изменений.</li>
<li>Проверяет, существует ли уже преобразованная строка формата в кэше <code class="prettyprint">$this-&gt;format_cache</code> для текущего
исходного формата (<code class="prettyprint">$this-&gt;current_format</code>) и входной строки <code class="prettyprint">$format</code>. Если найдено в кэше,
преобразованное значение возвращается немедленно.</li>
<li>Если формат не 'sqlite' и не найден в кэше, определяет карту соответствия символов формата для
преобразования из <code class="prettyprint">$this-&gt;current_format</code> (который может быть 'mysql' или 'pgsql') в SQLite.</li>
<li>Если текущий формат (<code class="prettyprint">$this-&gt;current_format</code>) не является поддерживаемым исходным форматом для
преобразования в SQLite, выбрасывается исключение InvalidArgumentException.</li>
<li>Использует карту соответствия для преобразования входной строки <code class="prettyprint">$format</code> с помощью <code class="prettyprint">strtr()</code>.</li>
<li>Сохраняет результат преобразования в кэше <code class="prettyprint">$this-&gt;format_cache</code> для будущего использования.</li>
<li>Возвращает преобразованную строку формата, совместимую с функцией SQLite <code class="prettyprint">strftime()</code>.
Этот метод является приватным и предназначен только для использования внутри класса. Вызывается из метода
<code class="prettyprint">_format_date_internal()</code> при работе с СУБД SQLite.</li>
</ol>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$format</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Строка формата даты/времени в стиле текущего формата строки (<code class="prettyprint">$this-&gt;current_format</code>).
Пример: '%Y-%m-%d' для формата MySQL/SQLite или 'YYYY-MM-DD HH24:MI:SS' для формата
PostgreSQL.</p>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-Database.html#method__convert_to_sqlite_format#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">internal</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                             
                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\InvalidArgumentException">InvalidArgumentException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если текущий формат строки (<code class="prettyprint">$this-&gt;current_format</code>) не
поддерживается методом <code class="prettyprint">_convert_to_sqlite_format</code> в качестве исходного
формата для преобразования в SQLite (т.е., не 'mysql' и не 'pgsql').</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Метод использует кэширование (<code class="prettyprint">$this-&gt;format_cache</code>) для хранения результатов преобразования форматов
и избежания повторных вычислений. Используется строковая замена (<code class="prettyprint">strtr()</code>) на основе
предопределенных карт соответствия.
Поведение метода зависит от свойства <code class="prettyprint">$this-&gt;current_format</code>.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Убедитесь, что свойство <code class="prettyprint">$this-&gt;current_format</code> содержит одно из допустимых значений ('mysql',
'pgsql', 'sqlite') перед вызовом этого метода.
Убедитесь, что входная строка <code class="prettyprint">$format</code> соответствует синтаксису формата, ожидаемому для
<code class="prettyprint">$this-&gt;current_format</code>. Неподдерживаемый исходный формат приведет к исключению.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#property_format_cache"><abbr title="\PhotoRigma\Classes\Database::$format_cache">Database::$format_cache</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Внутреннее свойство, используемое для кэширования
преобразований форматов.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#property_current_format"><abbr title="\PhotoRigma\Classes\Database::$current_format">Database::$current_format</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, определяющее исходный формат строки для
преобразования.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__format_date_internal"><abbr title="\PhotoRigma\Classes\Database::_format_date_internal()">Database::_format_date_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Преобразовывает формат даты в стиль SQLite.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">string</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Строка формата даты/времени, преобразованная в стиль, совместимый с функцией SQLite <code class="prettyprint">strftime()</code>.
Пример: '%Y-%m-%d %H:%M:%S'.</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -private
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method__execute_query">
        _execute_query()
        <a href="classes/PhotoRigma-Classes-Database.html#method__execute_query" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/Database.php"><a href="files/src-classes-database.html"><abbr title="src/Classes/Database.php">Database.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">1015</span>

    </aside>

        <p class="phpdocumentor-summary">Выполняет SQL-запрос с использованием подготовленных выражений.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">private</span>
                    <span class="phpdocumentor-signature__name">_execute_query</span><span>(</span><span class="phpdocumentor-signature__argument"><span>[</span><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$params</span><span> = </span><span class="phpdocumentor-signature__argument__default-value">[]</span><span> ]</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">bool</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот приватный метод выполняет следующие шаги:</p>
<ol>
<li>Проверяет состояние внутренних свойств (<code class="prettyprint">$this-&gt;res_query</code>, <code class="prettyprint">$this-&gt;txt_query</code>) и типы переданных
аргументов (<code class="prettyprint">$params</code>).</li>
<li>Очищает внутренние свойства для вывода результата предыдущего запроса (<code class="prettyprint">$this-&gt;res_query</code>,
<code class="prettyprint">$this-&gt;aff_rows</code>, <code class="prettyprint">$this-&gt;insert_id</code>).</li>
<li>Преобразует текст запроса (<code class="prettyprint">$this-&gt;txt_query</code>) в формат, специфичный для текущей СУБД, с помощью метода
<code class="prettyprint">_convert_query()</code>.</li>
<li>Если константа <code class="prettyprint">SQL_ANALYZE</code> установлена в <code class="prettyprint">true</code>, выполняет анализ запроса (например, <code class="prettyprint">EXPLAIN ANALYZE</code>) с
помощью метода <code class="prettyprint">_log_explain()</code>.</li>
<li>Подготавливает и выполняет SQL-запрос с использованием объекта PDO (<code class="prettyprint">$this-&gt;pdo</code>) и переданных параметров
<code class="prettyprint">$params</code>. Получает количество затронутых строк (<code class="prettyprint">$this-&gt;aff_rows</code>) и, если запрос является INSERT, ID
последней вставленной записи (<code class="prettyprint">$this-&gt;insert_id</code>).</li>
<li>Измеряет время выполнения запроса и, если константа <code class="prettyprint">SQL_LOG</code> установлена в <code class="prettyprint">true</code>:
<ul>
<li>Логирует запрос как &quot;медленный&quot; с помощью <code class="prettyprint">_log_query()</code>, если время выполнения превышает 200 мс.</li>
<li>Логирует запрос как &quot;без плейсхолдеров&quot; с помощью <code class="prettyprint">_log_query()</code>, если массив <code class="prettyprint">$params</code> пустой.</li>
</ul>
</li>
<li>Очищает текст запроса (<code class="prettyprint">$this-&gt;txt_query = null</code>) после его выполнения.</li>
<li>Возвращает <code class="prettyprint">true</code>, указывая на успешное выполнение запроса (даже если затронуто 0 строк или SELECT не
вернул результатов).
Этот метод является приватным и предназначен только для использования внутри класса <code class="prettyprint">Database</code>. Он является
ключевым методом для выполнения всех SQL-операций, и его вызывают другие методы класса (например, <code class="prettyprint">select()</code>,
<code class="prettyprint">insert()</code>, <code class="prettyprint">update()</code>, <code class="prettyprint">delete()</code>, <code class="prettyprint">truncate()</code>, <code class="prettyprint">join()</code>).</li>
</ol>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$params</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                 = <span class="phpdocumentor-signature__argument__default-value">[]</span>            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Ассоциативный массив параметров для подготовленного выражения (необязательно).
Пример: <code class="prettyprint">[':id' =&gt; 1, ':name' =&gt; 'John Doe']</code>.
Ключи массива должны соответствовать именам плейсхолдеров в тексте запроса
(<code class="prettyprint">$this-&gt;txt_query</code>).
По умолчанию: пустой массив (<code class="prettyprint">[]</code>), если параметры не требуются.</p>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-Database.html#method__execute_query#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">internal</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                             
                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\InvalidArgumentException">InvalidArgumentException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если:</p>
<ul>
<li>Внутреннее свойство <code class="prettyprint">$this-&gt;res_query</code> имеет некорректное состояние перед
выполнением запроса.</li>
<li>Внутреннее свойство <code class="prettyprint">$this-&gt;txt_query</code> не является строкой.</li>
<li>Переданный аргумент <code class="prettyprint">$params</code> не является массивом.</li>
</ul>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\PDOException">PDOException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если возникает ошибка на уровне PDO в процессе подготовки или
выполнения запроса.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\Exception">Exception</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если возникает ошибка при вызове метода <code class="prettyprint">_log_explain()</code> или
<code class="prettyprint">_log_query()</code>.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Метод зависит от корректной конфигурации базы данных и использует следующие константы для настройки
поведения:</p>
<ul>
<li><code class="prettyprint">SQL_LOG</code>: Управляет логированием медленных запросов (время выполнения &gt; 200 мс) и запросов без
плейсхолдеров.</li>
<li><code class="prettyprint">SQL_ANALYZE</code>: Управляет выполнением <code class="prettyprint">EXPLAIN ANALYZE</code> перед запросами для диагностики
производительности.
Эти константы позволяют настраивать поведение метода в зависимости от требований к отладке и
мониторингу.</li>
</ul>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Убедитесь, что перед вызовом этого метода:</p>
<ul>
<li>Свойство <code class="prettyprint">$this-&gt;txt_query</code> содержит валидную SQL-строку для подготовленного выражения.</li>
<li>Массив <code class="prettyprint">$params</code> содержит значения, соответствующие всем плейсхолдерам в <code class="prettyprint">$this-&gt;txt_query</code>.</li>
<li>Соединение с базой данных установлено (<code class="prettyprint">$this-&gt;pdo</code> является валидным объектом PDO).
Невалидные входные данные или некорректное состояние могут привести к выбросу исключений.</li>
</ul>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#property_pdo"><abbr title="\PhotoRigma\Classes\Database::$pdo">Database::$pdo</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Объект PDO, используемый для выполнения запроса.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#property_res_query"><abbr title="\PhotoRigma\Classes\Database::$res_query">Database::$res_query</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, хранящее результат выполненного запроса (объект
PDOStatement для SELECT/JOIN).</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#property_aff_rows"><abbr title="\PhotoRigma\Classes\Database::$aff_rows">Database::$aff_rows</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, хранящее количество строк, затронутых последним запросом.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#property_insert_id"><abbr title="\PhotoRigma\Classes\Database::$insert_id">Database::$insert_id</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, хранящее ID последней вставленной записи (для INSERT).</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#property_txt_query"><abbr title="\PhotoRigma\Classes\Database::$txt_query">Database::$txt_query</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, хранящее текст SQL-запроса для выполнения.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__convert_query"><abbr title="\PhotoRigma\Classes\Database::_convert_query()">Database::_convert_query()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Приватный метод для преобразования запроса в нужный
формат СУБД перед выполнением.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__log_explain"><abbr title="\PhotoRigma\Classes\Database::_log_explain()">Database::_log_explain()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Приватный метод для выполнения EXPLAIN ANALYZE.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__log_query"><abbr title="\PhotoRigma\Classes\Database::_log_query()">Database::_log_query()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Приватный метод для логирования запросов.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__delete_internal"><abbr title="\PhotoRigma\Classes\Database::_delete_internal()">Database::_delete_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Выполняет SQL-запрос.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__insert_internal"><abbr title="\PhotoRigma\Classes\Database::_insert_internal()">Database::_insert_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Выполняет SQL-запрос.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__join_internal"><abbr title="\PhotoRigma\Classes\Database::_join_internal()">Database::_join_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Выполняет SQL-запрос.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__select_internal"><abbr title="\PhotoRigma\Classes\Database::_select_internal()">Database::_select_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Выполняет SQL-запрос.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__truncate_internal"><abbr title="\PhotoRigma\Classes\Database::_truncate_internal()">Database::_truncate_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Выполняет SQL-запрос.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__update_internal"><abbr title="\PhotoRigma\Classes\Database::_update_internal()">Database::_update_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Выполняет SQL-запрос.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">bool</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Возвращает <code class="prettyprint">true</code>, если подготовка и выполнение запроса прошли успешно.</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -private
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method__fallback_to_ilike_pgsql">
        _fallback_to_ilike_pgsql()
        <a href="classes/PhotoRigma-Classes-Database.html#method__fallback_to_ilike_pgsql" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/Database.php"><a href="files/src-classes-database.html"><abbr title="src/Classes/Database.php">Database.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">4140</span>

    </aside>

        <p class="phpdocumentor-summary">Выполняет альтернативный поиск по ILIKE с ранжированием similarity() для PostgreSQL.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">private</span>
                    <span class="phpdocumentor-signature__name">_fallback_to_ilike_pgsql</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$columns_to_return_escaped</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$columns_to_search_escaped</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$search_string</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$table_escaped</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$options</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">array&lt;string|int, mixed&gt;|false</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот приватный метод реализует поиск данных в PostgreSQL, используя оператор <code class="prettyprint">ILIKE</code> (регистронезависимый
LIKE) по нескольким столбцам с возможностью ранжирования результатов по близости с использованием функции
<code class="prettyprint">similarity()</code>. Он используется как резервный механизм (fallback), когда основной полнотекстовый поиск (FTS)
недоступен, отключен, или не дал результатов.
Метод выполняет следующие действия:</p>
<ol>
<li>Проверяет, является ли строка поиска <code class="prettyprint">$search_string</code> пустой. Если да, возвращает <code class="prettyprint">false</code> без выполнения
запроса.</li>
<li>Формирует условия <code class="prettyprint">WHERE</code> для оператора <code class="prettyprint">ILIKE</code> по каждому столбцу из массива <code class="prettyprint">$columns_to_search_escaped</code>.
Каждое условие имеет вид <code class="prettyprint">&quot;имя_столбца&quot; ILIKE :плейсхолдер</code>. Для строки поиска автоматически добавляются
символы <code class="prettyprint">%</code> в начале и конце (для поиска подстроки). Каждое условие использует уникальный именованный
плейсхолдер (например, <code class="prettyprint">:search_string_0</code>, <code class="prettyprint">:search_string_1</code>) для безопасной привязки параметров.</li>
<li>Формирует выражения для ранжирования по близости с использованием функции <code class="prettyprint">similarity()</code> для каждого
столбца из массива <code class="prettyprint">$columns_to_search_escaped</code>. Каждое выражение имеет вид <code class="prettyprint">similarity (&quot;имя_столбца&quot;, :плейсхолдер_ранга)</code>, где <code class="prettyprint">:плейсхолдер_ранга</code> - уникальный именованный плейсхолдер для исходной строки
поиска.</li>
<li>Объединяет сформированные условия <code class="prettyprint">ILIKE</code> оператором <code class="prettyprint">OR</code> для создания общей строки условия <code class="prettyprint">WHERE</code>.</li>
<li>Объединяет сформированные выражения <code class="prettyprint">similarity()</code> оператором <code class="prettyprint">+</code> для создания общей строки сортировки
<code class="prettyprint">ORDER BY</code> по суммарному рангу (по убыванию).</li>
<li>Формирует базовые опции (<code class="prettyprint">$base_options</code>) для поиска по <code class="prettyprint">ILIKE</code> с ранжированием, включающие сформированные
строки <code class="prettyprint">WHERE</code> и <code class="prettyprint">ORDER BY</code>, а также массив параметров, содержащий плейсхолдеры как для <code class="prettyprint">ILIKE</code>, так и для
<code class="prettyprint">similarity()</code>.</li>
<li>Объединяет переданные внешние опции запроса (<code class="prettyprint">$options</code>) с базовыми опциями (<code class="prettyprint">$base_options</code>) с помощью
приватного метода <code class="prettyprint">_fts_check_options()</code>. Этот метод разрешает конфликты плейсхолдеров и определяет
приоритеты для WHERE, ORDER BY, GROUP BY, LIMIT и PARAMS (сортировка по рангу из $base_options имеет
приоритет).</li>
<li>Предпринимает попытку выполнить SQL-запрос SELECT с использованием экранированных столбцов для возврата,
экранированного имени таблицы и объединенных опций (<code class="prettyprint">$new_options</code>) в блоке <code class="prettyprint">try...catch</code>, вызывая
приватный метод <code class="prettyprint">_select_internal()</code>.</li>
<li>В случае возникновения исключения (<code class="prettyprint">Throwable</code>) во время выполнения LIKE-запроса (блок <code class="prettyprint">catch</code>):
<ul>
<li>Логирует информацию об ошибке с помощью функции <code class="prettyprint">log_in_file()</code>, включая текст запроса и сообщение об
ошибке.</li>
<li>Возвращает <code class="prettyprint">false</code>, сигнализируя об ошибке выполнения поиска.</li>
</ul>
</li>
<li>В случае успешного выполнения запроса (блок <code class="prettyprint">try</code> без исключений) получает результат запроса в виде
массива с помощью приватного метода <code class="prettyprint">_result_array_internal()</code> и возвращает его.
Этот метод является приватным и предназначен только для использования внутри класса <code class="prettyprint">Database</code>. Он вызывается
из приватного метода <code class="prettyprint">_full_text_search_pgsql()</code>.</li>
</ol>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$columns_to_return_escaped</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Массив строк с именами столбцов, которые нужно вернуть. Имена
столбцов должны быть уже экранированы для PostgreSQL (например, <code class="prettyprint">&quot;id&quot;</code>).</p>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$columns_to_search_escaped</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Массив строк с именами столбцов, по которым выполняется поиск по
ILIKE. Имена столбцов должны быть уже экранированы для PostgreSQL.</p>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$search_string</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Строка поиска, введенная пользователем. Для поиска по ILIKE
автоматически будут добавлены символы <code class="prettyprint">%</code>. Пустая строка приводит к
возврату <code class="prettyprint">false</code>. Используется как есть для ранжирования <code class="prettyprint">similarity()</code>.</p>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$table_escaped</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Строка с именем таблицы, в которой выполняется поиск. Имя таблицы
должно быть уже экранировано для PostgreSQL (например, <code class="prettyprint">&quot;users&quot;</code>).</p>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$options</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Массив дополнительных опций для формирования запроса. Используется
для добавления условий WHERE, GROUP BY, ORDER BY, LIMIT и параметров
к LIKE-запросу.
Поддерживаемые ключи:</p>
<ul>
<li>where (string|array|false): Дополнительное условие WHERE
(объединяется с условиями ILIKE оператором AND).</li>
<li>group (string|false): Группировка GROUP BY.</li>
<li>order (string|false): Дополнительная сортировка ORDER BY (имеет
более низкий приоритет, чем сортировка по рангу similarity()).</li>
<li>limit (int|string|false): Ограничение LIMIT.</li>
<li>params (array): Ассоциативный массив дополнительных параметров для
подготовленного выражения.</li>
</ul>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-Database.html#method__fallback_to_ilike_pgsql#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">internal</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                             
                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\Exception">Exception</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Может быть выброшено функцией логирования <code class="prettyprint">log_in_file()</code> в случае
невозможности записи в файл.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\PDOException">PDOException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Может быть выброшено методами <code class="prettyprint">_fts_check_options()</code> (через вызов
<code class="prettyprint">_build_conditions()</code>) или <code class="prettyprint">_select_internal()</code> в случае ошибок, связанных с
базой данных или некорректным SQL, если они не перехватываются в блоке
<code class="prettyprint">try...catch</code> или выбрасываются после него. (Большинство таких ошибок внутри
перехватываются и приводят к возврату false).</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\InvalidArgumentException">InvalidArgumentException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Может быть выброшено методом <code class="prettyprint">_fts_check_options()</code> (через вызов
<code class="prettyprint">_build_conditions()</code>) при некорректном формате опций. (Большинство таких
ошибок внутри перехватываются и приводят к возврату false).</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Метод используется как резервный вариант поиска для PostgreSQL, когда полнотекстовый поиск (FTS) не
может быть выполнен. Для каждого столбца поиска создается отдельное условие <code class="prettyprint">ILIKE</code> и отдельное
выражение <code class="prettyprint">similarity()</code> с уникальными плейсхолдерами. Условия <code class="prettyprint">ILIKE</code> объединяются оператором <code class="prettyprint">OR</code>,
а ранги <code class="prettyprint">similarity()</code> суммируются для сортировки по убыванию.
Использует приватный метод <code class="prettyprint">_fts_check_options()</code> для объединения этих условий и сортировки с любыми
дополнительными опциями, предоставленными пользователем.
Для работы функции <code class="prettyprint">similarity()</code> требуется установить и включить расширение <code class="prettyprint">pg_trgm</code> в базе данных
PostgreSQL.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Убедитесь, что входные параметры <code class="prettyprint">$columns_to_return_escaped</code>, <code class="prettyprint">$columns_to_search_escaped</code> и
<code class="prettyprint">$table_escaped</code> уже экранированы для PostgreSQL.
Убедитесь, что расширение <code class="prettyprint">pg_trgm</code> установлено и доступно в базе данных PostgreSQL для корректной
работы <code class="prettyprint">similarity()</code>.
Поиск с <code class="prettyprint">ILIKE</code> и ранжирование <code class="prettyprint">similarity()</code> могут быть неэффективны на больших объемах данных по
сравнению с FTS.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__fts_check_options"><abbr title="\PhotoRigma\Classes\Database::_fts_check_options()">Database::_fts_check_options()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Приватный метод, используемый для объединения опций.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__select_internal"><abbr title="\PhotoRigma\Classes\Database::_select_internal()">Database::_select_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Приватный метод для выполнения SELECT-запроса.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__result_array_internal"><abbr title="\PhotoRigma\Classes\Database::_result_array_internal()">Database::_result_array_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Приватный метод для получения всех строк
результата запроса.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="namespaces/photorigma-include.html#function_log_in_file"><abbr title="\PhotoRigma\Include\log_in_file()">log_in_file()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Записывает сообщение об ошибке в лог-файл.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">see</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="https://www.postgresql.org/docs/current/pgtrgm.html">https://www.postgresql.org/docs/current/pgtrgm.html</a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Документация по расширению pg_trgm и функции
similarity().</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__full_text_search_pgsql"><abbr title="\PhotoRigma\Classes\Database::_full_text_search_pgsql()">Database::_full_text_search_pgsql()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Приватный метод, реализующий поиск по ILIKE в
качестве fallback.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">array&lt;string|int, mixed&gt;|false</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Результат выполнения поиска в виде массива ассоциативных массивов (строк) при успехе и
наличии результатов, пустой массив при успехе, но отсутствии результатов, или <code class="prettyprint">false</code> в
случае пустой строки поиска или ошибки выполнения запроса.</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -private
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method__fallback_to_like_mysql">
        _fallback_to_like_mysql()
        <a href="classes/PhotoRigma-Classes-Database.html#method__fallback_to_like_mysql" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/Database.php"><a href="files/src-classes-database.html"><abbr title="src/Classes/Database.php">Database.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">3793</span>

    </aside>

        <p class="phpdocumentor-summary">Выполняет альтернативный поиск по LIKE для MySQL.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">private</span>
                    <span class="phpdocumentor-signature__name">_fallback_to_like_mysql</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$columns_to_return_escaped</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$columns_to_search_escaped</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$search_string</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$table_escaped</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$options</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">array&lt;string|int, mixed&gt;|false</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот приватный метод реализует поиск данных в MySQL, используя оператор <code class="prettyprint">LIKE</code> по нескольким столбцам.
Он используется как резервный механизм (fallback), когда основной полнотекстовый поиск (FTS) недоступен,
отключен, или не дал результатов (например, из-за минимальной длины строки поиска или отсутствия FTS-индекса).
Метод выполняет следующие действия:</p>
<ol>
<li>Проверяет, является ли строка поиска <code class="prettyprint">$search_string</code> пустой. Если да, возвращает <code class="prettyprint">false</code> без выполнения
запроса.</li>
<li>Формирует условия <code class="prettyprint">WHERE</code> для оператора <code class="prettyprint">LIKE</code> по каждому столбцу из массива <code class="prettyprint">$columns_to_search_escaped</code>.
Каждое условие имеет вид <code class="prettyprint">&quot;имя_столбца&quot; LIKE :плейсхолдер</code>. Для строки поиска автоматически добавляются
символы <code class="prettyprint">%</code> в начале и конце (для поиска подстроки). Каждое условие использует уникальный именованный
плейсхолдер (например, <code class="prettyprint">:search_string_0</code>, <code class="prettyprint">:search_string_1</code>) для безопасной привязки параметров.</li>
<li>Объединяет сформированные условия <code class="prettyprint">LIKE</code> оператором <code class="prettyprint">OR</code> для создания общей строки условия <code class="prettyprint">WHERE</code>.</li>
<li>Формирует базовые опции (<code class="prettyprint">$base_options</code>) для поиска по <code class="prettyprint">LIKE</code>, включающие сформированное условие <code class="prettyprint">WHERE</code> и
массив параметров для плейсхолдеров <code class="prettyprint">LIKE</code>.</li>
<li>Объединяет переданные внешние опции запроса (<code class="prettyprint">$options</code>) с базовыми опциями <code class="prettyprint">LIKE</code> (<code class="prettyprint">$base_options</code>) с
помощью приватного метода <code class="prettyprint">_fts_check_options()</code>. Этот метод разрешает конфликты плейсхолдеров и определяет
приоритеты для WHERE, ORDER BY, GROUP BY, LIMIT и PARAMS.</li>
<li>Предпринимает попытку выполнить SQL-запрос SELECT с использованием экранированных столбцов для возврата,
экранированного имени таблицы и объединенных опций (<code class="prettyprint">$new_options</code>) в блоке <code class="prettyprint">try...catch</code>, вызывая
приватный метод <code class="prettyprint">_select_internal()</code>.</li>
<li>В случае возникновения исключения (<code class="prettyprint">Throwable</code>) во время выполнения LIKE-запроса (блок <code class="prettyprint">catch</code>):
<ul>
<li>Логирует информацию об ошибке с помощью функции <code class="prettyprint">log_in_file()</code>, включая текст запроса и сообщение об
ошибке.</li>
<li>Возвращает <code class="prettyprint">false</code>, сигнализируя об ошибке выполнения поиска.</li>
</ul>
</li>
<li>В случае успешного выполнения запроса (блок <code class="prettyprint">try</code> без исключений) получает результат запроса в виде массива
с помощью приватного метода <code class="prettyprint">_result_array_internal()</code> и возвращает его.
Этот метод является приватным и предназначен только для использования внутри класса <code class="prettyprint">Database</code>. Он вызывается
из приватного метода <code class="prettyprint">_full_text_search_mysql()</code>.</li>
</ol>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$columns_to_return_escaped</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Массив строк с именами столбцов, которые нужно вернуть. Имена
столбцов должны быть уже экранированы для MySQL (например, <code class="prettyprint">`id`</code>).</p>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$columns_to_search_escaped</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Массив строк с именами столбцов, по которым выполняется поиск по LIKE.
Имена столбцов должны быть уже экранированы для MySQL.</p>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$search_string</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Строка поиска, введенная пользователем. Для поиска по LIKE
автоматически будут добавлены символы <code class="prettyprint">%</code>. Пустая строка приводит к
возврату <code class="prettyprint">false</code>.</p>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$table_escaped</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Строка с именем таблицы, в которой выполняется поиск. Имя таблицы
должно быть уже экранировано для MySQL (например, <code class="prettyprint">`users`</code>).</p>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$options</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Массив дополнительных опций для формирования запроса. Используется
для добавления условий WHERE, GROUP BY, ORDER BY, LIMIT и параметров
к LIKE-запросу.
Поддерживаемые ключи:</p>
<ul>
<li>where (string|array|false): Дополнительное условие WHERE
(объединяется с условиями LIKE оператором AND).</li>
<li>group (string|false): Группировка GROUP BY.</li>
<li>order (string|false): Сортировка ORDER BY.</li>
<li>limit (int|string|false): Ограничение LIMIT.</li>
<li>params (array): Ассоциативный массив дополнительных параметров для
подготовленного выражения.</li>
</ul>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-Database.html#method__fallback_to_like_mysql#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">internal</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                             
                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\Exception">Exception</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Может быть выброшено функцией логирования <code class="prettyprint">log_in_file()</code> в случае
невозможности записи в файл.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\PDOException">PDOException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Может быть выброшено методами <code class="prettyprint">_fts_check_options()</code> (через вызов
<code class="prettyprint">_build_conditions()</code>) или <code class="prettyprint">_select_internal()</code> в случае ошибок, связанных с
базой данных или некорректным SQL, если они не перехватываются в блоке
<code class="prettyprint">try...catch</code> или выбрасываются после него. (Большинство таких ошибок внутри
LIKE перехватываются и приводят к возврату false).</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\InvalidArgumentException">InvalidArgumentException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Может быть выброшено методом <code class="prettyprint">_fts_check_options()</code> (через вызов
<code class="prettyprint">_build_conditions()</code>) при некорректном формате опций. (Большинство таких
ошибок внутри LIKE перехватываются и приводят к возврату false).</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Метод используется как резервный вариант поиска, когда полнотекстовый поиск (FTS) не может быть выполнен.
Для каждого столбца поиска создается отдельное условие <code class="prettyprint">LIKE</code> с уникальным плейсхолдером.
Использует приватный метод <code class="prettyprint">_fts_check_options()</code> для объединения условий <code class="prettyprint">LIKE</code> с любыми
дополнительными опциями, предоставленными пользователем.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Убедитесь, что входные параметры <code class="prettyprint">$columns_to_return_escaped</code>, <code class="prettyprint">$columns_to_search_escaped</code> и
<code class="prettyprint">$table_escaped</code> уже экранированы для MySQL.
Поиск с <code class="prettyprint">LIKE</code> может быть неэффективен на больших объемах данных и может вызвать высокую нагрузку на
базу данных.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__fts_check_options"><abbr title="\PhotoRigma\Classes\Database::_fts_check_options()">Database::_fts_check_options()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Приватный метод, используемый для объединения опций.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__select_internal"><abbr title="\PhotoRigma\Classes\Database::_select_internal()">Database::_select_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Приватный метод для выполнения SELECT-запроса.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__result_array_internal"><abbr title="\PhotoRigma\Classes\Database::_result_array_internal()">Database::_result_array_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Приватный метод для получения всех строк
результата запроса.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="namespaces/photorigma-include.html#function_log_in_file"><abbr title="\PhotoRigma\Include\log_in_file()">log_in_file()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Записывает сообщение об ошибке в лог-файл.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__full_text_search_mysql"><abbr title="\PhotoRigma\Classes\Database::_full_text_search_mysql()">Database::_full_text_search_mysql()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Приватный метод, реализующий поиск по LIKE в
качестве fallback.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">array&lt;string|int, mixed&gt;|false</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Результат выполнения поиска в виде массива ассоциативных массивов (строк) при успехе и
наличии результатов, пустой массив при успехе, но отсутствии результатов, или <code class="prettyprint">false</code> в
случае пустой строки поиска или ошибки выполнения запроса.</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -private
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method__fallback_to_like_sqlite">
        _fallback_to_like_sqlite()
        <a href="classes/PhotoRigma-Classes-Database.html#method__fallback_to_like_sqlite" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/Database.php"><a href="files/src-classes-database.html"><abbr title="src/Classes/Database.php">Database.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">4478</span>

    </aside>

        <p class="phpdocumentor-summary">Выполняет альтернативный LIKE-поиск для SQLite.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">private</span>
                    <span class="phpdocumentor-signature__name">_fallback_to_like_sqlite</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$columns_to_return_escaped</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$columns_to_search_escaped</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$search_string</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$table_escaped</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$options</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">array&lt;string|int, mixed&gt;|false</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот приватный метод реализует поиск данных в SQLite, используя оператор <code class="prettyprint">LIKE</code> по нескольким столбцам. Он
используется как резервный механизм (fallback), когда основной полнотекстовый поиск (FTS5) недоступен,
отключен, или не дал результатов (например, из-за минимальной длины строки поиска или отсутствия виртуальной
FTS5 таблицы).
Метод выполняет следующие действия:</p>
<ol>
<li>Проверяет, является ли строка поиска <code class="prettyprint">$search_string</code> пустой. Если да, возвращает <code class="prettyprint">false</code> без выполнения
запроса.</li>
<li>Формирует условия <code class="prettyprint">WHERE</code> для оператора <code class="prettyprint">LIKE</code> по каждому столбцу из массива <code class="prettyprint">$columns_to_search_escaped</code>.
Каждое условие имеет вид <code class="prettyprint">&quot;имя_столбца&quot; LIKE :плейсхолдер</code>. Для строки поиска автоматически добавляются
символы <code class="prettyprint">%</code> в начале и конце (для поиска подстроки). Каждое условие использует уникальный именованный
плейсхолдер (например, <code class="prettyprint">:search_string_0</code>, <code class="prettyprint">:search_string_1</code>) для безопасной привязки параметров.</li>
<li>Объединяет сформированные условия <code class="prettyprint">LIKE</code> оператором <code class="prettyprint">OR</code> для создания общей строки условия <code class="prettyprint">WHERE</code>.</li>
<li>Формирует базовые опции (<code class="prettyprint">$base_options</code>) для поиска по <code class="prettyprint">LIKE</code>, включающие сформированное условие <code class="prettyprint">WHERE</code> и
массив параметров для плейсхолдеров <code class="prettyprint">LIKE</code>.</li>
<li>Объединяет переданные внешние опции запроса (<code class="prettyprint">$options</code>) с базовыми опциями <code class="prettyprint">LIKE</code> (<code class="prettyprint">$base_options</code>) с
помощью приватного метода <code class="prettyprint">_fts_check_options()</code>. Этот метод разрешает конфликты плейсхолдеров и определяет
приоритеты для WHERE, ORDER BY, GROUP BY, LIMIT и PARAMS.</li>
<li>Предпринимает попытку выполнить SQL-запрос SELECT с использованием экранированных столбцов для возврата,
экранированного имени таблицы и объединенных опций (<code class="prettyprint">$new_options</code>) в блоке <code class="prettyprint">try...catch</code>, вызывая
приватный метод <code class="prettyprint">_select_internal()</code>.</li>
<li>В случае возникновения исключения (<code class="prettyprint">Throwable</code>) во время выполнения LIKE-запроса (блок <code class="prettyprint">catch</code>):
<ul>
<li>Логирует информацию об ошибке с помощью функции <code class="prettyprint">log_in_file()</code>, включая текст запроса и сообщение об
ошибке.</li>
<li>Возвращает <code class="prettyprint">false</code>, сигнализируя об ошибке выполнения поиска.</li>
</ul>
</li>
<li>В случае успешного выполнения запроса (блок <code class="prettyprint">try</code> без исключений) получает результат запроса в виде массива
с помощью приватного метода <code class="prettyprint">_result_array_internal()</code> и возвращает его.
Этот метод является приватным и предназначен только для использования внутри класса <code class="prettyprint">Database</code>. Он вызывается
из приватного метода <code class="prettyprint">_full_text_search_sqlite()</code>.</li>
</ol>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$columns_to_return_escaped</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Массив строк с именами столбцов, которые нужно вернуть. Имена
столбцов должны быть уже экранированы для SQLite (например, <code class="prettyprint">&quot;id&quot;</code>
или <code class="prettyprint">[id]</code>).</p>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$columns_to_search_escaped</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Массив строк с именами столбцов, по которым выполняется поиск по LIKE.
Имена столбцов должны быть уже экранированы для SQLite.</p>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$search_string</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Строка поиска, введенная пользователем. Для поиска по LIKE
автоматически будут добавлены символы <code class="prettyprint">%</code>. Пустая строка приводит к
возврату <code class="prettyprint">false</code>.</p>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$table_escaped</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Строка с именем таблицы, в которой выполняется поиск. Имя таблицы
должно быть уже экранировано для SQLite (например, <code class="prettyprint">&quot;users&quot;</code> или
<code class="prettyprint">[users]</code>).</p>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$options</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Массив дополнительных опций для формирования запроса. Используется
для добавления условий WHERE, GROUP BY, ORDER BY, LIMIT и параметров
к LIKE-запросу.
Поддерживаемые ключи:</p>
<ul>
<li>where (string|array|false): Дополнительное условие WHERE
(объединяется с условиями LIKE оператором AND).</li>
<li>group (string|false): Группировка GROUP BY.</li>
<li>order (string|false): Сортировка ORDER BY.</li>
<li>limit (int|string|false): Ограничение LIMIT.</li>
<li>params (array): Ассоциативный массив дополнительных параметров для
подготовленного выражения.</li>
</ul>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-Database.html#method__fallback_to_like_sqlite#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">internal</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                             
                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\Exception">Exception</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Может быть выброшено функцией логирования <code class="prettyprint">log_in_file()</code> в случае
невозможности записи в файл.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\PDOException">PDOException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Может быть выброшено методами <code class="prettyprint">_fts_check_options()</code> (через вызов
<code class="prettyprint">_build_conditions()</code>) или <code class="prettyprint">_select_internal()</code> в случае ошибок, связанных с
базой данных или некорректным SQL, если они не перехватываются в блоке
<code class="prettyprint">try...catch</code> или выбрасываются после него. (Большинство таких ошибок внутри
LIKE перехватываются и приводят к возврату false).</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\InvalidArgumentException">InvalidArgumentException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Может быть выброшено методом <code class="prettyprint">_fts_check_options()</code> (через вызов
<code class="prettyprint">_build_conditions()</code>) при некорректном формате опций. (Большинство таких
ошибок внутри LIKE перехватываются и приводят к возврату false).</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Метод используется как резервный вариант поиска для SQLite, когда полнотекстовый поиск (FTS5) не
может быть выполнен. Для каждого столбца поиска создается отдельное условие <code class="prettyprint">LIKE</code> с уникальным
плейсхолдером. Использует приватный метод <code class="prettyprint">_fts_check_options()</code> для объединения условий <code class="prettyprint">LIKE</code> с
любыми дополнительными опциями, предоставленными пользователем.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Убедитесь, что входные параметры <code class="prettyprint">$columns_to_return_escaped</code>, <code class="prettyprint">$columns_to_search_escaped</code> и
<code class="prettyprint">$table_escaped</code> уже экранированы для SQLite.
Поиск с <code class="prettyprint">LIKE</code> может быть неэффективен на больших объемах данных по сравнению с FTS5.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__fts_check_options"><abbr title="\PhotoRigma\Classes\Database::_fts_check_options()">Database::_fts_check_options()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Приватный метод, используемый для объединения опций.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__select_internal"><abbr title="\PhotoRigma\Classes\Database::_select_internal()">Database::_select_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Приватный метод для выполнения SELECT-запроса.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__result_array_internal"><abbr title="\PhotoRigma\Classes\Database::_result_array_internal()">Database::_result_array_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Приватный метод для получения всех строк
результата запроса.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="namespaces/photorigma-include.html#function_log_in_file"><abbr title="\PhotoRigma\Include\log_in_file()">log_in_file()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Записывает сообщение об ошибке в лог-файл.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__full_text_search_sqlite"><abbr title="\PhotoRigma\Classes\Database::_full_text_search_sqlite()">Database::_full_text_search_sqlite()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Приватный метод, реализующий поиск по LIKE в
качестве fallback.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">array&lt;string|int, mixed&gt;|false</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Результат выполнения поиска в виде массива ассоциативных массивов (строк) при успехе и
наличии результатов, пустой массив при успехе, но отсутствии результатов, или <code class="prettyprint">false</code> в
случае пустой строки поиска или ошибки выполнения запроса.</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -private
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method__fts_check_options">
        _fts_check_options()
        <a href="classes/PhotoRigma-Classes-Database.html#method__fts_check_options" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/Database.php"><a href="files/src-classes-database.html"><abbr title="src/Classes/Database.php">Database.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">4602</span>

    </aside>

        <p class="phpdocumentor-summary">Формирует финальный массив опций для запроса с учетом базовых FTS-опций и внешних условий/дополнений.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">private</span>
                    <span class="phpdocumentor-signature__name">_fts_check_options</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$options</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$base_options</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">array&lt;string|int, mixed&gt;</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот приватный метод объединяет массив внешних опций (<code class="prettyprint">$options</code>) с базовыми опциями полнотекстового поиска
(FTS) (<code class="prettyprint">$base_options</code>), обрабатывая конфликты плейсхолдеров и применяя правила приоритета для формирования
результирующего набора опций запроса.
Метод выполняет следующие действия:</p>
<ol>
<li>Выполняет тримминг всех строковых значений во внешних (<code class="prettyprint">$options</code>) и базовых (<code class="prettyprint">$base_options</code>) массивах опций.</li>
<li>Обрабатывает конфликты именованных плейсхолдеров между <code class="prettyprint">$options['params']</code> и <code class="prettyprint">$base_options['params']</code>.
При обнаружении совпадающих ключей плейсхолдеров, плейсхолдеры во внешних опциях (<code class="prettyprint">$options</code>)
переименовываются путем добавления суффикса <code class="prettyprint">_ext_[n]</code> (где <code class="prettyprint">[n]</code> - инкрементирующийся счетчик).
Соответствующие ключи в массиве <code class="prettyprint">$options['params']</code> обновляются, и старые ключи удаляются.</li>
<li>Обновляет использование переименованных плейсхолдеров в условиях <code class="prettyprint">WHERE</code> внешних опций
(<code class="prettyprint">$options['where']</code>), если <code class="prettyprint">where</code> является массивом.</li>
<li>Обрабатывает внешнее условие <code class="prettyprint">WHERE</code> из <code class="prettyprint">$options['where']</code>, вызывая приватный метод <code class="prettyprint">_build_conditions()</code>
для его преобразования в SQL-строку и получения соответствующих параметров. Начальный <code class="prettyprint">WHERE</code> из строки
условий, возвращенной <code class="prettyprint">_build_conditions()</code>, удаляется. Если после обработки внешнее условие непустое, оно
сохраняется для последующего объединения.</li>
<li>Формирует финальный массив опций (<code class="prettyprint">$new_options</code>) на основе объединенных данных с учетом следующих правил
приоритета:
<ul>
<li><strong>WHERE:</strong> Если присутствуют и базовое FTS-условие (<code class="prettyprint">$base_options['where']</code>) и обработанное внешнее
условие (<code class="prettyprint">$options['where']</code>), они объединяются с помощью <code class="prettyprint">AND</code> (базовое условие идет первым). Если
присутствует только одно из них, используется это условие.</li>
<li><strong>ORDER BY:</strong> Если присутствует сортировка в базовых FTS-опциях (<code class="prettyprint">$base_options['order']</code>), она имеет
приоритет и используется. В противном случае, если присутствует сортировка во внешних опциях
(<code class="prettyprint">$options['order']</code>), используется она.</li>
<li><strong>GROUP BY:</strong> Используется только значение из внешних опций (<code class="prettyprint">$options['group']</code>), если оно задано и не
равно <code class="prettyprint">false</code>.</li>
<li><strong>LIMIT:</strong> Используется только значение из внешних опций (<code class="prettyprint">$options['limit']</code>), если оно задано и не
равно <code class="prettyprint">false</code>.</li>
<li><strong>params:</strong> Параметры из <code class="prettyprint">$options['params']</code> (уже с переименованными плейсхолдерами) и
<code class="prettyprint">$base_options['params']</code> объединяются с помощью <code class="prettyprint">array_merge()</code>. Параметры из <code class="prettyprint">$base_options['params']</code>
имеют приоритет при совпадении ключей (что не должно происходить после обработки конфликтов, но
<code class="prettyprint">array_merge</code> работает так).</li>
</ul>
</li>
<li>Возвращает финальный массив объединенных опций <code class="prettyprint">$new_options</code>.</li>
</ol>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$options</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Массив внешних опций запроса, предоставленных пользователем. Поддерживаемые ключи:</p>
<ul>
<li>where (string|array|false): Условие WHERE.
Может быть:
<ul>
<li>Строкой (используется как есть)</li>
<li>Массивом:
<ul>
<li>Простые условия: <code class="prettyprint">['поле' =&gt; значение]</code> (обрабатывается <code class="prettyprint">_build_conditions</code>,
генерируются плейсхолдеры)</li>
<li>Сложные условия: <code class="prettyprint">['OR' =&gt; [условия], 'NOT' =&gt; [условия]]</code> (обрабатывается
<code class="prettyprint">_build_conditions</code>)</li>
</ul>
</li>
<li><code class="prettyprint">false</code>: Игнорируется.</li>
</ul>
</li>
<li>group (string|false): Группировка GROUP BY. Должна быть строкой. Игнорируется,
если равно <code class="prettyprint">false</code>.</li>
<li>order (string|false): Сортировка ORDER BY. Должна быть строкой. Игнорируется,
если равно <code class="prettyprint">false</code>.</li>
<li>limit (int|string|false): Ограничение LIMIT. Должно быть целым числом или строкой
формата <code class="prettyprint">'OFFSET, COUNT'</code>. Игнорируется, если равно <code class="prettyprint">false</code>.</li>
<li>params (array): Исходный ассоциативный массив параметров для подготовленного
выражения ([&quot;:имя&quot; =&gt; значение]).</li>
</ul>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$base_options</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Массив базовых опций FTS (Full-Text Search), сгенерированных внутренней логикой FTS.
Поддерживаемые ключи:</p>
<ul>
<li>where (string): Строковое условие WHERE для полнотекстового поиска (например,
<code class="prettyprint">MATCH(...) AGAINST (...)</code>).</li>
<li>order (string): Строка сортировки по релевантности FTS.</li>
<li>params (array): Ассоциативный массив параметров для FTS-условий.</li>
</ul>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-Database.html#method__fts_check_options#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">internal</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                             
                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\InvalidArgumentException">InvalidArgumentException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Может быть выброшено методом <code class="prettyprint">_build_conditions()</code> при обработке
<code class="prettyprint">$options['where']</code>, если его формат недопустим.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__build_conditions"><abbr title="\PhotoRigma\Classes\Database::_build_conditions()">Database::_build_conditions()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Приватный метод, используемый для обработки внешней
части условия WHERE.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__full_text_search_internal"><abbr title="\PhotoRigma\Classes\Database::_full_text_search_internal()">Database::_full_text_search_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Используется для фильтрации опций при
<code class="prettyprint">$search_string = '*'</code>.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__full_text_search_mysql"><abbr title="\PhotoRigma\Classes\Database::_full_text_search_mysql()">Database::_full_text_search_mysql()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Приватный метод, объединяющий и обрабатывающий опции
запроса для FTS.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__fallback_to_like_mysql"><abbr title="\PhotoRigma\Classes\Database::_fallback_to_like_mysql()">Database::_fallback_to_like_mysql()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Приватный метод, используемый для объединения опций.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__full_text_search_pgsql"><abbr title="\PhotoRigma\Classes\Database::_full_text_search_pgsql()">Database::_full_text_search_pgsql()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Приватный метод, объединяющий и обрабатывающий опции
запроса для FTS.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__fallback_to_ilike_pgsql"><abbr title="\PhotoRigma\Classes\Database::_fallback_to_ilike_pgsql()">Database::_fallback_to_ilike_pgsql()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Приватный метод, используемый для объединения опций.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__full_text_search_sqlite"><abbr title="\PhotoRigma\Classes\Database::_full_text_search_sqlite()">Database::_full_text_search_sqlite()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Приватный метод, объединяющий и обрабатывающий опции
запроса для FTS.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__fallback_to_like_sqlite"><abbr title="\PhotoRigma\Classes\Database::_fallback_to_like_sqlite()">Database::_fallback_to_like_sqlite()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Приватный метод, используемый для объединения опций.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">array&lt;string|int, mixed&gt;</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Результирующий массив опций для запроса, содержащий объединенные и обработанные условия и
параметры. Ключи могут включать:</p>
<ul>
<li>where (string|null): Объединенные условия WHERE, или <code class="prettyprint">null</code> если условия отсутствуют.</li>
<li>order (string|null): Итоговая строка сортировки, или <code class="prettyprint">null</code> если сортировка не задана.</li>
<li>group (string|null): Строка GROUP BY из внешних опций, или <code class="prettyprint">null</code> если не задана.</li>
<li>limit (int|string|null): Значение LIMIT из внешних опций, или <code class="prettyprint">null</code> если не задано.</li>
<li>params (array): Объединенный ассоциативный массив параметров, включая параметры FTS и
параметры внешних условий (с разрешенными конфликтами именования).</li>
</ul>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -private
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method__full_text_search_mysql">
        _full_text_search_mysql()
        <a href="classes/PhotoRigma-Classes-Database.html#method__full_text_search_mysql" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/Database.php"><a href="files/src-classes-database.html"><abbr title="src/Classes/Database.php">Database.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">3619</span>

    </aside>

        <p class="phpdocumentor-summary">Выполняет полнотекстовый поиск в MySQL с обработкой минимальной длины строки, кешированием ошибок и fallback
на LIKE.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">private</span>
                    <span class="phpdocumentor-signature__name">_full_text_search_mysql</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$columns_to_return</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$columns_to_search</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$search_string</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$table</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$db_version</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$options</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">array&lt;string|int, mixed&gt;|false</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот приватный метод реализует логику полнотекстового поиска (Full-Text Search - FTS) для базы данных MySQL.
Он обрабатывает минимальную длину строки поиска, использует кеширование для быстрого определения предыдущих
ошибок выполнения FTS-запросов (например, из-за отсутствия FTS-индекса) и включает механизм автоматического
перехода (fallback) на поиск с использованием оператора <code class="prettyprint">LIKE</code> в случае необходимости.
Метод выполняет следующие действия:</p>
<ol>
<li>Экранирует имена столбцов для возврата (<code class="prettyprint">$columns_to_return</code>), столбцов для поиска (<code class="prettyprint">$columns_to_search</code>) и
имя таблицы (<code class="prettyprint">$table</code>) с использованием обратных кавычек (<code class="prettyprint">`</code>) для соответствия синтаксису MySQL.</li>
<li>Проверяет, что длина строки поиска <code class="prettyprint">$search_string</code> превышает минимально допустимое значение, определенное
константой <code class="prettyprint">MIN_FULLTEXT_SEARCH_LENGTH</code>. Если длина недостаточна, метод сразу же вызывает приватный метод
<code class="prettyprint">_fallback_to_like_mysql()</code> для выполнения поиска с использованием <code class="prettyprint">LIKE</code> и возвращает его результат.</li>
<li>Формирует уникальный ключ кеша на основе имени таблицы и столбцов для поиска для идентификации FTS-индекса
в кеше.</li>
<li>Проверяет кеш (<code class="prettyprint">$this-&gt;cache</code>) на наличие записи, связанной с этим FTS-индексом, используя <code class="prettyprint">$db_version</code>
как параметр валидности кеша. Если в кеше найдена запись с флагом <code class="prettyprint">query_error = true</code>, это означает, что
предыдущая попытка выполнить FTS-запрос для этого индекса завершилась ошибкой. В этом случае метод также
вызывает <code class="prettyprint">_fallback_to_like_mysql()</code> и возвращает его результат.</li>
<li>Предпринимает попытку выполнить полнотекстовый поиск в блоке <code class="prettyprint">try...catch</code>:
<ul>
<li>Формирует базовые опции FTS (<code class="prettyprint">$base_options</code>), включающие условие <code class="prettyprint">WHERE MATCH(...) AGAINST(...) IN NATURAL LANGUAGE MODE</code> и сортировку <code class="prettyprint">ORDER BY MATCH(...) AGAINST(...) DESC</code>, используя переданную строку
поиска <code class="prettyprint">$search_string</code> как параметр.</li>
<li>Объединяет переданные внешние опции запроса (<code class="prettyprint">$options</code>) с базовыми FTS-опциями (<code class="prettyprint">$base_options</code>) с
помощью приватного метода <code class="prettyprint">_fts_check_options()</code>. Этот метод разрешает конфликты плейсхолдеров и
определяет приоритеты для WHERE, ORDER BY, GROUP BY, LIMIT и PARAMS.</li>
<li>Вызывает приватный метод <code class="prettyprint">_select_internal()</code> с экранированными столбцами, экранированным именем таблицы
и объединенными опциями для выполнения SQL-запроса.</li>
</ul>
</li>
<li>В случае успешного выполнения FTS-запроса (блок <code class="prettyprint">try</code> без исключений):
<ul>
<li>Обновляет кеш (<code class="prettyprint">$this-&gt;cache</code>), устанавливая флаг <code class="prettyprint">query_error = false</code> для данного FTS-индекса, указывая
на успешность последнего запроса.</li>
<li>Получает результат запроса в виде массива с помощью приватного метода <code class="prettyprint">_result_array_internal()</code> и
возвращает его.</li>
</ul>
</li>
<li>В случае возникновения исключения (<code class="prettyprint">Throwable</code>) во время выполнения FTS-запроса (блок <code class="prettyprint">catch</code>):
<ul>
<li>Логирует информацию об ошибке с помощью функции <code class="prettyprint">log_in_file()</code>, включая сообщение об ошибке.</li>
<li>Обновляет кеш (<code class="prettyprint">$this-&gt;cache</code>), устанавливая флаг <code class="prettyprint">query_error = true</code> для данного FTS-индекса, чтобы
избежать повторных ошибок в будущем.</li>
<li>Вызывает приватный метод <code class="prettyprint">_fallback_to_like_mysql()</code> для выполнения поиска с использованием <code class="prettyprint">LIKE</code> и
возвращает его результат.
Этот метод является приватным и предназначен только для использования внутри класса <code class="prettyprint">Database</code>. Он вызывается
из публичных или защищенных методов поиска, когда определен тип базы данных MySQL.</li>
</ul>
</li>
</ol>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$columns_to_return</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Массив строк с именами столбцов, которые нужно вернуть в результате поиска.</p>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$columns_to_search</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Массив строк с именами столбцов, по которым выполняется полнотекстовый поиск.</p>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$search_string</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Строка поиска, введенная пользователем (должна быть без спецсимволов LIKE, но
может содержать операторы FTS, если включен соответствующий режим).
Проверяется на минимальную длину.</p>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$table</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Строка с именем таблицы, в которой выполняется поиск.</p>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$db_version</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Строка, представляющая версию структуры базы данных (например, из специальной
таблицы), используется для валидации кеша.</p>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$options</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Массив дополнительных опций для формирования запроса. Используется для
добавления условий WHERE, GROUP BY, ORDER BY, LIMIT и параметров к FTS-запросу.
Поддерживаемые ключи:</p>
<ul>
<li>where (string|array|false): Дополнительное условие WHERE.</li>
<li>group (string|false): Группировка GROUP BY.</li>
<li>order (string|false): Дополнительная сортировка ORDER BY (имеет более
низкий приоритет, чем сортировка FTS).</li>
<li>limit (int|string|false): Ограничение LIMIT.</li>
<li>params (array): Ассоциативный массив дополнительных параметров для
подготовленного выражения.</li>
</ul>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-Database.html#method__full_text_search_mysql#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">internal</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                             
                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\JsonException">JsonException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Может быть выброшено методами кеширования (<code class="prettyprint">$this-&gt;cache-&gt;is_valid</code>,
<code class="prettyprint">$this-&gt;cache-&gt;update_cache</code>) при ошибках сериализации/десериализации данных
кеша.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\Exception">Exception</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Может быть выброшено функцией логирования <code class="prettyprint">log_in_file()</code> в случае
невозможности записи в файл.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\PDOException">PDOException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Может быть выброшено методами <code class="prettyprint">_fts_check_options()</code> (через вызов
<code class="prettyprint">_build_conditions()</code>) или <code class="prettyprint">_select_internal()</code> в случае ошибок, связанных с
базой данных или некорректным SQL, если они не перехватываются в блоке
<code class="prettyprint">try...catch</code> или выбрасываются после него. (Большинство таких ошибок внутри
FTS перехватываются и приводят к fallback).</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\InvalidArgumentException">InvalidArgumentException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Может быть выброшено методом <code class="prettyprint">_fts_check_options()</code> (через вызов
<code class="prettyprint">_build_conditions()</code>) при некорректном формате опций. (Большинство таких
ошибок внутри FTS перехватываются и приводят к fallback).</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Метод использует константу <code class="prettyprint">MIN_FULLTEXT_SEARCH_LENGTH</code> для проверки минимальной длины строки поиска.
Активно используется кеширование (<code class="prettyprint">$this-&gt;cache</code>, <code class="prettyprint">$this-&gt;format_cache</code> неявно через
<code class="prettyprint">_select_internal</code>) для оптимизации и запоминания FTS-индексов, вызывающих ошибки.
При возникновении ошибок выполнения FTS-запроса (например, отсутствие FTS-индекса), метод
автоматически переключается на более медленный поиск с помощью оператора <code class="prettyprint">LIKE</code>, вызывая
<code class="prettyprint">_fallback_to_like_mysql()</code>.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Убедитесь, что в таблице, указанной в <code class="prettyprint">$table</code>, существуют столбцы из <code class="prettyprint">$columns_to_search</code>,
и по ним создан действующий полнотекстовый индекс (<code class="prettyprint">FULLTEXT</code>). Отсутствие индекса приведет к ошибке
выполнения FTS-запроса и переключению на <code class="prettyprint">LIKE</code>.
Поиск с <code class="prettyprint">LIKE</code> может быть значительно медленнее полнотекстового поиска на больших объемах данных.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__fallback_to_like_mysql"><abbr title="\PhotoRigma\Classes\Database::_fallback_to_like_mysql()">Database::_fallback_to_like_mysql()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Приватный метод, реализующий поиск по LIKE в
качестве fallback.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__fts_check_options"><abbr title="\PhotoRigma\Classes\Database::_fts_check_options()">Database::_fts_check_options()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Приватный метод, объединяющий и обрабатывающий опции
запроса для FTS.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__select_internal"><abbr title="\PhotoRigma\Classes\Database::_select_internal()">Database::_select_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Приватный метод для выполнения SELECT-запроса.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__result_array_internal"><abbr title="\PhotoRigma\Classes\Database::_result_array_internal()">Database::_result_array_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Приватный метод для получения всех строк
результата запроса.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="namespaces/photorigma-include.html#function_log_in_file"><abbr title="\PhotoRigma\Include\log_in_file()">log_in_file()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Записывает сообщение об ошибке в лог-файл.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Interfaces-Cache-Handler-Interface.html"><abbr title="\PhotoRigma\Interfaces\Cache_Handler_Interface">Cache_Handler_Interface</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Интерфейс, используемый для работы с кешированием.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#property_cache"><abbr title="\PhotoRigma\Classes\Database::$cache">Database::$cache</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, хранящее объект, реализующий <code class="prettyprint">Cache_Handler_Interface</code>.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#property_format_cache"><abbr title="\PhotoRigma\Classes\Database::$format_cache">Database::$format_cache</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Внутреннее свойство, используемое для кэширования форматов
(используется косвенно через _select_internal).</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#property_unescape_cache"><abbr title="\PhotoRigma\Classes\Database::$unescape_cache">Database::$unescape_cache</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Внутреннее свойство, используемое для кэширования снятия
экранирования (используется косвенно через _select_internal).</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#property_current_format"><abbr title="\PhotoRigma\Classes\Database::$current_format">Database::$current_format</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, хранящее текущий формат SQL.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#property_db_type"><abbr title="\PhotoRigma\Classes\Database::$db_type">Database::$db_type</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, хранящее тип текущей СУБД.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__full_text_search_internal"><abbr title="\PhotoRigma\Classes\Database::_full_text_search_internal()">Database::_full_text_search_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Специфический метод для полнотекстового поиска в
MySQL.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">array&lt;string|int, mixed&gt;|false</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Результат выполнения поиска в виде массива ассоциативных массивов (строк) при успехе и
наличии результатов, пустой массив при успехе, но отсутствии результатов, или <code class="prettyprint">false</code> в
случае критической ошибки (хотя большинство ошибок обрабатывается через исключения или
fallback).</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -private
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method__full_text_search_pgsql">
        _full_text_search_pgsql()
        <a href="classes/PhotoRigma-Classes-Database.html#method__full_text_search_pgsql" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/Database.php"><a href="files/src-classes-database.html"><abbr title="src/Classes/Database.php">Database.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">3950</span>

    </aside>

        <p class="phpdocumentor-summary">Выполняет полнотекстовый поиск в PostgreSQL с обработкой минимальной длины строки, кешированием ошибок и
fallback на ILIKE.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">private</span>
                    <span class="phpdocumentor-signature__name">_full_text_search_pgsql</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$columns_to_return</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$columns_to_search</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$search_string</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$table</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$db_version</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$options</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">array&lt;string|int, mixed&gt;|false</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот приватный метод реализует логику полнотекстового поиска (Full-Text Search - FTS) для базы данных
PostgreSQL. Он обрабатывает минимальную длину строки поиска, использует кеширование для быстрого определения
предыдущих ошибок выполнения FTS-запросов и включает механизм автоматического перехода (fallback) на поиск с
использованием оператора <code class="prettyprint">ILIKE</code> (регистронезависимый LIKE) в случае необходимости.
Метод выполняет следующие действия:</p>
<ol>
<li>Экранирует имена столбцов для возврата (<code class="prettyprint">$columns_to_return</code>), столбцов для поиска (<code class="prettyprint">$columns_to_search</code>) и
имя таблицы (<code class="prettyprint">$table</code>) с использованием двойных кавычек (<code class="prettyprint">&quot;</code>) для соответствия синтаксису PostgreSQL.</li>
<li>Проверяет, что длина строки поиска <code class="prettyprint">$search_string</code> превышает минимально допустимое значение, определенное
константой <code class="prettyprint">MIN_FULLTEXT_SEARCH_LENGTH</code>. Если длина недостаточна, метод сразу же вызывает приватный метод
<code class="prettyprint">_fallback_to_ilike_pgsql()</code> для выполнения поиска с использованием <code class="prettyprint">ILIKE</code> и возвращает его результат.</li>
<li>Формирует уникальный ключ кеша на основе имени таблицы и столбцов для поиска для идентификации FTS-индекса
в кеше.</li>
<li>Проверяет кеш (<code class="prettyprint">$this-&gt;cache</code>) на наличие записи, связанной с этим FTS-индексом, используя <code class="prettyprint">$db_version</code>
как параметр валидности кеша. Если в кеше найдена запись с флагом <code class="prettyprint">query_error = true</code>, это означает, что
предыдущая попытка выполнить FTS-запрос для этого индекса завершилась ошибкой. В этом случае метод также
вызывает <code class="prettyprint">_fallback_to_ilike_pgsql()</code> и возвращает его результат.</li>
<li>Предпринимает попытку выполнить полнотекстовый поиск в блоке <code class="prettyprint">try...catch</code>:
<ul>
<li>Формирует базовые опции FTS (<code class="prettyprint">$base_options</code>), включающие условие <code class="prettyprint">WHERE tsv_weighted @@ plainto_tsquery (:search_string_where)</code> и сортировку <code class="prettyprint">ORDER BY ts_rank(tsv_weighted, plainto_tsquery (:search_string_order)) DESC</code>, используя переданную строку поиска <code class="prettyprint">$search_string</code> как параметр.
Предполагается наличие столбца <code class="prettyprint">tsv_weighted</code> типа <code class="prettyprint">TSVECTOR</code> в таблице, содержащего лексемы для поиска.</li>
<li>Объединяет переданные внешние опции запроса (<code class="prettyprint">$options</code>) с базовыми FTS-опциями (<code class="prettyprint">$base_options</code>) с
помощью приватного метода <code class="prettyprint">_fts_check_options()</code>. Этот метод разрешает конфликты плейсхолдеров и
определяет приоритеты для WHERE, ORDER BY, GROUP BY, LIMIT и PARAMS.</li>
<li>Вызывает приватный метод <code class="prettyprint">_select_internal()</code> с экранированными столбцами, экранированным именем таблицы
и объединенными опциями для выполнения SQL-запроса.</li>
</ul>
</li>
<li>В случае успешного выполнения FTS-запроса (блок <code class="prettyprint">try</code> без исключений):
<ul>
<li>Обновляет кеш (<code class="prettyprint">$this-&gt;cache</code>), устанавливая флаг <code class="prettyprint">query_error = false</code> для данного FTS-индекса, указывая
на успешность последнего запроса.</li>
<li>Получает результат запроса в виде массива с помощью приватного метода <code class="prettyprint">_result_array_internal()</code> и
возвращает его.</li>
</ul>
</li>
<li>В случае возникновения исключения (<code class="prettyprint">Throwable</code>) во время выполнения FTS-запроса (блок <code class="prettyprint">catch</code>):
<ul>
<li>Логирует информацию об ошибке с помощью функции <code class="prettyprint">log_in_file()</code>, включая текст запроса и сообщение об
ошибке.</li>
<li>Обновляет кеш (<code class="prettyprint">$this-&gt;cache</code>), устанавливая флаг <code class="prettyprint">query_error = true</code> для данного FTS-индекса, чтобы
избежать повторных ошибок в будущем.</li>
<li>Вызывает приватный метод <code class="prettyprint">_fallback_to_ilike_pgsql()</code> для выполнения поиска с использованием <code class="prettyprint">ILIKE</code> и
возвращает его результат.
Этот метод является приватным и предназначен только для использования внутри класса <code class="prettyprint">Database</code>. Он вызывается
из публичных или защищенных методов поиска, когда определен тип базы данных PostgreSQL.</li>
</ul>
</li>
</ol>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$columns_to_return</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Массив строк с именами столбцов, которые нужно вернуть в результате поиска.</p>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$columns_to_search</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Массив строк с именами столбцов, по которым выполняется полнотекстовый поиск.</p>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$search_string</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Строка поиска, введенная пользователем (должна быть без спецсимволов LIKE, но
может содержать операторы FTS, если включен соответствующий режим).
Проверяется на минимальную длину.</p>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$table</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Строка с именем таблицы, в которой выполняется поиск.</p>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$db_version</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Строка, представляющая версию структуры базы данных (например, из специальной
таблицы), используется для валидации кеша.</p>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$options</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Массив дополнительных опций для формирования запроса. Используется для
добавления условий WHERE, GROUP BY, ORDER BY, LIMIT и параметров к FTS-запросу.
Поддерживаемые ключи:</p>
<ul>
<li>where (string|array|false): Дополнительное условие WHERE.</li>
<li>group (string|false): Группировка GROUP BY.</li>
<li>order (string|false): Дополнительная сортировка ORDER BY (имеет более
низкий приоритет, чем сортировка FTS).</li>
<li>limit (int|string|false): Ограничение LIMIT.</li>
<li>params (array): Ассоциативный массив дополнительных параметров для
подготовленного выражения.</li>
</ul>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-Database.html#method__full_text_search_pgsql#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">internal</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                             
                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\JsonException">JsonException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Может быть выброшено методами кеширования (<code class="prettyprint">$this-&gt;cache-&gt;is_valid</code>,
<code class="prettyprint">$this-&gt;cache-&gt;update_cache</code>) при ошибках сериализации/десериализации данных
кеша.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\Exception">Exception</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Может быть выброшено функцией логирования <code class="prettyprint">log_in_file()</code> в случае
невозможности записи в файл.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\PDOException">PDOException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Может быть выброшено методами <code class="prettyprint">_fts_check_options()</code> (через вызов
<code class="prettyprint">_build_conditions()</code>) или <code class="prettyprint">_select_internal()</code> в случае ошибок, связанных с
базой данных или некорректным SQL, если они не перехватываются в блоке
<code class="prettyprint">try...catch</code> или выбрасываются после него. (Большинство таких ошибок внутри
FTS перехватываются и приводят к fallback).</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\InvalidArgumentException">InvalidArgumentException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Может быть выброшено методом <code class="prettyprint">_fts_check_options()</code> (через вызов
<code class="prettyprint">_build_conditions()</code>) при некорректном формате опций. (Большинство таких
ошибок внутри FTS перехватываются и приводят к fallback).</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Метод использует константу <code class="prettyprint">MIN_FULLTEXT_SEARCH_LENGTH</code> для проверки минимальной длины строки поиска.
Активно используется кеширование (<code class="prettyprint">$this-&gt;cache</code>) для оптимизации и запоминания FTS-индексов,
вызывающих ошибки.
При возникновении ошибок выполнения FTS-запроса (например, из-за проблем с FTS конфигурацией или
отсутствия колонки tsv_weighted), метод автоматически переключается на поиск с помощью оператора
<code class="prettyprint">ILIKE</code>, вызывая <code class="prettyprint">_fallback_to_ilike_pgsql()</code>.
Для работы FTS в PostgreSQL требуется колонка типа TSVECTOR (например, <code class="prettyprint">tsv_weighted</code>) и
соответствующая конфигурация.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Убедитесь, что в таблице, указанной в <code class="prettyprint">$table</code>, существуют столбцы из <code class="prettyprint">$columns_to_search</code>,
а также колонка типа TSVECTOR (например, <code class="prettyprint">tsv_weighted</code>), содержащая лексемы для поиска. Убедитесь,
что настроена соответствующая FTS-конфигурация (словари, парсеры). Отсутствие необходимых компонентов
или некорректная конфигурация приведет к ошибке выполнения FTS-запроса и переключению на <code class="prettyprint">ILIKE</code>.
Поиск с <code class="prettyprint">ILIKE</code> может быть значительно медленнее полнотекстового поиска на больших объемах данных.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__fallback_to_ilike_pgsql"><abbr title="\PhotoRigma\Classes\Database::_fallback_to_ilike_pgsql()">Database::_fallback_to_ilike_pgsql()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Приватный метод, реализующий поиск по ILIKE в
качестве fallback.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__fts_check_options"><abbr title="\PhotoRigma\Classes\Database::_fts_check_options()">Database::_fts_check_options()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Приватный метод, объединяющий и обрабатывающий опции
запроса для FTS.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__select_internal"><abbr title="\PhotoRigma\Classes\Database::_select_internal()">Database::_select_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Приватный метод для выполнения SELECT-запроса.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__result_array_internal"><abbr title="\PhotoRigma\Classes\Database::_result_array_internal()">Database::_result_array_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Приватный метод для получения всех строк
результата запроса.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="namespaces/photorigma-include.html#function_log_in_file"><abbr title="\PhotoRigma\Include\log_in_file()">log_in_file()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Записывает сообщение об ошибке в лог-файл.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Interfaces-Cache-Handler-Interface.html"><abbr title="\PhotoRigma\Interfaces\Cache_Handler_Interface">Cache_Handler_Interface</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Интерфейс, используемый для работы с кешированием.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#property_cache"><abbr title="\PhotoRigma\Classes\Database::$cache">Database::$cache</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, хранящее объект, реализующий <code class="prettyprint">Cache_Handler_Interface</code>.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__full_text_search_internal"><abbr title="\PhotoRigma\Classes\Database::_full_text_search_internal()">Database::_full_text_search_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Специфический метод для полнотекстового поиска в
PostgreSQL.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">array&lt;string|int, mixed&gt;|false</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Результат выполнения поиска в виде массива ассоциативных массивов (строк) при успехе и
наличии результатов, пустой массив при успехе, но отсутствии результатов, или <code class="prettyprint">false</code> в
случае пустой строки поиска, критической ошибки или если предыдущий FTS-запрос для этого
индекса завершился ошибкой (приводит к fallback, который может вернуть false).</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -private
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method__full_text_search_sqlite">
        _full_text_search_sqlite()
        <a href="classes/PhotoRigma-Classes-Database.html#method__full_text_search_sqlite" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/Database.php"><a href="files/src-classes-database.html"><abbr title="src/Classes/Database.php">Database.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">4307</span>

    </aside>

        <p class="phpdocumentor-summary">Выполняет полнотекстовый поиск в SQLite через FTS5.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">private</span>
                    <span class="phpdocumentor-signature__name">_full_text_search_sqlite</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$columns_to_return</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$columns_to_search</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$search_string</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$table</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$db_version</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$options</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">array&lt;string|int, mixed&gt;|false</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот приватный метод реализует логику полнотекстового поиска (Full-Text Search - FTS) для базы данных SQLite,
используя возможности модуля FTS5. Он обрабатывает минимальную длину строки поиска, использует кеширование для
быстрого определения предыдущих ошибок выполнения FTS5-запросов и включает механизм автоматического перехода
(fallback) на поиск с использованием оператора <code class="prettyprint">LIKE</code> в случае необходимости.
Метод выполняет следующие действия:</p>
<ol>
<li>Экранирует имена столбцов для возврата (<code class="prettyprint">$columns_to_return</code>), столбцов для поиска (<code class="prettyprint">$columns_to_search</code>) и
имя основной таблицы (<code class="prettyprint">$table</code>) с использованием двойных кавычек (<code class="prettyprint">&quot;</code>) для соответствия синтаксису SQLite.
Также формирует экранированное имя связанной виртуальной FTS5 таблицы, добавляя суффикс <code class="prettyprint">_fts</code> к имени
основной таблицы.</li>
<li>Проверяет, что длина строки поиска <code class="prettyprint">$search_string</code> превышает минимально допустимое значение, определенное
константой <code class="prettyprint">MIN_FULLTEXT_SEARCH_LENGTH</code>. Если длина недостаточна, метод сразу же вызывает приватный метод
<code class="prettyprint">_fallback_to_like_sqlite()</code> для выполнения поиска с использованием <code class="prettyprint">LIKE</code> и возвращает его результат.</li>
<li>Формирует уникальный ключ кеша на основе имени основной таблицы и столбцов для поиска для идентификации
соответствующего FTS5-индекса в кеше.</li>
<li>Проверяет кеш (<code class="prettyprint">$this-&gt;cache</code>) на наличие записи, связанной с этим FTS5-индексом, используя <code class="prettyprint">$db_version</code>
как параметр валидности кеша. Если в кеше найдена запись с флагом <code class="prettyprint">query_error = true</code>, это означает, что
предыдущая попытка выполнить FTS5-запрос для этого индекса завершилась ошибкой. В этом случае метод также
вызывает <code class="prettyprint">_fallback_to_like_sqlite()</code> и возвращает его результат.</li>
<li>Предпринимает попытку выполнить полнотекстовый поиск FTS5 в блоке <code class="prettyprint">try...catch</code>:
<ul>
<li>Формирует базовые опции FTS (<code class="prettyprint">$base_options</code>), включающие условие <code class="prettyprint">WHERE &quot;имя_fts_таблицы&quot; MATCH :search_string_where</code> и сортировку <code class="prettyprint">ORDER BY rank DESC</code>, используя переданную строку поиска
<code class="prettyprint">$search_string</code> как параметр.</li>
<li>Объединяет переданные внешние опции запроса (<code class="prettyprint">$options</code>) с базовыми FTS-опциями (<code class="prettyprint">$base_options</code>) с
помощью приватного метода <code class="prettyprint">_fts_check_options()</code>. Этот метод разрешает конфликты плейсхолдеров и
определяет приоритеты для WHERE, ORDER BY, GROUP BY, LIMIT и PARAMS.</li>
<li>Вызывает приватный метод <code class="prettyprint">_select_internal()</code> с экранированными столбцами для возврата, <strong>экранированным
именем FTS5 таблицы</strong> (<code class="prettyprint">$fts_table_escaped</code>) и объединенными опциями (<code class="prettyprint">$new_options</code>) для выполнения
SQL-запроса к виртуальной FTS5 таблице.</li>
</ul>
</li>
<li>В случае успешного выполнения FTS5-запроса (блок <code class="prettyprint">try</code> без исключений):
<ul>
<li>Обновляет кеш (<code class="prettyprint">$this-&gt;cache</code>), устанавливая флаг <code class="prettyprint">query_error = false</code> для данного FTS5-индекса,
указывая на успешность последнего запроса.</li>
<li>Получает результат запроса в виде массива с помощью приватного метода <code class="prettyprint">_result_array_internal()</code> и
возвращает его.</li>
</ul>
</li>
<li>В случае возникновения исключения (<code class="prettyprint">Throwable</code>) во время выполнения FTS5-запроса (блок <code class="prettyprint">catch</code>):
<ul>
<li>Логирует информацию об ошибке с помощью функции <code class="prettyprint">log_in_file()</code>, включая текст запроса и сообщение об
ошибке.</li>
<li>Обновляет кеш (<code class="prettyprint">$this-&gt;cache</code>), устанавливая флаг <code class="prettyprint">query_error = true</code> для данного FTS5-индекса, чтобы
избежать повторных ошибок в будущем.</li>
<li>Вызывает приватный метод <code class="prettyprint">_fallback_to_like_sqlite()</code> для выполнения поиска с использованием <code class="prettyprint">LIKE</code> и
возвращает его результат.
Этот метод является приватным и предназначен только для использования внутри класса <code class="prettyprint">Database</code>. Он вызывается
из публичных или защищенных методов поиска, когда определен тип базы данных SQLite.</li>
</ul>
</li>
</ol>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$columns_to_return</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Массив строк с именами столбцов, которые нужно вернуть в результате поиска.</p>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$columns_to_search</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Массив строк с именами столбцов, по которым выполняется полнотекстовый поиск
(используются для формирования имени FTS5 таблицы и кеш-ключа).</p>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$search_string</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Строка поиска, введенная пользователем. Используется как есть для оператора
FTS5 <code class="prettyprint">MATCH</code>. Проверяется на минимальную длину.</p>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$table</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Строка с именем основной таблицы, для которой существует связанная FTS5
виртуальная таблица.</p>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$db_version</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Строка, представляющая версию структуры базы данных (например, из специальной
таблицы), используется для валидации кеша.</p>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$options</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Массив дополнительных опций для формирования запроса. Используется для
добавления условий WHERE, GROUP BY, ORDER BY, LIMIT и параметров к FTS5-запросу.
Поддерживаемые ключи:</p>
<ul>
<li>where (string|array|false): Дополнительное условие WHERE (объединяется с
FTS5 MATCH оператором AND).</li>
<li>group (string|false): Группировка GROUP BY.</li>
<li>order (string|false): Дополнительная сортировка ORDER BY (имеет более
низкий приоритет, чем FTS5 <code class="prettyprint">rank DESC</code>).</li>
<li>limit (int|string|false): Ограничение LIMIT.</li>
<li>params (array): Ассоциативный массив дополнительных параметров для
подготовленного выражения.</li>
</ul>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-Database.html#method__full_text_search_sqlite#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">internal</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                             
                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\JsonException">JsonException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Может быть выброшено методами кеширования (<code class="prettyprint">$this-&gt;cache-&gt;is_valid</code>,
<code class="prettyprint">$this-&gt;cache-&gt;update_cache</code>) при ошибках сериализации/десериализации данных кеша.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\Exception">Exception</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Может быть выброшено функцией логирования <code class="prettyprint">log_in_file()</code> в случае
невозможности записи в файл.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\PDOException">PDOException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Может быть выброшено методами <code class="prettyprint">_fts_check_options()</code> (через вызов
<code class="prettyprint">_build_conditions()</code>) или <code class="prettyprint">_select_internal()</code> в случае ошибок, связанных с
базой данных или некорректным SQL, если они не перехватываются в блоке
<code class="prettyprint">try...catch</code> или выбрасываются после него. (Большинство таких ошибок внутри
FTS5 перехватываются и приводят к fallback).</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\InvalidArgumentException">InvalidArgumentException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Может быть выброшено методом <code class="prettyprint">_fts_check_options()</code> (через вызов
<code class="prettyprint">_build_conditions()</code>) при некорректном формате опций. (Большинство таких
ошибок внутри FTS5 перехватываются и приводят к fallback).</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Метод использует константу <code class="prettyprint">MIN_FULLTEXT_SEARCH_LENGTH</code> для проверки минимальной длины строки поиска.
Активно используется кеширование (<code class="prettyprint">$this-&gt;cache</code>) для оптимизации и запоминания FTS5-индексов,
вызывающих ошибки. При возникновении ошибок выполнения FTS5-запроса (например, из-за отсутствия
виртуальной таблицы или некорректного синтаксиса FTS5), метод автоматически переключается на поиск с
использованием оператора <code class="prettyprint">LIKE</code>, вызывая <code class="prettyprint">_fallback_to_like_sqlite()</code>.
Для работы требуется создание виртуальной таблицы FTS5 с именем <code class="prettyprint">имя_основной_таблицы_fts</code> и
соответствующей структурой, содержащей столбцы для поиска.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Убедитесь, что для таблицы, указанной в <code class="prettyprint">$table</code>, существует виртуальная таблица FTS5 с именем
<code class="prettyprint">{$table}_fts</code> и что она содержит столбцы, достаточные для поиска.
Поиск с <code class="prettyprint">LIKE</code> может быть значительно медленнее полнотекстового поиска FTS5 на больших объемах данных.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__fallback_to_like_sqlite"><abbr title="\PhotoRigma\Classes\Database::_fallback_to_like_sqlite()">Database::_fallback_to_like_sqlite()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Приватный метод, реализующий поиск по LIKE в
качестве fallback.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__fts_check_options"><abbr title="\PhotoRigma\Classes\Database::_fts_check_options()">Database::_fts_check_options()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Приватный метод, объединяющий и обрабатывающий опции
запроса для FTS.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__select_internal"><abbr title="\PhotoRigma\Classes\Database::_select_internal()">Database::_select_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Приватный метод для выполнения SELECT-запроса к FTS5
таблице.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__result_array_internal"><abbr title="\PhotoRigma\Classes\Database::_result_array_internal()">Database::_result_array_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Приватный метод для получения всех строк
результата запроса.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="namespaces/photorigma-include.html#function_log_in_file"><abbr title="\PhotoRigma\Include\log_in_file()">log_in_file()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Записывает сообщение об ошибке в лог-файл.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Interfaces-Cache-Handler-Interface.html"><abbr title="\PhotoRigma\Interfaces\Cache_Handler_Interface">Cache_Handler_Interface</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Интерфейс, используемый для работы с кешированием.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#property_cache"><abbr title="\PhotoRigma\Classes\Database::$cache">Database::$cache</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, хранящее объект, реализующий <code class="prettyprint">Cache_Handler_Interface</code>.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">see</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="https://www.sqlite.org/fts5.html">https://www.sqlite.org/fts5.html</a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Документация по модулю SQLite FTS5.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__full_text_search_internal"><abbr title="\PhotoRigma\Classes\Database::_full_text_search_internal()">Database::_full_text_search_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Специфический метод для полнотекстового поиска
в SQLite.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">array&lt;string|int, mixed&gt;|false</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Результат выполнения поиска в виде массива ассоциативных массивов (строк) при успехе и
наличии результатов, пустой массив при успехе, но отсутствии результатов, или <code class="prettyprint">false</code> в
случае пустой строки поиска, критической ошибки или если предыдущий FTS5-запрос для этого
индекса завершился ошибкой (приводит к fallback, который может вернуть false).</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -private
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method__log_explain">
        _log_explain()
        <a href="classes/PhotoRigma-Classes-Database.html#method__log_explain" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/Database.php"><a href="files/src-classes-database.html"><abbr title="src/Classes/Database.php">Database.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">1384</span>

    </aside>

        <p class="phpdocumentor-summary">Логирует результат анализа SQL-запроса с помощью EXPLAIN или EXPLAIN ANALYZE.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">private</span>
                    <span class="phpdocumentor-signature__name">_log_explain</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$params</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">void</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот приватный метод выполняет анализ текущего SQL-запроса, хранящегося в свойстве <code class="prettyprint">$this-&gt;txt_query</code>, с
помощью команды <code class="prettyprint">EXPLAIN</code> или <code class="prettyprint">EXPLAIN ANALYZE</code>, и логирует полученный результат.
Алгоритм работы:</p>
<ol>
<li>Определяет тип команды анализа (<code class="prettyprint">EXPLAIN</code> или <code class="prettyprint">EXPLAIN ANALYZE</code>) в зависимости от типа текущей СУБД
(<code class="prettyprint">$this-&gt;db_type</code>), версии СУБД (для MySQL/MariaDB) и типа запроса (WRITE или SELECT для PostgreSQL/MySQL).
<ul>
<li>Для SQLite всегда используется только <code class="prettyprint">EXPLAIN</code>.</li>
<li>Для MySQL/MariaDB: <code class="prettyprint">EXPLAIN ANALYZE</code> используется только для SELECT-запросов на MySQL &gt;= 5.7 (не MariaDB).
В остальных случаях - <code class="prettyprint">EXPLAIN</code>.</li>
<li>Для PostgreSQL: <code class="prettyprint">EXPLAIN ANALYZE</code> используется для SELECT-запросов, <code class="prettyprint">EXPLAIN</code> - для WRITE-запросов.</li>
</ul>
</li>
<li>Выполняет команду анализа (<code class="prettyprint">EXPLAIN ...</code> или <code class="prettyprint">EXPLAIN ANALYZE ...</code>) с использованием объекта PDO
(<code class="prettyprint">$this-&gt;pdo</code>) и переданных параметров <code class="prettyprint">$params</code>.</li>
<li>Извлекает строки результата анализа и форматирует их для удобства чтения (ключ: значение).</li>
<li>Логирует результат анализа, исходный текст запроса (<code class="prettyprint">$this-&gt;txt_query</code>) и переданные параметры <code class="prettyprint">$params</code> с
использованием функции <code class="prettyprint">log_in_file()</code>.</li>
<li>В случае ошибки при определении версии СУБД или выполнении команды анализа, также логируется сообщение об
ошибке.
Этот метод является приватным и предназначен только для использования внутри класса. Вызывается из метода
<code class="prettyprint">_execute_query()</code>, если включена константа <code class="prettyprint">SQL_ANALYZE</code>.</li>
</ol>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$params</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Ассоциативный массив параметров для подготовленного запроса (такой же, как передается в
<code class="prettyprint">_execute_query()</code>).
Пример: <code class="prettyprint">[':id' =&gt; 1, ':name' =&gt; 'John Doe']</code>.
Ключи массива должны соответствовать именам плейсхолдеров в <code class="prettyprint">$this-&gt;txt_query</code>.
Если параметры отсутствуют, можно передать пустой массив (<code class="prettyprint">[]</code>).</p>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-Database.html#method__log_explain#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">internal</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                             
                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\InvalidArgumentException">InvalidArgumentException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если тип текущей СУБД (<code class="prettyprint">$this-&gt;db_type</code>) не поддерживается
методом <code class="prettyprint">_log_explain</code> для определения типа команды анализа.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\Exception">Exception</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если произошла ошибка при получении версии СУБД (для
MySQL/MariaDB) или при выполнении команды EXPLAIN/EXPLAIN ANALYZE (например,
синтаксическая ошибка в запросе на уровне PDO).
В случае выброса исключения, оно перехватывается внутри метода и логируется.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Метод использует объект PDO (<code class="prettyprint">$this-&gt;pdo</code>) для выполнения команд анализа и функцию <code class="prettyprint">log_in_file()</code>
для записи результатов и ошибок. Результат анализа форматируется для удобства чтения.
При возникновении ошибки логируются текст запроса, параметры и сообщение об ошибке из пойманного
исключения.
Поведение метода зависит от константы <code class="prettyprint">SQL_ANALYZE</code>.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Убедитесь, что свойство <code class="prettyprint">$this-&gt;txt_query</code> содержит синтаксически корректный SQL-запрос перед вызовом
метода, чтобы избежать ошибок при выполнении команды анализа.
Метод предполагает, что соединение с базой данных <code class="prettyprint">$this-&gt;pdo</code> установлено.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="namespaces/photorigma-include.html#function_log_in_file"><abbr title="\PhotoRigma\Include\log_in_file()">log_in_file()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Записывает сообщение об ошибке в лог-файл.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#property_txt_query"><abbr title="\PhotoRigma\Classes\Database::$txt_query">Database::$txt_query</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, содержащее текст SQL-запроса для анализа.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#property_pdo"><abbr title="\PhotoRigma\Classes\Database::$pdo">Database::$pdo</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Объект PDO, используемый для выполнения команды анализа.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#property_db_type"><abbr title="\PhotoRigma\Classes\Database::$db_type">Database::$db_type</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, определяющее тип используемой СУБД.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__execute_query"><abbr title="\PhotoRigma\Classes\Database::_execute_query()">Database::_execute_query()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Приватный метод для выполнения EXPLAIN ANALYZE.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">void</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Метод ничего не возвращает. Результат анализа логируется.</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -private
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method__log_query">
        _log_query()
        <a href="classes/PhotoRigma-Classes-Database.html#method__log_query" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/Database.php"><a href="files/src-classes-database.html"><abbr title="src/Classes/Database.php">Database.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">1528</span>

    </aside>

        <p class="phpdocumentor-summary">Логирует медленные запросы, запросы без использования плейсхолдеров и другие запросы в таблицу логов.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">private</span>
                    <span class="phpdocumentor-signature__name">_log_query</span><span>(</span><span class="phpdocumentor-signature__argument"><span>[</span><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$reason</span><span> = </span><span class="phpdocumentor-signature__argument__default-value">&#039;other&#039;</span><span> ]</span></span><span class="phpdocumentor-signature__argument"><span>[</span><span>, </span><span class="phpdocumentor-signature__argument__return-type">float|null&nbsp;</span><span class="phpdocumentor-signature__argument__name">$execution_time_ms</span><span> = </span><span class="phpdocumentor-signature__argument__default-value">null</span><span> ]</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">void</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот приватный метод выполняет логирование информации о SQL-запросах в специализированную таблицу логов
(<code class="prettyprint">TBL_LOG_QUERY</code>).
Алгоритм работы:</p>
<ol>
<li>Выполняет начальные проверки: убеждается, что <code class="prettyprint">$this-&gt;txt_query</code> является непустой строкой и не содержит
имени таблицы логов, чтобы избежать рекурсивного логирования.</li>
<li>Нормализует переданное время выполнения <code class="prettyprint">$execution_time_ms</code>, гарантируя, что оно является неотрицательным
числом.</li>
<li>Обрезает текст запроса <code class="prettyprint">$this-&gt;txt_query</code> до максимальной длины (<code class="prettyprint">$max_query_length</code>, по умолчанию 65530
символов), чтобы соответствовать размеру поля в базе данных (например, TEXT в MySQL), добавляя
суффикс &quot;...&quot; при обрезке.</li>
<li>Вычисляет MD5-хэш от полного текста запроса (<code class="prettyprint">$this-&gt;txt_query</code>) для последующей идентификации дубликатов.</li>
<li>Валидирует переданную причину логирования <code class="prettyprint">$reason</code>, используя <code class="prettyprint">match</code> для ограничения допустимых значений
('slow', 'no_placeholders', 'other'). Если значение некорректно, используется 'other'.</li>
<li>Проверяет наличие хэша запроса в кэше <code class="prettyprint">$this-&gt;query_cache</code> для оптимизации. Если хэш не найден в кэше,
выполняется запрос к таблице логов <code class="prettyprint">TBL_LOG_QUERY</code> для проверки существования записи с таким хэшем, и
результат сохраняется в кэше.</li>
<li>На основе результата проверки в кэше логирует или обновляет запись в таблице логов:
<ul>
<li>Если запись с таким хэшем уже существует (найдена в кэше/БД), обновляет поля <code class="prettyprint">usage_count</code> (увеличивает
на 1), <code class="prettyprint">last_used_at</code> (устанавливает текущее время) и <code class="prettyprint">execution_time</code> (обновляет только если переданное
<code class="prettyprint">$execution_time_ms</code> больше сохраненного).</li>
<li>Если запись не существует, вставляет новую строку с хэшем, обрезанным текстом запроса, причиной и
временем выполнения.
Этот метод является приватным и предназначен только для использования внутри класса <code class="prettyprint">Database</code>. Вызывается из
метода <code class="prettyprint">_execute_query()</code> при выполнении определенных условий логирования (<code class="prettyprint">SQL_LOG</code>).</li>
</ul>
</li>
</ol>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$reason</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                 = <span class="phpdocumentor-signature__argument__default-value">&#039;other&#039;</span>            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Причина логирования запроса. Допустимые значения: 'slow', 'no_placeholders',
'other'. Некорректные значения преобразуются в 'other'. По умолчанию:
'other'. Пример: 'slow'.</p>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$execution_time_ms</span>
                : <span class="phpdocumentor-signature__argument__return-type">float|null</span>
                 = <span class="phpdocumentor-signature__argument__default-value">null</span>            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Время выполнения запроса в миллисекундах. Должно быть положительным
числом или <code class="prettyprint">null</code>. Используется для записи или обновления максимального
времени выполнения в логах. По умолчанию: <code class="prettyprint">null</code>.
Пример: 1200.5.</p>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-Database.html#method__log_query#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">internal</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                             
                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\PDOException">PDOException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если произошла ошибка при работе с базой данных в процессе выполнения
запросов INSERT или UPDATE к таблице логов <code class="prettyprint">TBL_LOG_QUERY</code> (например, проблемы с
подключением или выполнением запроса).</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Метод активно использует кэширование (<code class="prettyprint">$this-&gt;query_cache</code>) для оптимизации проверки существования
запросов в базе данных. Запросы хэшируются с помощью <code class="prettyprint">md5()</code> для идентификации уникальных запросов и
предотвращения дублирования записей. Длинные запросы обрезаются для соответствия ограничению поля в
базе данных.
Поведение метода и целевая таблица определяются константой <code class="prettyprint">TBL_LOG_QUERY</code>.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Убедитесь, что константа <code class="prettyprint">TBL_LOG_QUERY</code> определена и указывает на существующую таблицу с подходящей
структурой. Также учтите, что слишком длинные запросы будут обрезаны до <code class="prettyprint">$max_query_length</code> символов
перед сохранением.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#property_txt_query"><abbr title="\PhotoRigma\Classes\Database::$txt_query">Database::$txt_query</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, содержащее текст SQL-запроса, который логируется.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#property_pdo"><abbr title="\PhotoRigma\Classes\Database::$pdo">Database::$pdo</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Объект PDO, используемый для выполнения запросов к таблице логов.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#property_query_cache"><abbr title="\PhotoRigma\Classes\Database::$query_cache">Database::$query_cache</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Внутреннее свойство, используемое для кэширования результатов
проверки существования запросов.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__execute_query"><abbr title="\PhotoRigma\Classes\Database::_execute_query()">Database::_execute_query()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Приватный метод для логирования запросов.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">void</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Метод ничего не возвращает.</p>
</section>

            </section>

</article>
                    <article
        class="phpdocumentor-element
            -method
            -private
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method__unescape_identifiers">
        _unescape_identifiers()
        <a href="classes/PhotoRigma-Classes-Database.html#method__unescape_identifiers" class="headerlink"><i class="fas fa-link"></i></a>

    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/Classes/Database.php"><a href="files/src-classes-database.html"><abbr title="src/Classes/Database.php">Database.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">4747</span>

    </aside>

        <p class="phpdocumentor-summary">Снятие экранирования идентификаторов (например, имён таблиц или столбцов).</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">private</span>
                    <span class="phpdocumentor-signature__name">_unescape_identifiers</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$identifiers</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">array&lt;string|int, mixed&gt;</span></code>

    <div class="phpdocumentor-label-line">
        </div>
    
        <section class="phpdocumentor-description"><p>Этот приватный метод обрабатывает массив идентификаторов, удаляя из них символы экранирования, специфичные для
текущей СУБД, определенной свойством <code class="prettyprint">$this-&gt;current_format</code>. Результат &quot;чистых&quot; идентификаторов сохраняется в
кэше для оптимизации.
Метод выполняет следующие шаги:</p>
<ol>
<li>Инициализирует пустой массив для хранения результатов и определяет правила снятия экранирования на основе
свойства <code class="prettyprint">$this-&gt;current_format</code>.</li>
<li>Перебирает каждый идентификатор в массиве <code class="prettyprint">$identifiers</code>, проверяя, является ли он строкой. Если обнаружен
не строковый элемент, выбрасывается исключение InvalidArgumentException.</li>
<li>Для каждого идентификатора проверяет наличие результата снятия экранирования в кэше <code class="prettyprint">$this-&gt;unescape_cache</code>.</li>
<li>Если идентификатор не найден в кэше, применяет соответствующие правила снятия экранирования (<code class="prettyprint">strtr</code>) для
удаления специфических символов (обратные кавычки для MySQL, двойные кавычки для PostgreSQL, квадратные
скобки и двойные кавычки для SQLite). Результат сохраняется в кэше.</li>
<li>Добавляет &quot;чистый&quot; идентификатор (из кэша или только что вычисленный) в массив результатов.</li>
<li>После обработки всех идентификаторов возвращает массив &quot;чистых&quot; идентификаторов.
Поддерживаемые правила снятия экранирования в зависимости от <code class="prettyprint">$this-&gt;current_format</code>:</li>
</ol>
<ul>
<li>'mysql': удаляются обратные кавычки (`).</li>
<li>'pgsql': удаляются двойные кавычки (&quot;).</li>
<li>'sqlite': удаляются квадратные скобки ([]) и двойные кавычки (&quot;).</li>
</ul>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$identifiers</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>Массив экранированных идентификаторов для обработки.
Элементы массива должны быть строками. Могут содержать квалифицированные имена
(например, &quot;schema.table&quot;).</p>
</section>

            </dd>
            </dl>

    
    <h5 class="phpdocumentor-tag-list__heading" id="tags">
        Tags
        <a href="classes/PhotoRigma-Classes-Database.html#method__unescape_identifiers#tags" class="headerlink"><i class="fas fa-link"></i></a>

    </h5>
    <dl class="phpdocumentor-tag-list">
                                    <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">internal</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                             
                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">throws</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                <span class="phpdocumentor-tag-link"><abbr title="\InvalidArgumentException">InvalidArgumentException</abbr></span>
                                                            
                                                 <section class="phpdocumentor-description"><p>Выбрасывается, если какой-либо элемент в массиве <code class="prettyprint">$identifiers</code> не является
строкой.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">note</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Метод использует текущую конфигурацию СУБД, заданную в свойстве <code class="prettyprint">$this-&gt;current_format</code>, для
определения правил снятия экранирования.
Результаты снятия экранирования кешируются в свойстве <code class="prettyprint">$this-&gt;unescape_cache</code> для оптимизации
повторных операций с теми же идентификаторами.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">warning</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                
                                                 <section class="phpdocumentor-description"><p>Убедитесь, что свойство <code class="prettyprint">$this-&gt;current_format</code> установлено в одно из поддерживаемых значений
('mysql', 'pgsql', 'sqlite') перед вызовом метода.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#property_unescape_cache"><abbr title="\PhotoRigma\Classes\Database::$unescape_cache">Database::$unescape_cache</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Внутреннее свойство, используемое для кэширования
результатов снятия экранирования идентификаторов.</p>
</section>

                                    </dd>
                            <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">uses</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#property_current_format"><abbr title="\PhotoRigma\Classes\Database::$current_format">Database::$current_format</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Свойство, хранящее текущий формат SQL, определяющий
правила снятия экранирования.</p>
</section>

                                    </dd>
                                                <dt class="phpdocumentor-tag-list__entry">
                    <span class="phpdocumentor-tag__name">used-by</span>
                </dt>
                <dd class="phpdocumentor-tag-list__definition">
                                                                                    <span class="phpdocumentor-tag-link"><a href="classes/PhotoRigma-Classes-Database.html#method__full_text_search_internal"><abbr title="\PhotoRigma\Classes\Database::_full_text_search_internal()">Database::_full_text_search_internal()</abbr></a></span>
                                        
                                                 <section class="phpdocumentor-description"><p>Используется для снятия экранирования имен
столбцов и таблицы.</p>
</section>

                                    </dd>
                        </dl>

    

            <section>
        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
        <span class="phpdocumentor-signature__response_type">array&lt;string|int, mixed&gt;</span>
                    &mdash;
                <section class="phpdocumentor-description"><p>Массив &quot;чистых&quot; идентификаторов.
Все экранирующие символы, специфичные для <code class="prettyprint">$this-&gt;current_format</code>, удалены.
Сохраняется исходная структура квалифицированных имен (например, разделитель '.').</p>
</section>

            </section>

</article>
            </section>

        <div class="phpdocumentor-modal" id="source-view">
    <div class="phpdocumentor-modal-bg" data-exit-button></div>
    <div class="phpdocumentor-modal-container">
        <div class="phpdocumentor-modal-content">
            <pre style="max-height: 500px; overflow-y: scroll" data-src="files/src/Classes/Database.php.txt" class="language-php line-numbers linkable-line-numbers"></pre>
        </div>
        <button data-exit-button class="phpdocumentor-modal__close">&times;</button>
    </div>
</div>

    <script type="text/javascript">
        (function () {
            function loadExternalCodeSnippet(el, url, line) {
                Array.prototype.slice.call(el.querySelectorAll('pre[data-src]')).forEach((pre) => {
                    const src = url || pre.getAttribute('data-src').replace(/\\/g, '/');
                    const language = 'php';

                    const code = document.createElement('code');
                    code.className = 'language-' + language;
                    pre.textContent = '';
                    pre.setAttribute('data-line', line)
                    code.textContent = 'Loading…';
                    pre.appendChild(code);

                    var xhr = new XMLHttpRequest();

                    xhr.open('GET', src, true);

                    xhr.onreadystatechange = function () {
                        if (xhr.readyState !== 4) {
                            return;
                        }

                        if (xhr.status < 400 && xhr.responseText) {
                            code.textContent = xhr.responseText;
                            Prism.highlightElement(code);
                            return;
                        }

                        if (xhr.status === 404) {
                            code.textContent = '✖ Error: File could not be found';
                            return;
                        }

                        if (xhr.status >= 400) {
                            code.textContent = '✖ Error ' + xhr.status + ' while fetching file: ' + xhr.statusText;
                            return;
                        }

                        code.textContent = '✖ Error: An unknown error occurred';
                    };

                    xhr.send(null);
                });
            }

            const modalButtons = document.querySelectorAll("[data-modal]");
            const openedAsLocalFile = window.location.protocol === 'file:';
            if (modalButtons.length > 0 && openedAsLocalFile) {
                console.warn(
                    'Viewing the source code is unavailable because you are opening this page from the file:// scheme; ' +
                    'browsers block XHR requests when a page is opened this way'
                );
            }

            modalButtons.forEach(function (trigger) {
                if (openedAsLocalFile) {
                    trigger.setAttribute("hidden", "hidden");
                }

                trigger.addEventListener("click", function (event) {
                    event.preventDefault();
                    const modal = document.getElementById(trigger.dataset.modal);
                    if (!modal) {
                        console.error(`Modal with id "${trigger.dataset.modal}" could not be found`);
                        return;
                    }
                    modal.classList.add("phpdocumentor-modal__open");

                    loadExternalCodeSnippet(modal, trigger.dataset.src || null, trigger.dataset.line)
                    const exits = modal.querySelectorAll("[data-exit-button]");
                    exits.forEach(function (exit) {
                        exit.addEventListener("click", function (event) {
                            event.preventDefault();
                            modal.classList.remove("phpdocumentor-modal__open");
                        });
                    });
                });
            });
        })();
    </script>

    </article>
                                </section>
                <section class="phpdocumentor-on-this-page__sidebar">
                                
    <section class="phpdocumentor-on-this-page__content">
        <strong class="phpdocumentor-on-this-page__title">On this page</strong>

        <ul class="phpdocumentor-list -clean">
            <li class="phpdocumentor-on-this-page-section__title">Table Of Contents</li>
            <li>
                <ul class="phpdocumentor-list -clean">
                                                            <li><a href="classes/PhotoRigma-Classes-Database.html#toc-properties">Properties</a></li>
                                                            <li><a href="classes/PhotoRigma-Classes-Database.html#toc-methods">Methods</a></li>
                                    </ul>
            </li>
            
                            <li class="phpdocumentor-on-this-page-section__title">Properties</li>
                <li>
                    <ul class="phpdocumentor-list -clean">
                                                    <li class=""><a href="classes/PhotoRigma-Classes-Database.html#property_aff_rows">$aff_rows</a></li>
                                                    <li class=""><a href="classes/PhotoRigma-Classes-Database.html#property_allowed_formats">$allowed_formats</a></li>
                                                    <li class=""><a href="classes/PhotoRigma-Classes-Database.html#property_cache">$cache</a></li>
                                                    <li class=""><a href="classes/PhotoRigma-Classes-Database.html#property_current_format">$current_format</a></li>
                                                    <li class=""><a href="classes/PhotoRigma-Classes-Database.html#property_db_name">$db_name</a></li>
                                                    <li class=""><a href="classes/PhotoRigma-Classes-Database.html#property_db_type">$db_type</a></li>
                                                    <li class=""><a href="classes/PhotoRigma-Classes-Database.html#property_format_cache">$format_cache</a></li>
                                                    <li class=""><a href="classes/PhotoRigma-Classes-Database.html#property_insert_id">$insert_id</a></li>
                                                    <li class=""><a href="classes/PhotoRigma-Classes-Database.html#property_pdo">$pdo</a></li>
                                                    <li class=""><a href="classes/PhotoRigma-Classes-Database.html#property_query_cache">$query_cache</a></li>
                                                    <li class=""><a href="classes/PhotoRigma-Classes-Database.html#property_res_query">$res_query</a></li>
                                                    <li class=""><a href="classes/PhotoRigma-Classes-Database.html#property_txt_query">$txt_query</a></li>
                                                    <li class=""><a href="classes/PhotoRigma-Classes-Database.html#property_unescape_cache">$unescape_cache</a></li>
                                            </ul>
                </li>
            
                        <li class="phpdocumentor-on-this-page-section__title">Methods</li>
            <li>
                <ul class="phpdocumentor-list -clean">
                                            <li class=""><a href="classes/PhotoRigma-Classes-Database.html#method___construct">__construct()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-Database.html#method___destruct">__destruct()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-Database.html#method_begin_transaction">begin_transaction()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-Database.html#method_commit_transaction">commit_transaction()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-Database.html#method_delete">delete()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-Database.html#method_format_date">format_date()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-Database.html#method_full_text_search">full_text_search()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-Database.html#method_get_affected_rows">get_affected_rows()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-Database.html#method_get_last_insert_id">get_last_insert_id()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-Database.html#method_insert">insert()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-Database.html#method_join">join()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-Database.html#method_result_array">result_array()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-Database.html#method_result_row">result_row()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-Database.html#method_rollback_transaction">rollback_transaction()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-Database.html#method_select">select()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-Database.html#method_truncate">truncate()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-Database.html#method_update">update()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-Database.html#method_with_sql_format">with_sql_format()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-Database.html#method__begin_transaction_internal">_begin_transaction_internal()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-Database.html#method__commit_transaction_internal">_commit_transaction_internal()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-Database.html#method__delete_internal">_delete_internal()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-Database.html#method__format_date_internal">_format_date_internal()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-Database.html#method__full_text_search_internal">_full_text_search_internal()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-Database.html#method__get_affected_rows_internal">_get_affected_rows_internal()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-Database.html#method__get_last_insert_id_internal">_get_last_insert_id_internal()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-Database.html#method__insert_internal">_insert_internal()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-Database.html#method__join_internal">_join_internal()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-Database.html#method__result_array_internal">_result_array_internal()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-Database.html#method__result_row_internal">_result_row_internal()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-Database.html#method__rollback_transaction_internal">_rollback_transaction_internal()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-Database.html#method__select_internal">_select_internal()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-Database.html#method__truncate_internal">_truncate_internal()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-Database.html#method__update_internal">_update_internal()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-Database.html#method__with_sql_format_internal">_with_sql_format_internal()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-Database.html#method__build_conditions">_build_conditions()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-Database.html#method__build_where_group">_build_where_group()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-Database.html#method__convert_from_mysql_to">_convert_from_mysql_to()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-Database.html#method__convert_from_pgsql_to">_convert_from_pgsql_to()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-Database.html#method__convert_from_sqlite_to">_convert_from_sqlite_to()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-Database.html#method__convert_query">_convert_query()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-Database.html#method__convert_to_mysql_format">_convert_to_mysql_format()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-Database.html#method__convert_to_postgres_format">_convert_to_postgres_format()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-Database.html#method__convert_to_sqlite_format">_convert_to_sqlite_format()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-Database.html#method__execute_query">_execute_query()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-Database.html#method__fallback_to_ilike_pgsql">_fallback_to_ilike_pgsql()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-Database.html#method__fallback_to_like_mysql">_fallback_to_like_mysql()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-Database.html#method__fallback_to_like_sqlite">_fallback_to_like_sqlite()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-Database.html#method__fts_check_options">_fts_check_options()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-Database.html#method__full_text_search_mysql">_full_text_search_mysql()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-Database.html#method__full_text_search_pgsql">_full_text_search_pgsql()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-Database.html#method__full_text_search_sqlite">_full_text_search_sqlite()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-Database.html#method__log_explain">_log_explain()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-Database.html#method__log_query">_log_query()</a></li>
                                            <li class=""><a href="classes/PhotoRigma-Classes-Database.html#method__unescape_identifiers">_unescape_identifiers()</a></li>
                                    </ul>
            </li>
                    </ul>
    </section>

                </section>
                            </div>
            <section data-search-results class="phpdocumentor-search-results phpdocumentor-search-results--hidden">
    <section class="phpdocumentor-search-results__dialog">
        <header class="phpdocumentor-search-results__header">
            <h2 class="phpdocumentor-search-results__title">Search results</h2>
            <button class="phpdocumentor-search-results__close"><i class="fas fa-times"></i></button>
        </header>
        <section class="phpdocumentor-search-results__body">
            <ul class="phpdocumentor-search-results__entries"></ul>
        </section>
    </section>
</section>
        </div>
        <a href="classes/PhotoRigma-Classes-Database.html#top" class="phpdocumentor-back-to-top"><i class="fas fa-chevron-circle-up"></i></a>

    </main>

    <script>
        cssVars({});
    </script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/prism.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/line-highlight/prism-line-highlight.min.js"></script>
</body>
</html>
