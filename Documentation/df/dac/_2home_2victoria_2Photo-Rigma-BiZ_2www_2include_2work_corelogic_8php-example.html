<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="ru">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Photo-Rigma-BiZ: /home/victoria/Photo-Rigma-BiZ/www/include/work_corelogic.php</title>
<link rel="icon" href="../../favicon.ico" type="image/x-icon" />
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../clipboard.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../logo-1.png"/></td>
  <td id="projectalign">
   <div id="projectname">Photo-Rigma-BiZ<span id="projectnumber">&#160;0.4.0</span>
   </div>
   <div id="projectbrief">Gallery_Photo-Rigma-BiZ</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Создано системой Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(1); });
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Поиск',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('df/dac/_2home_2victoria_2Photo-Rigma-BiZ_2www_2include_2work_corelogic_8php-example.html','../../'); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Загрузка...</div>
<div class="SRStatus" id="Searching">Поиск...</div>
<div class="SRStatus" id="NoMatches">Не найдено</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">/home/victoria/Photo-Rigma-BiZ/www/include/work_corelogic.php</div></div>
</div><!--header-->
<div class="contents">
<p>Получение данных о новостях.</p>
<p>Метод формирует массив данных о новостях в зависимости от типа запроса. Этот метод является редиректом на защищенный метод _news_internal, где реализована основная логика.</p>
<dl class="section see"><dt>См. также</dt><dd>\PhotoRigma\Classes\Work::news() Вызывает этот метод для получения данных о новостях. </dd>
<dd>
\PhotoRigma\Classes\Work_CoreLogic::_news_internal() Основная логика метода реализована здесь.</dd></dl>
<dl class="params"><dt>Аргументы</dt><dd>
  <table class="params">
    <tr><td class="paramtype">int</td><td class="paramname">$news_id_or_limit</td><td>Количество новостей или ID новости (в зависимости от параметра $act). </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$act</td><td>Тип запроса:<ul>
<li>'id': Получение новости по её ID.</li>
<li>'list': Получение списка новостей с сортировкой по дате последнего редактирования.</li>
</ul>
</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Возвращает</dt><dd>array Массив с данными о новостях. Если новостей нет, возвращается пустой массив.</dd></dl>
<dl class="exception"><dt>Исключения</dt><dd>
  <table class="exception">
    <tr><td class="paramname"></td><td></td></tr>
  </table>
  </dd>
</dl>
<p>InvalidArgumentException Если передан некорректный $act или $news_id_or_limit. </p><dl class="exception"><dt>Исключения</dt><dd>
  <table class="exception">
    <tr><td class="paramname"></td><td></td></tr>
  </table>
  </dd>
</dl>
<p>RuntimeException Если произошла ошибка при выполнении запроса к базе данных.</p>
<div class="fragment"><div class="line"><span class="comment">// Пример использования метода news()</span></div>
<div class="line">$news_by_id = $this-&gt;news(5, <span class="stringliteral">&#39;id&#39;</span>); <span class="comment">// Получение новости с ID 5</span></div>
<div class="line">print_r($news_by_id);</div>
<div class="line"> </div>
<div class="line">$news_list = $this-&gt;news(10, <span class="stringliteral">&#39;list&#39;</span>); <span class="comment">// Получение 10 последних новостей</span></div>
<div class="line">print_r($news_list);</div>
</div><!-- fragment --><div class="fragment"><div class="line">&lt;?php</div>
<div class="line"></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span><a class="code hl_namespace" href="../../d6/dc3/namespacePhotoRigma_1_1Classes.html">PhotoRigma\Classes</a>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Предотвращение прямого вызова файла</span></div>
<div class="line"><span class="keywordflow">if</span> (!defined(<span class="stringliteral">&#39;IN_GALLERY&#39;</span>) || <a id="a0" name="a0"></a><a class="code hl_variable" href="../../de/d90/namespacePhotoRigma.html#afc238d5007d9f82f9c59e7d33f7a75c6">IN_GALLERY</a> !== <span class="keyword">true</span>) {</div>
<div class="line">    error_log(</div>
<div class="line">        date(<span class="stringliteral">&#39;H:i:s&#39;</span>) .</div>
<div class="line">        <span class="stringliteral">&quot; [ERROR] | &quot;</span> .</div>
<div class="line">        (filter_input(INPUT_SERVER, <span class="stringliteral">&#39;REMOTE_ADDR&#39;</span>, <a id="a1" name="a1"></a><a class="code hl_variable" href="../../de/d90/namespacePhotoRigma.html#ae07beac783fdab08b691bb38425a6771">FILTER_VALIDATE_IP</a>) ?: <span class="stringliteral">&#39;UNKNOWN_IP&#39;</span>) .</div>
<div class="line">        <span class="stringliteral">&quot; | &quot;</span> . __FILE__ . <span class="stringliteral">&quot; | Попытка прямого вызова файла&quot;</span></div>
<div class="line">    );</div>
<div class="line">    die(<span class="stringliteral">&quot;HACK!&quot;</span>);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">interface </span>Work_CoreLogic_Interface</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> <a id="a2" name="a2"></a><a class="code hl_function" href="../../d0/d91/interfacePhotoRigma_1_1Classes_1_1Work__CoreLogic__Interface.html#a4dfb943f9b750ec6e1e2924a9620c7f5">category</a>(<span class="keywordtype">int</span> $cat_id = 0, <span class="keywordtype">int</span> $user_flag = 0): array;</div>
<div class="line"></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> <a id="a3" name="a3"></a><a class="code hl_function" href="../../d0/d91/interfacePhotoRigma_1_1Classes_1_1Work__CoreLogic__Interface.html#a84a1eeee53079a8e60fea1d1e0d94639">del_photo</a>(<span class="keywordtype">int</span> $photo_id): bool;</div>
<div class="line"></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> <a id="a4" name="a4"></a><a class="code hl_function" href="../../d0/d91/interfacePhotoRigma_1_1Classes_1_1Work__CoreLogic__Interface.html#abfa7c6c53ae460403a3d0b3923e71a90">news</a>(<span class="keywordtype">int</span> $news_id_or_limit, <span class="keywordtype">string</span> $act): array;</div>
<div class="line"></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> <a id="a5" name="a5"></a><a class="code hl_function" href="../../d0/d91/interfacePhotoRigma_1_1Classes_1_1Work__CoreLogic__Interface.html#a9c2ee4da4bf10547c3aff7296d707c66">get_languages</a>(): array;</div>
<div class="line"></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> <a id="a6" name="a6"></a><a class="code hl_function" href="../../d0/d91/interfacePhotoRigma_1_1Classes_1_1Work__CoreLogic__Interface.html#a8d2f43c00af0c9574caa0455df82c613">get_themes</a>(): array;</div>
<div class="line"></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> <a id="a7" name="a7"></a><a class="code hl_function" href="../../d0/d91/interfacePhotoRigma_1_1Classes_1_1Work__CoreLogic__Interface.html#ab90e7e1e6aa1d2c9abe81faed1db03a1">create_photo</a>(<span class="keywordtype">string</span> $type, <span class="keywordtype">int</span> $id_photo): array;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span><a id="_a8" name="_a8"></a><a class="code hl_class" href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html">Work_CoreLogic</a> <span class="keyword">implements</span> <a id="_a9" name="_a9"></a><a class="code hl_interface" href="../../d0/d91/interfacePhotoRigma_1_1Classes_1_1Work__CoreLogic__Interface.html">Work_CoreLogic_Interface</a></div>
<div class="line">{</div>
<div class="line">    <span class="keyword">private</span> array <a class="code hl_variable" href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#ab76f8f2ac851632a23ef69df2bd99dad">$config</a>; </div>
<div class="line">    <span class="keyword">private</span> ?array <a class="code hl_variable" href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#a9fd8978d2c6cbdcfdd6be875be161b7b">$lang</a> = <span class="keyword">null</span>; </div>
<div class="line">    <span class="keyword">private</span> Database_Interface <a class="code hl_variable" href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#a18e3eac65d39ced5231d9b3e3630ba75">$db</a>; </div>
<div class="line">    <span class="keyword">private</span> Work <a class="code hl_variable" href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#aa1464d140ae01b78294ee8d81d3374d7">$work</a>; </div>
<div class="line">    <span class="keyword">private</span> ?User <a class="code hl_variable" href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#a35c45cc33d8d420da794514df59466b7">$user</a> = <span class="keyword">null</span>; </div>
<div class="line"></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> <a id="a10" name="a10"></a><a class="code hl_function" href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#a37da0eda4c359e328dbf967d69a853a1">__construct</a>(array <a class="code hl_variable" href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#ab76f8f2ac851632a23ef69df2bd99dad">$config</a>, Database_Interface <a class="code hl_variable" href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#a18e3eac65d39ced5231d9b3e3630ba75">$db</a>, Work <a class="code hl_variable" href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#aa1464d140ae01b78294ee8d81d3374d7">$work</a>)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (!is_array(<a class="code hl_variable" href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#ab76f8f2ac851632a23ef69df2bd99dad">$config</a>)) {</div>
<div class="line">            <span class="keywordflow">throw</span> new \InvalidArgumentException(</div>
<div class="line">                __FILE__ . <span class="stringliteral">&quot;:&quot;</span> . __LINE__ . <span class="stringliteral">&quot; (&quot;</span> . (__METHOD__ ?: __FUNCTION__ ?: <span class="stringliteral">&#39;global&#39;</span>) . <span class="stringliteral">&quot;) | Неверный тип конфигурации | Ожидался массив, получено: &quot;</span> . gettype(<a class="code hl_variable" href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#ab76f8f2ac851632a23ef69df2bd99dad">$config</a>)</div>
<div class="line">            );</div>
<div class="line">        }</div>
<div class="line">        $this-&gt;config = <a class="code hl_variable" href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#ab76f8f2ac851632a23ef69df2bd99dad">$config</a>;</div>
<div class="line">        $this-&gt;db = <a class="code hl_variable" href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#a18e3eac65d39ced5231d9b3e3630ba75">$db</a>;</div>
<div class="line">        $this-&gt;work = <a class="code hl_variable" href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#aa1464d140ae01b78294ee8d81d3374d7">$work</a>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> <a id="a11" name="a11"></a><a class="code hl_function" href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#a0acd7052f38245fd3723ea29c83bf3f3">__get</a>(<span class="keywordtype">string</span> $name): array</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> ($name === <span class="stringliteral">&#39;config&#39;</span>) {</div>
<div class="line">            <span class="keywordflow">return</span> <a id="a12" name="a12"></a><a class="code hl_variable" href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#ab76f8f2ac851632a23ef69df2bd99dad">$this-&gt;config</a>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">throw</span> new \InvalidArgumentException(</div>
<div class="line">            __FILE__ . <span class="stringliteral">&quot;:&quot;</span> . __LINE__ . <span class="stringliteral">&quot; (&quot;</span> . (__METHOD__ ?: __FUNCTION__ ?: <span class="stringliteral">&#39;global&#39;</span>) . <span class="stringliteral">&quot;) | Свойство не существует | Получено: &#39;{$name}&#39;&quot;</span></div>
<div class="line">        );</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> <a id="a13" name="a13"></a><a class="code hl_function" href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#a7c8aa5e8f1335dd150232b9ba442d694">__set</a>(<span class="keywordtype">string</span> $name, array $value): void</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> ($name === <span class="stringliteral">&#39;config&#39;</span>) {</div>
<div class="line">            $this-&gt;config = $value;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            <span class="keywordflow">throw</span> new \InvalidArgumentException(</div>
<div class="line">                __FILE__ . <span class="stringliteral">&quot;:&quot;</span> . __LINE__ . <span class="stringliteral">&quot; (&quot;</span> . (__METHOD__ ?: __FUNCTION__ ?: <span class="stringliteral">&#39;global&#39;</span>) . <span class="stringliteral">&quot;) | Свойство не может быть установлено | Получено: &#39;{$name}&#39;&quot;</span></div>
<div class="line">            );</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> <a id="a14" name="a14"></a><a class="code hl_function" href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#aaf95d95540a3e47c5905a47db3424ed9">set_lang</a>(array <a class="code hl_variable" href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#a9fd8978d2c6cbdcfdd6be875be161b7b">$lang</a>): void</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (!is_array(<a class="code hl_variable" href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#a9fd8978d2c6cbdcfdd6be875be161b7b">$lang</a>)) {</div>
<div class="line">            <span class="keywordflow">throw</span> new \InvalidArgumentException(</div>
<div class="line">                __FILE__ . <span class="stringliteral">&quot;:&quot;</span> . __LINE__ . <span class="stringliteral">&quot; (&quot;</span> . (__METHOD__ ?: __FUNCTION__ ?: <span class="stringliteral">&#39;global&#39;</span>) . <span class="stringliteral">&quot;) | Неверный тип данных для языковых строк | Ожидался массив, получено: &quot;</span> . gettype(<a class="code hl_variable" href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#a9fd8978d2c6cbdcfdd6be875be161b7b">$lang</a>)</div>
<div class="line">            );</div>
<div class="line">        }</div>
<div class="line">        $this-&gt;lang = <a class="code hl_variable" href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#a9fd8978d2c6cbdcfdd6be875be161b7b">$lang</a>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> <a id="a15" name="a15"></a><a class="code hl_function" href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#ac632034f4e83ba35a7b3e2124829e0c2">set_user</a>(User <a class="code hl_variable" href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#a35c45cc33d8d420da794514df59466b7">$user</a>): void</div>
<div class="line">    {</div>
<div class="line">        $this-&gt;user = <a class="code hl_variable" href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#a35c45cc33d8d420da794514df59466b7">$user</a>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> <a id="a16" name="a16"></a><a class="code hl_function" href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#a4dfb943f9b750ec6e1e2924a9620c7f5">category</a>(<span class="keywordtype">int</span> $cat_id = 0, <span class="keywordtype">int</span> $user_flag = 0): array</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> $this-&gt;<a id="a17" name="a17"></a><a class="code hl_function" href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#af92390a67888a39d1aa0f3f10a045433">_category_internal</a>($cat_id, $user_flag);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> <a id="a18" name="a18"></a><a class="code hl_function" href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#a84a1eeee53079a8e60fea1d1e0d94639">del_photo</a>(<span class="keywordtype">int</span> $photo_id): bool</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> $this-&gt;<a id="a19" name="a19"></a><a class="code hl_function" href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#a818796fb684f095ff90ef5f03a894989">_del_photo_internal</a>($photo_id);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> <a id="a20" name="a20"></a><a class="code hl_function" href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#abfa7c6c53ae460403a3d0b3923e71a90">news</a>(<span class="keywordtype">int</span> $news_id_or_limit, <span class="keywordtype">string</span> $act): array</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> $this-&gt;<a id="a21" name="a21"></a><a class="code hl_function" href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#abfae1b80256c5a8b8addb7770d8939cf">_news_internal</a>($news_id_or_limit, $act);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> <a id="a22" name="a22"></a><a class="code hl_function" href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#a9c2ee4da4bf10547c3aff7296d707c66">get_languages</a>(): array</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> $this-&gt;<a id="a23" name="a23"></a><a class="code hl_function" href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#a35ca0976dc523b429918f6904b8fc4c1">_get_languages_internal</a>();</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> <a id="a24" name="a24"></a><a class="code hl_function" href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#a8d2f43c00af0c9574caa0455df82c613">get_themes</a>(): array</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> $this-&gt;<a id="a25" name="a25"></a><a class="code hl_function" href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#afd6b68f8d6f551886000447b30191b6a">_get_themes_internal</a>();</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> <a id="a26" name="a26"></a><a class="code hl_function" href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#ab90e7e1e6aa1d2c9abe81faed1db03a1">create_photo</a>(<span class="keywordtype">string</span> $type, <span class="keywordtype">int</span> $id_photo): array</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> $this-&gt;<a id="a27" name="a27"></a><a class="code hl_function" href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#a5be64e2d9c6592be321468cd2f947aeb">_create_photo_internal</a>($type, $id_photo);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keyword">protected</span> <span class="keyword">function</span> <a class="code hl_function" href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#af92390a67888a39d1aa0f3f10a045433">_category_internal</a>(<span class="keywordtype">int</span> $cat_id = 0, <span class="keywordtype">int</span> $user_flag = 0): array</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Проверка входных параметров</span></div>
<div class="line">        <span class="keywordflow">if</span> (!is_int($cat_id) || $cat_id &lt; 0) {</div>
<div class="line">            <span class="keywordflow">throw</span> new \InvalidArgumentException(</div>
<div class="line">                __FILE__ . <span class="stringliteral">&quot;:&quot;</span> . __LINE__ . <span class="stringliteral">&quot; (&quot;</span> . (__METHOD__ ?: __FUNCTION__ ?: <span class="stringliteral">&#39;global&#39;</span>) . <span class="stringliteral">&quot;) | Неверное значение параметра \$cat_id | Ожидалось целое положительное число&quot;</span></div>
<div class="line">            );</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (!in_array($user_flag, [0, 1], <span class="keyword">true</span>)) {</div>
<div class="line">            <span class="keywordflow">throw</span> new \InvalidArgumentException(</div>
<div class="line">                __FILE__ . <span class="stringliteral">&quot;:&quot;</span> . __LINE__ . <span class="stringliteral">&quot; (&quot;</span> . (__METHOD__ ?: __FUNCTION__ ?: <span class="stringliteral">&#39;global&#39;</span>) . <span class="stringliteral">&quot;) | Неверное значение параметра \$user_flag | Ожидалось 0 или 1&quot;</span></div>
<div class="line">            );</div>
<div class="line">        }</div>
<div class="line">        <a class="code hl_variable" href="../../de/d8e/namespacePhotoRigma_1_1Action.html#ae68c67c422f1090027f6eb6ba01b62b2">$photo</a> = [];</div>
<div class="line">        $category_data = [];</div>
<div class="line">        $add_query = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line">        <span class="keywordflow">if</span> ($user_flag == 1) {</div>
<div class="line">            <span class="comment">// Получение данных о пользователе и его альбоме</span></div>
<div class="line">            $this-&gt;db-&gt;select([<span class="stringliteral">&#39;id&#39;</span>, <span class="stringliteral">&#39;name&#39;</span>], TBL_CATEGORY, [<span class="stringliteral">&#39;where&#39;</span> =&gt; <span class="stringliteral">&#39;`id` = 0&#39;</span>]);</div>
<div class="line">            $category_data = $this-&gt;db-&gt;res_row();</div>
<div class="line">            <span class="keywordflow">if</span> (!$category_data) {</div>
<div class="line">                <span class="keywordflow">throw</span> new \RuntimeException(</div>
<div class="line">                    __FILE__ . <span class="stringliteral">&quot;:&quot;</span> . __LINE__ . <span class="stringliteral">&quot; (&quot;</span> . (__METHOD__ ?: __FUNCTION__ ?: <span class="stringliteral">&#39;global&#39;</span>) . <span class="stringliteral">&quot;) | Не удалось получить данные о корневой категории | Причина: Отсутствуют данные в таблице &quot;</span> . TBL_CATEGORY</div>
<div class="line">                );</div>
<div class="line">            }</div>
<div class="line">            $this-&gt;db-&gt;select([<span class="stringliteral">&#39;real_name&#39;</span>], TBL_USERS, [<span class="stringliteral">&#39;where&#39;</span> =&gt; <span class="stringliteral">&#39;`id` = :user_id&#39;</span>, <span class="stringliteral">&#39;params&#39;</span> =&gt; [<span class="stringliteral">&#39;:user_id&#39;</span> =&gt; $cat_id]]);</div>
<div class="line">            $user_data = $this-&gt;db-&gt;res_row();</div>
<div class="line">            <span class="keywordflow">if</span> (!$user_data) {</div>
<div class="line">                <span class="keywordflow">throw</span> new \RuntimeException(</div>
<div class="line">                    __FILE__ . <span class="stringliteral">&quot;:&quot;</span> . __LINE__ . <span class="stringliteral">&quot; (&quot;</span> . (__METHOD__ ?: __FUNCTION__ ?: <span class="stringliteral">&#39;global&#39;</span>) . <span class="stringliteral">&quot;) | Не удалось получить данные о пользователе | Переменная \$cat_id = $cat_id&quot;</span></div>
<div class="line">                );</div>
<div class="line">            }</div>
<div class="line">            $add_query = <span class="stringliteral">&#39; AND `user_upload` = :user_id&#39;</span>;</div>
<div class="line">            $category_data[<span class="stringliteral">&#39;description&#39;</span>] = $category_data[<span class="stringliteral">&#39;name&#39;</span>] . <span class="charliteral">&#39; &#39;</span> . <a id="a28" name="a28"></a><a class="code hl_function" href="../../d7/d53/classPhotoRigma_1_1Classes_1_1Work.html#ab73ba07b8376dd2e1764240c73a338ea">Work::clean_field</a>($user_data[<span class="stringliteral">&#39;real_name&#39;</span>]);</div>
<div class="line">            $category_data[<span class="stringliteral">&#39;name&#39;</span>] = <a class="code hl_function" href="../../d7/d53/classPhotoRigma_1_1Classes_1_1Work.html#ab73ba07b8376dd2e1764240c73a338ea">Work::clean_field</a>($user_data[<span class="stringliteral">&#39;real_name&#39;</span>]);</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            <span class="comment">// Получение данных о категории</span></div>
<div class="line">            $this-&gt;db-&gt;select([<span class="stringliteral">&#39;id&#39;</span>, <span class="stringliteral">&#39;name&#39;</span>, <span class="stringliteral">&#39;description&#39;</span>], TBL_CATEGORY, [<span class="stringliteral">&#39;where&#39;</span> =&gt; <span class="stringliteral">&#39;`id` = :cat_id&#39;</span>, <span class="stringliteral">&#39;params&#39;</span> =&gt; [<span class="stringliteral">&#39;:cat_id&#39;</span> =&gt; $cat_id]]);</div>
<div class="line">            $category_data = $this-&gt;db-&gt;res_row();</div>
<div class="line">            <span class="keywordflow">if</span> (!$category_data) {</div>
<div class="line">                <span class="keywordflow">throw</span> new \RuntimeException(</div>
<div class="line">                    __FILE__ . <span class="stringliteral">&quot;:&quot;</span> . __LINE__ . <span class="stringliteral">&quot; (&quot;</span> . (__METHOD__ ?: __FUNCTION__ ?: <span class="stringliteral">&#39;global&#39;</span>) . <span class="stringliteral">&quot;) | Не удалось получить данные о категории | Переменная \$cat_id = $cat_id&quot;</span></div>
<div class="line">                );</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        <span class="comment">// Получение количества фотографий</span></div>
<div class="line">        $this-&gt;db-&gt;select([<span class="stringliteral">&#39;COUNT(*) AS num_photo&#39;</span>], TBL_PHOTO, [</div>
<div class="line">            <span class="stringliteral">&#39;where&#39;</span> =&gt; <span class="stringliteral">&#39;`category` = :cat_id&#39;</span> . $add_query,</div>
<div class="line">            <span class="stringliteral">&#39;params&#39;</span> =&gt; array_merge([<span class="stringliteral">&#39;:cat_id&#39;</span> =&gt; $category_data[<span class="stringliteral">&#39;id&#39;</span>]], $user_flag ? [<span class="stringliteral">&#39;:user_id&#39;</span> =&gt; $cat_id] : [])</div>
<div class="line">        ]);</div>
<div class="line">        $photo_count_data = $this-&gt;db-&gt;res_row();</div>
<div class="line">        <span class="keywordflow">if</span> (!$photo_count_data) {</div>
<div class="line">            <span class="keywordflow">throw</span> new \RuntimeException(</div>
<div class="line">                __FILE__ . <span class="stringliteral">&quot;:&quot;</span> . __LINE__ . <span class="stringliteral">&quot; (&quot;</span> . (__METHOD__ ?: __FUNCTION__ ?: <span class="stringliteral">&#39;global&#39;</span>) . <span class="stringliteral">&quot;) | Не удалось получить количество фотографий для категории | Переменная \$cat_id = $cat_id&quot;</span></div>
<div class="line">            );</div>
<div class="line">        }</div>
<div class="line">        <span class="comment">// Формирование массива $photo</span></div>
<div class="line">        <a class="code hl_variable" href="../../de/d8e/namespacePhotoRigma_1_1Action.html#ae68c67c422f1090027f6eb6ba01b62b2">$photo</a>[<span class="stringliteral">&#39;count&#39;</span>] = $photo_count_data[<span class="stringliteral">&#39;num_photo&#39;</span>];</div>
<div class="line">        <a class="code hl_variable" href="../../de/d8e/namespacePhotoRigma_1_1Action.html#ae68c67c422f1090027f6eb6ba01b62b2">$photo</a>[<span class="stringliteral">&#39;last_name&#39;</span>] = $this-&gt;lang[<span class="stringliteral">&#39;main&#39;</span>][<span class="stringliteral">&#39;no_foto&#39;</span>];</div>
<div class="line">        <a class="code hl_variable" href="../../de/d8e/namespacePhotoRigma_1_1Action.html#ae68c67c422f1090027f6eb6ba01b62b2">$photo</a>[<span class="stringliteral">&#39;last_url&#39;</span>] = sprintf(<span class="stringliteral">&#39;%s?action=photo&amp;amp;id=0&#39;</span>, $this-&gt;config[<span class="stringliteral">&#39;site_url&#39;</span>]);</div>
<div class="line">        <a class="code hl_variable" href="../../de/d8e/namespacePhotoRigma_1_1Action.html#ae68c67c422f1090027f6eb6ba01b62b2">$photo</a>[<span class="stringliteral">&#39;top_name&#39;</span>] = $this-&gt;lang[<span class="stringliteral">&#39;main&#39;</span>][<span class="stringliteral">&#39;no_foto&#39;</span>];</div>
<div class="line">        <a class="code hl_variable" href="../../de/d8e/namespacePhotoRigma_1_1Action.html#ae68c67c422f1090027f6eb6ba01b62b2">$photo</a>[<span class="stringliteral">&#39;top_url&#39;</span>] = sprintf(<span class="stringliteral">&#39;%s?action=photo&amp;amp;id=0&#39;</span>, $this-&gt;config[<span class="stringliteral">&#39;site_url&#39;</span>]);</div>
<div class="line">        <span class="keywordflow">if</span> ($this-&gt;user-&gt;user[<span class="stringliteral">&#39;pic_view&#39;</span>]) {</div>
<div class="line">            <span class="comment">// Получение данных о последней фотографии</span></div>
<div class="line">            $this-&gt;db-&gt;select(</div>
<div class="line">                [<span class="stringliteral">&#39;p.id&#39;</span>, <span class="stringliteral">&#39;p.name&#39;</span>, <span class="stringliteral">&#39;p.description&#39;</span>],</div>
<div class="line">                TBL_PHOTO . <span class="stringliteral">&#39; p&#39;</span>,</div>
<div class="line">                [</div>
<div class="line">                    <span class="stringliteral">&#39;where&#39;</span> =&gt; <span class="stringliteral">&#39;`p.category` = :cat_id&#39;</span> . $add_query,</div>
<div class="line">                    <span class="stringliteral">&#39;order&#39;</span> =&gt; <span class="stringliteral">&#39;p.date_upload DESC&#39;</span>,</div>
<div class="line">                    <span class="stringliteral">&#39;limit&#39;</span> =&gt; 1,</div>
<div class="line">                    <span class="stringliteral">&#39;params&#39;</span> =&gt; array_merge([<span class="stringliteral">&#39;:cat_id&#39;</span> =&gt; $category_data[<span class="stringliteral">&#39;id&#39;</span>]], $user_flag ? [<span class="stringliteral">&#39;:user_id&#39;</span> =&gt; $cat_id] : [])</div>
<div class="line">                ]</div>
<div class="line">            );</div>
<div class="line">            $last_photo_data = $this-&gt;db-&gt;res_row();</div>
<div class="line">            <span class="comment">// Получение данных о лучшей фотографии</span></div>
<div class="line">            $this-&gt;db-&gt;select(</div>
<div class="line">                [<span class="stringliteral">&#39;p.id&#39;</span>, <span class="stringliteral">&#39;p.name&#39;</span>, <span class="stringliteral">&#39;p.description&#39;</span>],</div>
<div class="line">                TBL_PHOTO . <span class="stringliteral">&#39; p&#39;</span>,</div>
<div class="line">                [</div>
<div class="line">                    <span class="stringliteral">&#39;where&#39;</span> =&gt; <span class="stringliteral">&#39;`p.category` = :cat_id&#39;</span> . $add_query . <span class="stringliteral">&#39; AND `p.rate_user` != 0&#39;</span>,</div>
<div class="line">                    <span class="stringliteral">&#39;order&#39;</span> =&gt; <span class="stringliteral">&#39;p.rate_user DESC&#39;</span>,</div>
<div class="line">                    <span class="stringliteral">&#39;limit&#39;</span> =&gt; 1,</div>
<div class="line">                    <span class="stringliteral">&#39;params&#39;</span> =&gt; array_merge([<span class="stringliteral">&#39;:cat_id&#39;</span> =&gt; $category_data[<span class="stringliteral">&#39;id&#39;</span>]], $user_flag ? [<span class="stringliteral">&#39;:user_id&#39;</span> =&gt; $cat_id] : [])</div>
<div class="line">                ]</div>
<div class="line">            );</div>
<div class="line">            $top_photo_data = $this-&gt;db-&gt;res_row();</div>
<div class="line">            <span class="keywordflow">if</span> ($last_photo_data) {</div>
<div class="line">                <a class="code hl_variable" href="../../de/d8e/namespacePhotoRigma_1_1Action.html#ae68c67c422f1090027f6eb6ba01b62b2">$photo</a>[<span class="stringliteral">&#39;last_name&#39;</span>] = sprintf(<span class="stringliteral">&#39;%s (%s)&#39;</span>, <a class="code hl_function" href="../../d7/d53/classPhotoRigma_1_1Classes_1_1Work.html#ab73ba07b8376dd2e1764240c73a338ea">Work::clean_field</a>($last_photo_data[<span class="stringliteral">&#39;name&#39;</span>]), <a class="code hl_function" href="../../d7/d53/classPhotoRigma_1_1Classes_1_1Work.html#ab73ba07b8376dd2e1764240c73a338ea">Work::clean_field</a>($last_photo_data[<span class="stringliteral">&#39;description&#39;</span>]));</div>
<div class="line">                <a class="code hl_variable" href="../../de/d8e/namespacePhotoRigma_1_1Action.html#ae68c67c422f1090027f6eb6ba01b62b2">$photo</a>[<span class="stringliteral">&#39;last_url&#39;</span>] = sprintf(<span class="stringliteral">&#39;%s?action=photo&amp;amp;id=%d&#39;</span>, $this-&gt;config[<span class="stringliteral">&#39;site_url&#39;</span>], $last_photo_data[<span class="stringliteral">&#39;id&#39;</span>]);</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">if</span> ($top_photo_data) {</div>
<div class="line">                <a class="code hl_variable" href="../../de/d8e/namespacePhotoRigma_1_1Action.html#ae68c67c422f1090027f6eb6ba01b62b2">$photo</a>[<span class="stringliteral">&#39;top_name&#39;</span>] = sprintf(<span class="stringliteral">&#39;%s (%s)&#39;</span>, <a class="code hl_function" href="../../d7/d53/classPhotoRigma_1_1Classes_1_1Work.html#ab73ba07b8376dd2e1764240c73a338ea">Work::clean_field</a>($top_photo_data[<span class="stringliteral">&#39;name&#39;</span>]), <a class="code hl_function" href="../../d7/d53/classPhotoRigma_1_1Classes_1_1Work.html#ab73ba07b8376dd2e1764240c73a338ea">Work::clean_field</a>($top_photo_data[<span class="stringliteral">&#39;description&#39;</span>]));</div>
<div class="line">                <a class="code hl_variable" href="../../de/d8e/namespacePhotoRigma_1_1Action.html#ae68c67c422f1090027f6eb6ba01b62b2">$photo</a>[<span class="stringliteral">&#39;top_url&#39;</span>] = sprintf(<span class="stringliteral">&#39;%s?action=photo&amp;amp;id=%d&#39;</span>, $this-&gt;config[<span class="stringliteral">&#39;site_url&#39;</span>], $top_photo_data[<span class="stringliteral">&#39;id&#39;</span>]);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        <span class="comment">// Дополнительная информация для корневой категории</span></div>
<div class="line">        <span class="keywordflow">if</span> ($cat_id == 0) {</div>
<div class="line">            $this-&gt;db-&gt;select([<span class="stringliteral">&#39;COUNT(DISTINCT `user_upload`) AS num_user_upload&#39;</span>], TBL_PHOTO, [<span class="stringliteral">&#39;where&#39;</span> =&gt; <span class="stringliteral">&#39;`category` = 0&#39;</span>]);</div>
<div class="line">            $user_upload_data = $this-&gt;db-&gt;res_row();</div>
<div class="line">            $category_data[<span class="stringliteral">&#39;id&#39;</span>] = <span class="stringliteral">&#39;user&#39;</span>;</div>
<div class="line">            <span class="keywordflow">if</span> ($user_upload_data) {</div>
<div class="line">                $category_data[<span class="stringliteral">&#39;name&#39;</span>] .= sprintf(<span class="stringliteral">&#39; (%s: %d)&#39;</span>, $this-&gt;lang[<span class="stringliteral">&#39;category&#39;</span>][<span class="stringliteral">&#39;count_user_category&#39;</span>], $user_upload_data[<span class="stringliteral">&#39;num_user_upload&#39;</span>]);</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                $category_data[<span class="stringliteral">&#39;name&#39;</span>] .= sprintf(<span class="stringliteral">&#39;&lt;br /&gt;(%s)&#39;</span>, $this-&gt;lang[<span class="stringliteral">&#39;category&#39;</span>][<span class="stringliteral">&#39;no_user_category&#39;</span>]);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> ($user_flag == 1) {</div>
<div class="line">            $category_data[<span class="stringliteral">&#39;id&#39;</span>] = <span class="stringliteral">&#39;user&amp;amp;id=&#39;</span> . $cat_id;</div>
<div class="line">        }</div>
<div class="line">        <span class="comment">// Формирование результирующего массива</span></div>
<div class="line">        $category = [</div>
<div class="line">            <span class="stringliteral">&#39;name&#39;</span>           =&gt; <a class="code hl_function" href="../../d7/d53/classPhotoRigma_1_1Classes_1_1Work.html#ab73ba07b8376dd2e1764240c73a338ea">Work::clean_field</a>($category_data[<span class="stringliteral">&#39;name&#39;</span>]),</div>
<div class="line">            <span class="stringliteral">&#39;description&#39;</span>    =&gt; <a class="code hl_function" href="../../d7/d53/classPhotoRigma_1_1Classes_1_1Work.html#ab73ba07b8376dd2e1764240c73a338ea">Work::clean_field</a>($category_data[<span class="stringliteral">&#39;description&#39;</span>]),</div>
<div class="line">            <span class="stringliteral">&#39;count_photo&#39;</span>    =&gt; <a class="code hl_variable" href="../../de/d8e/namespacePhotoRigma_1_1Action.html#ae68c67c422f1090027f6eb6ba01b62b2">$photo</a>[<span class="stringliteral">&#39;count&#39;</span>],</div>
<div class="line">            <span class="stringliteral">&#39;last_photo&#39;</span>     =&gt; <a class="code hl_variable" href="../../de/d8e/namespacePhotoRigma_1_1Action.html#ae68c67c422f1090027f6eb6ba01b62b2">$photo</a>[<span class="stringliteral">&#39;last_name&#39;</span>],</div>
<div class="line">            <span class="stringliteral">&#39;top_photo&#39;</span>      =&gt; <a class="code hl_variable" href="../../de/d8e/namespacePhotoRigma_1_1Action.html#ae68c67c422f1090027f6eb6ba01b62b2">$photo</a>[<span class="stringliteral">&#39;top_name&#39;</span>],</div>
<div class="line">            <span class="stringliteral">&#39;url_cat&#39;</span>        =&gt; sprintf(<span class="stringliteral">&#39;%s?action=category&amp;amp;cat=%s&#39;</span>, $this-&gt;config[<span class="stringliteral">&#39;site_url&#39;</span>], $category_data[<span class="stringliteral">&#39;id&#39;</span>]),</div>
<div class="line">            <span class="stringliteral">&#39;url_last_photo&#39;</span> =&gt; <a class="code hl_variable" href="../../de/d8e/namespacePhotoRigma_1_1Action.html#ae68c67c422f1090027f6eb6ba01b62b2">$photo</a>[<span class="stringliteral">&#39;last_url&#39;</span>],</div>
<div class="line">            <span class="stringliteral">&#39;url_top_photo&#39;</span>  =&gt; <a class="code hl_variable" href="../../de/d8e/namespacePhotoRigma_1_1Action.html#ae68c67c422f1090027f6eb6ba01b62b2">$photo</a>[<span class="stringliteral">&#39;top_url&#39;</span>]</div>
<div class="line">        ];</div>
<div class="line">        <span class="keywordflow">return</span> $category;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keyword">protected</span> <span class="keyword">function</span> <a class="code hl_function" href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#a818796fb684f095ff90ef5f03a894989">_del_photo_internal</a>(<span class="keywordtype">int</span> $photo_id): bool</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Проверка входного параметра</span></div>
<div class="line">        <span class="keywordflow">if</span> (!is_int($photo_id) || $photo_id &lt;= 0) {</div>
<div class="line">            <span class="keywordflow">throw</span> new \InvalidArgumentException(</div>
<div class="line">                __FILE__ . <span class="stringliteral">&quot;:&quot;</span> . __LINE__ . <span class="stringliteral">&quot; (&quot;</span> . (__METHOD__ ?: __FUNCTION__ ?: <span class="stringliteral">&#39;global&#39;</span>) . <span class="stringliteral">&quot;) | Неверное значение параметра \$photo_id | Ожидалось положительное целое число&quot;</span></div>
<div class="line">            );</div>
<div class="line">        }</div>
<div class="line">        <span class="comment">// Получение данных об изображении и категории через JOIN</span></div>
<div class="line">        $this-&gt;db-&gt;join(</div>
<div class="line">            [<span class="stringliteral">&#39;p.*&#39;</span>, <span class="stringliteral">&#39;c.folder&#39;</span>],</div>
<div class="line">            TBL_PHOTO . <span class="stringliteral">&#39; p&#39;</span>,</div>
<div class="line">            [</div>
<div class="line">                <span class="stringliteral">&#39;table&#39;</span> =&gt; TBL_CATEGORY . <span class="stringliteral">&#39; c&#39;</span>,</div>
<div class="line">                <span class="stringliteral">&#39;on&#39;</span> =&gt; <span class="stringliteral">&#39;p.category = c.id&#39;</span></div>
<div class="line">            ],</div>
<div class="line">            [</div>
<div class="line">                <span class="stringliteral">&#39;where&#39;</span> =&gt; <span class="stringliteral">&#39;p.id = :photo_id&#39;</span>,</div>
<div class="line">                <span class="stringliteral">&#39;params&#39;</span> =&gt; [<span class="stringliteral">&#39;:photo_id&#39;</span> =&gt; $photo_id]</div>
<div class="line">            ]</div>
<div class="line">        );</div>
<div class="line">        $temp_data = $this-&gt;db-&gt;res_row();</div>
<div class="line">        <span class="keywordflow">if</span> (!$temp_data) {</div>
<div class="line">            <span class="keywordflow">throw</span> new \RuntimeException(</div>
<div class="line">                __FILE__ . <span class="stringliteral">&quot;:&quot;</span> . __LINE__ . <span class="stringliteral">&quot; (&quot;</span> . (__METHOD__ ?: __FUNCTION__ ?: <span class="stringliteral">&#39;global&#39;</span>) . <span class="stringliteral">&quot;) | Не удалось найти изображение | Переменная \$photo_id = $photo_id&quot;</span></div>
<div class="line">            );</div>
<div class="line">        }</div>
<div class="line">        <span class="comment">// Определение путей к файлам</span></div>
<div class="line">        $path_thumbnail = $this-&gt;config[<span class="stringliteral">&#39;site_dir&#39;</span>] . $this-&gt;config[<span class="stringliteral">&#39;thumbnail_folder&#39;</span>] . <span class="charliteral">&#39;/&#39;</span> . $temp_data[<span class="stringliteral">&#39;folder&#39;</span>] . <span class="charliteral">&#39;/&#39;</span> . $temp_data[<span class="stringliteral">&#39;file&#39;</span>];</div>
<div class="line">        $path_photo = $this-&gt;config[<span class="stringliteral">&#39;site_dir&#39;</span>] . $this-&gt;config[<span class="stringliteral">&#39;gallery_folder&#39;</span>] . <span class="charliteral">&#39;/&#39;</span> . $temp_data[<span class="stringliteral">&#39;folder&#39;</span>] . <span class="charliteral">&#39;/&#39;</span> . $temp_data[<span class="stringliteral">&#39;file&#39;</span>];</div>
<div class="line">        <span class="comment">// Удаление записи об изображении из таблицы</span></div>
<div class="line">        $this-&gt;db-&gt;delete(TBL_PHOTO, [<span class="stringliteral">&#39;where&#39;</span> =&gt; <span class="stringliteral">&#39;`id` = :photo_id&#39;</span>, <span class="stringliteral">&#39;params&#39;</span> =&gt; [<span class="stringliteral">&#39;:photo_id&#39;</span> =&gt; $photo_id]]);</div>
<div class="line">        <span class="keywordflow">if</span> ($this-&gt;db-&gt;aff_rows !== 1) {</div>
<div class="line">            <span class="keywordflow">throw</span> new \RuntimeException(</div>
<div class="line">                __FILE__ . <span class="stringliteral">&quot;:&quot;</span> . __LINE__ . <span class="stringliteral">&quot; (&quot;</span> . (__METHOD__ ?: __FUNCTION__ ?: <span class="stringliteral">&#39;global&#39;</span>) . <span class="stringliteral">&quot;) | Не удалось удалить запись об изображении | Переменная \$photo_id = $photo_id&quot;</span></div>
<div class="line">            );</div>
<div class="line">        }</div>
<div class="line">        <span class="comment">// Удаление файлов</span></div>
<div class="line">        <span class="keywordflow">if</span> (file_exists($path_thumbnail)) {</div>
<div class="line">            <span class="keywordflow">if</span> (!unlink($path_thumbnail)) {</div>
<div class="line">                <a class="code hl_function" href="../../db/d02/namespacePhotoRigma_1_1Include.html#a2d74c46a21e4ce612a98eee60981aef0">log_in_file</a>(</div>
<div class="line">                    __FILE__ . <span class="stringliteral">&quot;:&quot;</span> . __LINE__ . <span class="stringliteral">&quot; (&quot;</span> . (__METHOD__ ?: __FUNCTION__ ?: <span class="stringliteral">&#39;global&#39;</span>) . <span class="stringliteral">&quot;) | Не удалось удалить файл эскиза | Путь: $path_thumbnail&quot;</span></div>
<div class="line">                );</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (file_exists($path_photo)) {</div>
<div class="line">            <span class="keywordflow">if</span> (!unlink($path_photo)) {</div>
<div class="line">                <a class="code hl_function" href="../../db/d02/namespacePhotoRigma_1_1Include.html#a2d74c46a21e4ce612a98eee60981aef0">log_in_file</a>(</div>
<div class="line">                    __FILE__ . <span class="stringliteral">&quot;:&quot;</span> . __LINE__ . <span class="stringliteral">&quot; (&quot;</span> . (__METHOD__ ?: __FUNCTION__ ?: <span class="stringliteral">&#39;global&#39;</span>) . <span class="stringliteral">&quot;) | Не удалось удалить файл изображения | Путь: $path_photo&quot;</span></div>
<div class="line">                );</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        <span class="comment">// Удаление связанных записей из других таблиц</span></div>
<div class="line">        $this-&gt;db-&gt;delete(TBL_RATE_USER, [<span class="stringliteral">&#39;where&#39;</span> =&gt; <span class="stringliteral">&#39;`id_foto` = :photo_id&#39;</span>, <span class="stringliteral">&#39;params&#39;</span> =&gt; [<span class="stringliteral">&#39;:photo_id&#39;</span> =&gt; $photo_id]]);</div>
<div class="line">        $this-&gt;db-&gt;delete(TBL_RATE_MODER, [<span class="stringliteral">&#39;where&#39;</span> =&gt; <span class="stringliteral">&#39;`id_foto` = :photo_id&#39;</span>, <span class="stringliteral">&#39;params&#39;</span> =&gt; [<span class="stringliteral">&#39;:photo_id&#39;</span> =&gt; $photo_id]]);</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keyword">protected</span> <span class="keyword">function</span> <a class="code hl_function" href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#abfae1b80256c5a8b8addb7770d8939cf">_news_internal</a>(<span class="keywordtype">int</span> $news_id_or_limit, <span class="keywordtype">string</span> $act): array</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Проверка входных данных</span></div>
<div class="line">        <span class="keywordflow">if</span> ($act === <span class="stringliteral">&#39;id&#39;</span>) {</div>
<div class="line">            <span class="keywordflow">if</span> (!filter_var($news_id_or_limit, FILTER_VALIDATE_INT)) {</div>
<div class="line">                <span class="keywordflow">throw</span> new \InvalidArgumentException(</div>
<div class="line">                    __FILE__ . <span class="stringliteral">&quot;:&quot;</span> . __LINE__ . <span class="stringliteral">&quot; (&quot;</span> . (__METHOD__ ?: __FUNCTION__ ?: <span class="stringliteral">&#39;global&#39;</span>) . <span class="stringliteral">&quot;) | Некорректный ID новости | Переменная \$news_id_or_limit = $news_id_or_limit&quot;</span></div>
<div class="line">                );</div>
<div class="line">            }</div>
<div class="line">        } elseif ($act === <span class="stringliteral">&#39;list&#39;</span>) {</div>
<div class="line">            <span class="keywordflow">if</span> ($news_id_or_limit &lt;= 0 || !filter_var($news_id_or_limit, FILTER_VALIDATE_INT)) {</div>
<div class="line">                <span class="keywordflow">throw</span> new \InvalidArgumentException(</div>
<div class="line">                    __FILE__ . <span class="stringliteral">&quot;:&quot;</span> . __LINE__ . <span class="stringliteral">&quot; (&quot;</span> . (__METHOD__ ?: __FUNCTION__ ?: <span class="stringliteral">&#39;global&#39;</span>) . <span class="stringliteral">&quot;) | Некорректное количество новостей | Переменная \$news_id_or_limit = $news_id_or_limit&quot;</span></div>
<div class="line">                );</div>
<div class="line">            }</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            <span class="comment">// Обработка некорректного типа запроса</span></div>
<div class="line">            <span class="keywordflow">throw</span> new \InvalidArgumentException(</div>
<div class="line">                __FILE__ . <span class="stringliteral">&quot;:&quot;</span> . __LINE__ . <span class="stringliteral">&quot; (&quot;</span> . (__METHOD__ ?: __FUNCTION__ ?: <span class="stringliteral">&#39;global&#39;</span>) . <span class="stringliteral">&quot;) | Некорректный тип запроса | Переменная \$act = &#39;$act&#39;&quot;</span></div>
<div class="line">            );</div>
<div class="line">        }</div>
<div class="line">        <span class="comment">// Формирование параметров запроса через match()</span></div>
<div class="line">        $query_params = match ($act) {</div>
<div class="line">            <span class="stringliteral">&#39;id&#39;</span> =&gt; [</div>
<div class="line">                <span class="comment">// Формируем запрос для &#39;id&#39;</span></div>
<div class="line">                <span class="stringliteral">&#39;columns&#39;</span> =&gt; [<span class="stringliteral">&#39;id&#39;</span>, <span class="stringliteral">&#39;title&#39;</span>, <span class="stringliteral">&#39;content&#39;</span>, <span class="stringliteral">&#39;data_last_edit&#39;</span>],</div>
<div class="line">                <span class="stringliteral">&#39;table&#39;</span> =&gt; <a class="code hl_variable" href="../../db/d02/namespacePhotoRigma_1_1Include.html#a26ebc544afff0aad8a2ae5ca6005ed08">TBL_NEWS</a>,</div>
<div class="line">                <span class="stringliteral">&#39;where&#39;</span> =&gt; <span class="stringliteral">&#39;`id` = :id&#39;</span>,</div>
<div class="line">                <span class="stringliteral">&#39;params&#39;</span> =&gt; [<span class="stringliteral">&#39;:id&#39;</span> =&gt; $news_id_or_limit],</div>
<div class="line">            ],</div>
<div class="line">            <span class="stringliteral">&#39;list&#39;</span> =&gt; [</div>
<div class="line">                <span class="comment">// Формируем запрос для &#39;list&#39;</span></div>
<div class="line">                <span class="stringliteral">&#39;columns&#39;</span> =&gt; [<span class="stringliteral">&#39;id&#39;</span>, <span class="stringliteral">&#39;title&#39;</span>, <span class="stringliteral">&#39;content&#39;</span>, <span class="stringliteral">&#39;data_last_edit&#39;</span>],</div>
<div class="line">                <span class="stringliteral">&#39;table&#39;</span> =&gt; <a class="code hl_variable" href="../../db/d02/namespacePhotoRigma_1_1Include.html#a26ebc544afff0aad8a2ae5ca6005ed08">TBL_NEWS</a>,</div>
<div class="line">                <span class="stringliteral">&#39;order_by&#39;</span> =&gt; [<span class="stringliteral">&#39;data_last_edit&#39;</span> =&gt; <span class="stringliteral">&#39;DESC&#39;</span>],</div>
<div class="line">                <span class="stringliteral">&#39;limit&#39;</span> =&gt; $news_id_or_limit,</div>
<div class="line">            ],</div>
<div class="line">        };</div>
<div class="line">        <span class="comment">// Выполняем запрос по результатам match()</span></div>
<div class="line">        $this-&gt;db-&gt;select(</div>
<div class="line">            $query_params[<span class="stringliteral">&#39;columns&#39;</span>],</div>
<div class="line">            $query_params[<span class="stringliteral">&#39;table&#39;</span>],</div>
<div class="line">            array_filter([</div>
<div class="line">                <span class="stringliteral">&#39;where&#39;</span> =&gt; $query_params[<span class="stringliteral">&#39;where&#39;</span>] ?? <span class="keyword">null</span>,</div>
<div class="line">                <span class="stringliteral">&#39;params&#39;</span> =&gt; $query_params[<span class="stringliteral">&#39;params&#39;</span>] ?? [],</div>
<div class="line">                <span class="stringliteral">&#39;order_by&#39;</span> =&gt; $query_params[<span class="stringliteral">&#39;order_by&#39;</span>] ?? <span class="keyword">null</span>,</div>
<div class="line">                <span class="stringliteral">&#39;limit&#39;</span> =&gt; $query_params[<span class="stringliteral">&#39;limit&#39;</span>] ?? <span class="keyword">null</span>,</div>
<div class="line">            ])</div>
<div class="line">        );</div>
<div class="line">        <span class="comment">// Получение результатов</span></div>
<div class="line">        $news_results = $this-&gt;db-&gt;res_arr();</div>
<div class="line">        <span class="keywordflow">if</span> (!$news_results) {</div>
<div class="line">            <span class="keywordflow">throw</span> new \RuntimeException(</div>
<div class="line">                __FILE__ . <span class="stringliteral">&quot;:&quot;</span> . __LINE__ . <span class="stringliteral">&quot; (&quot;</span> . (__METHOD__ ?: __FUNCTION__ ?: <span class="stringliteral">&#39;global&#39;</span>) . <span class="stringliteral">&quot;) | Не удалось получить данные из базы данных | Тип запроса: &#39;$act&#39;&quot;</span></div>
<div class="line">            );</div>
<div class="line">        }</div>
<div class="line">        <span class="comment">// Возврат результата</span></div>
<div class="line">        <span class="keywordflow">return</span> $news_results ?: [];</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keyword">protected</span> <span class="keyword">function</span> <a class="code hl_function" href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#a35ca0976dc523b429918f6904b8fc4c1">_get_languages_internal</a>(): array</div>
<div class="line">    {</div>
<div class="line">        $list_languages = [];</div>
<div class="line">        <span class="comment">// Нормализуем путь к site_dir и проверяем его существование</span></div>
<div class="line">        $site_dir = realpath(rtrim($this-&gt;config[<span class="stringliteral">&#39;site_dir&#39;</span>], <span class="charliteral">&#39;/&#39;</span>));</div>
<div class="line">        $language_dir = $site_dir . <span class="stringliteral">&#39;/language/&#39;</span>;</div>
<div class="line">        <span class="keywordflow">if</span> (!is_dir($language_dir) || !is_readable($language_dir)) {</div>
<div class="line">            <span class="keywordflow">throw</span> new \RuntimeException(</div>
<div class="line">                __FILE__ . <span class="stringliteral">&quot;:&quot;</span> . __LINE__ . <span class="stringliteral">&quot; (&quot;</span> . (__METHOD__ ?: __FUNCTION__ ?: <span class="stringliteral">&#39;global&#39;</span>) . <span class="stringliteral">&quot;) | Директория языков недоступна или не существует | Путь: $language_dir&quot;</span></div>
<div class="line">            );</div>
<div class="line">        }</div>
<div class="line">        <span class="comment">// Проверяем, что директория не пуста</span></div>
<div class="line">        $iterator = new \DirectoryIterator($language_dir);</div>
<div class="line">        $has_subdirs = <span class="keyword">false</span>;</div>
<div class="line">        <span class="keywordflow">foreach</span> ($iterator as $file) {</div>
<div class="line">            <span class="keywordflow">if</span> (!$file-&gt;isDot() &amp;&amp; $file-&gt;isDir()) {</div>
<div class="line">                $has_subdirs = <span class="keyword">true</span>;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (!$has_subdirs) {</div>
<div class="line">            <span class="keywordflow">throw</span> new \RuntimeException(</div>
<div class="line">                __FILE__ . <span class="stringliteral">&quot;:&quot;</span> . __LINE__ . <span class="stringliteral">&quot; (&quot;</span> . (__METHOD__ ?: __FUNCTION__ ?: <span class="stringliteral">&#39;global&#39;</span>) . <span class="stringliteral">&quot;) | Директория языков пуста | Путь: $language_dir&quot;</span></div>
<div class="line">            );</div>
<div class="line">        }</div>
<div class="line">        <span class="comment">// Перебираем поддиректории</span></div>
<div class="line">        <span class="keywordflow">foreach</span> ($iterator as $file) {</div>
<div class="line">            <span class="keywordflow">if</span> ($file-&gt;isDot() || !$file-&gt;isDir()) {</div>
<div class="line">                <span class="keywordflow">continue</span>;</div>
<div class="line">            }</div>
<div class="line">            $lang_subdir = $file-&gt;getPathname();</div>
<div class="line">            <span class="comment">// Проверяем, что директория существует и доступна для чтения</span></div>
<div class="line">            <span class="keywordflow">if</span> (!is_dir($lang_subdir) || !is_readable($lang_subdir)) {</div>
<div class="line">                <a class="code hl_function" href="../../db/d02/namespacePhotoRigma_1_1Include.html#a2d74c46a21e4ce612a98eee60981aef0">log_in_file</a>(</div>
<div class="line">                    __FILE__ . <span class="stringliteral">&quot;:&quot;</span> . __LINE__ . <span class="stringliteral">&quot; (&quot;</span> . (__METHOD__ ?: __FUNCTION__ ?: <span class="stringliteral">&#39;global&#39;</span>) . <span class="stringliteral">&quot;) | Поддиректория языка недоступна для чтения | Директория: $lang_subdir&quot;</span></div>
<div class="line">                );</div>
<div class="line">                <span class="keywordflow">continue</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="comment">// Формируем полный путь к main.php и нормализуем его</span></div>
<div class="line">            $main_php_path = realpath($lang_subdir . <span class="stringliteral">&#39;/main.php&#39;</span>);</div>
<div class="line">            <span class="keywordflow">if</span> ($main_php_path === <span class="keyword">false</span> || !is_file($main_php_path) || !is_readable($main_php_path)) {</div>
<div class="line">                <a class="code hl_function" href="../../db/d02/namespacePhotoRigma_1_1Include.html#a2d74c46a21e4ce612a98eee60981aef0">log_in_file</a>(</div>
<div class="line">                    __FILE__ . <span class="stringliteral">&quot;:&quot;</span> . __LINE__ . <span class="stringliteral">&quot; (&quot;</span> . (__METHOD__ ?: __FUNCTION__ ?: <span class="stringliteral">&#39;global&#39;</span>) . <span class="stringliteral">&quot;) | Файл main.php отсутствует или недоступен | Директория: $lang_subdir&quot;</span></div>
<div class="line">                );</div>
<div class="line">                <span class="keywordflow">continue</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="comment">// Проверяем, что файл находится внутри разрешенной директории</span></div>
<div class="line">            <span class="keywordflow">if</span> (strncmp($main_php_path, $language_dir, strlen($language_dir)) !== 0) {</div>
<div class="line">                <a class="code hl_function" href="../../db/d02/namespacePhotoRigma_1_1Include.html#a2d74c46a21e4ce612a98eee60981aef0">log_in_file</a>(</div>
<div class="line">                    __FILE__ . <span class="stringliteral">&quot;:&quot;</span> . __LINE__ . <span class="stringliteral">&quot; (&quot;</span> . (__METHOD__ ?: __FUNCTION__ ?: <span class="stringliteral">&#39;global&#39;</span>) . <span class="stringliteral">&quot;) | Подозрительный путь к файлу main.php | Директория: $lang_subdir&quot;</span></div>
<div class="line">                );</div>
<div class="line">                <span class="keywordflow">continue</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="comment">// Безопасное подключение файла</span></div>
<div class="line">            <a class="code hl_variable" href="../../dc/d7a/namespacePhotoRigma_1_1Language.html#aaac542e9d3d45bc170bae6775a413a9d">$lang_name</a> = <span class="keyword">null</span>;</div>
<div class="line">            include($main_php_path);</div>
<div class="line">            <span class="keywordflow">if</span> (!is_string($lang_name) || trim($lang_name) === <span class="stringliteral">&#39;&#39;</span>) {</div>
<div class="line">                <a class="code hl_function" href="../../db/d02/namespacePhotoRigma_1_1Include.html#a2d74c46a21e4ce612a98eee60981aef0">log_in_file</a>(</div>
<div class="line">                    __FILE__ . <span class="stringliteral">&quot;:&quot;</span> . __LINE__ . <span class="stringliteral">&quot; (&quot;</span> . (__METHOD__ ?: __FUNCTION__ ?: <span class="stringliteral">&#39;global&#39;</span>) . <span class="stringliteral">&quot;) | Переменная \$lang_name не определена или некорректна | Файл: $main_php_path&quot;</span></div>
<div class="line">                );</div>
<div class="line">                <span class="keywordflow">continue</span>;</div>
<div class="line">            }</div>
<div class="line">            $list_languages[] = [</div>
<div class="line">                <span class="stringliteral">&#39;value&#39;</span> =&gt; $file-&gt;getFilename(),</div>
<div class="line">                <span class="stringliteral">&#39;name&#39;</span> =&gt; mb_trim($lang_name),</div>
<div class="line">            ];</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (empty($list_languages)) {</div>
<div class="line">            <span class="keywordflow">throw</span> new \RuntimeException(</div>
<div class="line">                __FILE__ . <span class="stringliteral">&quot;:&quot;</span> . __LINE__ . <span class="stringliteral">&quot; (&quot;</span> . (__METHOD__ ?: __FUNCTION__ ?: <span class="stringliteral">&#39;global&#39;</span>) . <span class="stringliteral">&quot;) | Ни один язык не найден | Путь: $language_dir&quot;</span></div>
<div class="line">            );</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">return</span> $list_languages;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keyword">protected</span> <span class="keyword">function</span> <a class="code hl_function" href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#afd6b68f8d6f551886000447b30191b6a">_get_themes_internal</a>(): array</div>
<div class="line">    {</div>
<div class="line">        $list_themes = [];</div>
<div class="line">        <span class="comment">// Нормализуем путь к site_dir</span></div>
<div class="line">        $site_dir = realpath(rtrim($this-&gt;config[<span class="stringliteral">&#39;site_dir&#39;</span>], <span class="charliteral">&#39;/&#39;</span>));</div>
<div class="line">        $themes_dir = $site_dir . <span class="stringliteral">&#39;/themes/&#39;</span>;</div>
<div class="line">        <span class="comment">// Проверяем существование и доступность директории /themes/</span></div>
<div class="line">        <span class="keywordflow">if</span> (!is_dir($themes_dir) || !is_readable($themes_dir)) {</div>
<div class="line">            <span class="keywordflow">throw</span> new \RuntimeException(</div>
<div class="line">                __FILE__ . <span class="stringliteral">&quot;:&quot;</span> . __LINE__ . <span class="stringliteral">&quot; (&quot;</span> . (__METHOD__ ?: __FUNCTION__ ?: <span class="stringliteral">&#39;global&#39;</span>) . <span class="stringliteral">&quot;) | Директория тем недоступна | Путь: $themes_dir&quot;</span></div>
<div class="line">            );</div>
<div class="line">        }</div>
<div class="line">        <span class="comment">// Проверяем, что директория не пуста</span></div>
<div class="line">        $iterator = new \DirectoryIterator($themes_dir);</div>
<div class="line">        $has_subdirs = <span class="keyword">false</span>;</div>
<div class="line">        <span class="keywordflow">foreach</span> ($iterator as $file) {</div>
<div class="line">            <span class="keywordflow">if</span> (!$file-&gt;isDot() &amp;&amp; $file-&gt;isDir()) {</div>
<div class="line">                $has_subdirs = <span class="keyword">true</span>;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (!$has_subdirs) {</div>
<div class="line">            <span class="keywordflow">throw</span> new \RuntimeException(</div>
<div class="line">                __FILE__ . <span class="stringliteral">&quot;:&quot;</span> . __LINE__ . <span class="stringliteral">&quot; (&quot;</span> . (__METHOD__ ?: __FUNCTION__ ?: <span class="stringliteral">&#39;global&#39;</span>) . <span class="stringliteral">&quot;) | Директория тем пуста | Путь: $themes_dir&quot;</span></div>
<div class="line">            );</div>
<div class="line">        }</div>
<div class="line">        <span class="comment">// Перебираем поддиректории</span></div>
<div class="line">        <span class="keywordflow">foreach</span> ($iterator as $file) {</div>
<div class="line">            <span class="comment">// Пропускаем точки (.) и файлы</span></div>
<div class="line">            <span class="keywordflow">if</span> ($file-&gt;isDot() || !$file-&gt;isDir()) {</div>
<div class="line">                <span class="keywordflow">continue</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="comment">// Получаем нормализованный путь к поддиректории</span></div>
<div class="line">            $theme_dir = $file-&gt;getRealPath();</div>
<div class="line">            <span class="comment">// Проверяем, что директория доступна для чтения</span></div>
<div class="line">            <span class="keywordflow">if</span> (!is_readable($theme_dir)) {</div>
<div class="line">                <a class="code hl_function" href="../../db/d02/namespacePhotoRigma_1_1Include.html#a2d74c46a21e4ce612a98eee60981aef0">log_in_file</a>(</div>
<div class="line">                    __FILE__ . <span class="stringliteral">&quot;:&quot;</span> . __LINE__ . <span class="stringliteral">&quot; (&quot;</span> . (__METHOD__ ?: __FUNCTION__ ?: <span class="stringliteral">&#39;global&#39;</span>) . <span class="stringliteral">&quot;) | Поддиректория темы недоступна для чтения | Директория: $theme_dir&quot;</span></div>
<div class="line">                );</div>
<div class="line">                <span class="keywordflow">continue</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="comment">// Проверяем, что директория находится внутри $themes_dir</span></div>
<div class="line">            <span class="keywordflow">if</span> (strncmp($theme_dir, $themes_dir, strlen($themes_dir)) !== 0) {</div>
<div class="line">                <a class="code hl_function" href="../../db/d02/namespacePhotoRigma_1_1Include.html#a2d74c46a21e4ce612a98eee60981aef0">log_in_file</a>(</div>
<div class="line">                    __FILE__ . <span class="stringliteral">&quot;:&quot;</span> . __LINE__ . <span class="stringliteral">&quot; (&quot;</span> . (__METHOD__ ?: __FUNCTION__ ?: <span class="stringliteral">&#39;global&#39;</span>) . <span class="stringliteral">&quot;) | Подозрительная директория темы | Директория: $theme_dir&quot;</span></div>
<div class="line">                );</div>
<div class="line">                <span class="keywordflow">continue</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="comment">// Добавляем имя папки в список тем</span></div>
<div class="line">            $list_themes[] = $file-&gt;getFilename();</div>
<div class="line">        }</div>
<div class="line">        <span class="comment">// Если ни одна тема не найдена, выбрасываем исключение</span></div>
<div class="line">        <span class="keywordflow">if</span> (empty($list_themes)) {</div>
<div class="line">            <span class="keywordflow">throw</span> new \RuntimeException(</div>
<div class="line">                __FILE__ . <span class="stringliteral">&quot;:&quot;</span> . __LINE__ . <span class="stringliteral">&quot; (&quot;</span> . (__METHOD__ ?: __FUNCTION__ ?: <span class="stringliteral">&#39;global&#39;</span>) . <span class="stringliteral">&quot;) | Ни одна тема не найдена | Путь: $themes_dir&quot;</span></div>
<div class="line">            );</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">return</span> $list_themes;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keyword">protected</span> <span class="keyword">function</span> <a class="code hl_function" href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#a5be64e2d9c6592be321468cd2f947aeb">_create_photo_internal</a>(<span class="keywordtype">string</span> $type, <span class="keywordtype">int</span> $id_photo): array</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Валидация входных параметров</span></div>
<div class="line">        <span class="keywordflow">if</span> (!in_array($type, [<span class="stringliteral">&#39;top&#39;</span>, <span class="stringliteral">&#39;last&#39;</span>, <span class="stringliteral">&#39;cat&#39;</span>], <span class="keyword">true</span>) &amp;&amp; !is_string($type)) {</div>
<div class="line">            <span class="keywordflow">throw</span> new \InvalidArgumentException(</div>
<div class="line">                __FILE__ . <span class="stringliteral">&quot;:&quot;</span> . __LINE__ . <span class="stringliteral">&quot; (&quot;</span> . (__METHOD__ ?: __FUNCTION__ ?: <span class="stringliteral">&#39;global&#39;</span>) . <span class="stringliteral">&quot;) | Недопустимый тип запроса | Получено: &#39;$type&#39;&quot;</span></div>
<div class="line">            );</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> ($type === <span class="stringliteral">&#39;cat&#39;</span> &amp;&amp; (!is_int($id_photo) || $id_photo &lt;= 0)) {</div>
<div class="line">            <span class="keywordflow">throw</span> new \InvalidArgumentException(</div>
<div class="line">                __FILE__ . <span class="stringliteral">&quot;:&quot;</span> . __LINE__ . <span class="stringliteral">&quot; (&quot;</span> . (__METHOD__ ?: __FUNCTION__ ?: <span class="stringliteral">&#39;global&#39;</span>) . <span class="stringliteral">&quot;) | Недопустимый идентификатор фото для типа &#39;cat&#39; | Переменная \$id_photo = $id_photo&quot;</span></div>
<div class="line">            );</div>
<div class="line">        }</div>
<div class="line">        <span class="comment">// Проверяем права пользователя на просмотр изображений</span></div>
<div class="line">        <span class="keywordflow">if</span> ($this-&gt;user-&gt;user[<span class="stringliteral">&#39;pic_view&#39;</span>] !== <span class="keyword">true</span>) {</div>
<div class="line">            <span class="keywordflow">return</span> $this-&gt;<a id="a29" name="a29"></a><a class="code hl_function" href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#a40ec1fd9d599c07199049eb1df5551b6">generate_photo_data</a>();</div>
<div class="line">        }</div>
<div class="line">        <span class="comment">// Формируем условия для SQL-запроса</span></div>
<div class="line">        $conditions = match ($type) {</div>
<div class="line">            <span class="stringliteral">&#39;top&#39;</span> =&gt; [<span class="stringliteral">&#39;where&#39;</span> =&gt; <span class="stringliteral">&#39;rate_user != :rate&#39;</span>, <span class="stringliteral">&#39;order&#39;</span> =&gt; <span class="stringliteral">&#39;rate_user DESC&#39;</span>, <span class="stringliteral">&#39;params&#39;</span> =&gt; [<span class="stringliteral">&#39;:rate&#39;</span> =&gt; 0]],</div>
<div class="line">            <span class="stringliteral">&#39;last&#39;</span> =&gt; [<span class="stringliteral">&#39;order&#39;</span> =&gt; <span class="stringliteral">&#39;date_upload DESC&#39;</span>],</div>
<div class="line">            <span class="stringliteral">&#39;cat&#39;</span> =&gt; [<span class="stringliteral">&#39;where&#39;</span> =&gt; <span class="stringliteral">&#39;id = :id&#39;</span>, <span class="stringliteral">&#39;params&#39;</span> =&gt; [<span class="stringliteral">&#39;:id&#39;</span> =&gt; $id_photo]],</div>
<div class="line">            <span class="keywordflow">default</span> =&gt; [<span class="stringliteral">&#39;order&#39;</span> =&gt; <span class="stringliteral">&#39;RAND()&#39;</span>],</div>
<div class="line">        };</div>
<div class="line">        $where = $conditions[<span class="stringliteral">&#39;where&#39;</span>] ?? <span class="keyword">null</span>;</div>
<div class="line">        $order = $conditions[<span class="stringliteral">&#39;order&#39;</span>] ?? <span class="keyword">null</span>;</div>
<div class="line">        $params = $conditions[<span class="stringliteral">&#39;params&#39;</span>] ?? [];</div>
<div class="line">        <span class="comment">// Получаем данные изображения и пользователя через JOIN</span></div>
<div class="line">        $this-&gt;db-&gt;join(</div>
<div class="line">            [<span class="stringliteral">&#39;photos.*&#39;</span>, <span class="stringliteral">&#39;users.real_name&#39;</span>, <span class="stringliteral">&#39;categories.id as category_id&#39;</span>, <span class="stringliteral">&#39;categories.name as category_name&#39;</span>, <span class="stringliteral">&#39;categories.folder&#39;</span>],</div>
<div class="line">            TBL_PHOTO,</div>
<div class="line">            [</div>
<div class="line">                [<span class="stringliteral">&#39;type&#39;</span> =&gt; <span class="stringliteral">&#39;LEFT&#39;</span>, <span class="stringliteral">&#39;table&#39;</span> =&gt; TBL_USERS, <span class="stringliteral">&#39;on&#39;</span> =&gt; <span class="stringliteral">&#39;photos.user_upload = users.id&#39;</span>],</div>
<div class="line">                [<span class="stringliteral">&#39;type&#39;</span> =&gt; <span class="stringliteral">&#39;LEFT&#39;</span>, <span class="stringliteral">&#39;table&#39;</span> =&gt; TBL_CATEGORY, <span class="stringliteral">&#39;on&#39;</span> =&gt; <span class="stringliteral">&#39;photos.category = categories.id&#39;</span>],</div>
<div class="line">            ],</div>
<div class="line">            [</div>
<div class="line">                <span class="stringliteral">&#39;where&#39;</span> =&gt; $where,</div>
<div class="line">                <span class="stringliteral">&#39;order&#39;</span> =&gt; $order,</div>
<div class="line">                <span class="stringliteral">&#39;limit&#39;</span> =&gt; 1,</div>
<div class="line">                <span class="stringliteral">&#39;params&#39;</span> =&gt; $params,</div>
<div class="line">            ]</div>
<div class="line">        );</div>
<div class="line">        $photo_data = $this-&gt;db-&gt;res_row();</div>
<div class="line">        <span class="keywordflow">if</span> (!$photo_data) {</div>
<div class="line">            <span class="keywordflow">throw</span> new \RuntimeException(</div>
<div class="line">                __FILE__ . <span class="stringliteral">&quot;:&quot;</span> . __LINE__ . <span class="stringliteral">&quot; (&quot;</span> . (__METHOD__ ?: __FUNCTION__ ?: <span class="stringliteral">&#39;global&#39;</span>) . <span class="stringliteral">&quot;) | Ошибка при выборке данных из таблицы фото | Тип: &#39;$type&#39;&quot;</span></div>
<div class="line">            );</div>
<div class="line">        }</div>
<div class="line">        <span class="comment">// Формируем путь к файлу изображения</span></div>
<div class="line">        $gallery_directory = realpath($this-&gt;config[<span class="stringliteral">&#39;site_dir&#39;</span>] . $this-&gt;config[<span class="stringliteral">&#39;gallery_folder&#39;</span>]);</div>
<div class="line">        $image_path = realpath($this-&gt;config[<span class="stringliteral">&#39;site_dir&#39;</span>] . $this-&gt;config[<span class="stringliteral">&#39;gallery_folder&#39;</span>] . <span class="charliteral">&#39;/&#39;</span> . $photo_data[<span class="stringliteral">&#39;file&#39;</span>]);</div>
<div class="line">        <span class="keywordflow">if</span> (!$image_path || !str_starts_with($image_path, $gallery_directory)) {</div>
<div class="line">            <span class="keywordflow">throw</span> new \RuntimeException(</div>
<div class="line">                __FILE__ . <span class="stringliteral">&quot;:&quot;</span> . __LINE__ . <span class="stringliteral">&quot; (&quot;</span> . (__METHOD__ ?: __FUNCTION__ ?: <span class="stringliteral">&#39;global&#39;</span>) . <span class="stringliteral">&quot;) | Запрещенный доступ к файлу | Путь: &#39;$image_path&#39;&quot;</span></div>
<div class="line">            );</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (!file_exists($image_path) || !is_readable($image_path)) {</div>
<div class="line">            <a class="code hl_function" href="../../db/d02/namespacePhotoRigma_1_1Include.html#a2d74c46a21e4ce612a98eee60981aef0">log_in_file</a>(</div>
<div class="line">                __FILE__ . <span class="stringliteral">&quot;:&quot;</span> . __LINE__ . <span class="stringliteral">&quot; (&quot;</span> . (__METHOD__ ?: __FUNCTION__ ?: <span class="stringliteral">&#39;global&#39;</span>) . <span class="stringliteral">&quot;) | Файл изображения недоступен или не существует | Путь: &#39;$image_path&#39; | Тип: &#39;$type&#39;&quot;</span></div>
<div class="line">            );</div>
<div class="line">            <span class="keywordflow">return</span> $this-&gt;<a class="code hl_function" href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#a40ec1fd9d599c07199049eb1df5551b6">generate_photo_data</a>();</div>
<div class="line">        }</div>
<div class="line">        <span class="comment">// Вычисляем размеры изображения</span></div>
<div class="line">        $image_size = $this-&gt;work-&gt;size_image($image_path);</div>
<div class="line">        <span class="comment">// Наполняем массив данными для вывода изображения</span></div>
<div class="line">        $photo_data = [</div>
<div class="line">            <span class="stringliteral">&#39;url&#39;</span> =&gt; sprintf(<span class="stringliteral">&#39;%s?action=photo&amp;amp;id=%d&#39;</span>, $this-&gt;config[<span class="stringliteral">&#39;site_url&#39;</span>], $photo_data[<span class="stringliteral">&#39;id&#39;</span>]),</div>
<div class="line">            <span class="stringliteral">&#39;thumbnail_url&#39;</span> =&gt; sprintf(<span class="stringliteral">&#39;%s?action=attach&amp;amp;foto=%d&amp;amp;thumbnail=1&#39;</span>, $this-&gt;config[<span class="stringliteral">&#39;site_url&#39;</span>], $photo_data[<span class="stringliteral">&#39;id&#39;</span>]),</div>
<div class="line">            <span class="stringliteral">&#39;name&#39;</span> =&gt; <a class="code hl_function" href="../../d7/d53/classPhotoRigma_1_1Classes_1_1Work.html#ab73ba07b8376dd2e1764240c73a338ea">Work::clean_field</a>($photo_data[<span class="stringliteral">&#39;name&#39;</span>]),</div>
<div class="line">            <span class="stringliteral">&#39;category_name&#39;</span> =&gt; $photo_data[<span class="stringliteral">&#39;category_name&#39;</span>]</div>
<div class="line">                ? <a class="code hl_function" href="../../d7/d53/classPhotoRigma_1_1Classes_1_1Work.html#ab73ba07b8376dd2e1764240c73a338ea">Work::clean_field</a>($photo_data[<span class="stringliteral">&#39;category_name&#39;</span>])</div>
<div class="line">                : $this-&gt;lang[<span class="stringliteral">&#39;main&#39;</span>][<span class="stringliteral">&#39;no_category&#39;</span>],</div>
<div class="line">            <span class="stringliteral">&#39;description&#39;</span> =&gt; Work::clean_field($photo_data[<span class="stringliteral">&#39;description&#39;</span>]),</div>
<div class="line">            <span class="stringliteral">&#39;category_description&#39;</span> =&gt; $photo_data[<span class="stringliteral">&#39;category_name&#39;</span>]</div>
<div class="line">                ? Work::clean_field($photo_data[<span class="stringliteral">&#39;category_name&#39;</span>])</div>
<div class="line">                : $this-&gt;lang[<span class="stringliteral">&#39;main&#39;</span>][<span class="stringliteral">&#39;no_category&#39;</span>],</div>
<div class="line">            <span class="stringliteral">&#39;rate&#39;</span> =&gt; $this-&gt;lang[<span class="stringliteral">&#39;main&#39;</span>][<span class="stringliteral">&#39;rate&#39;</span>] . <span class="stringliteral">&#39;: &#39;</span> . $photo_data[<span class="stringliteral">&#39;rate_user&#39;</span>] . <span class="stringliteral">&#39;/&#39;</span> . $photo_data[<span class="stringliteral">&#39;rate_moder&#39;</span>],</div>
<div class="line">            <span class="stringliteral">&#39;url_user&#39;</span> =&gt; $photo_data[<span class="stringliteral">&#39;real_name&#39;</span>]</div>
<div class="line">                ? sprintf(<span class="stringliteral">&#39;%s?action=profile&amp;amp;subact=profile&amp;amp;uid=%d&#39;</span>, $this-&gt;config[<span class="stringliteral">&#39;site_url&#39;</span>], $photo_data[<span class="stringliteral">&#39;user_upload&#39;</span>])</div>
<div class="line">                : null,</div>
<div class="line">            <span class="stringliteral">&#39;real_name&#39;</span> =&gt; $photo_data[<span class="stringliteral">&#39;real_name&#39;</span>]</div>
<div class="line">                ? Work::clean_field($photo_data[<span class="stringliteral">&#39;real_name&#39;</span>])</div>
<div class="line">                : $this-&gt;lang[<span class="stringliteral">&#39;main&#39;</span>][<span class="stringliteral">&#39;no_user_add&#39;</span>],</div>
<div class="line">            <span class="stringliteral">&#39;width&#39;</span> =&gt; $image_size[<span class="stringliteral">&#39;width&#39;</span>],</div>
<div class="line">            <span class="stringliteral">&#39;height&#39;</span> =&gt; $image_size[<span class="stringliteral">&#39;height&#39;</span>],</div>
<div class="line">            <span class="stringliteral">&#39;name_block&#39;</span> =&gt; $this-&gt;lang[<span class="stringliteral">&#39;main&#39;</span>][$type . <span class="stringliteral">&#39;_foto&#39;</span>] ?? $this-&gt;lang[<span class="stringliteral">&#39;main&#39;</span>][<span class="stringliteral">&#39;no_foto&#39;</span>],</div>
<div class="line">            <span class="stringliteral">&#39;category_url&#39;</span> =&gt; $photo_data[<span class="stringliteral">&#39;category_id&#39;</span>] == 0</div>
<div class="line">                ? sprintf(<span class="stringliteral">&#39;%s?action=category&amp;amp;cat=user&amp;amp;id=%d&#39;</span>, $this-&gt;config[<span class="stringliteral">&#39;site_url&#39;</span>], $photo_data[<span class="stringliteral">&#39;user_upload&#39;</span>])</div>
<div class="line">                : sprintf(<span class="stringliteral">&#39;%s?action=category&amp;amp;cat=%d&#39;</span>, $this-&gt;config[<span class="stringliteral">&#39;site_url&#39;</span>], $photo_data[<span class="stringliteral">&#39;category_id&#39;</span>]),</div>
<div class="line">        ];</div>
<div class="line">        <span class="comment">// Возвращаем результат через generate_photo_data()</span></div>
<div class="line">        <span class="keywordflow">return</span> $this-&gt;<a class="code hl_function" href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#a40ec1fd9d599c07199049eb1df5551b6">generate_photo_data</a>($photo_data);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keyword">private</span> <span class="keyword">function</span> <a class="code hl_function" href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#a40ec1fd9d599c07199049eb1df5551b6">generate_photo_data</a>(array $photo_data = []): array</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Значения по умолчанию</span></div>
<div class="line">        $defaults = [</div>
<div class="line">            <span class="stringliteral">&#39;url&#39;</span> =&gt; sprintf(<span class="stringliteral">&#39;%s?action=photo&amp;amp;id=0&#39;</span>, $this-&gt;config[<span class="stringliteral">&#39;site_url&#39;</span>]),</div>
<div class="line">            <span class="stringliteral">&#39;thumbnail_url&#39;</span> =&gt; sprintf(<span class="stringliteral">&#39;%s?action=attach&amp;amp;foto=0&amp;amp;thumbnail=1&#39;</span>, $this-&gt;config[<span class="stringliteral">&#39;site_url&#39;</span>]),</div>
<div class="line">            <span class="stringliteral">&#39;name&#39;</span> =&gt; $this-&gt;lang[<span class="stringliteral">&#39;main&#39;</span>][<span class="stringliteral">&#39;no_foto&#39;</span>],</div>
<div class="line">            <span class="stringliteral">&#39;description&#39;</span> =&gt; $this-&gt;lang[<span class="stringliteral">&#39;main&#39;</span>][<span class="stringliteral">&#39;no_foto&#39;</span>],</div>
<div class="line">            <span class="stringliteral">&#39;category_name&#39;</span> =&gt; $this-&gt;lang[<span class="stringliteral">&#39;main&#39;</span>][<span class="stringliteral">&#39;no_category&#39;</span>],</div>
<div class="line">            <span class="stringliteral">&#39;category_description&#39;</span> =&gt; $this-&gt;lang[<span class="stringliteral">&#39;main&#39;</span>][<span class="stringliteral">&#39;no_category&#39;</span>],</div>
<div class="line">            <span class="stringliteral">&#39;rate&#39;</span> =&gt; $this-&gt;lang[<span class="stringliteral">&#39;main&#39;</span>][<span class="stringliteral">&#39;rate&#39;</span>] . <span class="stringliteral">&#39;: 0/0&#39;</span>,</div>
<div class="line">            <span class="stringliteral">&#39;url_user&#39;</span> =&gt; <span class="keyword">null</span>,</div>
<div class="line">            <span class="stringliteral">&#39;real_name&#39;</span> =&gt; $this-&gt;lang[<span class="stringliteral">&#39;main&#39;</span>][<span class="stringliteral">&#39;no_user_add&#39;</span>],</div>
<div class="line">        ];</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Формируем массив данных, используя значения из $photo_data или значения по умолчанию</span></div>
<div class="line">        <a class="code hl_variable" href="../../de/d8e/namespacePhotoRigma_1_1Action.html#ae68c67c422f1090027f6eb6ba01b62b2">$photo</a> = [];</div>
<div class="line">        <span class="keywordflow">foreach</span> ($defaults as $key =&gt; $default_value) {</div>
<div class="line">            <a class="code hl_variable" href="../../de/d8e/namespacePhotoRigma_1_1Action.html#ae68c67c422f1090027f6eb6ba01b62b2">$photo</a>[$key] = $photo_data[$key] ?? $default_value;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> <a class="code hl_variable" href="../../de/d8e/namespacePhotoRigma_1_1Action.html#ae68c67c422f1090027f6eb6ba01b62b2">$photo</a>;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="aclassPhotoRigma_1_1Classes_1_1Work__CoreLogic_html"><div class="ttname"><a href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html">PhotoRigma\Classes\Work_CoreLogic</a></div><div class="ttdoc">Класс, реализующий интерфейс Work_CoreLogic_Interface для выполнения базовой логики приложения.</div><div class="ttdef"><b>Определения</b> <a href="../../dd/d79/work__corelogic_8php_source.html#l00181">work_corelogic.php:182</a></div></div>
<div class="ttc" id="aclassPhotoRigma_1_1Classes_1_1Work__CoreLogic_html_a0acd7052f38245fd3723ea29c83bf3f3"><div class="ttname"><a href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#a0acd7052f38245fd3723ea29c83bf3f3">PhotoRigma\Classes\Work_CoreLogic\__get</a></div><div class="ttdeci">__get(string $name)</div><div class="ttdef"><b>Определения</b> <a href="../../dd/d79/work__corelogic_8php_source.html#l00265">work_corelogic.php:265</a></div></div>
<div class="ttc" id="aclassPhotoRigma_1_1Classes_1_1Work__CoreLogic_html_a18e3eac65d39ced5231d9b3e3630ba75"><div class="ttname"><a href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#a18e3eac65d39ced5231d9b3e3630ba75">PhotoRigma\Classes\Work_CoreLogic\$db</a></div><div class="ttdeci">Database_Interface $db</div><div class="ttdoc">Объект для работы с базой данных (обязательный).</div><div class="ttdef"><b>Определения</b> <a href="../../dd/d79/work__corelogic_8php_source.html#l00185">work_corelogic.php:185</a></div></div>
<div class="ttc" id="aclassPhotoRigma_1_1Classes_1_1Work__CoreLogic_html_a35c45cc33d8d420da794514df59466b7"><div class="ttname"><a href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#a35c45cc33d8d420da794514df59466b7">PhotoRigma\Classes\Work_CoreLogic\$user</a></div><div class="ttdeci">User $user</div><div class="ttdoc">Объект пользователя (может быть null при инициализации).</div><div class="ttdef"><b>Определения</b> <a href="../../dd/d79/work__corelogic_8php_source.html#l00187">work_corelogic.php:187</a></div></div>
<div class="ttc" id="aclassPhotoRigma_1_1Classes_1_1Work__CoreLogic_html_a35ca0976dc523b429918f6904b8fc4c1"><div class="ttname"><a href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#a35ca0976dc523b429918f6904b8fc4c1">PhotoRigma\Classes\Work_CoreLogic\_get_languages_internal</a></div><div class="ttdeci">_get_languages_internal()</div><div class="ttdef"><b>Определения</b> <a href="../../dd/d79/work__corelogic_8php_source.html#l00932">work_corelogic.php:932</a></div></div>
<div class="ttc" id="aclassPhotoRigma_1_1Classes_1_1Work__CoreLogic_html_a37da0eda4c359e328dbf967d69a853a1"><div class="ttname"><a href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#a37da0eda4c359e328dbf967d69a853a1">PhotoRigma\Classes\Work_CoreLogic\__construct</a></div><div class="ttdeci">__construct(array $config, Database_Interface $db, Work $work)</div><div class="ttdef"><b>Определения</b> <a href="../../dd/d79/work__corelogic_8php_source.html#l00223">work_corelogic.php:223</a></div></div>
<div class="ttc" id="aclassPhotoRigma_1_1Classes_1_1Work__CoreLogic_html_a40ec1fd9d599c07199049eb1df5551b6"><div class="ttname"><a href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#a40ec1fd9d599c07199049eb1df5551b6">PhotoRigma\Classes\Work_CoreLogic\generate_photo_data</a></div><div class="ttdeci">generate_photo_data(array $photo_data=[])</div><div class="ttdef"><b>Определения</b> <a href="../../dd/d79/work__corelogic_8php_source.html#l01287">work_corelogic.php:1287</a></div></div>
<div class="ttc" id="aclassPhotoRigma_1_1Classes_1_1Work__CoreLogic_html_a4dfb943f9b750ec6e1e2924a9620c7f5"><div class="ttname"><a href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#a4dfb943f9b750ec6e1e2924a9620c7f5">PhotoRigma\Classes\Work_CoreLogic\category</a></div><div class="ttdeci">category(int $cat_id=0, int $user_flag=0)</div><div class="ttdoc">Формирует информационную строку для конкретного раздела или пользовательского альбома.</div><div class="ttdef"><b>Определения</b> <a href="../../dd/d79/work__corelogic_8php_source.html#l00416">work_corelogic.php:416</a></div></div>
<div class="ttc" id="aclassPhotoRigma_1_1Classes_1_1Work__CoreLogic_html_a5be64e2d9c6592be321468cd2f947aeb"><div class="ttname"><a href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#a5be64e2d9c6592be321468cd2f947aeb">PhotoRigma\Classes\Work_CoreLogic\_create_photo_internal</a></div><div class="ttdeci">_create_photo_internal(string $type, int $id_photo)</div><div class="ttdef"><b>Определения</b> <a href="../../dd/d79/work__corelogic_8php_source.html#l01136">work_corelogic.php:1136</a></div></div>
<div class="ttc" id="aclassPhotoRigma_1_1Classes_1_1Work__CoreLogic_html_a7c8aa5e8f1335dd150232b9ba442d694"><div class="ttname"><a href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#a7c8aa5e8f1335dd150232b9ba442d694">PhotoRigma\Classes\Work_CoreLogic\__set</a></div><div class="ttdeci">__set(string $name, array $value)</div><div class="ttdef"><b>Определения</b> <a href="../../dd/d79/work__corelogic_8php_source.html#l00304">work_corelogic.php:304</a></div></div>
<div class="ttc" id="aclassPhotoRigma_1_1Classes_1_1Work__CoreLogic_html_a818796fb684f095ff90ef5f03a894989"><div class="ttname"><a href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#a818796fb684f095ff90ef5f03a894989">PhotoRigma\Classes\Work_CoreLogic\_del_photo_internal</a></div><div class="ttdeci">_del_photo_internal(int $photo_id)</div><div class="ttdoc">Удаляет изображение с указанным идентификатором, а также все упоминания об этом изображении в таблица...</div><div class="ttdef"><b>Определения</b> <a href="../../dd/d79/work__corelogic_8php_source.html#l00754">work_corelogic.php:754</a></div></div>
<div class="ttc" id="aclassPhotoRigma_1_1Classes_1_1Work__CoreLogic_html_a84a1eeee53079a8e60fea1d1e0d94639"><div class="ttname"><a href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#a84a1eeee53079a8e60fea1d1e0d94639">PhotoRigma\Classes\Work_CoreLogic\del_photo</a></div><div class="ttdeci">del_photo(int $photo_id)</div><div class="ttdoc">Удаляет изображение с указанным идентификатором, а также все упоминания об этом изображении в таблица...</div><div class="ttdef"><b>Определения</b> <a href="../../dd/d79/work__corelogic_8php_source.html#l00437">work_corelogic.php:437</a></div></div>
<div class="ttc" id="aclassPhotoRigma_1_1Classes_1_1Work__CoreLogic_html_a8d2f43c00af0c9574caa0455df82c613"><div class="ttname"><a href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#a8d2f43c00af0c9574caa0455df82c613">PhotoRigma\Classes\Work_CoreLogic\get_themes</a></div><div class="ttdeci">get_themes()</div><div class="ttdef"><b>Определения</b> <a href="../../dd/d79/work__corelogic_8php_source.html#l00527">work_corelogic.php:527</a></div></div>
<div class="ttc" id="aclassPhotoRigma_1_1Classes_1_1Work__CoreLogic_html_a9c2ee4da4bf10547c3aff7296d707c66"><div class="ttname"><a href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#a9c2ee4da4bf10547c3aff7296d707c66">PhotoRigma\Classes\Work_CoreLogic\get_languages</a></div><div class="ttdeci">get_languages()</div><div class="ttdef"><b>Определения</b> <a href="../../dd/d79/work__corelogic_8php_source.html#l00505">work_corelogic.php:505</a></div></div>
<div class="ttc" id="aclassPhotoRigma_1_1Classes_1_1Work__CoreLogic_html_a9fd8978d2c6cbdcfdd6be875be161b7b"><div class="ttname"><a href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#a9fd8978d2c6cbdcfdd6be875be161b7b">PhotoRigma\Classes\Work_CoreLogic\$lang</a></div><div class="ttdeci">array $lang</div><div class="ttdoc">Языковые данные (могут быть null при инициализации).</div><div class="ttdef"><b>Определения</b> <a href="../../dd/d79/work__corelogic_8php_source.html#l00184">work_corelogic.php:184</a></div></div>
<div class="ttc" id="aclassPhotoRigma_1_1Classes_1_1Work__CoreLogic_html_aa1464d140ae01b78294ee8d81d3374d7"><div class="ttname"><a href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#aa1464d140ae01b78294ee8d81d3374d7">PhotoRigma\Classes\Work_CoreLogic\$work</a></div><div class="ttdeci">Work $work</div><div class="ttdoc">Основной объект приложения (обязательный).</div><div class="ttdef"><b>Определения</b> <a href="../../dd/d79/work__corelogic_8php_source.html#l00186">work_corelogic.php:186</a></div></div>
<div class="ttc" id="aclassPhotoRigma_1_1Classes_1_1Work__CoreLogic_html_aaf95d95540a3e47c5905a47db3424ed9"><div class="ttname"><a href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#aaf95d95540a3e47c5905a47db3424ed9">PhotoRigma\Classes\Work_CoreLogic\set_lang</a></div><div class="ttdeci">set_lang(array $lang)</div><div class="ttdef"><b>Определения</b> <a href="../../dd/d79/work__corelogic_8php_source.html#l00345">work_corelogic.php:345</a></div></div>
<div class="ttc" id="aclassPhotoRigma_1_1Classes_1_1Work__CoreLogic_html_ab76f8f2ac851632a23ef69df2bd99dad"><div class="ttname"><a href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#ab76f8f2ac851632a23ef69df2bd99dad">PhotoRigma\Classes\Work_CoreLogic\$config</a></div><div class="ttdeci">array $config</div><div class="ttdoc">Конфигурация приложения.</div><div class="ttdef"><b>Определения</b> <a href="../../dd/d79/work__corelogic_8php_source.html#l00183">work_corelogic.php:183</a></div></div>
<div class="ttc" id="aclassPhotoRigma_1_1Classes_1_1Work__CoreLogic_html_ab90e7e1e6aa1d2c9abe81faed1db03a1"><div class="ttname"><a href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#ab90e7e1e6aa1d2c9abe81faed1db03a1">PhotoRigma\Classes\Work_CoreLogic\create_photo</a></div><div class="ttdeci">create_photo(string $type, int $id_photo)</div><div class="ttdef"><b>Определения</b> <a href="../../dd/d79/work__corelogic_8php_source.html#l00575">work_corelogic.php:575</a></div></div>
<div class="ttc" id="aclassPhotoRigma_1_1Classes_1_1Work__CoreLogic_html_abfa7c6c53ae460403a3d0b3923e71a90"><div class="ttname"><a href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#abfa7c6c53ae460403a3d0b3923e71a90">PhotoRigma\Classes\Work_CoreLogic\news</a></div><div class="ttdeci">news(int $news_id_or_limit, string $act)</div><div class="ttdef"><b>Определения</b> <a href="../../dd/d79/work__corelogic_8php_source.html#l00471">work_corelogic.php:471</a></div></div>
<div class="ttc" id="aclassPhotoRigma_1_1Classes_1_1Work__CoreLogic_html_abfae1b80256c5a8b8addb7770d8939cf"><div class="ttname"><a href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#abfae1b80256c5a8b8addb7770d8939cf">PhotoRigma\Classes\Work_CoreLogic\_news_internal</a></div><div class="ttdeci">_news_internal(int $news_id_or_limit, string $act)</div><div class="ttdef"><b>Определения</b> <a href="../../dd/d79/work__corelogic_8php_source.html#l00841">work_corelogic.php:841</a></div></div>
<div class="ttc" id="aclassPhotoRigma_1_1Classes_1_1Work__CoreLogic_html_ac632034f4e83ba35a7b3e2124829e0c2"><div class="ttname"><a href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#ac632034f4e83ba35a7b3e2124829e0c2">PhotoRigma\Classes\Work_CoreLogic\set_user</a></div><div class="ttdeci">set_user(User $user)</div><div class="ttdef"><b>Определения</b> <a href="../../dd/d79/work__corelogic_8php_source.html#l00385">work_corelogic.php:385</a></div></div>
<div class="ttc" id="aclassPhotoRigma_1_1Classes_1_1Work__CoreLogic_html_af92390a67888a39d1aa0f3f10a045433"><div class="ttname"><a href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#af92390a67888a39d1aa0f3f10a045433">PhotoRigma\Classes\Work_CoreLogic\_category_internal</a></div><div class="ttdeci">_category_internal(int $cat_id=0, int $user_flag=0)</div><div class="ttdoc">Формирует информационную строку для конкретного раздела или пользовательского альбома.</div><div class="ttdef"><b>Определения</b> <a href="../../dd/d79/work__corelogic_8php_source.html#l00609">work_corelogic.php:609</a></div></div>
<div class="ttc" id="aclassPhotoRigma_1_1Classes_1_1Work__CoreLogic_html_afd6b68f8d6f551886000447b30191b6a"><div class="ttname"><a href="../../d9/da8/classPhotoRigma_1_1Classes_1_1Work__CoreLogic.html#afd6b68f8d6f551886000447b30191b6a">PhotoRigma\Classes\Work_CoreLogic\_get_themes_internal</a></div><div class="ttdeci">_get_themes_internal()</div><div class="ttdef"><b>Определения</b> <a href="../../dd/d79/work__corelogic_8php_source.html#l01026">work_corelogic.php:1026</a></div></div>
<div class="ttc" id="aclassPhotoRigma_1_1Classes_1_1Work_html_ab73ba07b8376dd2e1764240c73a338ea"><div class="ttname"><a href="../../d7/d53/classPhotoRigma_1_1Classes_1_1Work.html#ab73ba07b8376dd2e1764240c73a338ea">PhotoRigma\Classes\Work\clean_field</a></div><div class="ttdeci">static clean_field($field)</div><div class="ttdef"><b>Определения</b> <a href="../../dc/d7a/work_8php_source.html#l00875">work.php:875</a></div></div>
<div class="ttc" id="ainterfacePhotoRigma_1_1Classes_1_1Work__CoreLogic__Interface_html"><div class="ttname"><a href="../../d0/d91/interfacePhotoRigma_1_1Classes_1_1Work__CoreLogic__Interface.html">PhotoRigma\Classes\Work_CoreLogic_Interface</a></div><div class="ttdoc">Интерфейс, определяющий контракт для классов, реализующих базовую логику приложения.</div><div class="ttdef"><b>Определения</b> <a href="../../dd/d79/work__corelogic_8php_source.html#l00060">work_corelogic.php:61</a></div></div>
<div class="ttc" id="ainterfacePhotoRigma_1_1Classes_1_1Work__CoreLogic__Interface_html_a4dfb943f9b750ec6e1e2924a9620c7f5"><div class="ttname"><a href="../../d0/d91/interfacePhotoRigma_1_1Classes_1_1Work__CoreLogic__Interface.html#a4dfb943f9b750ec6e1e2924a9620c7f5">PhotoRigma\Classes\Work_CoreLogic_Interface\category</a></div><div class="ttdeci">category(int $cat_id=0, int $user_flag=0)</div></div>
<div class="ttc" id="ainterfacePhotoRigma_1_1Classes_1_1Work__CoreLogic__Interface_html_a84a1eeee53079a8e60fea1d1e0d94639"><div class="ttname"><a href="../../d0/d91/interfacePhotoRigma_1_1Classes_1_1Work__CoreLogic__Interface.html#a84a1eeee53079a8e60fea1d1e0d94639">PhotoRigma\Classes\Work_CoreLogic_Interface\del_photo</a></div><div class="ttdeci">del_photo(int $photo_id)</div></div>
<div class="ttc" id="ainterfacePhotoRigma_1_1Classes_1_1Work__CoreLogic__Interface_html_a8d2f43c00af0c9574caa0455df82c613"><div class="ttname"><a href="../../d0/d91/interfacePhotoRigma_1_1Classes_1_1Work__CoreLogic__Interface.html#a8d2f43c00af0c9574caa0455df82c613">PhotoRigma\Classes\Work_CoreLogic_Interface\get_themes</a></div><div class="ttdeci">get_themes()</div></div>
<div class="ttc" id="ainterfacePhotoRigma_1_1Classes_1_1Work__CoreLogic__Interface_html_a9c2ee4da4bf10547c3aff7296d707c66"><div class="ttname"><a href="../../d0/d91/interfacePhotoRigma_1_1Classes_1_1Work__CoreLogic__Interface.html#a9c2ee4da4bf10547c3aff7296d707c66">PhotoRigma\Classes\Work_CoreLogic_Interface\get_languages</a></div><div class="ttdeci">get_languages()</div></div>
<div class="ttc" id="ainterfacePhotoRigma_1_1Classes_1_1Work__CoreLogic__Interface_html_ab90e7e1e6aa1d2c9abe81faed1db03a1"><div class="ttname"><a href="../../d0/d91/interfacePhotoRigma_1_1Classes_1_1Work__CoreLogic__Interface.html#ab90e7e1e6aa1d2c9abe81faed1db03a1">PhotoRigma\Classes\Work_CoreLogic_Interface\create_photo</a></div><div class="ttdeci">create_photo(string $type, int $id_photo)</div></div>
<div class="ttc" id="ainterfacePhotoRigma_1_1Classes_1_1Work__CoreLogic__Interface_html_abfa7c6c53ae460403a3d0b3923e71a90"><div class="ttname"><a href="../../d0/d91/interfacePhotoRigma_1_1Classes_1_1Work__CoreLogic__Interface.html#abfa7c6c53ae460403a3d0b3923e71a90">PhotoRigma\Classes\Work_CoreLogic_Interface\news</a></div><div class="ttdeci">news(int $news_id_or_limit, string $act)</div></div>
<div class="ttc" id="anamespacePhotoRigma_1_1Action_html_ae68c67c422f1090027f6eb6ba01b62b2"><div class="ttname"><a href="../../de/d8e/namespacePhotoRigma_1_1Action.html#ae68c67c422f1090027f6eb6ba01b62b2">PhotoRigma\Action\$photo</a></div><div class="ttdeci">$photo</div><div class="ttdef"><b>Определения</b> <a href="../../dc/d71/photo_8php_source.html#l00033">photo.php:33</a></div></div>
<div class="ttc" id="anamespacePhotoRigma_1_1Classes_html"><div class="ttname"><a href="../../d6/dc3/namespacePhotoRigma_1_1Classes.html">PhotoRigma\Classes</a></div><div class="ttdef"><b>Определения</b> <a href="../../dc/d82/db_8php_source.html#l00036">db.php:36</a></div></div>
<div class="ttc" id="anamespacePhotoRigma_1_1Include_html_a26ebc544afff0aad8a2ae5ca6005ed08"><div class="ttname"><a href="../../db/d02/namespacePhotoRigma_1_1Include.html#a26ebc544afff0aad8a2ae5ca6005ed08">PhotoRigma\Include\TBL_NEWS</a></div><div class="ttdeci">const TBL_NEWS</div><div class="ttdoc">Таблица с новостями</div><div class="ttdef"><b>Определения</b> <a href="../../d9/dcd/common_8php_source.html#l00063">common.php:63</a></div></div>
<div class="ttc" id="anamespacePhotoRigma_1_1Include_html_a2d74c46a21e4ce612a98eee60981aef0"><div class="ttname"><a href="../../db/d02/namespacePhotoRigma_1_1Include.html#a2d74c46a21e4ce612a98eee60981aef0">PhotoRigma\Include\log_in_file</a></div><div class="ttdeci">log_in_file(string $txt, bool $die=false)</div><div class="ttdoc">Записывает сообщение об ошибке в лог-файл и, при необходимости, завершает выполнение скрипта.</div><div class="ttdef"><b>Определения</b> <a href="../../d9/dcd/common_8php_source.html#l00341">common.php:341</a></div></div>
<div class="ttc" id="anamespacePhotoRigma_1_1Language_html_aaac542e9d3d45bc170bae6775a413a9d"><div class="ttname"><a href="../../dc/d7a/namespacePhotoRigma_1_1Language.html#aaac542e9d3d45bc170bae6775a413a9d">PhotoRigma\Language\$lang_name</a></div><div class="ttdeci">if(!defined(&#39;IN_GALLERY&#39;)||IN_GALLERY !==true) $lang_name</div><div class="ttdoc">Название языка</div><div class="ttdef"><b>Определения</b> <a href="../../d4/d40/language_2english_2main_8php_source.html#l00041">main.php:41</a></div></div>
<div class="ttc" id="anamespacePhotoRigma_html_ae07beac783fdab08b691bb38425a6771"><div class="ttname"><a href="../../de/d90/namespacePhotoRigma.html#ae07beac783fdab08b691bb38425a6771">PhotoRigma\FILTER_VALIDATE_IP</a></div><div class="ttdeci">if( $header_footer) if($template_output) catch(\RuntimeException $e) catch(\PDOException $e) catch(\InvalidArgumentException $e) catch(\LogicException $e) catch(\BadMethodCallException $e) catch(\BadFunctionCallException $e) catch(\DomainException $e) catch(\UnexpectedValueException $e) catch(\LengthException $e) catch(\OutOfBoundsException $e) catch(\RangeException $e) catch(\Exception $e FILTER_VALIDATE_IP</div><div class="ttdef"><b>Определения</b> <a href="../../de/d20/index_8php_source.html#l00293">index.php:293</a></div></div>
<div class="ttc" id="anamespacePhotoRigma_html_afc238d5007d9f82f9c59e7d33f7a75c6"><div class="ttname"><a href="../../de/d90/namespacePhotoRigma.html#afc238d5007d9f82f9c59e7d33f7a75c6">PhotoRigma\IN_GALLERY</a></div><div class="ttdeci">const IN_GALLERY</div><div class="ttdef"><b>Определения</b> <a href="../../de/d20/index_8php_source.html#l00059">index.php:59</a></div></div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Создано системой <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
