<?php

/**
 * @file        include/Work_Interface.php
 * @brief       Интерфейс для центральной точки приложения.
 *
 * @author      Dark Dayver
 * @version     0.4.1
 * @date        2025-04-25
 * @namespace   Photorigma\\Interfaces
 *
 * @details     Этот файл содержит интерфейс `Work_Interface`, который определяет методы для управления языковыми
 *              данными, объектом пользователя и обеспечивает доступ к функционалу дочерних компонентов через фасады:
 *              - Установка языковых данных из файла (`set_lang`).
 *              - Установка объекта пользователя через сеттер (`set_user`).
 *              - Делегирование вызовов методов дочерним компонентам:
 *                - `Work_Helper_Interface`: Вспомогательные методы (например, очистка строк, преобразование размеров).
 *                - `Work_CoreLogic_Interface`: Базовая логика приложения (например, работа с категориями, новостями).
 *                - `Work_Image_Interface`: Работа с изображениями (например, изменение размеров, вывод эскизов).
 *                - `Work_Template_Interface`: Формирование данных для шаблонов (например, меню, статистика).
 *                - `Work_Security_Interface`: Безопасность приложения (например, проверка входных данных, CAPTCHA).
 *
 * @section     Основные функции
 *              - Управление языковыми данными.
 *              - Управление объектом пользователя.
 *              - Делегирование вызовов дочерним компонентам.
 *
 * @see         PhotoRigma::Interfaces::User_Interface Интерфейс для работы с пользователями.
 * @see         PhotoRigma::Interfaces::Work_Helper_Interface Интерфейс для вспомогательных методов.
 * @see         PhotoRigma::Interfaces::Work_CoreLogic_Interface Интерфейс для базовой логики приложения.
 * @see         PhotoRigma::Interfaces::Work_Image_Interface Интерфейс для работы с изображениями.
 * @see         PhotoRigma::Interfaces::Work_Template_Interface Интерфейс для формирования данных шаблонов.
 * @see         PhotoRigma::Interfaces::Work_Security_Interface Интерфейс для работы с безопасностью.
 *
 * @note        Этот файл является частью системы PhotoRigma и играет ключевую роль в организации работы приложения.
 *
 * @copyright   Copyright (c) 2008-2025 Dark Dayver. Все права защищены.
 * @license     MIT License (https://opensource.org/licenses/MIT)
 *              Разрешается использовать, копировать, изменять, объединять, публиковать, распространять,
 *              сублицензировать и/или продавать копии программного обеспечения, а также разрешать лицам, которым
 *              предоставляется данное программное обеспечение, делать это при соблюдении следующих условий:
 *              - Уведомление об авторских правах и условия лицензии должны быть включены во все копии или значимые
 *              части программного обеспечения.
 */

namespace PhotoRigma\Interfaces;

// Предотвращение прямого вызова файла
use Exception;
use InvalidArgumentException;
use JetBrains\PhpStorm\NoReturn;
use JsonException;
use PDOException;
use Random;
use RuntimeException;

if (!defined('IN_GALLERY') || IN_GALLERY !== true) {
    error_log(
        date('H:i:s') . " [ERROR] | " . (filter_input(
            INPUT_SERVER,
            'REMOTE_ADDR',
            FILTER_VALIDATE_IP
        ) ?: 'UNKNOWN_IP') . " | " . __FILE__ . " | Попытка прямого вызова файла"
    );
    die("HACK!");
}

/**
 * @interface Work_Interface
 * @brief     Интерфейс для центральной точки приложения.
 *
 * @details   Этот интерфейс определяет контракт для класса `Work`, который является центральной точкой приложения.
 *            Он предоставляет методы для управления языковыми данными, объектом пользователя и обеспечивает доступ
 *            к функционалу дочерних компонентов через фасады. Все методы вызываются через класс `Work`.
 *            Основные возможности:
 *            - Установка языковых данных из файла (`set_lang`).
 *            - Установка объекта пользователя через сеттер (`set_user`).
 *            - Делегирование вызовов методов дочерним компонентам:
 *              - `Work_Helper_Interface`: Вспомогательные методы (например, очистка строк, преобразование размеров).
 *              - `Work_CoreLogic_Interface`: Базовая логика приложения (например, работа с категориями, новостями).
 *              - `Work_Image_Interface`: Работа с изображениями (например, изменение размеров, вывод эскизов).
 *              - `Work_Template_Interface`: Формирование данных для шаблонов (например, меню, статистика).
 *              - `Work_Security_Interface`: Безопасность приложения (например, проверка входных данных, CAPTCHA).
 *
 * @note      Методы данного интерфейса зависят от реализации дочерних компонентов. Некорректная реализация
 *            дочерних интерфейсов может привести к ошибкам в работе приложения.
 *
 * @warning   Все методы должны быть реализованы в классе `Work`. Неполная реализация может привести к непредсказуемому
 *            поведению приложения.
 *
 * @see       PhotoRigma::Interfaces::User_Interface Интерфейс для работы с пользователями.
 * @see       PhotoRigma::Interfaces::Work_Helper_Interface Интерфейс для вспомогательных методов.
 * @see       PhotoRigma::Interfaces::Work_CoreLogic_Interface Интерфейс для базовой логики приложения.
 * @see       PhotoRigma::Interfaces::Work_Image_Interface Интерфейс для работы с изображениями.
 * @see       PhotoRigma::Interfaces::Work_Template_Interface Интерфейс для формирования данных шаблонов.
 * @see       PhotoRigma::Interfaces::Work_Security_Interface Интерфейс для работы с безопасностью.
 */
interface Work_Interface
{
    /**
     * @brief   Преобразует размер в формате "число[K|M|G]" в количество байт.
     *
     * @details Этот метод выполняет следующие действия:
     *          1. Проверяет корректность входных данных.
     *          2. Преобразует размер, заданный в формате "число[K|M|G]", в количество байт:
     *             - K (килобайты): умножается на 1024.
     *             - M (мегабайты): умножается на 1024².
     *             - G (гигабайты): умножается на 1024³.
     *          3. Если суффикс отсутствует или недопустим, значение считается в байтах.
     *          4. Отрицательные числа преобразуются в положительные.
     *          5. Возвращает `0`, если входные данные некорректны.
     *
     * @param string|int $val Размер в формате "число[K|M|G]" или число:
     *                        - Допустимые суффиксы: `K`, `M`, `G`.
     *                        - Если суффикс недопустим, он игнорируется, и значение преобразуется в число.
     *                        - Отрицательные числа преобразуются в положительные.
     *
     * @return int Размер в байтах. Возвращает `0` для некорректных входных данных.
     *
     * @warning Метод чувствителен к формату входных данных. Убедитесь, что они корректны.
     *
     * Пример использования:
     * @code
     * // Преобразование с допустимым суффиксом
     * $bytes = Work::return_bytes('2M');
     * echo $bytes; // Выведет: 2097152
     *
     * // Преобразование отрицательного значения
     * $bytes = Work::return_bytes('-1G');
     * echo $bytes; // Выведет: 1073741824
     *
     * // Преобразование с недопустимым суффиксом
     * $bytes = Work::return_bytes('10X');
     * echo $bytes; // Выведет: 10
     *
     * // Преобразование некорректных данных
     * $bytes = Work::return_bytes('abc');
     * echo $bytes; // Выведет: 0
     * @endcode
     */
    public static function return_bytes(string|int $val): int;

    /**
     * @brief   Транслитерирует строку и заменяет знаки пунктуации на "_".
     *
     * @details Этот метод выполняет следующие действия:
     *          1. Проверяет, что входная строка не является пустой. Если строка пустая, она возвращается без обработки.
     *          2. Транслитерирует не латинские символы в латиницу.
     *          3. Заменяет все символы, кроме букв и цифр, на `"_"`:
     *             - Заменяет множественные подчёркивания на одно.
     *             - Удаляет подчёркивания в начале и конце строки.
     *          4. Если после обработки строка становится пустой, генерируется уникальная последовательность длиной 16
     *             символов.
     *          Метод используется для создания "безопасных" имен файлов или URL.
     *
     * @param string $string Исходная строка:
     *                       - Если строка пустая, она возвращается без обработки.
     *                       Рекомендуется использовать строки в кодировке UTF-8.
     *
     * @return string Строка после транслитерации и замены символов:
     *                - Если после обработки строка становится пустой, генерируется уникальная последовательность.
     *
     * @warning Метод не гарантирует сохранение исходного формата строки, так как все специальные символы заменяются на
     *          `"_"`.
     *
     * Пример использования:
     * @code
     * // Транслитерация строки с заменой знаков пунктуации
     * $encoded = Work::encodename('Привет, мир!');
     * echo $encoded; // Выведет: Privet_mir
     *
     * // Обработка пустой строки
     * $encoded = Work::encodename('');
     * echo $encoded; // Выведет: пустую строку
     *
     * // Обработка строки без кириллицы и знаков пунктуации
     * $encoded = Work::encodename('12345');
     * echo $encoded; // Выведет: 12345
     *
     * // Генерация уникальной последовательности для пустой строки после обработки
     * $encoded = Work::encodename('!!!');
     * echo $encoded; // Выведет: уникальную последовательность из 16 символов
     * @endcode
     */
    public static function encodename(string $string): string;

    /**
     * @brief   Преобразует BBCode в HTML.
     *
     * @details Этот метод преобразует BBCode-теги в соответствующие HTML-теги. Поддерживаются следующие BBCode-теги:
     *          - [b]Жирный текст[/b] -> `<strong>Жирный текст</strong>`
     *          - [u]Подчёркнутый текст[/u] -> `<u>Подчёркнутый текст</u>`
     *          - [i]Курсив[/i] -> `<em>Курсив</em>`
     *          - [url]Ссылка[/url], [url=URL]Текст ссылки[/url] -> `<a href="URL" target="_blank" rel="noopener
     *          noreferrer">Текст ссылки</a>`
     *          - [color=COLOR]Цвет текста[/color] -> `<span style="color: COLOR;">Цвет текста</span>`
     *          - [size=SIZE]Размер текста[/size] -> `<span style="font-size: SIZE;">Размер текста</span>`
     *          - [quote]Цитата[/quote], [quote=AUTHOR]Цитата автора[/quote] -> `<blockquote>Цитата</blockquote>`
     *          - [list], [list=1], [list=a] — списки -> `<ul>`, `<ol>` с соответствующими элементами `<li>`
     *          - [code]Блок кода[/code] -> `<pre><code>Блок кода</code></pre>`
     *          - [spoiler]Спойлер[/spoiler] -> `<details><summary>Спойлер</summary>Содержимое</details>`
     *          - [hr] — горизонтальная линия -> `<hr>`
     *          - [br] — перенос строки -> `<br>`
     *          - [left], [center], [right] — выравнивание текста -> `<div style="text-align: left|center|right;">`
     *          - [img]Изображение[/img] -> `<img src="URL" alt="Изображение">`
     *          Метод защищает от XSS-атак и ограничивает глубину рекурсии для вложенных тегов.
     *
     * @param string $text Текст с BBCode:
     *                     - Если строка пустая, она возвращается без обработки.
     *                     Рекомендуется использовать строки в кодировке UTF-8.
     *
     * @return string Текст с HTML-разметкой:
     *                - Некорректные BBCode-теги игнорируются или преобразуются в текст.
     *
     * @throws Exception Выбрасывается, если произошла ошибка при обработке BBCode.
     *
     * @warning Метод ограничивает глубину рекурсии для вложенных тегов (максимум 10 уровней).
     *          Некорректные URL или изображения заменяются на безопасные значения или удаляются.
     *
     * Пример использования:
     * @code
     * // Преобразование жирного текста
     * $html = Work::ubb('[b]Bold text[/b]');
     * echo $html; // Выведет: <strong>Bold text</strong>
     *
     * // Преобразование ссылки
     * $html = Work::ubb('[url=https://example.com]Example[/url]');
     * echo $html; // Выведет: <a href="https://example.com" target="_blank" rel="noopener noreferrer">Example</a>
     *
     * // Преобразование цитаты
     * $html = Work::ubb('[quote=Author]This is a quote.[/quote]');
     * echo $html; // Выведет: <blockquote><cite>Author:</cite>This is a quote.</blockquote>
     *
     * // Преобразование списка
     * $html = Work::ubb('[list][*]Item 1[*]Item 2[/list]');
     * echo $html; // Выведет: <ul><li>Item 1</li><li>Item 2</li></ul>
     * @endcode
     */
    public static function ubb(string $text): string;

    /**
     * @brief   Разбивает строку на несколько строк ограниченной длины.
     *
     * @details Этот метод разбивает строку на несколько строк, каждая из которых имеет длину не более указанной.
     *          Разрыв строки выполняется только по пробелам, чтобы сохранить читаемость текста. Поддерживается работа
     *          с UTF-8 символами. Если параметры некорректны (например, `$width <= 0` или `$break` пустой),
     *          возвращается исходная строка.
     *
     * @param string $str   Исходная строка:
     *                      - Рекомендуется использовать строки в кодировке UTF-8.
     *                      - Если строка пустая или её длина меньше или равна `$width`, она возвращается без
     *                      изменений.
     * @param int    $width Максимальная длина строки (по умолчанию 70):
     *                      - Должен быть положительным целым числом.
     * @param string $break Символ разрыва строки (по умолчанию PHP_EOL):
     *                      - Не должен быть пустой строкой.
     *
     * @return string Строка, разбитая на несколько строк:
     *                - В случае некорректных параметров возвращается исходная строка.
     *
     * @throws Exception Выбрасывается при возникновении ошибок логирования информации.
     *
     * @warning Метод корректно работает только с UTF-8 символами.
     *          Если параметры некорректны (например, `$width <= 0` или `$break` пустой), возвращается исходная строка.
     *
     * Пример использования:
     * @code
     * // Разбивка строки на части длиной 10 символов
     * $wrapped = Work::utf8_wordwrap('This is a very long string that needs to be wrapped.', 10);
     * echo $wrapped;
     * // Выведет:
     * // This is a
     * // very long
     * // string that
     * // needs to be
     * // wrapped.
     *
     * // Разбивка строки с пользовательским символом разрыва
     * $wrapped = Work::utf8_wordwrap('This is another example.', 15, '---');
     * echo $wrapped;
     * // Выведет:
     * // This is another---
     * // example.
     *
     * // Некорректные параметры
     * $wrapped = Work::utf8_wordwrap('Short text', 0);
     * echo $wrapped; // Выведет: Short text
     * @endcode
     */
    public static function utf8_wordwrap(string $str, int $width = 70, string $break = PHP_EOL): string;

    /**
     * @brief   Проверяет, поддерживается ли указанный MIME-тип изображения.
     *
     * @details Этот метод проверяет, поддерживается ли указанный MIME-тип хотя бы одной из доступных библиотек:
     *          - Imagick: Поддерживает широкий спектр форматов, включая JPEG, PNG, GIF, WebP, TIFF, SVG, BMP, ICO,
     *            AVIF, HEIC, PSD, CR2, NEF и другие.
     *          - Gmagick: Поддерживает основные форматы, такие как JPEG, PNG, GIF, WebP, TIFF, SVG, BMP, ICO, AVIF,
     *            HEIC.
     *          - Встроенные функции PHP (GD): Поддерживаются только базовые форматы, такие как JPEG, PNG, GIF, WebP.
     *          Если MIME-тип не поддерживается ни одной библиотекой, возвращается `false`.
     *
     * @param string $real_mime_type Реальный MIME-тип файла:
     *                               - Должен быть корректным MIME-типом для изображений.
     *
     * @return bool True, если MIME-тип поддерживается хотя бы одной библиотекой, иначе false.
     *
     * @throws Exception Выбрасывается при возникновении ошибок логирования информации.
     *
     * @warning Метод зависит от доступности библиотек (Imagick, Gmagick) и встроенных функций PHP по работе с
     *          изображениями (GD). Если ни одна из библиотек недоступна, метод может некорректно работать.
     *
     * Пример использования:
     * @code
     * // Проверка поддерживаемого MIME-типа
     * $is_supported = Work::validate_mime_type('image/jpeg');
     * var_dump($is_supported); // Выведет: true
     *
     * // Проверка неподдерживаемого MIME-типа
     * $is_supported = Work::validate_mime_type('application/pdf');
     * var_dump($is_supported); // Выведет: false
     *
     * // Проверка MIME-типа, поддерживаемого только через Imagick
     * $is_supported = Work::validate_mime_type('image/vnd.adobe.photoshop');
     * var_dump($is_supported); // Выведет: true (если Imagick доступен)
     * @endcode
     */
    public static function validate_mime_type(string $real_mime_type): bool;

    /**
     * @brief   Очищает строку от HTML-тегов и специальных символов.
     *
     * @details Этот метод выполняет следующие действия:
     *          1. Проверяет, что входные данные не являются пустыми (`null` или пустая строка). Если данные пусты,
     *             возвращает пустую строку (`''`).
     *          2. Преобразует входные данные в кодировку UTF-8.
     *          3. Удаляет все HTML-теги из строки.
     *          4. Экранирует специальные символы (например, `<`, `>`, `&`, `"`, `'`) для защиты от XSS-атак.
     *          Метод используется для безопасной обработки пользовательского ввода.
     *
     * @param string $field Строка или данные, которые могут быть преобразованы в строку:
     *                      - Если входные данные пусты (`null` или пустая строка), метод вернёт пустую строку (`''`).
     *
     * @return string Очищенная строка или пустая строка (`''`), если входные данные пусты.
     *
     * @warning Метод не обрабатывает вложенные структуры данных (например, массивы).
     *          Убедитесь, что входные данные могут быть преобразованы в строку.
     *
     * Пример использования:
     * @code
     * // Очистка строки от HTML-тегов и специальных символов
     * $dirty_input = '<script>alert("XSS")</script>';
     * $cleaned = Work::clean_field($dirty_input);
     * echo $cleaned; // Выведет: <script>alert(&quot;XSS&quot;)</script>
     * @endcode
     */
    public static function clean_field(string $field): string;

    /**
     * @brief   Устанавливает языковые данные из файла и передаёт их в дочерние классы.
     *
     * @details Этот метод используется для установки массива языковых данных ($lang) из файла.
     *          Выполняются следующие шаги:
     *          1. Формируется путь к файлу языковых данных на основе текущего языка сессии или конфигурации.
     *          2. Проверяется существование и доступность файла для чтения.
     *          3. Загружаются данные из файла, которые должны быть массивом с ключом `'lang'`.
     *          4. Проверяется корректность массива через метод `process_lang_array()`.
     *          5. Логируются изменения (если они есть).
     *          6. Обновляются языковые данные в текущем классе и передаются в дочерние классы (`Work_Template` и
     *          `Work_CoreLogic`).
     *
     * @param string $lang Имя файла языковых данных:
     *                     - Должен быть непустой строкой.
     *                     - Должен соответствовать имени файла в директории языковых данных.
     *                     - По умолчанию: 'main'.
     *
     * @throws InvalidArgumentException Если имя файла некорректно (пустое или не существует).
     *                                  Пример сообщения: "Некорректное имя языкового файла | Поле не должно быть
     *                                  пустым". Если массив языковых данных некорректен (не содержит ключ 'lang' или
     *                                  содержит ошибки). Пример сообщения: "Обнаружены ошибки в массиве языковых
     *                                  данных | Ошибки:
     *                                  [список ошибок]".
     * @throws RuntimeException         Если файл языковых данных недоступен для чтения.
     *                                  Пример сообщения: "Файл языковых данных недоступен для чтения | Путь: [путь к
     *                                  файлу]".
     * @throws JsonException            При ошибках кодирования JSON.
     * @throws Exception                При ошибках логирования.
     *
     * @note    Этот метод является точкой входа для установки языковых данных. Все проверки и обработка выполняются в
     *          защищённом методе _set_lang_internal().
     *
     * @warning Если файл языковых данных отсутствует или содержит ошибки, метод выбрасывает исключение.
     *
     * Пример использования:
     * @code
     * // Вызов метода из клиентского кода
     * $work = new \PhotoRigma\Classes\Work();
     * $work->set_lang('main');
     * @endcode
     */
    public function set_lang(string $lang = 'main'): void;

    /**
     * @brief   Установка объекта пользователя через сеттер.
     *
     * @details Этот метод позволяет установить объект пользователя, реализующий интерфейс `User_Interface`.
     *          Метод выполняет следующие действия:
     *          1. Проверяет, что переданный объект является экземпляром класса, реализующего интерфейс
     *          `User_Interface`.
     *          2. Передаёт объект пользователя в связанные компоненты системы (`Work_Template` и `Work_CoreLogic`)
     *             для дальнейшего использования.
     *
     * @param User_Interface $user Объект пользователя:
     *                             - Должен быть экземпляром класса, реализующего интерфейс `User_Interface`.
     *
     * @throws InvalidArgumentException Если передан некорректный объект (не экземпляр интерфейса `User_Interface`).
     *
     * @note    Метод проверяет тип переданного объекта.
     *          Объект пользователя используется в связанных компонентах системы (например, для авторизации,
     *          управления правами доступа и т.д.).
     *
     * @warning Некорректный объект (не экземпляр интерфейса `User_Interface`) вызывает исключение.
     *
     * Пример использования:
     * @code
     * // Создание объекта Work и установка пользователя
     * $work = new \PhotoRigma\Classes\Work();
     * $user = new \PhotoRigma\Classes\User($db, $_SESSION);
     * $work->set_user($user);
     * @endcode
     * @see     PhotoRigma::Classes::User_Interface
     *          Интерфейс, которому должен соответствовать объект пользователя.
     */
    public function set_user(User_Interface $user): void;

    /**
     * @brief   Проверяет входные данные из различных источников.
     *
     * @details Этот метод выполняет проверку данных из различных источников ($_GET, $_POST, $_SESSION, $_COOKIE,
     *          $_FILES) на соответствие заданным условиям. Поддерживаются следующие типы проверок:
     *          - Проверка наличия поля в источнике данных (параметр 'isset').
     *          - Проверка, что значение поля не пустое (параметр 'empty').
     *          - Проверка значения поля по регулярному выражению (параметр 'regexp').
     *          - Проверка, что значение поля не равно нулю (параметр 'not_zero').
     *          - Проверка размера файла для $_FILES (параметр 'max_size') и его MIME-типа.
     *
     * @param string $source_name   Источник данных ($_GET, $_POST, $_SESSION, $_COOKIE, $_FILES):
     *                              - Должен быть одним из допустимых значений: '_GET', '_POST', '_SESSION', '_COOKIE',
     *                              '_FILES'.
     * @param string $field         Поле для проверки (имя ключа в массиве источника данных):
     *                              - Указывается имя ключа, которое необходимо проверить.
     * @param array  $options       Дополнительные параметры проверки:
     *                              - Ключ 'isset' (bool, опционально): Проверять наличие поля в источнике данных.
     *                              - Ключ 'empty' (bool, опционально): Проверять, что значение поля не пустое.
     *                              - Ключ 'regexp' (string|false, опционально): Регулярное выражение для проверки
     *                              значения поля.
     *                              - Ключ 'not_zero' (bool, опционально): Проверять, что значение поля не равно нулю.
     *                              - Ключ 'max_size' (int, опционально): Максимальный размер файла (в байтах) для
     *                              $_FILES.
     *
     * @return bool True, если данные прошли проверку, иначе False.
     *              Для $_FILES также учитывается корректность MIME-типа и размера файла.
     *
     * @throws RuntimeException Выбрасывается, если MIME-тип загруженного файла не поддерживается.
     * @throws Exception        Выбрасывается при возникновении ошибок логирования информации.
     *
     * @note    Для источника данных `_SESSION` используется внутреннее свойство класса.
     *          Метод зависит от корректности данных в источниках ($_GET, $_POST, $_SESSION, $_COOKIE, $_FILES).
     *          Если источник данных повреждён или содержит некорректные значения, результат может быть
     *          непредсказуемым.
     *
     * @warning Убедитесь, что переданные параметры проверки ($options) корректны и соответствуют требованиям.
     *
     * Пример использования:
     * @code
     * // Создание объекта
     * $work = new Work();
     *
     * // Проверка поля $_POST['username'] на наличие и непустое значение
     * $is_valid = $work->check_input('_POST', 'username', [
     *     'isset' => true,
     *     'empty' => true,
     * ]);
     * if ($is_valid) {
     *     echo "Поле username прошло проверку.";
     * } else {
     *     echo "Поле username не прошло проверку.";
     * }
     * @endcode
     */
    public function check_input(string $source_name, string $field, array $options = []): bool;

    /**
     * @brief   Проверяет URL на наличие вредоносного кода.
     *
     * @details Этот метод выполняет следующие действия:
     *          1. Анализирует строку запроса из глобального массива `$_SERVER['QUERY_STRING']`.
     *          2. Проверяет строку запроса на наличие запрещённых паттернов, определённых в конфигурации.
     *          3. Логирует информацию о попытке взлома, если обнаружены запрещённые паттерны.
     *
     * @return bool True, если URL безопасен (не содержит запрещённых паттернов), иначе False.
     *
     * @throws Exception Выбрасывается при возникновении ошибок логирования информации.
     *
     * @note    Метод работает с глобальным массивом `$_SERVER['QUERY_STRING']`.
     *          Убедитесь, что этот массив доступен и содержит корректные данные.
     *
     * @warning Метод зависит от корректности данных в конфигурации правил проверки.
     *          Если правила некорректны, результат может быть непредсказуемым.
     *
     * Пример использования:
     * @code
     * // Создание объекта
     * $work = new Work();
     *
     * // Проверка безопасности URL
     * $is_safe = $work->url_check();
     * if ($is_safe) {
     *     echo "URL безопасен.";
     * } else {
     *     echo "URL содержит запрещённые паттерны.";
     * }
     * @endcode
     */
    public function url_check(): bool;

    /**
     * @brief   Проверяет содержимое поля на соответствие регулярному выражению или другим условиям.
     *
     * @details Этот метод выполняет следующие проверки:
     *          1. Если задано регулярное выражение ($regexp):
     *             - Проверяет корректность регулярного выражения.
     *             - Проверяет соответствие значения поля этому выражению.
     *          2. Если флаг $not_zero установлен, проверяет, что значение поля не равно '0'.
     *          3. Проверяет, что значение поля не содержит запрещённых паттернов из конфигурации.
     *
     * @param string       $field    Значение поля для проверки:
     *                               - Указывается строковое значение, которое необходимо проверить.
     * @param string|false $regexp   Регулярное выражение (необязательно). Если задано, значение должно соответствовать
     *                               этому выражению. Если регулярное выражение некорректно, метод завершает выполнение
     *                               с ошибкой.
     * @param bool         $not_zero Флаг, указывающий, что значение не должно быть числом 0:
     *                               - Если флаг установлен, а значение равно '0', проверка завершается с ошибкой.
     *
     * @return bool True, если поле прошло все проверки, иначе False.
     *              Проверки включают соответствие регулярному выражению, отсутствие запрещённых паттернов
     *              и выполнение условия $not_zero (если оно задано).
     *
     * @throws Exception Выбрасывается при возникновении ошибок логирования информации.
     *
     * @note    Метод использует конфигурацию для проверки на наличие запрещённых паттернов.
     *          Конфигурация должна содержать массив скомпилированных регулярных выражений.
     *
     * @warning Метод зависит от корректности данных в конфигурации правил проверки.
     *          Если правила некорректны, результат может быть непредсказуемым.
     *          Также важно убедиться, что регулярное выражение ($regexp) корректно перед использованием.
     *
     * Пример использования:
     * @code
     * // Создание объекта
     * $work = new Work();
     *
     * // Проверка поля на соответствие регулярному выражению и условию not_zero
     * $field_value = "example123";
     * $regexp = "/^[a-z0-9]+$/i";
     * $is_valid = $work->check_field($field_value, $regexp, true);
     * if ($is_valid) {
     *     echo "Поле прошло проверку.";
     * } else {
     *     echo "Поле не прошло проверку.";
     * }
     * @endcode
     */
    public function check_field(string $field, string|false $regexp = false, bool $not_zero = false): bool;

    /**
     * @brief   Генерирует математический CAPTCHA-вопрос и ответ.
     *
     * @details Этот метод выполняет следующие действия:
     *          1. Генерирует случайные числа в диапазоне от 1 до 9.
     *          2. Формирует математическое выражение, которое может включать сложение (`+`) или умножение (`x`)
     *             с использованием скобок.
     *          3. Вычисляет правильный ответ для сгенерированного выражения.
     *          Метод используется для защиты от спам-ботов.
     *
     * @return array Массив с ключами 'question' и 'answer':
     *               - Ключ 'question' содержит строку математического выражения (например, "2 x (3 + 4)").
     *               - Ключ 'answer' содержит целочисленный результат вычисления (например, 14).
     *
     * @throws Random\RandomException Выбрасывается, если произошла ошибка при генерации случайных чисел.
     *
     * @note    Метод использует криптографически безопасную функцию для генерации случайных чисел.
     *          Если требуется замена на менее безопасную функцию, это должно быть явно указано в конфигурации.
     *
     * @warning Убедитесь, что PHP поддерживает криптографически безопасные функции генерации случайных чисел.
     *
     * Пример использования:
     * @code
     * // Создание объекта
     * $work = new Work();
     *
     * // Генерация CAPTCHA-вопроса и ответа
     * $captcha = $work->gen_captcha();
     * echo "Вопрос: {$captcha['question']}\n";
     * echo "Ответ: {$captcha['answer']}\n";
     * @endcode
     */
    public function gen_captcha(): array;

    /**
     * @brief   Заменяет символы в email-адресах для защиты от парсинга ботами.
     *
     * @details Этот метод выполняет следующие действия:
     *          1. Проверяет корректность формата email.
     *          2. Если email некорректен или пуст, возвращает пустую строку.
     *          3. Заменяет символы '@' и '.' на '[at]' и '[dot]' соответственно.
     *          Метод предназначен для затруднения автоматического парсинга email-адресов ботами.
     *
     * @param string $email Email-адрес для обработки:
     *                      - Должен быть непустым и соответствовать формату email (например, "example@example.com").
     *                      - Если email некорректен или пуст, метод возвращает пустую строку.
     *
     * @return string Обработанный email-адрес, где символы '@' и '.' заменены на '[at]' и '[dot]'.
     *                Если входной email некорректен или пуст, возвращается пустая строка.
     *
     * @throws Exception Выбрасывается при возникновении ошибок логирования.
     *
     * @note    Метод использует базовую проверку формата email.
     *          Если требуется более строгая валидация, следует учитывать дополнительные правила.
     *
     * @warning Убедитесь, что входной email соответствует формату перед вызовом метода.
     *          Если email некорректен или пуст, метод вернёт пустую строку.
     *
     * Пример использования:
     * @code
     * // Создание объекта
     * $work = new Work();
     *
     * // Обработка email-адреса
     * $email = "example@example.com";
     * $filtered_email = $work->filt_email($email);
     * if (!empty($filtered_email)) {
     *     echo "Обработанный email: {$filtered_email}";
     * } else {
     *     echo "Email некорректен или пуст.";
     * }
     * @endcode
     */
    public function filt_email(string $email): string;

    /**
     * @brief   Формирует информационную строку для категории или пользовательского альбома.
     *
     * @details Этот метод выполняет следующие действия:
     *          1. Проверяет корректность входных параметров:
     *             - `$cat_id` должен быть целым числом >= `0`.
     *             - `$user_flag` должен принимать значения `0` (категория) или `1` (пользовательский альбом).
     *          2. Получает данные о категории или пользовательском альбоме из базы данных.
     *          3. Подсчитывает количество фотографий, связанных с категорией или альбомом.
     *          4. Формирует результирующий массив с информацией о категории или альбоме, включая название, описание,
     *             количество фотографий, данные о последней и лучшей фотографии, а также ссылки на них.
     *
     * @param int $cat_id    Идентификатор категории или пользователя (если `$user_flag = 1`):
     *                       - Должен быть целым числом >= `0`.
     *                       Пример: `5` (для категории) или `123` (для пользовательского альбома).
     * @param int $user_flag Флаг, указывающий формировать ли информацию о категории (`0`) или пользовательском альбоме
     *                       (`1`):
     *                       - По умолчанию: `0`.
     *                       - Допустимые значения: `0` или `1`.
     *
     * @return array Информационная строка для категории или пользовательского альбома:
     *               - 'name'           (string): Название категории или альбома.
     *               - 'description'    (string): Описание категории или альбома.
     *               - 'count_photo'    (int):    Количество фотографий.
     *               - 'last_photo'     (string): Форматированное название последней фотографии.
     *               - 'top_photo'      (string): Форматированное название лучшей фотографии.
     *               - 'url_cat'        (string): Ссылка на категорию или альбом.
     *               - 'url_last_photo' (string): Ссылка на последнюю фотографию.
     *               - 'url_top_photo'  (string): Ссылка на лучшую фотографию.
     *
     * @throws InvalidArgumentException Выбрасывается, если входные параметры имеют некорректный тип или значение.
     *                                  Пример сообщения:
     *                                      cat_id и user_flag должны быть 0 или положительным целым числом.
     * @throws PDOException            Выбрасывается, если возникают ошибки при получении данных из базы данных.
     *                                  Пример сообщения:
     *                                      Не удалось получить данные категории или пользователя.
     * @throws Exception               При выполнении запросов к базам данных.
     *
     * @note    Используются константы:
     *          - TBL_CATEGORY: Таблица для хранения данных о категориях (`category`).
     *          - TBL_USERS:    Таблица для хранения данных о пользователях (`users`).
     *          - TBL_PHOTO:    Таблица для хранения данных о фотографиях (`photo`).
     *
     * @warning Убедитесь, что:
     *          - Входные параметры `$cat_id` и `$user_flag` корректны.
     *          - База данных содержит необходимые данные для выполнения запросов.
     *          - Пользователь имеет права на просмотр фотографий (если это требуется).
     *
     * Пример использования:
     * @code
     * // Создание объекта
     * $work = new Work();
     *
     * // Получение данных о категории с ID = 5
     * $category_data = $work->category(5, 0);
     * print_r($category_data);
     *
     * // Получение данных о пользовательском альбоме с ID = 123
     * $user_album_data = $work->category(123, 1);
     * print_r($user_album_data);
     * @endcode
     */
    public function category(int $cat_id = 0, int $user_flag = 0): array;

    /**
     * @brief   Удаляет изображение с указанным идентификатором, а также все упоминания об этом изображении.
     *
     * @details Этот метод выполняет следующие действия:
     *          1. Проверяет корректность входного параметра `photo_id`.
     *          2. Получает данные об изображении из базы данных.
     *          3. Удаляет файлы изображений (полноразмерные и эскизы) с диска.
     *          4. Удаляет запись об изображении из базы данных.
     *          5. Логирует ошибки, если они возникают.
     *
     * @param int $photo_id Идентификатор удаляемого изображения:
     *                      - Должен быть положительным целым числом.
     *                      Пример: `42`.
     *
     * @return bool Возвращает:
     *              - `true`, если удаление успешно.
     *              - `false`, если произошла ошибка.
     *
     * @throws InvalidArgumentException Выбрасывается, если параметр `photo_id` имеет некорректный тип или значение.
     *                                  Пример сообщения:
     *                                      Неверное значение параметра photo_id | Ожидалось положительное целое число.
     * @throws RuntimeException         Выбрасывается, если возникает ошибка при выполнении запросов к базе данных или
     *                                  удалении файлов.
     *                                  Пример сообщения:
     *                                      Не удалось найти изображение | Переменная photo_id = [значение].
     * @throws Exception                Выбрасывается при записи ошибок в лог.
     *
     * @note    Метод автоматически удаляет связанные записи в базе данных благодаря использованию внешних ключей.
     *
     * @warning Убедитесь, что:
     *          - Скрипт имеет необходимые права на запись и чтение для удаления файлов.
     *          - Удаление файлов и записей из базы данных необратимо. Передайте корректный идентификатор изображения.
     *
     * Пример использования:
     * @code
     * // Создание объекта
     * $work = new Work();
     *
     * // Удаление изображения с ID = 42
     * $result = $work->del_photo(42);
     * if ($result) {
     *     echo "Изображение успешно удалено.";
     * } else {
     *     echo "Не удалось удалить изображение.";
     * }
     * @endcode
     */
    public function del_photo(int $photo_id): bool;

    /**
     * @brief   Получает данные о новостях в зависимости от типа запроса.
     *
     * @details Этот метод выполняет следующие действия:
     *          1. Проверяет корректность входных параметров `$news_id_or_limit` и `$act`.
     *          2. Выполняет запрос к базе данных для получения данных о новостях:
     *             - Для `$act = 'id'`: Возвращает новость по её ID.
     *             - Для `$act = 'last'`: Возвращает список последних новостей с сортировкой по дате редактирования.
     *          3. Возвращает массив с данными о новостях или пустой массив, если новости не найдены.
     *
     * @param int    $news_id_or_limit Количество новостей или ID новости (в зависимости от параметра `$act`):
     *                                 - Должен быть положительным целым числом.
     *                                 Пример: `5` (для ID новости) или `10` (для количества новостей).
     * @param string $act              Тип запроса:
     *                                 - `'id'`: Получение новости по её ID.
     *                                 - `'last'`: Получение списка последних новостей.
     *
     * @return array Массив с данными о новостях. Если новостей нет, возвращается пустой массив.
     *
     * @throws InvalidArgumentException Выбрасывается, если передан некорректный `$act` или `$news_id_or_limit`.
     *                                  Пример сообщения:
     *                                      Некорректный ID новости | Переменная $news_id_or_limit = [значение].
     *                                  Пример сообщения:
     *                                      Некорректное количество новостей | Переменная $news_id_or_limit =
     *                                      [значение]. Пример сообщения: Некорректный тип запроса | Переменная $act =
     *                                      '$act'.
     * @throws RuntimeException         Выбрасывается, если произошла ошибка при выполнении запроса к базе данных.
     *                                  Пример сообщения:
     *                                      Не удалось получить данные из базы данных | Тип запроса: '$act'.
     * @throws Exception                При выполнении запросов к базам данных.
     *
     * @note    Метод автоматически возвращает пустой массив, если новости не найдены.
     *
     * @warning Убедитесь, что:
     *          - Передаются допустимые значения для `$news_id_or_limit` и `$act`.
     *          - База данных содержит необходимые данные для выполнения запросов.
     *
     * Пример использования:
     * @code
     * // Создание объекта
     * $work = new Work();
     *
     * // Получение новости с ID = 5
     * $news_by_id = $work->news(5, 'id');
     * print_r($news_by_id);
     *
     * // Получение 10 последних новостей
     * $news_list = $work->news(10, 'last');
     * print_r($news_list);
     * @endcode
     */
    public function news(int $news_id_or_limit, string $act): array;

    /**
     * @brief   Загружает доступные языки из директории `/language/`.
     *
     * @details Этот метод выполняет следующие действия:
     *          1. Проверяет существование и доступность директории `/language/`.
     *          2. Перебирает поддиректории в `/language/` и загружает данные о доступных языках.
     *          3. Для каждого языка проверяет наличие корректного файла конфигурации с названием языка.
     *          4. Возвращает массив с данными о доступных языках или выбрасывает исключение, если языки не найдены.
     *
     * @return array Массив с данными о доступных языках. Каждый элемент массива содержит:
     *               - `value`: Имя директории языка (строка).
     *               - `name`: Название языка (строка).
     *
     * @throws RuntimeException Выбрасывается, если:
     *                           - Директория `/language/` недоступна или не существует.
     *                           - Ни один язык не найден в указанной директории.
     * @throws Exception         Выбрасывается при записи ошибок в лог.
     *
     * @note    Метод автоматически возвращает пустой массив, если языки не найдены.
     *
     * @warning Убедитесь, что:
     *          - Директория `/language/` содержит корректные поддиректории с файлами конфигурации.
     *          - Файлы конфигурации содержат корректное название языка.
     *          Если директория `/language/` пуста или содержит недоступные поддиректории, метод выбрасывает исключение.
     *
     * Пример использования:
     * @code
     * // Создание объекта
     * $work = new Work();
     *
     * // Получение списка доступных языков
     * $languages = $work->get_languages();
     * foreach ($languages as $language) {
     *     echo "Язык: " . $language['name'] . " (ID: " . $language['value'] . ")\n";
     * }
     * @endcode
     */
    public function get_languages(): array;

    /**
     * @brief   Загружает доступные темы из директории `/themes/`.
     *
     * @details Этот метод выполняет следующие действия:
     *          1. Проверяет существование и доступность директории `/themes/`.
     *          2. Перебирает поддиректории в `/themes/` и загружает имена доступных тем.
     *          3. Возвращает массив с именами доступных тем или выбрасывает исключение, если темы не найдены.
     *
     * @return array Массив с именами доступных тем (строки).
     *
     * @throws RuntimeException Выбрасывается, если:
     *                           - Директория `/themes/` не существует или недоступна для чтения.
     *                           - Ни одна тема не найдена в указанной директории.
     * @throws Exception         Выбрасывается при записи ошибок в лог.
     *
     * @note    Метод автоматически возвращает пустой массив, если темы не найдены.
     *
     * @warning Убедитесь, что:
     *          - Директория `/themes/` существует и содержит корректные поддиректории.
     *          - Поддиректории находятся внутри директории `/themes/`.
     *          Если директория `/themes/` пуста или содержит недоступные поддиректории, метод выбрасывает исключение.
     *
     * Пример использования:
     * @code
     * // Создание объекта
     * $work = new Work();
     *
     * // Получение списка доступных тем
     * $themes = $work->get_themes();
     * foreach ($themes as $theme) {
     *     echo "Доступная тема: $theme\n";
     * }
     * @endcode
     */
    public function get_themes(): array;

    /**
     * @brief   Генерирует блок данных для вывода изображений различных типов.
     *
     * @details Этот метод выполняет следующие действия:
     *          1. Проверяет корректность входных параметров `$type` и `$id_photo`.
     *          2. Проверяет права пользователя на просмотр изображений.
     *          3. Формирует данные для вывода изображения в зависимости от типа:
     *             - `'top'`: Лучшее изображение (по рейтингу).
     *             - `'last'`: Последнее загруженное изображение.
     *             - `'cat'`: Изображение из конкретной категории по `$id_photo`.
     *             - `'rand'`: Любое случайное изображение.
     *          4. Возвращает массив данных для вывода изображения или данные по умолчанию, если изображение недоступно.
     *
     * @param string $type     Тип изображения:
     *                         - `'top'`: Лучшее изображение (по рейтингу).
     *                         - `'last'`: Последнее загруженное изображение.
     *                         - `'cat'`: Изображение из конкретной категории (требует указания `$id_photo`).
     *                         - `'rand'`: Любое случайное изображение.
     *                         По умолчанию: `'top'`.
     *                         Допустимые значения: `'top'`, `'last'`, `'cat'`, `'rand'`.
     * @param int    $id_photo Идентификатор фото. Используется только при `$type == 'cat'`.
     *                         Должен быть целым числом >= `0`.
     *                         По умолчанию: `0`.
     *
     * @return array Массив данных для вывода изображения:
     *               - `'name_block'`         (string): Название блока изображения (например, "Лучшее фото").
     *               - `'url'`                (string): URL для просмотра полного изображения.
     *               - `'thumbnail_url'`      (string): URL для миниатюры изображения.
     *               - `'name'`               (string): Название изображения.
     *               - `'description'`        (string): Описание изображения.
     *               - `'category_name'`      (string): Название категории.
     *               - `'category_description'` (string): Описание категории.
     *               - `'rate'`               (string): Рейтинг изображения (например, "Рейтинг: 5/10").
     *               - `'url_user'`           (string|null): URL профиля пользователя, добавившего изображение.
     *               - `'real_name'`          (string): Реальное имя пользователя.
     *               - `'category_url'`       (string): URL категории или пользовательского альбома.
     *               - `'width'`              (int): Ширина изображения после масштабирования.
     *               - `'height'`             (int): Высота изображения после масштабирования.
     *
     * @throws InvalidArgumentException Выбрасывается, если передан недопустимый `$type` или `$id_photo < 0`.
     *                                  Пример сообщения:
     *                                      Некорректный идентификатор фотографии | Значение: {$id_photo}.
     * @throws RuntimeException         Выбрасывается, если файл изображения недоступен или не существует.
     * @throws Exception                Выбрасывается при записи ошибок в лог.
     *
     * @note    Если изображение недоступно, метод возвращает данные по умолчанию.
     *
     * @warning Убедитесь, что:
     *          - Пользователь имеет право на просмотр изображений.
     *          - Передаются допустимые значения для `$type` и `$id_photo`.
     *
     * Пример использования:
     * @code
     * // Создание объекта
     * $work = new Work();
     *
     * // Получение данных для вывода лучшего изображения
     * $top_photo = $work->create_photo('top');
     * print_r($top_photo);
     *
     * // Получение данных для вывода изображения из категории с ID = 5
     * $category_photo = $work->create_photo('cat', 5);
     * print_r($category_photo);
     * @endcode
     */
    public function create_photo(string $type = 'top', int $id_photo = 0): array;

    /**
     * @brief   Добавляет новую оценку в таблицу и возвращает среднюю оценку фотографии.
     *
     * @details Этот метод выполняет следующие действия:
     *          1. Проверяет корректность входных параметров `$table`, `$photo_id`, `$user_id` и `$rate_value`.
     *          2. Вставляет новую оценку в указанную таблицу.
     *          3. Пересчитывает среднюю оценку для фотографии автоматически через триггеры и функции в СУБД.
     *          4. Возвращает среднюю оценку для указанной фотографии или `0`, если оценок нет.
     *
     * @param string $table      Имя таблицы для вставки оценки:
     *                           - `'rate_user'`: Таблица с оценками фотографий от пользователей.
     *                           - `'rate_moder'`: Таблица с оценками фотографий от модераторов.
     * @param int    $photo_id   ID фотографии:
     *                           - Должен быть положительным целым числом.
     * @param int    $user_id    ID пользователя:
     *                           - Должен быть положительным целым числом.
     * @param int    $rate_value Значение оценки:
     *                           - Должен быть целым числом в диапазоне допустимых значений (например, 1–5).
     *
     * @return float Возвращает число с плавающей точкой, представляющее среднюю оценку.
     *               Если оценок нет, возвращается `0`.
     *
     * @throws InvalidArgumentException Выбрасывается, если переданы некорректные параметры.
     *                                  Пример сообщения:
     *                                      Некорректное значение параметра table | Ожидалось 'rate_user' или
     *                                      'rate_moder'.
     * @throws RuntimeException         Выбрасывается, если не удалось добавить оценку.
     *                                  Пример сообщения:
     *                                      Не удалось добавить оценку для фотографии с ID: {$photo_id}.
     * @throws Exception                При выполнении запросов к базам данных.
     *
     * @note    Метод автоматически пересчитывает среднюю оценку через триггеры и функции в СУБД.
     *
     * @warning Убедитесь, что:
     *          - Параметр `$table` соответствует одной из допустимых таблиц (`'rate_user'` или `'rate_moder'`).
     *          - В СУБД настроены триггеры и функции для перерасчета средней оценки.
     *
     * Пример использования:
     * @code
     * // Создание объекта
     * $work = new Work();
     *
     * // Добавление оценки и получение средней оценки
     * $averageRate = $work->process_rating('rate_user', 123, 456, 5);
     * echo "Средняя оценка: {$averageRate}";
     * @endcode
     */
    public function process_rating(string $table, int $photo_id, int $user_id, int $rate_value): float;

    /**
     * @brief   Формирует массив данных для меню в зависимости от типа и активного пункта.
     *
     * @details Этот метод выполняет следующие действия:
     *          1. Проверяет корректность входных параметров:
     *             - Тип меню должен быть равен одной из констант: SHORT_MENU или LONG_MENU.
     *             - Активный пункт меню должен быть строкой.
     *          2. Определяет тип меню:
     *             - SHORT_MENU: Краткое горизонтальное меню.
     *             - LONG_MENU: Полное вертикальное меню.
     *          3. Получает данные меню из базы данных:
     *             - Условие выборки зависит от типа меню.
     *             - Данные фильтруются на основе прав доступа текущего пользователя.
     *          4. Для каждого пункта меню проверяются права доступа:
     *             - Если пункт видим, он добавляется в результат.
     *             - URL формируется на основе активного пункта меню.
     *             - Название пункта локализуется с использованием языковых строк.
     *          Метод предназначен для создания данных меню.
     *
     * @param string $action Активный пункт меню:
     *                       - Указывается строка, соответствующая активному пункту меню (например, 'home', 'profile').
     * @param int    $menu   Тип меню:
     *                       - SHORT_MENU (0): Краткое горизонтальное меню.
     *                       - LONG_MENU (1): Полное вертикальное меню.
     *                       Другие значения недопустимы и приведут к выбросу исключения InvalidArgumentException.
     *
     * @return array Массив с данными для меню.
     *               Каждый элемент массива содержит:
     *               - Ключ 'url': URL пункта меню (null, если пункт активен).
     *               - Ключ 'name': Название пункта меню (локализованное или дефолтное значение).
     *               Если меню пустое, возвращается пустой массив.
     *
     * @throws InvalidArgumentException Выбрасывается, если передан некорректный $menu или $action.
     * @throws RuntimeException         Выбрасывается, если произошла ошибка при выполнении запроса к базе данных.
     * @throws Exception                При выполнении запросов к базам данных.
     *
     * @note    Данные для меню берутся из таблицы базы данных.
     *          Константы SHORT_MENU и LONG_MENU определяют тип меню:
     *          - SHORT_MENU: Краткое горизонтальное меню.
     *          - LONG_MENU: Полное вертикальное меню.
     *
     * @warning Убедитесь, что передаваемые параметры корректны, так как это может привести к ошибкам.
     *          Также убедитесь, что права доступа пользователя настроены правильно.
     *
     * Пример использования:
     * @code
     * // Создание объекта
     * $work = new Work();
     *
     * // Создание горизонтального меню
     * $short_menu = $work->create_menu('home', SHORT_MENU);
     * print_r($short_menu);
     *
     * // Создание вертикального меню
     * $long_menu = $work->create_menu('profile', LONG_MENU);
     * print_r($long_menu);
     * @endcode
     */
    public function create_menu(string $action, int $menu): array;

    /**
     * @brief   Формирует данные для блока пользователя.
     *
     * @details Этот метод выполняет следующие действия:
     *          1. Проверяет статус авторизации пользователя:
     *             - Если пользователь не авторизован, формируется блок со ссылками на вход, восстановление пароля
     *               и регистрацию.
     *             - Если пользователь авторизован, формируется блок с приветствием, группой и аватаром.
     *          2. Для авторизованных пользователей проверяется существование аватара:
     *             - Если аватар недоступен или имеет недопустимый формат, используется дефолтный аватар.
     *          3. Возвращает массив данных для блока пользователя, который используется для отображения в шаблоне.
     *
     * @return array Массив с данными для блока пользователя:
     *               - Для неавторизованных пользователей:
     *                 - 'NAME_BLOCK': Название блока (локализованное).
     *                 - 'CSRF_TOKEN': CSRF-токен для защиты формы.
     *                 - 'L_LOGIN', 'L_PASSWORD', 'L_ENTER', 'L_FORGOT_PASSWORD', 'L_REGISTRATION': Локализованные
     *                 строки.
     *                 - 'U_LOGIN', 'U_FORGOT_PASSWORD', 'U_REGISTRATION': URL для входа, восстановления пароля и
     *                 регистрации.
     *               - Для авторизованных пользователей:
     *                 - 'NAME_BLOCK': Название блока (локализованное).
     *                 - 'L_HI_USER': Приветствие с именем пользователя (локализованное).
     *                 - 'L_GROUP': Группа пользователя (локализованная строка).
     *                 - 'U_AVATAR': URL аватара (или дефолтного аватара, если файл недоступен или некорректен).
     *
     * @throws RuntimeException Выбрасывается, если объект пользователя не установлен или данные некорректны.
     * @throws Random\RandomException Выбрасывается при ошибке генерации CSRF-токена.
     * @throws Exception Выбрасывается при ошибках проверки MIME-типа файла или логирования.
     *
     * @note    Статус авторизации проверяется через внутренние данные пользователя.
     *          Дефолтный аватар определяется конфигурацией системы.
     *
     * @warning Убедитесь, что объект пользователя корректно установлен перед вызовом метода.
     *          Также убедитесь, что конфигурация аватаров настроена правильно.
     *
     * Пример использования:
     * @code
     * // Создание объекта
     * $work = new Work();
     *
     * // Формирование данных для блока пользователя
     * $userData = $work->template_user();
     * print_r($userData);
     * @endcode
     */
    public function template_user(): array;

    /**
     * @brief   Генерирует массив статистических данных для шаблона.
     *
     * @details Этот метод выполняет следующие действия:
     *          1. Выполняет запросы к базе данных для получения статистической информации:
     *             - Количество пользователей, администраторов и модераторов.
     *             - Количество категорий (включая пользовательские альбомы).
     *             - Количество фотографий.
     *             - Количество пользовательских и модераторских оценок.
     *             - Список онлайн-пользователей.
     *          2. Возвращает ассоциативный массив с локализованными подписями и данными для вывода статистики.
     *
     * @return array Ассоциативный массив данных для вывода статистики:
     *               - 'NAME_BLOCK': Название блока статистики (локализованное).
     *               - 'L_STAT_REGIST': Подпись для количества зарегистрированных пользователей.
     *               - 'D_STAT_REGIST': Количество зарегистрированных пользователей.
     *               - 'L_STAT_PHOTO': Подпись для количества фотографий.
     *               - 'D_STAT_PHOTO': Количество фотографий.
     *               - 'L_STAT_CATEGORY': Подпись для количества категорий.
     *               - 'D_STAT_CATEGORY': Количество категорий (включая пользовательские альбомы).
     *               - 'L_STAT_USER_ADMIN': Подпись для количества администраторов.
     *               - 'D_STAT_USER_ADMIN': Количество администраторов.
     *               - 'L_STAT_USER_MODER': Подпись для количества модераторов.
     *               - 'D_STAT_USER_MODER': Количество модераторов.
     *               - 'L_STAT_RATE_USER': Подпись для количества пользовательских оценок.
     *               - 'D_STAT_RATE_USER': Количество пользовательских оценок.
     *               - 'L_STAT_RATE_MODER': Подпись для количества модераторских оценок.
     *               - 'D_STAT_RATE_MODER': Количество модераторских оценок.
     *               - 'L_STAT_ONLINE': Подпись для онлайн-пользователей.
     *               - 'D_STAT_ONLINE': Список онлайн-пользователей (HTML-ссылки) или сообщение об отсутствии
     *                 онлайн-пользователей.
     *
     * @throws RuntimeException Выбрасывается при ошибке выполнения запросов к базе данных.
     * @throws Exception        При выполнении запросов к базам данных.
     *
     * @note    Данные берутся из таблиц и представлений базы данных:
     *          - Пользователи, администраторы, модераторы.
     *          - Категории и фотографии.
     *          - Оценки пользователей и модераторов.
     *          - Онлайн-пользователи.
     *
     * @warning Убедитесь, что структура базы данных корректна. Ошибки в структуре таблиц могут привести
     *          к некорректной статистике.
     *
     * Пример использования:
     * @code
     * // Создание объекта
     * $work = new Work();
     *
     * // Генерация статистических данных
     * $statData = $work->template_stat();
     * print_r($statData);
     * @endcode
     */
    public function template_stat(): array;

    /**
     * @brief   Формирует список пользователей, загрузивших наибольшее количество изображений.
     *
     * @details Этот метод выполняет следующие действия:
     *          1. Выполняет запрос к базе данных для получения списка пользователей с наибольшим количеством
     *          загруженных фотографий.
     *          2. Ограничивает количество результатов параметром $best_user.
     *          3. Возвращает массив данных для вывода в шаблон, включая ссылки на профили пользователей и количество
     *             загруженных фотографий.
     *          Если данные отсутствуют, добавляется запись "пустого" пользователя.
     *
     * @param int $best_user Количество лучших пользователей для вывода:
     *                       - Должно быть положительным целым числом.
     *                       - Если передано недопустимое значение, выбрасывается исключение InvalidArgumentException.
     *
     * @return array Массив данных для вывода в шаблон:
     *               - 'NAME_BLOCK': Название блока (локализованное).
     *               - 'L_USER_NAME': Подпись для имени пользователя (локализованная строка).
     *               - 'L_USER_PHOTO': Подпись для количества фотографий (локализованная строка).
     *               - 'user_url': Ссылка на профиль пользователя (null, если данных нет).
     *               - 'user_name': Имя пользователя ('---', если данных нет).
     *               - 'user_photo': Количество загруженных фотографий ('-', если данных нет).
     *
     * @throws InvalidArgumentException Выбрасывается, если параметр $best_user не является положительным целым числом.
     * @throws Exception                При выполнении запросов к базам данных.
     *
     * @note    Если запрос к базе данных не возвращает данных, добавляется запись "пустого" пользователя:
     *          - 'user_url': null.
     *          - 'user_name': '---'.
     *          - 'user_photo': '-'.
     *
     * @warning Убедитесь, что таблицы базы данных содержат корректные данные. Ошибки в структуре таблиц могут привести
     *          к некорректному результату.
     *
     * Пример использования:
     * @code
     * // Создание объекта
     * $work = new Work();
     *
     * // Формирование списка лучших пользователей
     * $bestUsers = $work->template_best_user(3);
     * print_r($bestUsers);
     * @endcode
     */
    public function template_best_user(int $best_user = 1): array;

    /**
     * @brief   Вычисляет размеры для вывода эскиза изображения.
     *
     * @details Этот метод выполняет следующие действия:
     *          1. Проверяет существование файла.
     *          2. Получает реальные размеры изображения.
     *          3. Вычисляет ширину и высоту эскиза на основе реальных размеров изображения и конфигурационных
     *          параметров:
     *             - `temp_photo_w`: Целевая ширина эскиза (в пикселях).
     *             - `temp_photo_h`: Целевая высота эскиза (в пикселях).
     *          4. Если изображение меньше целевого размера, возвращаются оригинальные размеры.
     *          5. В противном случае размеры масштабируются пропорционально.
     *
     * @param string $path_image Путь к файлу изображения:
     *                           - Путь должен быть абсолютным.
     *                           - Файл должен существовать и быть доступным для чтения.
     *
     * @return array Массив с шириной и высотой эскиза:
     *               - Ключ `'width'` (int): Ширина эскиза (целое число ≥ 0).
     *               - Ключ `'height'` (int): Высота эскиза (целое число ≥ 0).
     *               Размеры могут совпадать с оригинальными размерами изображения,
     *               если оно меньше целевого размера.
     *
     * @throws RuntimeException Выбрасывается в следующих случаях:
     *                           - Если файл не существует.
     *                           - Если не удалось получить размеры изображения.
     *
     * @warning Метод зависит от корректности данных в конфигурации (`temp_photo_w` и `temp_photo_h`).
     *          Если эти параметры некорректны, результат может быть непредсказуемым.
     *
     * Пример использования:
     * @code
     * // Создание объекта
     * $work = new Work();
     *
     * // Вычисление размеров эскиза для изображения
     * $path = '/path/to/image.jpg';
     * $sizes = $work->size_image($path);
     * echo "Ширина: {$sizes['width']}, Высота: {$sizes['height']}";
     * @endcode
     */
    public function size_image(string $path_image): array;

    /**
     * @brief   Изменяет размер изображения.
     *
     * @details Этот метод выполняет следующие действия:
     *          1. Проверяет корректность путей к исходному изображению и файлу эскиза.
     *          2. Проверяет существование и доступность исходного изображения для чтения.
     *          3. Проверяет доступность директории для сохранения эскиза для записи.
     *          4. Получает размеры исходного изображения и проверяет их на соответствие максимальным значениям.
     *          5. Рассчитывает размеры эскиза на основе конфигурации (`temp_photo_w`, `temp_photo_h`).
     *          6. Если файл эскиза уже существует и его размеры совпадают с расчётными, метод завершает работу.
     *          7. Определяет MIME-тип исходного изображения.
     *          8. Выбирает библиотеку для обработки изображения в следующем порядке приоритета:
     *             - GraphicsMagick (если доступен),
     *             - ImageMagick (если доступен),
     *             - GD (если предыдущие библиотеки недоступны или вызвали ошибку).
     *
     * @param string $full_path      Путь к исходному изображению:
     *                               - Путь должен быть абсолютным.
     *                               - Файл должен существовать и быть доступным для чтения.
     * @param string $thumbnail_path Путь для сохранения эскиза:
     *                               - Путь должен быть абсолютным.
     *                               - Директория должна быть доступна для записи.
     *
     * @return bool True, если операция выполнена успешно, иначе False.
     *
     * @throws InvalidArgumentException Выбрасывается, если пути к файлам некорректны или имеют недопустимый формат.
     * @throws RuntimeException         Выбрасывается, если возникли ошибки при проверке файлов, директорий или
     *                                  размеров изображения.
     * @throws Exception                Выбрасывается при возникновении ошибок логирования информации.
     *
     * @note    Метод использует следующие константы класса для ограничения размеров исходного изображения:
     *          - `MAX_IMAGE_WIDTH`: Максимальная ширина исходного изображения (в пикселях). Значение: 5000.
     *          - `MAX_IMAGE_HEIGHT`: Максимальная высота исходного изображения (в пикселях). Значение: 5000.
     *
     * @warning Метод зависит от корректности данных в конфигурации (`temp_photo_w`, `temp_photo_h`).
     *          Если эти параметры некорректны, результат может быть непредсказуемым.
     *          Убедитесь, что пути к файлам и директориям корректны перед вызовом метода.
     *
     * Пример использования:
     * @code
     * // Создание объекта
     * $work = new Work();
     *
     * // Изменение размера изображения
     * $full_path = '/path/to/source_image.jpg';
     * $thumbnail_path = '/path/to/thumbnail.jpg';
     * $success = $work->image_resize($full_path, $thumbnail_path);
     * if ($success) {
     *     echo "Эскиз успешно создан.";
     * } else {
     *     echo "Ошибка при создании эскиза.";
     * }
     * @endcode
     */
    public function image_resize(string $full_path, string $thumbnail_path): bool;

    /**
     * @brief   Возвращает данные для отсутствующего изображения.
     *
     * @details Этот метод формирует массив данных, который используется для представления информации об отсутствующем
     *          изображении. Это может быть полезно, например, если изображение не найдено или недоступно. Метод
     *          использует конфигурацию приложения для формирования URL-адресов и путей:
     *          - `site_url`: Базовый URL сайта.
     *          - `site_dir`: Базовая директория сайта.
     *          - `gallery_folder`: Директория для хранения изображений.
     *          - `thumbnail_folder`: Директория для хранения эскизов.
     *
     * @return array Массив данных об изображении или его отсутствии:
     *               - `'url'` (string): URL полноразмерного изображения.
     *               - `'thumbnail_url'` (string): URL эскиза изображения.
     *               - `'name'` (string): Название изображения. Значение по умолчанию: `'No photo'`.
     *               - `'description'` (string): Описание изображения. Значение по умолчанию: `'No photo available'`.
     *               - `'category_name'` (string): Название категории. Значение по умолчанию: `'No category'`.
     *               - `'category_description'` (string): Описание категории. Значение по умолчанию: `'No category
     *                 available'`.
     *               - `'rate'` (string): Рейтинг изображения. Значение по умолчанию: `'Rate: 0/0'`.
     *               - `'url_user'` (string): URL пользователя. Значение по умолчанию: пустая строка (`''`).
     *               - `'real_name'` (string): Имя пользователя. Значение по умолчанию: `'No user'`.
     *               - `'full_path'` (string): Полный путь к изображению. Формируется на основе конфигурации.
     *               - `'thumbnail_path'` (string): Полный путь к эскизу. Формируется на основе конфигурации.
     *               - `'file'` (string): Имя файла. Значение по умолчанию: `'no_foto.png'`.
     *
     * @warning Метод зависит от корректности данных в конфигурации (`site_url`, `site_dir`, `gallery_folder`,
     *          `thumbnail_folder`). Если эти параметры некорректны, результат может быть непредсказуемым.
     *
     * Пример использования:
     * @code
     * // Создание объекта
     * $work = new Work();
     *
     * // Получение данных для отсутствующего изображения
     * $noPhotoData = $work->no_photo();
     * echo "URL изображения: {$noPhotoData['url']}\n";
     * echo "Описание: {$noPhotoData['description']}\n";
     * @endcode
     */
    public function no_photo(): array;

    /**
     * @brief   Выводит изображение через HTTP.
     *
     * @details Этот метод выполняет следующие действия:
     *          1. Проверяет существование и доступность файла:
     *             - Если файл не существует или недоступен для чтения, отправляется HTTP-статус `404 Not Found`.
     *          2. Определяет MIME-тип файла:
     *             - Если MIME-тип не соответствует изображению, отправляется HTTP-статус `500 Internal Server Error`.
     *          3. Проверяет размер файла:
     *             - Если размер превышает 10 МБ или неизвестен, отправляется HTTP-статус `413 Payload Too Large`.
     *          4. Устанавливает заголовки для вывода изображения:
     *             - `Content-Type`: MIME-тип файла.
     *             - `Content-Disposition`: Имя файла для заголовка.
     *             - `Content-Length`: Размер файла.
     *             - Дополнительные заголовки безопасности.
     *          5. Отправляет содержимое файла через HTTP.
     *          6. Завершает выполнение скрипта после отправки заголовков и содержимого файла.
     *
     * @param string $full_path Полный путь к файлу:
     *                          - Путь должен быть абсолютным.
     *                          - Файл должен существовать и быть доступным для чтения.
     * @param string $name_file Имя файла для заголовка `Content-Disposition`:
     *                          - Имя должно быть корректным (например, без запрещённых символов).
     *
     * @return void Метод ничего не возвращает. Завершает выполнение скрипта после отправки заголовков и содержимого
     *              файла.
     *
     * @throws Exception Выбрасывается при возникновении ошибок логирования информации.
     *
     * @note    Метод завершает выполнение скрипта (`exit`), отправляя заголовки и содержимое файла.
     *          Дополнительные заголовки безопасности:
     *          - `X-Content-Type-Options: nosniff`
     *          - `X-Frame-Options: DENY`
     *          - `X-XSS-Protection: 1; mode=block`
     *          - `Referrer-Policy: no-referrer`
     *          - `Content-Security-Policy: default-src 'self'; img-src 'self' data:;`
     *
     * @warning Метод завершает выполнение скрипта (`exit`), отправляя заголовки и содержимое файла.
     *          Убедитесь, что файл существует и доступен для чтения перед вызовом метода.
     *
     * Пример использования:
     * @code
     * // Создание объекта
     * $work = new Work();
     *
     * // Вывод изображения через HTTP
     * $work->image_attach('/path/to/image.jpg', 'example.jpg');
     * @endcode
     */
    #[NoReturn] public function image_attach(string $full_path, string $name_file): void;

    /**
     * @brief   Корректировка расширения файла в соответствии с его MIME-типом.
     *
     * @details Этот метод выполняет следующие действия:
     *          1. Проверяет путь к файлу на корректность.
     *          2. Определяет реальный MIME-тип файла.
     *          3. Проверяет соответствие MIME-типа поддерживаемым форматам:
     *             - 'image/jpeg' -> 'jpg'
     *             - 'image/png' -> 'png'
     *             - 'image/gif' -> 'gif'
     *             - 'image/webp' -> 'webp'
     *             - 'image/tiff' -> 'tiff'
     *             - 'image/svg+xml' -> 'svg'
     *             - 'image/bmp' -> 'bmp'
     *             - 'image/x-icon' -> 'ico'
     *             - 'image/avif' -> 'avif'
     *             - 'image/heic' -> 'heic'
     *             - 'image/vnd.adobe.photoshop' -> 'psd'
     *             - 'image/x-canon-cr2' -> 'cr2'
     *             - 'image/x-nikon-nef' -> 'nef'
     *             - 'image/x-xbitmap' -> 'xbm'
     *             - 'image/x-portable-anymap' -> 'pnm'
     *             - 'image/x-pcx' -> 'pcx'
     *          4. Если расширение отсутствует или некорректное, оно добавляется или исправляется.
     *
     * @param string $full_path Полный путь к файлу:
     *                          - Путь должен быть абсолютным.
     *                          - Файл должен существовать и быть доступным для чтения.
     *
     * @return string Полный путь к файлу с правильным расширением:
     *                - Если расширение было изменено или добавлено, возвращается новый путь.
     *                - Если расширение уже корректное, возвращается исходный путь.
     *
     * @throws InvalidArgumentException Выбрасывается, если путь к файлу имеет недопустимый формат.
     * @throws RuntimeException         Выбрасывается, если:
     *                                  - MIME-тип файла не поддерживается.
     *                                  - Файл недоступен для чтения.
     * @throws Exception               Выбрасывается при возникновении ошибок логирования информации.
     *
     * @warning Метод завершает выполнение с ошибкой, если MIME-тип файла не поддерживается.
     *          Убедитесь, что файл существует и доступен для чтения перед вызовом метода.
     *
     * Пример использования:
     * @code
     * // Создание объекта
     * $work = new Work();
     *
     * // Корректировка расширения файла
     * $full_path = '/path/to/file_without_extension';
     * $corrected_path = $work->fix_file_extension($full_path);
     * echo "Исправленный путь: {$corrected_path}";
     * @endcode
     */
    public function fix_file_extension(string $full_path): string;

    /**
     * @brief   Удаляет директорию и её содержимое, предварительно проверяя права доступа.
     *
     * @details Этот метод выполняет следующие действия:
     *          1. Проверяет существование указанной директории.
     *          2. Проверяет права доступа к директории (должна быть доступна для записи).
     *          3. Рекурсивно удаляет все файлы и поддиректории внутри директории.
     *          4. Удаляет саму директорию.
     *
     * @param string $path Путь к директории:
     *                     - Должен быть строкой, указывающей на существующую директорию.
     *                     - Директория должна быть доступна для записи.
     *
     * @return bool Возвращает `true`, если директория успешно удалена.
     *
     * @throws RuntimeException Выбрасывается в следующих случаях:
     *                           - Если директория не существует.
     *                           - Если директория недоступна для записи.
     *                           - Если не удалось удалить файл или поддиректорию внутри директории.
     *                           - Если не удалось удалить саму директорию.
     *
     * @note    Метод рекурсивно удаляет все файлы и поддиректории внутри директории.
     *
     * @warning Используйте этот метод с осторожностью, так как удаление директории необратимо.
     *          Убедитесь, что переданная директория действительно должна быть удалена.
     *
     * Пример использования:
     * @code
     * // Создание объекта
     * $work = new Work();
     *
     * // Удаление директории
     * $path = '/path/to/directory';
     * $result = $work->remove_directory($path);
     * if ($result) {
     *     echo "Директория успешно удалена!";
     * }
     * @endcode
     */
    public function remove_directory(string $path): bool;

    /**
     * @brief   Создаёт директории для категории и копирует файлы `index.php`.
     *
     * @details Этот метод выполняет следующие действия:
     *          1. Формирует пути для директорий галереи и миниатюр на основе конфигурации.
     *          2. Проверяет права доступа к родительским директориям.
     *          3. Рекурсивно создаёт директории для галереи и миниатюр.
     *          4. Копирует и модифицирует файлы `index.php` для новых директорий.
     *
     * @param string $directory_name Имя директории:
     *                               - Должен быть строкой, содержащей только допустимые символы для имён директорий.
     *                               - Не должен содержать запрещённых символов (например, `\/:*?"<>|`).
     *
     * @return bool Возвращает `true`, если директории успешно созданы и файлы скопированы.
     *
     * @throws RuntimeException Выбрасывается в следующих случаях:
     *                           - Если родительская директория недоступна для записи.
     *                           - Если не удалось создать директории.
     *                           - Если исходные файлы `index.php` не существуют.
     *                           - Если не удалось прочитать или записать файлы `index.php`.
     *
     * @warning Используйте этот метод с осторожностью, так как он создаёт директории и изменяет файлы.
     *
     * Пример использования:
     * @code
     * // Создание объекта
     * $work = new Work();
     *
     * // Создание директорий для новой категории
     * $directoryName = 'new_category';
     * $result = $work->create_directory($directoryName);
     * if ($result) {
     *     echo "Директории успешно созданы!";
     * }
     * @endcode
     */
    public function create_directory(string $directory_name): bool;
}
